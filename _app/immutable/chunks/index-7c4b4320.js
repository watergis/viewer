import{K as Og,S as Ay,i as zy,s as Cy,l as jp,m as Vp,n as Np,h as Nu,p as $m,b as qp,E as Zp,L as Xm,o as Ug,M as jg,r as Vg,a as Ng,w as qg,u as Zg,c as Gg,x as $g,J as Wm,y as Xg,f as Wg,t as Hg,B as Kg}from"./index-826da4b2.js";import{w as Jg,_ as Yg}from"./preload-helper-fc38b599.js";var rh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function r1(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}function Qg(C){var w=C.default;if(typeof w=="function"){var A=function(){return w.apply(this,arguments)};A.prototype=w.prototype}else A={};return Object.defineProperty(A,"__esModule",{value:!0}),Object.keys(C).forEach(function(R){var q=Object.getOwnPropertyDescriptor(C,R);Object.defineProperty(A,R,q.get?q:{enumerable:!0,get:function(){return C[R]}})}),A}var qu={exports:{}};(function(C,w){(function(A,R){C.exports=R()})(rh,function(){var A,R,q;function Y(v,ce){if(!A)A=ce;else if(!R)R=ce;else{var Te="var sharedChunk = {}; ("+A+")(sharedChunk); ("+R+")(sharedChunk);",Oe={};A(Oe),q=ce(Oe),typeof window<"u"&&(q.workerUrl=window.URL.createObjectURL(new Blob([Te],{type:"text/javascript"})))}}Y(["exports"],function(v){var ce=Te;function Te(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}function Oe(i,e,r,s){const p=new ce(i,e,r,s);return function(m){return p.solve(m)}}Te.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var p=this.sampleCurveX(r)-i;if(Math.abs(p)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=p/m}var g=0,I=1;for(r=i,s=0;s<20&&(p=this.sampleCurveX(r),!(Math.abs(p-i)<e));s++)i>p?g=r:I=r,r=.5*(I-g)+g;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const Xe=Oe(.25,.1,.25,1);function xe(i,e,r){return Math.min(r,Math.max(e,i))}function dt(i,e,r){const s=r-e,p=((i-e)%s+s)%s+e;return p===e?r:p}function zt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let ci=1;function Ct(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function hr(i,e,r){const s={};for(const p in i)s[p]=e.call(r||this,i[p],p,i);return s}function wt(i,e,r){const s={};for(const p in i)e.call(r||this,i[p],p,i)&&(s[p]=i[p]);return s}function Et(i){return Array.isArray(i)?i.map(Et):typeof i=="object"&&i?hr(i,Et):i}const oi={};function Jt(i){oi[i]||(typeof console<"u"&&console.warn(i),oi[i]=!0)}function Kt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function pi(i){let e=0;for(let r,s,p=0,m=i.length,g=m-1;p<m;g=p++)r=i[p],s=i[g],e+=(s.x-r.x)*(r.y+s.y);return e}function or(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function zi(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,p,m)=>{const g=p||m;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let sn,Xr,fn=null;function lr(i){if(fn==null){const e=i.navigator?i.navigator.userAgent:null;fn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return fn}function Li(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Yr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,s.drawImage(i,0,0,i.width,i.height),s.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(sn||(sn=document.createElement("a")),sn.href=i,sn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Xr==null&&(Xr=matchMedia("(prefers-reduced-motion: reduce)")),Xr.matches)}};var Wt=Qr;function Qr(i,e){this.x=i,this.y=e}Qr.prototype={clone:function(){return new Qr(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),p=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qr.convert=function(i){return i instanceof Qr?i:Array.isArray(i)?new Qr(i[0],i[1]):i};const An={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Jn="mapbox-tiles";let kt,ti,si=500,Fi=50;function Oi(){typeof caches>"u"||kt||(kt=caches.open(Jn))}let Qi=1/0;const Ui={supported:!1,testSupport:function(i){!gi&&ir&&(vr?Ar(i):ji=i)}};let ji,ir,gi=!1,vr=!1;function Ar(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,ir),i.isContextLost())return;Ui.supported=!0}catch{}i.deleteTexture(e),gi=!0}typeof document<"u"&&(ir=document.createElement("img"),ir.onload=function(){ji&&Ar(ji),ji=null,vr=!0},ir.onerror=function(){gi=!0,ji=null},ir.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(zr);class Ht extends Error{constructor(e,r,s,p){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=p}}const jr=or()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Sr(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:jr(),signal:r.signal});let p=!1,m=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),((g,I,E)=>{if(m)return;const M=Date.now();fetch(s).then(L=>L.ok?((F,O,Z)=>{(i.type==="arrayBuffer"?F.arrayBuffer():i.type==="json"?F.json():F.text()).then($=>{m||(O&&Z&&function(te,ie,ve){if(Oi(),!kt)return;const Pe={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Ue,qe)=>Pe.headers.set(qe,Ue));const Me=zi(ie.headers.get("Cache-Control")||"");Me["no-store"]||(Me["max-age"]&&Pe.headers.set("Expires",new Date(ve+1e3*Me["max-age"]).toUTCString()),new Date(Pe.headers.get("Expires")).getTime()-ve<42e4||function(Ue,qe){if(ti===void 0)try{new Response(new ReadableStream),ti=!0}catch{ti=!1}ti?qe(Ue.body):Ue.blob().then(qe)}(ie,Ue=>{const qe=new Response(Ue,Pe);Oi(),kt&&kt.then(Ge=>Ge.put(function(Qe){const yt=Qe.indexOf("?");return yt<0?Qe:Qe.slice(0,yt)}(te.url),qe)).catch(Ge=>Jt(Ge.message))}))}(s,O,Z),p=!0,e(null,$,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch($=>{m||e(new Error($.message))})})(L,null,M):L.blob().then(F=>e(new Ht(L.status,L.statusText,i.url,F)))).catch(L=>{L.code!==20&&e(new Error(L.message))})})(),{cancel:()=>{m=!0,p||r.abort()}}}const Wr=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!or()){const s=i.url.substring(0,i.url.indexOf("://"));return(An.REGISTERED_PROTOCOLS[s]||Sr)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(jr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Sr(i,e);if(or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,p){const m=new XMLHttpRequest;m.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const g in s.headers)m.setRequestHeader(g,s.headers[g]);return s.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=s.credentials==="include",m.onerror=()=>{p(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(s.type==="json")try{g=JSON.parse(m.response)}catch(I){return p(I)}p(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const g=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});p(new Ht(m.status,m.statusText,s.url,g))}},m.send(s.body),{cancel:()=>m.abort()}}(i,e)},Eo=function(i,e){return Wr(zt(i,{type:"arrayBuffer"}),e)};function to(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const po="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let en,jn;en=[],jn=0;const Go=function(i,e){if(Ui.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),jn>=An.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return en.push(m),m}jn++;let r=!1;const s=()=>{if(!r)for(r=!0,jn--;en.length&&jn<An.MAX_PARALLEL_IMAGE_REQUESTS;){const m=en.shift(),{requestParameters:g,callback:I,cancelled:E}=m;E||(m.cancel=Go(g,I).cancel)}},p=Eo(i,(m,g,I,E)=>{s(),m?e(m):g&&function(M,L){typeof createImageBitmap=="function"?function(F,O){const Z=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(Z).then($=>{O(null,$)}).catch($=>{O(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,L):function(F,O){const Z=new Image;Z.onload=()=>{O(null,Z),URL.revokeObjectURL(Z.src),Z.onload=null,window.requestAnimationFrame(()=>{Z.src=po})},Z.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Blob([new Uint8Array(F)],{type:"image/png"});Z.src=F.byteLength?URL.createObjectURL($):po}(M,L)}(g,(M,L)=>{M!=null?e(M):L!=null&&e(null,L,{cacheControl:I,expires:E})})});return{cancel:()=>{p.cancel(),s()}}};function Si(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function wn(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class io{constructor(e,r={}){zt(this,r),this.type=e}}class zn extends io{constructor(e,r={}){super("error",zt({error:e},r))}}class Sa{on(e,r){return this._listeners=this._listeners||{},Si(e,r,this._listeners),this}off(e,r){return wn(e,r,this._listeners),wn(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Si(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new io(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const p=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const I of p)I.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const I of m)wn(s,I,this._oneTimeListeners),I.call(this,e);const g=this._eventedParent;g&&(zt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof zn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ot={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Mt{constructor(e,r,s,p){this.message=(e?`${e}: `:"")+s,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function Bo(i){const e=i.value;return e?[new Mt(i.key,e,"constants have been deprecated as of v8")]:[]}function ro(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}function pr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Cn(i){if(Array.isArray(i))return i.map(Cn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Cn(i[r]);return e}return pr(i)}class mn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class fo{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,p]of r)this.bindings[s]=p}concat(e){return new fo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const xr={kind:"null"},St={kind:"number"},Mi={kind:"string"},Ii={kind:"boolean"},tn={kind:"color"},Pn={kind:"object"},_i={kind:"value"},mo={kind:"collator"},Vn={kind:"formatted"},ar={kind:"resolvedImage"};function W(i,e){return{kind:"array",itemType:i,N:e}}function Q(i){if(i.kind==="array"){const e=Q(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const re=[xr,St,Mi,Ii,tn,Vn,Pn,W(_i),ar];function he(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!he(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of re)if(!he(r,e))return null}}return`Expected ${Q(i)} but found ${Q(e)} instead.`}function be(i,e){return e.some(r=>r.kind===i.kind)}function De(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var Fe,Le={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ye(i){return(i=Math.round(i))<0?0:i>255?255:i}function ke(i){return ye(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function ee(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function V(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{Fe={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in Le)return Le[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),p=r.indexOf(")");if(s!==-1&&p+1===r.length){var m=r.substr(0,s),g=r.substr(s+1,p-(s+1)).split(","),I=1;switch(m){case"rgba":if(g.length!==4)return null;I=ee(g.pop());case"rgb":return g.length!==3?null:[ke(g[0]),ke(g[1]),ke(g[2]),I];case"hsla":if(g.length!==4)return null;I=ee(g.pop());case"hsl":if(g.length!==3)return null;var E=(parseFloat(g[0])%360+360)%360/360,M=ee(g[1]),L=ee(g[2]),F=L<=.5?L*(M+1):L+M-L*M,O=2*L-F;return[ye(255*V(O,F,E+1/3)),ye(255*V(O,F,E)),ye(255*V(O,F,E-1/3)),I];default:return null}}return null}}catch{}class j{constructor(e,r,s,p=1){this.r=e,this.g=r,this.b=s,this.a=p}static parse(e){if(!e)return;if(e instanceof j)return e;if(typeof e!="string")return;const r=Fe(e);return r?new j(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${p})`}toArray(){const{r:e,g:r,b:s,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*s/p,p]}}j.black=new j(0,0,0,1),j.white=new j(1,1,1,1),j.transparent=new j(0,0,0,0),j.red=new j(1,0,0,1);class J{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ne{constructor(e,r,s,p,m){this.text=e,this.image=r,this.scale=s,this.fontStack=p,this.textColor=m}}class pe{constructor(e){this.sections=e}static fromString(e){return new pe([new ne(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof pe?e:pe.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class Ie{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ie({name:e,available:!1}):null}serialize(){return["image",this.name]}}function le(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _e(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof j||i instanceof J||i instanceof pe||i instanceof Ie)return!0;if(Array.isArray(i)){for(const e of i)if(!_e(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!_e(i[e]))return!1;return!0}return!1}function de(i){if(i===null)return xr;if(typeof i=="string")return Mi;if(typeof i=="boolean")return Ii;if(typeof i=="number")return St;if(i instanceof j)return tn;if(i instanceof J)return mo;if(i instanceof pe)return Vn;if(i instanceof Ie)return ar;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const p=de(s);if(r){if(r===p)continue;r=_i;break}r=p}return W(r||_i,e)}return Pn}function $e(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof j||i instanceof pe||i instanceof Ie?i.toString():JSON.stringify(i)}class Ke{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!_e(e[1]))return r.error("invalid value");const s=e[1];let p=de(s);const m=r.expectedType;return p.kind!=="array"||p.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(p=m),new Ke(p,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof j?["rgba"].concat(this.value.toArray()):this.value instanceof pe?this.value.serialize():this.value}}class Be{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xt={string:Mi,number:St,boolean:Ii,object:Pn};class ht{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,p=1;const m=e[0];if(m==="array"){let I,E;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in xt)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);I=xt[M],p++}else I=_i;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],p++}s=W(I,E)}else s=xt[m];const g=[];for(;p<e.length;p++){const I=r.parse(e[p],p,_i);if(!I)return null;g.push(I)}return new ht(s,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!he(this.type,de(s)))return s;if(r===this.args.length-1)throw new Be(`Expected value to be of type ${Q(this.type)}, but found ${Q(de(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const p=e.N;(typeof p=="number"||this.args.length>1)&&r.push(p)}}return r.concat(this.args.map(s=>s.serialize()))}}class bt{constructor(e){this.type=Vn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const p=[];let m=!1;for(let g=1;g<=e.length-1;++g){const I=e[g];if(m&&typeof I=="object"&&!Array.isArray(I)){m=!1;let E=null;if(I["font-scale"]&&(E=r.parse(I["font-scale"],1,St),!E))return null;let M=null;if(I["text-font"]&&(M=r.parse(I["text-font"],1,W(Mi)),!M))return null;let L=null;if(I["text-color"]&&(L=r.parse(I["text-color"],1,tn),!L))return null;const F=p[p.length-1];F.scale=E,F.font=M,F.textColor=L}else{const E=r.parse(e[g],1,_i);if(!E)return null;const M=E.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new bt(p)}evaluate(e){return new pe(this.sections.map(r=>{const s=r.content.evaluate(e);return de(s)===ar?new ne("",s,null,null,null):new ne($e(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class Rt{constructor(e){this.type=ar,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Mi);return s?new Rt(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Ie.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Zt={"to-boolean":Ii,"to-color":tn,"to-number":St,"to-string":Mi};class Yt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const p=Zt[s],m=[];for(let g=1;g<e.length;g++){const I=r.parse(e[g],g,_i);if(!I)return null;m.push(I)}return new Yt(p,m)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,s;for(const p of this.args){if(r=p.evaluate(e),s=null,r instanceof j)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:le(r[0],r[1],r[2],r[3]),!s))return new j(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Be(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new Be(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?pe.fromString($e(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ie.fromString($e(this.args[0].evaluate(e))):$e(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new bt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Rt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const ii=["Unknown","Point","LineString","Polygon"];class qt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ii[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=j.parse(e)),r}}class It{constructor(e,r,s,p){this.name=e,this.type=r,this._evaluate=s,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],p=It.definitions[s];if(!p)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(p)?p[0]:p.type,g=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,I=g.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let E=null;for(const[M,L]of I){E=new ia(r.registry,r.path,null,r.scope);const F=[];let O=!1;for(let Z=1;Z<e.length;Z++){const $=e[Z],te=Array.isArray(M)?M[Z-1]:M.type,ie=E.parse($,1+F.length,te);if(!ie){O=!0;break}F.push(ie)}if(!O)if(Array.isArray(M)&&M.length!==F.length)E.error(`Expected ${M.length} arguments, but found ${F.length} instead.`);else{for(let Z=0;Z<F.length;Z++){const $=Array.isArray(M)?M[Z]:M.type,te=F[Z];E.concat(Z+1).checkSubtype($,te.type)}if(E.errors.length===0)return new It(s,m,L,F)}}if(I.length===1)r.errors.push(...E.errors);else{const M=(I.length?I:g).map(([F])=>{return O=F,Array.isArray(O)?`(${O.map(Q).join(", ")})`:`(${Q(O.type)}...)`;var O}).join(" | "),L=[];for(let F=1;F<e.length;F++){const O=r.parse(e[F],1+L.length);if(!O)return null;L.push(Q(O.type))}r.error(`Expected arguments of type ${M}, but found (${L.join(", ")}) instead.`)}return null}static register(e,r){It.definitions=r;for(const s in r)e[s]=It}}class Rr{constructor(e,r,s){this.type=mo,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const p=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ii);if(!p)return null;const m=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ii);if(!m)return null;let g=null;return s.locale&&(g=r.parse(s.locale,1,Mi),!g)?null:new Rr(p,m,g)}evaluate(e){return new J(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ri=8192;function Vr(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ln(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function rn(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*ri),Math.round(s*p*ri)]}function Mn(i,e,r){const s=i[0]-e[0],p=i[1]-e[1],m=i[0]-r[0],g=i[1]-r[1];return s*g-m*p==0&&s*m<=0&&p*g<=0}function br(i,e){let r=!1;for(let g=0,I=e.length;g<I;g++){const E=e[g];for(let M=0,L=E.length;M<L-1;M++){if(Mn(i,E[M],E[M+1]))return!1;(p=E[M])[1]>(s=i)[1]!=(m=E[M+1])[1]>s[1]&&s[0]<(m[0]-p[0])*(s[1]-p[1])/(m[1]-p[1])+p[0]&&(r=!r)}}var s,p,m;return r}function ja(i,e){for(let r=0;r<e.length;r++)if(br(i,e[r]))return!0;return!1}function Hr(i,e,r,s){const p=s[0]-r[0],m=s[1]-r[1],g=(i[0]-r[0])*m-p*(i[1]-r[1]),I=(e[0]-r[0])*m-p*(e[1]-r[1]);return g>0&&I<0||g<0&&I>0}function $o(i,e,r){for(const M of r)for(let L=0;L<M.length-1;++L)if((I=[(g=M[L+1])[0]-(m=M[L])[0],g[1]-m[1]])[0]*(E=[(p=e)[0]-(s=i)[0],p[1]-s[1]])[1]-I[1]*E[0]!=0&&Hr(s,p,m,g)&&Hr(m,g,s,p))return!0;var s,p,m,g,I,E;return!1}function no(i,e){for(let r=0;r<i.length;++r)if(!br(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if($o(i[r],i[r+1],e))return!1;return!0}function Ir(i,e){for(let r=0;r<e.length;r++)if(no(i,e[r]))return!0;return!1}function Dn(i,e,r){const s=[];for(let p=0;p<i.length;p++){const m=[];for(let g=0;g<i[p].length;g++){const I=rn(i[p][g],r);Vr(e,I),m.push(I)}s.push(m)}return s}function yn(i,e,r){const s=[];for(let p=0;p<i.length;p++){const m=Dn(i[p],e,r);s.push(m)}return s}function Nn(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const p=.5*s;let m=i[0]-r[0]>p?-s:r[0]-i[0]>p?s:0;m===0&&(m=i[0]-r[2]>p?-s:r[2]-i[0]>p?s:0),i[0]+=m}Vr(e,i)}function Xo(i,e,r,s){const p=Math.pow(2,s.z)*ri,m=[s.x*ri,s.y*ri],g=[];for(const I of i)for(const E of I){const M=[E.x+m[0],E.y+m[1]];Nn(M,e,r,p),g.push(M)}return g}function xu(i,e,r,s){const p=Math.pow(2,s.z)*ri,m=[s.x*ri,s.y*ri],g=[];for(const E of i){const M=[];for(const L of E){const F=[L.x+m[0],L.y+m[1]];Vr(e,F),M.push(F)}g.push(M)}if(e[2]-e[0]<=p/2){(I=e)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const E of g)for(const M of E)Nn(M,e,r,p)}var I;return g}class Tn{constructor(e,r){this.type=Ii,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(_e(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let p=0;p<s.features.length;++p){const m=s.features[p].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Tn(s,s.features[p].geometry)}else if(s.type==="Feature"){const p=s.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Tn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Tn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(s.type==="Polygon"){const I=Dn(s.coordinates,m,g),E=Xo(r.geometry(),p,m,g);if(!ln(p,m))return!1;for(const M of E)if(!br(M,I))return!1}if(s.type==="MultiPolygon"){const I=yn(s.coordinates,m,g),E=Xo(r.geometry(),p,m,g);if(!ln(p,m))return!1;for(const M of E)if(!ja(M,I))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(s.type==="Polygon"){const I=Dn(s.coordinates,m,g),E=xu(r.geometry(),p,m,g);if(!ln(p,m))return!1;for(const M of E)if(!no(M,I))return!1}if(s.type==="MultiPolygon"){const I=yn(s.coordinates,m,g),E=xu(r.geometry(),p,m,g);if(!ln(p,m))return!1;for(const M of E)if(!Ir(M,I))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Rs(i){if(i instanceof It&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Tn)return!1;let e=!0;return i.eachChild(r=>{e&&!Rs(r)&&(e=!1)}),e}function oo(i){if(i instanceof It&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!oo(r)&&(e=!1)}),e}function Zr(i,e){if(i instanceof It&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Zr(s,e)&&(r=!1)}),r}class Nr{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Nr(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ia{constructor(e,r=[],s,p=new fo,m=[]){this.registry=e,this.path=r,this.key=r.map(g=>`[${g}]`).join(""),this.scope=p,this.errors=m,this.expectedType=s}parse(e,r,s,p,m={}){return r?this.concat(r,s,p)._parse(e,m):this._parse(e,m)}_parse(e,r){function s(p,m,g){return g==="assert"?new ht(m,[p]):g==="coerce"?new Yt(m,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[p];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const I=this.expectedType,E=g.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||E.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(I,E))return null}else g=s(g,I,r.typeAnnotation||"coerce");else g=s(g,I,r.typeAnnotation||"assert")}if(!(g instanceof Ke)&&g.type.kind!=="resolvedImage"&&Ia(g)){const I=new qt;try{g=new Ke(g.type,g.evaluate(I))}catch(E){return this.error(E.message),null}}return g}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const p=typeof e=="number"?this.path.concat(e):this.path,m=s?this.scope.concat(s):this.scope;return new ia(this.registry,p,r||null,m,this.errors)}error(e,...r){const s=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new mn(s,e))}checkSubtype(e,r){const s=he(e,r);return s&&this.error(s),s}}function Ia(i){if(i instanceof Nr)return Ia(i.boundExpression);if(i instanceof It&&i.name==="error"||i instanceof Rr||i instanceof Tn)return!1;const e=i instanceof Yt||i instanceof ht;let r=!0;return i.eachChild(s=>{r=e?r&&Ia(s):r&&s instanceof Ke}),!!r&&Rs(i)&&Zr(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function vl(i,e){const r=i.length-1;let s,p,m=0,g=r,I=0;for(;m<=g;)if(I=Math.floor((m+g)/2),s=i[I],p=i[I+1],s<=e){if(I===r||e<p)return I;m=I+1}else{if(!(s>e))throw new Be("Input is not a number.");g=I-1}return 0}class Bs{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[p,m]of s)this.labels.push(p),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,St);if(!s)return null;const p=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=1;g<e.length;g+=2){const I=g===1?-1/0:e[g],E=e[g+1],M=g,L=g+1;if(typeof I!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=I)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const F=r.parse(E,L,m);if(!F)return null;m=m||F.type,p.push([I,F])}return new Bs(m,s,p)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return s[0].evaluate(e);const m=r.length;return p>=r[m-1]?s[m-1].evaluate(e):s[vl(r,p)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function Kr(i,e,r){return i*(1-r)+e*r}var Fs=Object.freeze({__proto__:null,number:Kr,color:function(i,e,r){return new j(Kr(i.r,e.r,r),Kr(i.g,e.g,r),Kr(i.b,e.b,r),Kr(i.a,e.a,r))},array:function(i,e,r){return i.map((s,p)=>Kr(s,e[p],r))}});const xl=.95047,bu=1.08883,bl=4/29,Va=6/29,hs=3*Va*Va,Os=Math.PI/180,wu=180/Math.PI;function ps(i){return i>.008856451679035631?Math.pow(i,1/3):i/hs+bl}function Us(i){return i>Va?i*i*i:hs*(i-bl)}function Ln(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ra(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function na(i){const e=ra(i.r),r=ra(i.g),s=ra(i.b),p=ps((.4124564*e+.3575761*r+.1804375*s)/xl),m=ps((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*m-16,a:500*(p-m),b:200*(m-ps((.0193339*e+.119192*r+.9503041*s)/bu)),alpha:i.a}}function Wi(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*Us(e),r=xl*Us(r),s=bu*Us(s),new j(Ln(3.2404542*r-1.5371385*e-.4985314*s),Ln(-.969266*r+1.8760108*e+.041556*s),Ln(.0556434*r-.2040259*e+1.0572252*s),i.alpha)}function Ea(i,e,r){const s=e-i;return i+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const ko={forward:na,reverse:Wi,interpolate:function(i,e,r){return{l:Kr(i.l,e.l,r),a:Kr(i.a,e.a,r),b:Kr(i.b,e.b,r),alpha:Kr(i.alpha,e.alpha,r)}}},yo={forward:function(i){const{l:e,a:r,b:s}=na(i),p=Math.atan2(s,r)*wu;return{h:p<0?p+360:p,c:Math.sqrt(r*r+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Os,r=i.c;return Wi({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Ea(i.h,e.h,r),c:Kr(i.c,e.c,r),l:Kr(i.l,e.l,r),alpha:Kr(i.alpha,e.alpha,r)}}};var Ao=Object.freeze({__proto__:null,lab:ko,hcl:yo});class rr{constructor(e,r,s,p,m){this.type=e,this.operator=r,this.interpolation=s,this.input=p,this.labels=[],this.outputs=[];for(const[g,I]of m)this.labels.push(g),this.outputs.push(I)}static interpolationFactor(e,r,s,p){let m=0;if(e.name==="exponential")m=ds(r,e.base,s,p);else if(e.name==="linear")m=ds(r,1,s,p);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new ce(g[0],g[1],g[2],g[3]).solve(ds(r,1,s,p))}return m}static parse(e,r){let[s,p,m,...g]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some(L=>typeof L!="number"||L<0||L>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,St),!m)return null;const I=[];let E=null;s==="interpolate-hcl"||s==="interpolate-lab"?E=tn:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let M=0;M<g.length;M+=2){const L=g[M],F=g[M+1],O=M+3,Z=M+4;if(typeof L!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(I.length&&I[I.length-1][0]>=L)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const $=r.parse(F,Z,E);if(!$)return null;E=E||$.type,I.push([L,$])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new rr(E,s,p,m,I):r.error(`Type ${Q(E)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return s[0].evaluate(e);const m=r.length;if(p>=r[m-1])return s[m-1].evaluate(e);const g=vl(r,p),I=rr.interpolationFactor(this.interpolation,p,r[g],r[g+1]),E=s[g].evaluate(e),M=s[g+1].evaluate(e);return this.operator==="interpolate"?Fs[this.type.kind.toLowerCase()](E,M,I):this.operator==="interpolate-hcl"?yo.reverse(yo.interpolate(yo.forward(E),yo.forward(M),I)):ko.reverse(ko.interpolate(ko.forward(E),ko.forward(M),I))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function ds(i,e,r,s){const p=s-r,m=i-r;return p===0?0:e===1?m/p:(Math.pow(e,m)-1)/(Math.pow(e,p)-1)}class js{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const p=r.expectedType;p&&p.kind!=="value"&&(s=p);const m=[];for(const I of e.slice(1)){const E=r.parse(I,1+m.length,s,void 0,{typeAnnotation:"omit"});if(!E)return null;s=s||E.type,m.push(E)}const g=p&&m.some(I=>he(p,I.type));return new js(g?_i:s,m)}evaluate(e){let r,s=null,p=0;for(const m of this.args)if(p++,s=m.evaluate(e),s&&s instanceof Ie&&!s.available&&(r||(r=s.name),s=null,p===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class wl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const I=r.parse(e[m+1],m+1);if(!I)return null;s.push([g,I])}const p=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return p?new wl(s,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}class Gl{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,St),p=r.parse(e[2],2,W(r.expectedType||_i));return s&&p?new Gl(p.type.itemType,s,p):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Be(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Be(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Be(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vs{constructor(e,r){this.type=Ii,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,_i),p=r.parse(e[2],2,_i);return s&&p?be(s.type,[Ii,Mi,St,xr,_i])?new Vs(s,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!De(r,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${Q(de(r))} instead.`);if(!De(s,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${Q(de(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class fs{constructor(e,r,s){this.type=St,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,_i),p=r.parse(e[2],2,_i);if(!s||!p)return null;if(!be(s.type,[Ii,Mi,St,xr,_i]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(s.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,St);return m?new fs(s,p,m):null}return new fs(s,p)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!De(r,["boolean","string","number","null"]))throw new Be(`Expected first argument to be of type boolean, string, number or null, but found ${Q(de(r))} instead.`);if(!De(s,["string","array"]))throw new Be(`Expected second argument to be of type array or string, but found ${Q(de(s))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return s.indexOf(r,p)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ns{constructor(e,r,s,p,m,g){this.inputType=e,this.type=r,this.input=s,this.cases=p,this.outputs=m,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const m={},g=[];for(let M=2;M<e.length-1;M+=2){let L=e[M];const F=e[M+1];Array.isArray(L)||(L=[L]);const O=r.concat(M);if(L.length===0)return O.error("Expected at least one branch label.");for(const $ of L){if(typeof $!="number"&&typeof $!="string")return O.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return O.error("Numeric branch labels must be integer values.");if(s){if(O.checkSubtype(s,de($)))return null}else s=de($);if(m[String($)]!==void 0)return O.error("Branch labels must be unique.");m[String($)]=g.length}const Z=r.parse(F,M,p);if(!Z)return null;p=p||Z.type,g.push(Z)}const I=r.parse(e[1],1,_i);if(!I)return null;const E=r.parse(e[e.length-1],e.length-1,p);return E?I.type.kind!=="value"&&r.concat(1).checkSubtype(s,I.type)?null:new Ns(s,p,I,m,g,E):null}evaluate(e){const r=this.input.evaluate(e);return(de(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],p={};for(const g of r){const I=p[this.cases[g]];I===void 0?(p[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[I][1].push(g)}const m=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,I]of s)e.push(I.length===1?m(I[0]):I.map(m)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class qs{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const p=[];for(let g=1;g<e.length-1;g+=2){const I=r.parse(e[g],g,Ii);if(!I)return null;const E=r.parse(e[g+1],g+1,s);if(!E)return null;p.push([I,E]),s=s||E.type}const m=r.parse(e[e.length-1],e.length-1,s);return m?new qs(s,p,m):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Zs{constructor(e,r,s,p){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,_i),p=r.parse(e[2],2,St);if(!s||!p)return null;if(!be(s.type,[W(_i),Mi,_i]))return r.error(`Expected first argument to be of type array or string, but found ${Q(s.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,St);return m?new Zs(s.type,s,p,m):null}return new Zs(s.type,s,p)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!De(r,["string","array"]))throw new Be(`Expected first argument to be of type array or string, but found ${Q(de(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return r.slice(s,p)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function $l(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Tu(i,e,r,s){return s.compare(e,r)===0}function Wo(i,e,r){const s=i!=="=="&&i!=="!=";return class Py{constructor(m,g,I){this.type=Ii,this.lhs=m,this.rhs=g,this.collator=I,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const I=m[0];let E=g.parse(m[1],1,_i);if(!E)return null;if(!$l(I,E.type))return g.concat(1).error(`"${I}" comparisons are not supported for type '${Q(E.type)}'.`);let M=g.parse(m[2],2,_i);if(!M)return null;if(!$l(I,M.type))return g.concat(2).error(`"${I}" comparisons are not supported for type '${Q(M.type)}'.`);if(E.type.kind!==M.type.kind&&E.type.kind!=="value"&&M.type.kind!=="value")return g.error(`Cannot compare types '${Q(E.type)}' and '${Q(M.type)}'.`);s&&(E.type.kind==="value"&&M.type.kind!=="value"?E=new ht(M.type,[E]):E.type.kind!=="value"&&M.type.kind==="value"&&(M=new ht(E.type,[M])));let L=null;if(m.length===4){if(E.type.kind!=="string"&&M.type.kind!=="string"&&E.type.kind!=="value"&&M.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(L=g.parse(m[3],3,mo),!L)return null}return new Py(E,M,L)}evaluate(m){const g=this.lhs.evaluate(m),I=this.rhs.evaluate(m);if(s&&this.hasUntypedArgument){const E=de(g),M=de(I);if(E.kind!==M.kind||E.kind!=="string"&&E.kind!=="number")throw new Be(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const E=de(g),M=de(I);if(E.kind!=="string"||M.kind!=="string")return e(m,g,I)}return this.collator?r(m,g,I,this.collator.evaluate(m)):e(m,g,I)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[i];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const Gs=Wo("==",function(i,e,r){return e===r},Tu),Su=Wo("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!Tu(0,e,r,s)}),Sn=Wo("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),Xl=Wo(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),ka=Wo("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),Aa=Wo(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class oa{constructor(e,r,s,p,m){this.type=Mi,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,St);if(!s)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let m=null;if(p.locale&&(m=r.parse(p.locale,1,Mi),!m))return null;let g=null;if(p.currency&&(g=r.parse(p.currency,1,Mi),!g))return null;let I=null;if(p["min-fraction-digits"]&&(I=r.parse(p["min-fraction-digits"],1,St),!I))return null;let E=null;return p["max-fraction-digits"]&&(E=r.parse(p["max-fraction-digits"],1,St),!E)?null:new oa(s,m,g,I,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class aa{constructor(e){this.type=St,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Q(s.type)} instead.`):new aa(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Be(`Expected value to be of type string or array, but found ${Q(de(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const go={"==":Gs,"!=":Su,">":Xl,"<":Sn,">=":Aa,"<=":ka,array:ht,at:Gl,boolean:ht,case:qs,coalesce:js,collator:Rr,format:bt,image:Rt,in:Vs,"index-of":fs,interpolate:rr,"interpolate-hcl":rr,"interpolate-lab":rr,length:aa,let:wl,literal:Ke,match:Ns,number:ht,"number-format":oa,object:ht,slice:Zs,step:Bs,string:ht,"to-boolean":Yt,"to-color":Yt,"to-number":Yt,"to-string":Yt,var:Nr,within:Tn};function za(i,[e,r,s,p]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const m=p?p.evaluate(i):1,g=le(e,r,s,m);if(g)throw new Be(g);return new j(e/255*m,r/255*m,s/255*m,m)}function Ca(i,e){return i in e}function Ho(i,e){const r=e[i];return r===void 0?null:r}function Pa(i){return{type:i}}function Er(i){return{result:"success",value:i}}function zo(i){return{result:"error",value:i}}function sa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Wl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Tl(i){return!!i.expression&&i.expression.interpolated}function Ei(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function $s(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function dr(i){return i}function Fo(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",p=s||!(s||i.property!==void 0),m=i.type||(Tl(e)?"exponential":"interval");if(r&&((i=ro({},i)).stops&&(i.stops=i.stops.map(M=>[M[0],j.parse(M[1])])),i.default=j.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Ao[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let g,I,E;if(m==="exponential")g=Sl;else if(m==="interval")g=Xs;else if(m==="categorical"){g=Cr,I=Object.create(null);for(const M of i.stops)I[M[0]]=M[1];E=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=Hl}if(s){const M={},L=[];for(let Z=0;Z<i.stops.length;Z++){const $=i.stops[Z],te=$[0].zoom;M[te]===void 0&&(M[te]={zoom:te,type:i.type,property:i.property,default:i.default,stops:[]},L.push(te)),M[te].stops.push([$[0].value,$[1]])}const F=[];for(const Z of L)F.push([M[Z].zoom,Fo(M[Z],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:rr.interpolationFactor.bind(void 0,O),zoomStops:F.map(Z=>Z[0]),evaluate:({zoom:Z},$)=>Sl({stops:F,base:i.base},e,Z).evaluate(Z,$)}}if(p){const M=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:rr.interpolationFactor.bind(void 0,M),zoomStops:i.stops.map(L=>L[0]),evaluate:({zoom:L})=>g(i,e,L,I,E)}}return{kind:"source",evaluate(M,L){const F=L&&L.properties?L.properties[i.property]:void 0;return F===void 0?ur(i.default,e.default):g(i,e,F,I,E)}}}function ur(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Cr(i,e,r,s,p){return ur(typeof r===p?s[r]:void 0,i.default,e.default)}function Xs(i,e,r){if(Ei(r)!=="number")return ur(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const p=vl(i.stops.map(m=>m[0]),r);return i.stops[p][1]}function Sl(i,e,r){const s=i.base!==void 0?i.base:1;if(Ei(r)!=="number")return ur(i.default,e.default);const p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];const m=vl(i.stops.map(L=>L[0]),r),g=function(L,F,O,Z){const $=Z-O,te=L-O;return $===0?0:F===1?te/$:(Math.pow(F,te)-1)/(Math.pow(F,$)-1)}(r,s,i.stops[m][0],i.stops[m+1][0]),I=i.stops[m][1],E=i.stops[m+1][1];let M=Fs[e.type]||dr;if(i.colorSpace&&i.colorSpace!=="rgb"){const L=Ao[i.colorSpace];M=(F,O)=>L.reverse(L.interpolate(L.forward(F),L.forward(O),g))}return typeof I.evaluate=="function"?{evaluate(...L){const F=I.evaluate.apply(void 0,L),O=E.evaluate.apply(void 0,L);if(F!==void 0&&O!==void 0)return M(F,O,g)}}:M(I,E,g)}function Hl(i,e,r){return e.type==="color"?r=j.parse(r):e.type==="formatted"?r=pe.fromString(r.toString()):e.type==="resolvedImage"?r=Ie.fromString(r.toString()):Ei(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ur(r,i.default,e.default)}It.register(go,{error:[{kind:"error"},[Mi],(i,[e])=>{throw new Be(e.evaluate(i))}],typeof:[Mi,[_i],(i,[e])=>Q(de(e.evaluate(i)))],"to-rgba":[W(St,4),[tn],(i,[e])=>e.evaluate(i).toArray()],rgb:[tn,[St,St,St],za],rgba:[tn,[St,St,St,St],za],has:{type:Ii,overloads:[[[Mi],(i,[e])=>Ca(e.evaluate(i),i.properties())],[[Mi,Pn],(i,[e,r])=>Ca(e.evaluate(i),r.evaluate(i))]]},get:{type:_i,overloads:[[[Mi],(i,[e])=>Ho(e.evaluate(i),i.properties())],[[Mi,Pn],(i,[e,r])=>Ho(e.evaluate(i),r.evaluate(i))]]},"feature-state":[_i,[Mi],(i,[e])=>Ho(e.evaluate(i),i.featureState||{})],properties:[Pn,[],i=>i.properties()],"geometry-type":[Mi,[],i=>i.geometryType()],id:[_i,[],i=>i.id()],zoom:[St,[],i=>i.globals.zoom],"heatmap-density":[St,[],i=>i.globals.heatmapDensity||0],"line-progress":[St,[],i=>i.globals.lineProgress||0],accumulated:[_i,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[St,Pa(St),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[St,Pa(St),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:St,overloads:[[[St,St],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[St],(i,[e])=>-e.evaluate(i)]]},"/":[St,[St,St],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[St,[St,St],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[St,[St],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[St,[St],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[St,[St],(i,[e])=>Math.log(e.evaluate(i))],log2:[St,[St],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[St,[St],(i,[e])=>Math.sin(e.evaluate(i))],cos:[St,[St],(i,[e])=>Math.cos(e.evaluate(i))],tan:[St,[St],(i,[e])=>Math.tan(e.evaluate(i))],asin:[St,[St],(i,[e])=>Math.asin(e.evaluate(i))],acos:[St,[St],(i,[e])=>Math.acos(e.evaluate(i))],atan:[St,[St],(i,[e])=>Math.atan(e.evaluate(i))],min:[St,Pa(St),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[St,Pa(St),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[St,[St],(i,[e])=>Math.abs(e.evaluate(i))],round:[St,[St],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[St,[St],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[St,[St],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Ii,[Mi,_i],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Ii,[_i],(i,[e])=>i.id()===e.value],"filter-type-==":[Ii,[Mi],(i,[e])=>i.geometryType()===e.value],"filter-<":[Ii,[Mi,_i],(i,[e,r])=>{const s=i.properties()[e.value],p=r.value;return typeof s==typeof p&&s<p}],"filter-id-<":[Ii,[_i],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Ii,[Mi,_i],(i,[e,r])=>{const s=i.properties()[e.value],p=r.value;return typeof s==typeof p&&s>p}],"filter-id->":[Ii,[_i],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ii,[Mi,_i],(i,[e,r])=>{const s=i.properties()[e.value],p=r.value;return typeof s==typeof p&&s<=p}],"filter-id-<=":[Ii,[_i],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ii,[Mi,_i],(i,[e,r])=>{const s=i.properties()[e.value],p=r.value;return typeof s==typeof p&&s>=p}],"filter-id->=":[Ii,[_i],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ii,[_i],(i,[e])=>e.value in i.properties()],"filter-has-id":[Ii,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ii,[W(Mi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ii,[W(_i)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Ii,[Mi,W(_i)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Ii,[Mi,W(_i)],(i,[e,r])=>function(s,p,m,g){for(;m<=g;){const I=m+g>>1;if(p[I]===s)return!0;p[I]>s?g=I-1:m=I+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ii,overloads:[[[Ii,Ii],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Pa(Ii),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Pa(Ii),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Ii,[Ii],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Ii,[Mi],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Mi,[Mi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Mi,[Mi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Mi,Pa(_i),(i,e)=>e.map(r=>$e(r.evaluate(i))).join("")],"resolved-locale":[Mi,[mo],(i,[e])=>e.evaluate(i).resolvedLocale()]});class la{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new qt,this._defaultValue=r?function(s){return s.type==="color"&&$s(s.default)?new j(0,0,0,0):s.type==="color"?j.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,p,m,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,p,m,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Be(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function ms(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in go}function Ko(i,e){const r=new ia(go,[],e?function(p){const m={color:tn,string:Mi,number:St,enum:Mi,boolean:Ii,formatted:Vn,resolvedImage:ar};return p.type==="array"?W(m[p.value]||_i,p.length):m[p.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Er(new la(s,e)):zo(r.errors)}class ua{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!oo(r.expression)}evaluateWithoutErrorHandling(e,r,s,p,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,p,m,g)}evaluate(e,r,s,p,m,g){return this._styleExpression.evaluate(e,r,s,p,m,g)}}class Na{constructor(e,r,s,p){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!oo(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,s,p,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,p,m,g)}evaluate(e,r,s,p,m,g){return this._styleExpression.evaluate(e,r,s,p,m,g)}interpolationFactor(e,r,s){return this.interpolationType?rr.interpolationFactor(this.interpolationType,e,r,s):0}}function Ws(i,e){const r=Ko(i,e);if(r.result==="error")return r;const s=r.value.expression,p=Rs(s);if(!p&&!sa(e))return zo([new mn("","data expressions not supported")]);const m=Zr(s,["zoom"]);if(!m&&!Wl(e))return zo([new mn("","zoom expressions not supported")]);const g=qa(s);return g||m?g instanceof mn?zo([g]):g instanceof rr&&!Tl(e)?zo([new mn("",'"interpolate" expressions cannot be used with this property')]):Er(g?new Na(p?"camera":"composite",r.value,g.labels,g instanceof rr?g.interpolation:void 0):new ua(p?"constant":"source",r.value)):zo([new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nr{constructor(e,r){this._parameters=e,this._specification=r,ro(this,Fo(this._parameters,this._specification))}static deserialize(e){return new nr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qa(i){let e=null;if(i instanceof wl)e=qa(i.result);else if(i instanceof js){for(const r of i.args)if(e=qa(r),e)break}else(i instanceof Bs||i instanceof rr)&&i.input instanceof It&&i.input.name==="zoom"&&(e=i);return e instanceof mn||i.eachChild(r=>{const s=qa(r);s instanceof mn?e=s:!e&&s?e=new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new mn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Co(i){const e=i.key,r=i.value,s=i.valueSpec||{},p=i.objectElementValidators||{},m=i.style,g=i.styleSpec;let I=[];const E=Ei(r);if(E!=="object")return[new Mt(e,r,`object expected, ${E} found`)];for(const M in r){const L=M.split(".")[0],F=s[L]||s["*"];let O;if(p[L])O=p[L];else if(s[L])O=Rn;else if(p["*"])O=p["*"];else{if(!s["*"]){I.push(new Mt(e,r[M],`unknown property "${M}"`));continue}O=Rn}I=I.concat(O({key:(e&&`${e}.`)+M,value:r[M],valueSpec:F,style:m,styleSpec:g,object:r,objectKey:M},r))}for(const M in s)p[M]||s[M].required&&s[M].default===void 0&&r[M]===void 0&&I.push(new Mt(e,r,`missing required property "${M}"`));return I}function Za(i){const e=i.value,r=i.valueSpec,s=i.style,p=i.styleSpec,m=i.key,g=i.arrayElementValidator||Rn;if(Ei(e)!=="array")return[new Mt(m,e,`array expected, ${Ei(e)} found`)];if(r.length&&e.length!==r.length)return[new Mt(m,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Mt(m,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let I={type:r.value,values:r.values};p.$version<7&&(I.function=r.function),Ei(r.value)==="object"&&(I=r.value);let E=[];for(let M=0;M<e.length;M++)E=E.concat(g({array:e,arrayIndex:M,value:e[M],valueSpec:I,style:s,styleSpec:p,key:`${m}[${M}]`}));return E}function Iu(i){const e=i.key,r=i.value,s=i.valueSpec;let p=Ei(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new Mt(e,r,`number expected, ${p} found`)]:"minimum"in s&&r<s.minimum?[new Mt(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Mt(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Eu(i){const e=i.valueSpec,r=pr(i.value.type);let s,p,m,g={};const I=r!=="categorical"&&i.value.property===void 0,E=!I,M=Ei(i.value.stops)==="array"&&Ei(i.value.stops[0])==="array"&&Ei(i.value.stops[0][0])==="object",L=Co({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new Mt(Z.key,Z.value,'identity function may not have a "stops" property')];let $=[];const te=Z.value;return $=$.concat(Za({key:Z.key,value:te,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:F})),Ei(te)==="array"&&te.length===0&&$.push(new Mt(Z.key,te,"array must have at least one stop")),$},default:function(Z){return Rn({key:Z.key,value:Z.value,valueSpec:e,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&I&&L.push(new Mt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||L.push(new Mt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Tl(i.valueSpec)&&L.push(new Mt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!sa(i.valueSpec)?L.push(new Mt(i.key,i.value,"property functions not supported")):I&&!Wl(i.valueSpec)&&L.push(new Mt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!M||i.value.property!==void 0||L.push(new Mt(i.key,i.value,'"property" property is required')),L;function F(Z){let $=[];const te=Z.value,ie=Z.key;if(Ei(te)!=="array")return[new Mt(ie,te,`array expected, ${Ei(te)} found`)];if(te.length!==2)return[new Mt(ie,te,`array length 2 expected, length ${te.length} found`)];if(M){if(Ei(te[0])!=="object")return[new Mt(ie,te,`object expected, ${Ei(te[0])} found`)];if(te[0].zoom===void 0)return[new Mt(ie,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new Mt(ie,te,"object stop key must have value")];if(m&&m>pr(te[0].zoom))return[new Mt(ie,te[0].zoom,"stop zoom values must appear in ascending order")];pr(te[0].zoom)!==m&&(m=pr(te[0].zoom),p=void 0,g={}),$=$.concat(Co({key:`${ie}[0]`,value:te[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Iu,value:O}}))}else $=$.concat(O({key:`${ie}[0]`,value:te[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},te));return ms(Cn(te[1]))?$.concat([new Mt(`${ie}[1]`,te[1],"expressions are not allowed in function stops.")]):$.concat(Rn({key:`${ie}[1]`,value:te[1],valueSpec:e,style:Z.style,styleSpec:Z.styleSpec}))}function O(Z,$){const te=Ei(Z.value),ie=pr(Z.value),ve=Z.value!==null?Z.value:$;if(s){if(te!==s)return[new Mt(Z.key,ve,`${te} stop domain type must match previous stop domain type ${s}`)]}else s=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new Mt(Z.key,ve,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&r!=="categorical"){let Pe=`number expected, ${te} found`;return sa(e)&&r===void 0&&(Pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(Z.key,ve,Pe)]}return r!=="categorical"||te!=="number"||isFinite(ie)&&Math.floor(ie)===ie?r!=="categorical"&&te==="number"&&p!==void 0&&ie<p?[new Mt(Z.key,ve,"stop domain values must appear in ascending order")]:(p=ie,r==="categorical"&&ie in g?[new Mt(Z.key,ve,"stop domain values must be unique")]:(g[ie]=!0,[])):[new Mt(Z.key,ve,`integer expected, found ${ie}`)]}}function Jo(i){const e=(i.expressionContext==="property"?Ws:Ko)(Cn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Mt(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Mt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!oo(r))return[new Mt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!oo(r))return[new Mt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Zr(r,["zoom","feature-state"]))return[new Mt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Rs(r))return[new Mt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(i){const e=i.key,r=i.value,s=i.valueSpec,p=[];return Array.isArray(s.values)?s.values.indexOf(pr(r))===-1&&p.push(new Mt(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(pr(r))===-1&&p.push(new Mt(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Ma(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ma(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ks={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ga(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ma(i)||(i=Xa(i));const e=Ko(i,Ks);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,p)=>e.value.evaluate(r,s,{},p),needGeometry:$a(i)}}function Da(i,e){return i<e?-1:i>e?1:0}function $a(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if($a(i[e]))return!0;return!1}function Xa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Wa(i[1],i[2],"=="):e==="!="?Ha(Wa(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wa(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Xa))):e==="all"?["all"].concat(i.slice(1).map(Xa)):e==="none"?["all"].concat(i.slice(1).map(Xa).map(Ha)):e==="in"?ao(i[1],i.slice(2)):e==="!in"?Ha(ao(i[1],i.slice(2))):e==="has"?Js(i[1]):e==="!has"?Ha(Js(i[1])):e!=="within"||i;var r}function Wa(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function ao(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Da)]]:["filter-in-small",i,["literal",e]]}}function Js(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ha(i){return["!",i]}function Ka(i){return Ma(Cn(i.value))?Jo(ro({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):La(i)}function La(i){const e=i.value,r=i.key;if(Ei(e)!=="array")return[new Mt(r,e,`array expected, ${Ei(e)} found`)];const s=i.styleSpec;let p,m=[];if(e.length<1)return[new Mt(r,e,"filter array must have at least 1 element")];switch(m=m.concat(Hs({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),pr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&pr(e[1])==="$type"&&m.push(new Mt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Mt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Ei(e[1]),p!=="string"&&m.push(new Mt(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let g=2;g<e.length;g++)p=Ei(e[g]),pr(e[1])==="$type"?m=m.concat(Hs({key:`${r}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&m.push(new Mt(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(La({key:`${r}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Ei(e[1]),e.length!==2?m.push(new Mt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&m.push(new Mt(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Ei(e[1]),e.length!==2?m.push(new Mt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&m.push(new Mt(`${r}[1]`,e[1],`object expected, ${p} found`))}return m}function ca(i,e){const r=i.key,s=i.style,p=i.styleSpec,m=i.value,g=i.objectKey,I=p[`${e}_${i.layerType}`];if(!I)return[];const E=g.match(/^(.*)-transition$/);if(e==="paint"&&E&&I[E[1]]&&I[E[1]].transition)return Rn({key:r,value:m,valueSpec:p.transition,style:s,styleSpec:p});const M=i.valueSpec||I[g];if(!M)return[new Mt(r,m,`unknown property "${g}"`)];let L;if(Ei(m)==="string"&&sa(M)&&!M.tokens&&(L=/^{([^}]+)}$/.exec(m)))return[new Mt(r,m,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(g==="text-field"&&s&&!s.glyphs&&F.push(new Mt(r,m,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&$s(Cn(m))&&pr(m.type)==="identity"&&F.push(new Mt(r,m,'"text-font" does not support identity functions'))),F.concat(Rn({key:i.key,value:m,valueSpec:M,style:s,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:g}))}function ys(i){return ca(i,"paint")}function ku(i){return ca(i,"layout")}function Ys(i){let e=[];const r=i.value,s=i.key,p=i.style,m=i.styleSpec;r.type||r.ref||e.push(new Mt(s,r,'either "type" or "ref" is required'));let g=pr(r.type);const I=pr(r.ref);if(r.id){const E=pr(r.id);for(let M=0;M<i.arrayIndex;M++){const L=p.layers[M];pr(L.id)===E&&e.push(new Mt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let E;["type","source","source-layer","filter","layout"].forEach(M=>{M in r&&e.push(new Mt(s,r[M],`"${M}" is prohibited for ref layers`))}),p.layers.forEach(M=>{pr(M.id)===I&&(E=M)}),E?E.ref?e.push(new Mt(s,r.ref,"ref cannot reference another ref layer")):g=pr(E.type):e.push(new Mt(s,r.ref,`ref layer "${I}" not found`))}else if(g!=="background")if(r.source){const E=p.sources&&p.sources[r.source],M=E&&pr(E.type);E?M==="vector"&&g==="raster"?e.push(new Mt(s,r.source,`layer "${r.id}" requires a raster source`)):M==="raster"&&g!=="raster"?e.push(new Mt(s,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&g!=="hillshade"?e.push(new Mt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||M==="geojson"&&E.lineMetrics||e.push(new Mt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Mt(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Mt(s,r.source,`source "${r.source}" not found`))}else e.push(new Mt(s,r,'missing required property "source"'));return e=e.concat(Co({key:s,value:r,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rn({key:`${s}.type`,value:r.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:Ka,layout:E=>Co({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>ku(ro({layerType:g},M))}}),paint:E=>Co({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>ys(ro({layerType:g},M))}})}})),e}function gs(i){const e=i.value,r=i.key,s=Ei(e);return s!=="string"?[new Mt(r,e,`string expected, ${s} found`)]:[]}const Qs={promoteId:function({key:i,value:e}){if(Ei(e)==="string")return gs({key:i,value:e});{const r=[];for(const s in e)r.push(...gs({key:`${i}.${s}`,value:e[s]}));return r}}};function Ja(i){const e=i.value,r=i.key,s=i.styleSpec,p=i.style;if(!e.type)return[new Mt(r,e,'"type" is required')];const m=pr(e.type);let g;switch(m){case"vector":case"raster":case"raster-dem":return g=Co({key:r,value:e,valueSpec:s[`source_${m.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Qs}),g;case"geojson":if(g=Co({key:r,value:e,valueSpec:s.source_geojson,style:p,styleSpec:s,objectElementValidators:Qs}),e.cluster)for(const I in e.clusterProperties){const[E,M]=e.clusterProperties[I],L=typeof E=="string"?[E,["accumulated"],["get",I]]:E;g.push(...Jo({key:`${r}.${I}.map`,value:M,expressionContext:"cluster-map"})),g.push(...Jo({key:`${r}.${I}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return g;case"video":return Co({key:r,value:e,valueSpec:s.source_video,style:p,styleSpec:s});case"image":return Co({key:r,value:e,valueSpec:s.source_image,style:p,styleSpec:s});case"canvas":return[new Mt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:s})}}function _s(i){const e=i.value,r=i.styleSpec,s=r.light,p=i.style;let m=[];const g=Ei(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Mt("light",e,`object expected, ${g} found`)]),m;for(const I in e){const E=I.match(/^(.*)-transition$/);m=m.concat(E&&s[E[1]]&&s[E[1]].transition?Rn({key:I,value:e[I],valueSpec:r.transition,style:p,styleSpec:r}):s[I]?Rn({key:I,value:e[I],valueSpec:s[I],style:p,styleSpec:r}):[new Mt(I,e[I],`unknown property "${I}"`)])}return m}const so={"*":()=>[],array:Za,boolean:function(i){const e=i.value,r=i.key,s=Ei(e);return s!=="boolean"?[new Mt(r,e,`boolean expected, ${s} found`)]:[]},number:Iu,color:function(i){const e=i.key,r=i.value,s=Ei(r);return s!=="string"?[new Mt(e,r,`color expected, ${s} found`)]:Fe(r)===null?[new Mt(e,r,`color expected, "${r}" found`)]:[]},constants:Bo,enum:Hs,filter:Ka,function:Eu,layer:Ys,object:Co,source:Ja,light:_s,string:gs,formatted:function(i){return gs(i).length===0?[]:Jo(i)},resolvedImage:function(i){return gs(i).length===0?[]:Jo(i)}};function Rn(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return r.expression&&$s(pr(e))?Eu(i):r.expression&&ms(Cn(e))?Jo(i):r.type&&so[r.type]?so[r.type](i):Co(ro({},i,{valueSpec:r.type?s[r.type]:r}))}function Il(i){const e=i.value,r=i.key,s=gs(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Mt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Mt(r,e,'"glyphs" url must include a "{range}" token'))),s}function ha(i,e=ot){let r=[];return r=r.concat(Rn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Il,"*":()=>[]}})),i.constants&&(r=r.concat(Bo({key:"constants",value:i.constants,style:i,styleSpec:e}))),vs(r)}function vs(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Ya(i){return function(...e){return vs(i.apply(this,e))}}ha.source=Ya(Ja),ha.light=Ya(_s),ha.layer=Ya(Ys),ha.filter=Ya(Ka),ha.paintProperty=Ya(ys),ha.layoutProperty=Ya(ku);const pa=ha,fr=pa.light,xs=pa.paintProperty,Qa=pa.layoutProperty;function da(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new zn(new Error(s.message))),r=!0;return r}class Gi{constructor(e,r,s){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(s=g[2]);for(let E=0;E<this.d*this.d;E++){const M=g[3+E],L=g[3+E+1];p.push(M===L?null:g.subarray(M,L))}const I=g[3+p.length+1];this.keys=g.subarray(g[3+p.length],I),this.bboxes=g.subarray(I),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let g=0;g<this.d*this.d;g++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const m=s/r*e;this.min=-m,this.max=e+m}insert(e,r,s,p,m){this._forEachCell(r,s,p,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,p,m,g){this.cells[m].push(g)}query(e,r,s,p,m){const g=this.min,I=this.max;if(e<=g&&r<=g&&I<=s&&I<=p&&!m)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(e,r,s,p,this._queryCell,E,{},m),E}}_queryCell(e,r,s,p,m,g,I,E){const M=this.cells[m];if(M!==null){const L=this.keys,F=this.bboxes;for(let O=0;O<M.length;O++){const Z=M[O];if(I[Z]===void 0){const $=4*Z;(E?E(F[$+0],F[$+1],F[$+2],F[$+3]):e<=F[$+2]&&r<=F[$+3]&&s>=F[$+0]&&p>=F[$+1])?(I[Z]=!0,g.push(L[Z])):I[Z]=!1}}}}_forEachCell(e,r,s,p,m,g,I,E){const M=this._convertToCellCoord(e),L=this._convertToCellCoord(r),F=this._convertToCellCoord(s),O=this._convertToCellCoord(p);for(let Z=M;Z<=F;Z++)for(let $=L;$<=O;$++){const te=this.d*$+Z;if((!E||E(this._convertFromCellCoord(Z),this._convertFromCellCoord($),this._convertFromCellCoord(Z+1),this._convertFromCellCoord($+1)))&&m.call(this,e,r,s,p,te,g,I,E))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let g=0;g<this.cells.length;g++)s+=this.cells[g].length;const p=new Int32Array(r+s+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let m=r;for(let g=0;g<e.length;g++){const I=e[g];p[3+g]=m,p.set(I,m),m+=I.length}return p[3+e.length]=m,p.set(this.keys,m),m+=this.keys.length,p[3+e.length+1]=m,p.set(this.bboxes,m),m+=this.bboxes.length,p.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new Gi(e.buffer)}}const Ri={};function Ut(i,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ri[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ut("Object",Object),Ut("TransferableGridIndex",Gi),Ut("Color",j),Ut("Error",Error),Ut("AJAXError",Ht),Ut("ResolvedImage",Ie),Ut("StylePropertyFunction",nr),Ut("StyleExpression",la,{omit:["_evaluator"]}),Ut("ZoomDependentExpression",Na),Ut("ZoomConstantExpression",ua),Ut("CompoundExpression",It,{omit:["_evaluate"]});for(const i in go)go[i]._classRegistryKey||Ut(`Expression_${i}`,go[i]);function Po(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function bs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Po(i)||Li(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(bs(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const p=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const m in i){if(!i.hasOwnProperty(m)||Ri[s].omit.indexOf(m)>=0)continue;const g=i[m];p[m]=Ri[s].shallow.indexOf(m)>=0?g:bs(g,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(p.$name=s),p}throw new Error("can't serialize object of type "+typeof i)}function Mo(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Po(i)||Li(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Mo);if(typeof i=="object"){const e=i.$name||"Object";if(!Ri[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ri[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const m=i[p];s[p]=Ri[e].shallow.indexOf(p)>=0?m:Mo(m)}return s}throw new Error("can't deserialize object of type "+typeof i)}class fa{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Ft={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function es(i){for(const e of i)if(nn(e.charCodeAt(0)))return!0;return!1}function el(i){for(const e of i)if(!tl(e.charCodeAt(0)))return!1;return!0}function tl(i){return!(Ft.Arabic(i)||Ft["Arabic Supplement"](i)||Ft["Arabic Extended-A"](i)||Ft["Arabic Presentation Forms-A"](i)||Ft["Arabic Presentation Forms-B"](i))}function nn(i){return!(i!==746&&i!==747&&(i<4352||!(Ft["Bopomofo Extended"](i)||Ft.Bopomofo(i)||Ft["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ft["CJK Compatibility Ideographs"](i)||Ft["CJK Compatibility"](i)||Ft["CJK Radicals Supplement"](i)||Ft["CJK Strokes"](i)||!(!Ft["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ft["CJK Unified Ideographs Extension A"](i)||Ft["CJK Unified Ideographs"](i)||Ft["Enclosed CJK Letters and Months"](i)||Ft["Hangul Compatibility Jamo"](i)||Ft["Hangul Jamo Extended-A"](i)||Ft["Hangul Jamo Extended-B"](i)||Ft["Hangul Jamo"](i)||Ft["Hangul Syllables"](i)||Ft.Hiragana(i)||Ft["Ideographic Description Characters"](i)||Ft.Kanbun(i)||Ft["Kangxi Radicals"](i)||Ft["Katakana Phonetic Extensions"](i)||Ft.Katakana(i)&&i!==12540||!(!Ft["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ft["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ft["Unified Canadian Aboriginal Syllabics"](i)||Ft["Unified Canadian Aboriginal Syllabics Extended"](i)||Ft["Vertical Forms"](i)||Ft["Yijing Hexagram Symbols"](i)||Ft["Yi Syllables"](i)||Ft["Yi Radicals"](i))))}function lo(i){return!(nn(i)||function(e){return!!(Ft["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ft["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ft["Letterlike Symbols"](e)||Ft["Number Forms"](e)||Ft["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ft["Control Pictures"](e)&&e!==9251||Ft["Optical Character Recognition"](e)||Ft["Enclosed Alphanumerics"](e)||Ft["Geometric Shapes"](e)||Ft["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ft["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ft["CJK Symbols and Punctuation"](e)||Ft.Katakana(e)||Ft["Private Use Area"](e)||Ft["CJK Compatibility Forms"](e)||Ft["Small Form Variants"](e)||Ft["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Kl(i){return i>=1424&&i<=2303||Ft["Arabic Presentation Forms-A"](i)||Ft["Arabic Presentation Forms-B"](i)}function gn(i,e){return!(!e&&Kl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ft.Khmer(i))}function uo(i){for(const e of i)if(Kl(e.charCodeAt(0)))return!0;return!1}const Dt="deferred",ts="loading",Ra="loaded";let Yo=null,Pr="unavailable",Do=null;const qn=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Pr="error"),Yo&&Yo(i)};function Bt(){ma.fire(new io("pluginStateChange",{pluginStatus:Pr,pluginURL:Do}))}const ma=new Sa,ws=function(){return Pr},Yn=function(){if(Pr!==Dt||!Do)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pr=ts,Bt(),Do&&Eo({url:Do},i=>{i?qn(i):(Pr=Ra,Bt())})},Br={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pr===Ra||Br.applyArabicShaping!=null,isLoading:()=>Pr===ts,setState(i){Pr=i.pluginStatus,Do=i.pluginURL},isParsed:()=>Br.applyArabicShaping!=null&&Br.processBidirectionalText!=null&&Br.processStyledBidirectionalText!=null,getPluginURL:()=>Do};class kr{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fa,this.transition={})}isSupportedScript(e){return function(r,s){for(const p of r)if(!gn(p.charCodeAt(0),s))return!1;return!0}(e,Br.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class il{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,p){if($s(s))return new nr(s,p);if(ms(s)){const m=Ws(s,p);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=s;return typeof s=="string"&&p.type==="color"&&(m=j.parse(s)),{kind:"constant",evaluate:()=>m}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Ts{constructor(e){this.property=e,this.value=new il(e,void 0)}transitioned(e,r){return new ya(this.property,this.value,r,zt({},e.transition,this.transition),e.now)}untransitioned(){return new ya(this.property,this.value,null,{},0)}}class Bn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Et(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ts(this._values[e].property)),this._values[e].value=new il(this._values[e].property,r===null?void 0:Et(r))}getTransition(e){return Et(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ts(this._values[e].property)),this._values[e].transition=Et(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){const s=new rl(this._properties);for(const p of Object.keys(this._values))s._values[p]=this._values[p].transitioned(e,r._values[p]);return s}untransitioned(){const e=new rl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ya{constructor(e,r,s,p,m){this.property=e,this.value=r,this.begin=m+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const p=e.now||0,m=this.value.possiblyEvaluate(e,r,s),g=this.prior;if(g){if(p>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(p<this.begin)return g.possiblyEvaluate(e,r,s);{const I=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,s),m,function(E){if(E<=0)return 0;if(E>=1)return 1;const M=E*E,L=M*E;return 4*(E<.5?L:3*(E-M)+L-.75)}(I))}}return m}}class rl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const p=new co(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(e,r,s);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Jl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Et(this._values[e].value)}setValue(e,r){this._values[e]=new il(this._values[e].property,r===null?void 0:Et(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const p=new co(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(e,r,s);return p}}class Lo{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,p){return this.property.evaluate(this.value,this.parameters,e,r,s,p)}}class co{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Qt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const p=Fs[this.specification.type];return p?p(e,r,s):e}}class Ot{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,p){return new Lo(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,p)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Lo(this,{kind:"constant",value:void 0},e.parameters);const p=Fs[this.specification.type];return p?new Lo(this,{kind:"constant",value:p(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,p,m,g){return e.kind==="constant"?e.value:e.evaluate(r,s,p,m,g)}}class $i extends Ot{possiblyEvaluate(e,r,s,p){if(e.value===void 0)return new Lo(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},s,p),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,I=this._calculate(g,g,g,r);return new Lo(this,{kind:"constant",value:I},r)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Lo(this,{kind:"constant",value:m},r)}return new Lo(this,e.expression,r)}evaluate(e,r,s,p,m,g){if(e.kind==="source"){const I=e.evaluate(r,s,p,m,g);return this._calculate(I,I,I,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,p),e.evaluate({zoom:Math.floor(r.zoom)},s,p),e.evaluate({zoom:Math.floor(r.zoom)+1},s,p),r):e.value}_calculate(e,r,s,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Zn{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},s,p);return this._calculate(m,m,m,r)}return this._calculate(e.expression.evaluate(new kr(Math.floor(r.zoom-1),r)),e.expression.evaluate(new kr(Math.floor(r.zoom),r)),e.expression.evaluate(new kr(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Gn{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,p){return!!e.expression.evaluate(r,null,{},s,p)}interpolate(){return!1}}class mr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new il(s,void 0),m=this.defaultTransitionablePropertyValues[r]=new Ts(s);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}Ut("DataDrivenProperty",Ot),Ut("DataConstantProperty",Qt),Ut("CrossFadedDataDrivenProperty",$i),Ut("CrossFadedProperty",Zn),Ut("ColorRampProperty",Gn);const _o="-transition";class Gr extends Sa{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Jl(r.layout)),r.paint)){this._transitionablePaint=new Bn(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new co(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Qa,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(_o)?this._transitionablePaint.getTransition(e.slice(0,-_o.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(xs,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(_o))return this._transitionablePaint.setTransition(e.slice(0,-_o.length),r||void 0),!1;{const p=this._transitionablePaint._values[e],m=p.property.specification["property-type"]==="cross-faded-data-driven",g=p.value.isDataDriven(),I=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,I,E)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),wt(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,p,m={}){return(!m||m.validate!==!1)&&da(this,e.call(pa,{key:r,layerType:this.type,objectKey:s,value:p,styleSpec:ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Lo&&sa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Ba={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gt(i,e=1){let r=0,s=0;return{members:i.map(p=>{const m=Ba[p.type].BYTES_PER_ELEMENT,g=r=ui(r,Math.max(e,m)),I=p.components||1;return s=Math.max(s,m),r+=m*I,{name:p.name,type:p.type,components:I,offset:g}}),size:ui(r,Math.max(s,e)),alignment:e}}function ui(i,e){return Math.ceil(i/e)*e}class _n extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const p=2*e;return this.int16[p+0]=r,this.int16[p+1]=s,e}}_n.prototype.bytesPerElement=4,Ut("StructArrayLayout2i4",_n);class $n extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,p)}emplace(e,r,s,p,m){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=p,this.int16[g+3]=m,e}}$n.prototype.bytesPerElement=8,Ut("StructArrayLayout4i8",$n);class b extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,p,m,g)}emplace(e,r,s,p,m,g,I){const E=6*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=p,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=I,e}}b.prototype.bytesPerElement=12,Ut("StructArrayLayout2i4i12",b);class o extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,p,m,g)}emplace(e,r,s,p,m,g,I){const E=4*e,M=8*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.uint8[M+4]=p,this.uint8[M+5]=m,this.uint8[M+6]=g,this.uint8[M+7]=I,e}}o.prototype.bytesPerElement=8,Ut("StructArrayLayout2i4ub8",o);class h extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const p=2*e;return this.float32[p+0]=r,this.float32[p+1]=s,e}}h.prototype.bytesPerElement=8,Ut("StructArrayLayout2f8",h);class x extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g,I,E,M,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,s,p,m,g,I,E,M,L)}emplace(e,r,s,p,m,g,I,E,M,L,F){const O=10*e;return this.uint16[O+0]=r,this.uint16[O+1]=s,this.uint16[O+2]=p,this.uint16[O+3]=m,this.uint16[O+4]=g,this.uint16[O+5]=I,this.uint16[O+6]=E,this.uint16[O+7]=M,this.uint16[O+8]=L,this.uint16[O+9]=F,e}}x.prototype.bytesPerElement=20,Ut("StructArrayLayout10ui20",x);class S extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g,I,E,M,L,F,O){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,s,p,m,g,I,E,M,L,F,O)}emplace(e,r,s,p,m,g,I,E,M,L,F,O,Z){const $=12*e;return this.int16[$+0]=r,this.int16[$+1]=s,this.int16[$+2]=p,this.int16[$+3]=m,this.uint16[$+4]=g,this.uint16[$+5]=I,this.uint16[$+6]=E,this.uint16[$+7]=M,this.int16[$+8]=L,this.int16[$+9]=F,this.int16[$+10]=O,this.int16[$+11]=Z,e}}S.prototype.bytesPerElement=24,Ut("StructArrayLayout4i4ui4i24",S);class k extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s)}emplace(e,r,s,p){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=p,e}}k.prototype.bytesPerElement=12,Ut("StructArrayLayout3f12",k);class D extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}D.prototype.bytesPerElement=4,Ut("StructArrayLayout1ul4",D);class U extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g,I,E,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,p,m,g,I,E,M)}emplace(e,r,s,p,m,g,I,E,M,L){const F=10*e,O=5*e;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=p,this.int16[F+3]=m,this.int16[F+4]=g,this.int16[F+5]=I,this.uint32[O+3]=E,this.uint16[F+8]=M,this.uint16[F+9]=L,e}}U.prototype.bytesPerElement=20,Ut("StructArrayLayout6i1ul2ui20",U);class N extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,p,m,g)}emplace(e,r,s,p,m,g,I){const E=6*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=p,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=I,e}}N.prototype.bytesPerElement=12,Ut("StructArrayLayout2i2i2i12",N);class X extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,p,m)}emplace(e,r,s,p,m,g){const I=4*e,E=8*e;return this.float32[I+0]=r,this.float32[I+1]=s,this.float32[I+2]=p,this.int16[E+6]=m,this.int16[E+7]=g,e}}X.prototype.bytesPerElement=16,Ut("StructArrayLayout2f1f2i16",X);class K extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,p)}emplace(e,r,s,p,m){const g=12*e,I=3*e;return this.uint8[g+0]=r,this.uint8[g+1]=s,this.float32[I+1]=p,this.float32[I+2]=m,e}}K.prototype.bytesPerElement=12,Ut("StructArrayLayout2ub2f12",K);class ae extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s)}emplace(e,r,s,p){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=s,this.uint16[m+2]=p,e}}ae.prototype.bytesPerElement=6,Ut("StructArrayLayout3ui6",ae);class fe extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve)}emplace(e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe){const Me=24*e,Ue=12*e,qe=48*e;return this.int16[Me+0]=r,this.int16[Me+1]=s,this.uint16[Me+2]=p,this.uint16[Me+3]=m,this.uint32[Ue+2]=g,this.uint32[Ue+3]=I,this.uint32[Ue+4]=E,this.uint16[Me+10]=M,this.uint16[Me+11]=L,this.uint16[Me+12]=F,this.float32[Ue+7]=O,this.float32[Ue+8]=Z,this.uint8[qe+36]=$,this.uint8[qe+37]=te,this.uint8[qe+38]=ie,this.uint32[Ue+10]=ve,this.int16[Me+22]=Pe,e}}fe.prototype.bytesPerElement=48,Ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fe);class ze extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt,nt,tt,at,ct){const pt=this.length;return this.resize(pt+1),this.emplace(pt,e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt,nt,tt,at,ct)}emplace(e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt,nt,tt,at,ct,pt){const Je=34*e,Tt=17*e;return this.int16[Je+0]=r,this.int16[Je+1]=s,this.int16[Je+2]=p,this.int16[Je+3]=m,this.int16[Je+4]=g,this.int16[Je+5]=I,this.int16[Je+6]=E,this.int16[Je+7]=M,this.uint16[Je+8]=L,this.uint16[Je+9]=F,this.uint16[Je+10]=O,this.uint16[Je+11]=Z,this.uint16[Je+12]=$,this.uint16[Je+13]=te,this.uint16[Je+14]=ie,this.uint16[Je+15]=ve,this.uint16[Je+16]=Pe,this.uint16[Je+17]=Me,this.uint16[Je+18]=Ue,this.uint16[Je+19]=qe,this.uint16[Je+20]=Ge,this.uint16[Je+21]=Qe,this.uint16[Je+22]=yt,this.uint32[Tt+12]=nt,this.float32[Tt+13]=tt,this.float32[Tt+14]=at,this.float32[Tt+15]=ct,this.float32[Tt+16]=pt,e}}ze.prototype.bytesPerElement=68,Ut("StructArrayLayout8i15ui1ul4f68",ze);class me extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}me.prototype.bytesPerElement=4,Ut("StructArrayLayout1f4",me);class Ce extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s)}emplace(e,r,s,p){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=p,e}}Ce.prototype.bytesPerElement=6,Ut("StructArrayLayout3i6",Ce);class Ne extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s)}emplace(e,r,s,p){const m=4*e;return this.uint32[2*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=p,e}}Ne.prototype.bytesPerElement=8,Ut("StructArrayLayout1ul2ui8",Ne);class Ve extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=s,e}}Ve.prototype.bytesPerElement=4,Ut("StructArrayLayout2ui4",Ve);class We extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}We.prototype.bytesPerElement=2,Ut("StructArrayLayout1ui2",We);class Ze extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,p)}emplace(e,r,s,p,m){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=p,this.float32[g+3]=m,e}}Ze.prototype.bytesPerElement=16,Ut("StructArrayLayout4f16",Ze);class ut extends Fn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Wt(this.anchorPointX,this.anchorPointY)}}ut.prototype.size=20;class it extends U{get(e){return new ut(this,e)}}Ut("CollisionBoxArray",it);class rt extends Fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}rt.prototype.size=48;class ft extends fe{get(e){return new rt(this,e)}}Ut("PlacedSymbolArray",ft);class _t extends Fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}_t.prototype.size=68;class lt extends ze{get(e){return new _t(this,e)}}Ut("SymbolInstanceArray",lt);class Gt extends me{getoffsetX(e){return this.float32[1*e+0]}}Ut("GlyphOffsetArray",Gt);class Lt extends Ce{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ut("SymbolLineVertexArray",Lt);class yi extends Fn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}yi.prototype.size=8;class l extends Ne{get(e){return new yi(this,e)}}Ut("FeatureIndexArray",l);class c extends _n{}class u extends _n{}class f extends b{}class T extends o{}class z extends h{}class P extends x{}class B extends S{}class G extends k{}class H extends D{}class oe extends N{}class ue extends K{}class se extends ae{}class Se extends Ve{}const we=gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ae}=we;class ge{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,p){let m=this.segments[this.segments.length-1];return e>ge.MAX_VERTEX_ARRAY_LENGTH&&Jt(`Max vertices per segment is ${ge.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>ge.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==p)&&(m={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},p!==void 0&&(m.sortKey=p),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,p){return new ge([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:p,vaos:{},sortKey:0}])}}function Ee(i,e){return 256*(i=xe(Math.floor(i),0,255))+xe(Math.floor(e),0,255)}ge.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut("SegmentVector",ge);const Re=gt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var je={exports:{}},He={exports:{}};He.exports=function(i,e){var r,s,p,m,g,I,E,M;for(s=i.length-(r=3&i.length),p=e,g=3432918353,I=461845907,M=0;M<s;)E=255&i.charCodeAt(M)|(255&i.charCodeAt(++M))<<8|(255&i.charCodeAt(++M))<<16|(255&i.charCodeAt(++M))<<24,++M,p=27492+(65535&(m=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*g+(((E>>>16)*g&65535)<<16)&4294967295)<<15|E>>>17))*I+(((E>>>16)*I&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(E=0,r){case 3:E^=(255&i.charCodeAt(M+2))<<16;case 2:E^=(255&i.charCodeAt(M+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(M)))*g+(((E>>>16)*g&65535)<<16)&4294967295)<<15|E>>>17))*I+(((E>>>16)*I&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Ye={exports:{}};Ye.exports=function(i,e){for(var r,s=i.length,p=e^s,m=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++m;switch(s){case 3:p^=(255&i.charCodeAt(m+2))<<16;case 2:p^=(255&i.charCodeAt(m+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(m)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var et=He.exports,st=Ye.exports;je.exports=et,je.exports.murmur3=et,je.exports.murmur2=st;var vt=je.exports;class mt{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,p){this.ids.push(Pt(e)),this.positions.push(r,s,p)}getPositions(e){const r=Pt(e);let s=0,p=this.ids.length-1;for(;s<p;){const g=s+p>>1;this.ids[g]>=r?p=g:s=g+1}const m=[];for(;this.ids[s]===r;)m.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return m}static serialize(e,r){const s=new Float64Array(e.ids),p=new Uint32Array(e.positions);return $t(s,p,0,s.length-1),r&&r.push(s.buffer,p.buffer),{ids:s,positions:p}}static deserialize(e){const r=new mt;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Pt(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:vt(String(i))}function $t(i,e,r,s){for(;r<s;){const p=i[r+s>>1];let m=r-1,g=s+1;for(;;){do m++;while(i[m]<p);do g--;while(i[g]>p);if(m>=g)break;ei(i,m,g),ei(e,3*m,3*g),ei(e,3*m+1,3*g+1),ei(e,3*m+2,3*g+2)}g-r<s-g?($t(i,e,r,g),r=g+1):($t(i,e,g+1,s),s=g)}}function ei(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ut("FeaturePositionMap",mt);class Nt{constructor(e,r){this.gl=e.gl,this.location=r}}class Bi extends Nt{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class jt extends Nt{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class bi extends Nt{constructor(e,r){super(e,r),this.current=j.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Di=new Float32Array(16);function vi(i){return[Ee(255*i.r,255*i.g),Ee(255*i.b,255*i.a)]}class di{constructor(e,r,s){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new bi(e,r):new Bi(e,r)}}class hi{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,p){const m=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new jt(e,r):new Bi(e,r)}}class ni{constructor(e,r,s,p){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,p,m){const g=this.paintVertexArray.length,I=this.expression.evaluate(new kr(0),r,{},p,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,I)}updatePaintArray(e,r,s,p){const m=this.expression.evaluate({zoom:0},s,p);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if(this.type==="color"){const p=vi(s);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xt{constructor(e,r,s,p,m,g){this.expression=e,this.uniformNames=r.map(I=>`u_${I}_t`),this.type=s,this.useIntegerZoom=p,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(I=>({name:`a_${I}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,s,p,m){const g=this.expression.evaluate(new kr(this.zoom),r,{},p,[],m),I=this.expression.evaluate(new kr(this.zoom+1),r,{},p,[],m),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,g,I)}updatePaintArray(e,r,s,p){const m=this.expression.evaluate({zoom:this.zoom},s,p),g=this.expression.evaluate({zoom:this.zoom+1},s,p);this._setPaintValue(e,r,m,g)}_setPaintValue(e,r,s,p){if(this.type==="color"){const m=vi(s),g=vi(p);for(let I=e;I<r;I++)this.paintVertexArray.emplace(I,m[0],m[1],g[0],g[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,s,p);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=xe(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,r,s){return new Bi(e,r)}}class Hi{constructor(e,r,s,p,m,g){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=p,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,s){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,p,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,p){if(!p||!s)return;const{min:m,mid:g,max:I}=s,E=p[m],M=p[g],L=p[I];if(E&&M&&L)for(let F=e;F<r;F++)this.zoomInPaintVertexArray.emplace(F,M.tl[0],M.tl[1],M.br[0],M.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],M.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,M.tl[0],M.tl[1],M.br[0],M.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],M.pixelRatio,L.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Jr{constructor(e,r,s){this.binders={},this._buffers=[];const p=[];for(const m in e.paint._values){if(!s(m))continue;const g=e.paint.get(m);if(!(g instanceof Lo&&sa(g.property.specification)))continue;const I=In(m,e.type),E=g.value,M=g.property.specification.type,L=g.property.useIntegerZoom,F=g.property.specification["property-type"],O=F==="cross-faded"||F==="cross-faded-data-driven";if(E.kind==="constant")this.binders[m]=O?new hi(E.value,I):new di(E.value,I,M),p.push(`/u_${m}`);else if(E.kind==="source"||O){const Z=vn(m,M,"source");this.binders[m]=O?new Hi(E,M,L,r,Z,e.id):new ni(E,I,M,Z),p.push(`/a_${m}`)}else{const Z=vn(m,M,"composite");this.binders[m]=new Xt(E,I,M,L,r,Z),p.push(`/z_${m}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ni||r instanceof Xt?r.maxValue:0}populatePaintArrays(e,r,s,p,m){for(const g in this.binders){const I=this.binders[g];(I instanceof ni||I instanceof Xt||I instanceof Hi)&&I.populatePaintArray(e,r,s,p,m)}}setConstantPatternPositions(e,r){for(const s in this.binders){const p=this.binders[s];p instanceof hi&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,p,m){let g=!1;for(const I in e){const E=r.getPositions(I);for(const M of E){const L=s.feature(M.index);for(const F in this.binders){const O=this.binders[F];if((O instanceof ni||O instanceof Xt||O instanceof Hi)&&O.expression.isStateDependent===!0){const Z=p.paint.get(F);O.expression=Z.value,O.updatePaintArray(M.start,M.end,L,e[I],m),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof di||s instanceof hi)&&e.push(...s.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ni||s instanceof Xt)for(let p=0;p<s.paintVertexAttributes.length;p++)e.push(s.paintVertexAttributes[p].name);else if(s instanceof Hi)for(let p=0;p<Re.members.length;p++)e.push(Re.members[p].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof di||s instanceof hi||s instanceof Xt)for(const p of s.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const p in this.binders){const m=this.binders[p];if(m instanceof di||m instanceof hi||m instanceof Xt){for(const g of m.uniformNames)if(r[g]){const I=m.getBinding(e,r[g],g);s.push({name:g,property:p,binding:I})}}}return s}setUniforms(e,r,s,p){for(const{name:m,property:g,binding:I}of r)this.binders[g].setUniform(I,p,s.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Hi){const p=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(s instanceof ni||s instanceof Xt)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof ni||s instanceof Xt||s instanceof Hi)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ni||r instanceof Xt||r instanceof Hi)&&r.destroy()}}}class un{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new Jr(p,r,s);this.needsUpload=!1,this._featureMap=new mt,this._bufferOffset=0}populatePaintArrays(e,r,s,p,m,g){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,r,p,m,g);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,p){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function In(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function vn(i,e,r){const s={color:{source:h,composite:Ze},number:{source:me,composite:h}},p=function(m){return{"line-pattern":{source:P,composite:P},"fill-pattern":{source:P,composite:P},"fill-extrusion-pattern":{source:P,composite:P}}[m]}(i);return p&&p[r]||s[e][r]}Ut("ConstantBinder",di),Ut("CrossFadedConstantBinder",hi),Ut("SourceExpressionBinder",ni),Ut("CrossFadedCompositeBinder",Hi),Ut("CompositeExpressionBinder",Xt),Ut("ProgramConfiguration",Jr,{omit:["_buffers"]}),Ut("ProgramConfigurationSet",un);var Vi=8192;const On=Math.pow(2,14)-1,ga=-On-1;function cn(i){const e=Vi/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const p=r[s];for(let m=0;m<p.length;m++){const g=p[m],I=Math.round(g.x*e),E=Math.round(g.y*e);g.x=xe(I,ga,On),g.y=xe(E,ga,On),(I<g.x||I>g.x+1||E<g.y||E>g.y+1)&&Jt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function hn(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?cn(i):[]}}function Oo(i,e,r,s,p){i.emplaceBack(2*e+(s+1)/2,2*r+(p+1)/2)}class vo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new c,this.indexArray=new se,this.segments=new ge,this.programConfigurations=new un(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const p=this.layers[0],m=[];let g=null,I=!1;p.type==="circle"&&(g=p.layout.get("circle-sort-key"),I=!g.isConstant());for(const{feature:E,id:M,index:L,sourceLayerIndex:F}of e){const O=this.layers[0]._featureFilter.needGeometry,Z=hn(E,O);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),Z,s))continue;const $=I?g.evaluate(Z,{},s):void 0,te={id:M,properties:E.properties,type:E.type,sourceLayerIndex:F,index:L,geometry:O?Z.geometry:cn(E),patterns:{},sortKey:$};m.push(te)}I&&m.sort((E,M)=>E.sortKey-M.sortKey);for(const E of m){const{geometry:M,index:L,sourceLayerIndex:F}=E,O=e[L].feature;this.addFeature(E,M,L,s),r.featureIndex.insert(O,M,L,F,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ae),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,p){for(const m of r)for(const g of m){const I=g.x,E=g.y;if(I<0||I>=Vi||E<0||E>=Vi)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=M.vertexLength;Oo(this.layoutVertexArray,I,E,-1,-1),Oo(this.layoutVertexArray,I,E,1,-1),Oo(this.layoutVertexArray,I,E,1,1),Oo(this.layoutVertexArray,I,E,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},p)}}function Au(i,e){for(let r=0;r<i.length;r++)if(Ro(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ro(i,e[r]))return!0;return!!al(i,e)}function Ss(i,e,r){return!!Ro(i,e)||!!Qo(e,i,r)}function nl(i,e){if(i.length===1)return pn(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let p=0;p<s.length;p++)if(Ro(i,s[p]))return!0}for(let r=0;r<i.length;r++)if(pn(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(al(i,e[r]))return!0;return!1}function ol(i,e,r){if(i.length>1){if(al(i,e))return!0;for(let s=0;s<e.length;s++)if(Qo(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Qo(i[s],e,r))return!0;return!1}function al(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],p=i[r+1];for(let m=0;m<e.length-1;m++)if(El(s,p,e[m],e[m+1]))return!0}return!1}function El(i,e,r,s){return Kt(i,r,s)!==Kt(e,r,s)&&Kt(i,e,r)!==Kt(i,e,s)}function Qo(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let p=1;p<e.length;p++)if(sl(i,e[p-1],e[p])<s)return!0;return!1}function sl(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function pn(i,e){let r,s,p,m=!1;for(let g=0;g<i.length;g++){r=i[g];for(let I=0,E=r.length-1;I<r.length;E=I++)s=r[I],p=r[E],s.y>e.y!=p.y>e.y&&e.x<(p.x-s.x)*(e.y-s.y)/(p.y-s.y)+s.x&&(m=!m)}return m}function Ro(i,e){let r=!1;for(let s=0,p=i.length-1;s<i.length;p=s++){const m=i[s],g=i[p];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(r=!r)}return r}function _a(i,e,r){const s=r[0],p=r[2];if(i.x<s.x&&e.x<s.x||i.x>p.x&&e.x>p.x||i.y<s.y&&e.y<s.y||i.y>p.y&&e.y>p.y)return!1;const m=Kt(i,e,r[0]);return m!==Kt(i,e,r[1])||m!==Kt(i,e,r[2])||m!==Kt(i,e,r[3])}function va(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function qr(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Or(i,e,r,s,p){if(!e[0]&&!e[1])return i;const m=Wt.convert(e)._mult(p);r==="viewport"&&m._rotate(-s);const g=[];for(let I=0;I<i.length;I++)g.push(i[I].sub(m));return g}Ut("CircleBucket",vo,{omit:["layers"]});const ho=new mr({"circle-sort-key":new Ot(ot.layout_circle["circle-sort-key"])});var Yl={paint:new mr({"circle-radius":new Ot(ot.paint_circle["circle-radius"]),"circle-color":new Ot(ot.paint_circle["circle-color"]),"circle-blur":new Ot(ot.paint_circle["circle-blur"]),"circle-opacity":new Ot(ot.paint_circle["circle-opacity"]),"circle-translate":new Qt(ot.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(ot.paint_circle["circle-stroke-opacity"])}),layout:ho},is=typeof Float32Array<"u"?Float32Array:Array;function Gu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ql(i,e,r){var s=e[0],p=e[1],m=e[2],g=e[3],I=e[4],E=e[5],M=e[6],L=e[7],F=e[8],O=e[9],Z=e[10],$=e[11],te=e[12],ie=e[13],ve=e[14],Pe=e[15],Me=r[0],Ue=r[1],qe=r[2],Ge=r[3];return i[0]=Me*s+Ue*I+qe*F+Ge*te,i[1]=Me*p+Ue*E+qe*O+Ge*ie,i[2]=Me*m+Ue*M+qe*Z+Ge*ve,i[3]=Me*g+Ue*L+qe*$+Ge*Pe,i[4]=(Me=r[4])*s+(Ue=r[5])*I+(qe=r[6])*F+(Ge=r[7])*te,i[5]=Me*p+Ue*E+qe*O+Ge*ie,i[6]=Me*m+Ue*M+qe*Z+Ge*ve,i[7]=Me*g+Ue*L+qe*$+Ge*Pe,i[8]=(Me=r[8])*s+(Ue=r[9])*I+(qe=r[10])*F+(Ge=r[11])*te,i[9]=Me*p+Ue*E+qe*O+Ge*ie,i[10]=Me*m+Ue*M+qe*Z+Ge*ve,i[11]=Me*g+Ue*L+qe*$+Ge*Pe,i[12]=(Me=r[12])*s+(Ue=r[13])*I+(qe=r[14])*F+(Ge=r[15])*te,i[13]=Me*p+Ue*E+qe*O+Ge*ie,i[14]=Me*m+Ue*M+qe*Z+Ge*ve,i[15]=Me*g+Ue*L+qe*$+Ge*Pe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Is,Tc=Ql;function Es(i,e,r){var s=e[0],p=e[1],m=e[2],g=e[3];return i[0]=r[0]*s+r[4]*p+r[8]*m+r[12]*g,i[1]=r[1]*s+r[5]*p+r[9]*m+r[13]*g,i[2]=r[2]*s+r[6]*p+r[10]*m+r[14]*g,i[3]=r[3]*s+r[7]*p+r[11]*m+r[15]*g,i}function kl(i,e){const r=Es([],[i.x,i.y,0,1],e);return new Wt(r[0]/r[3],r[1]/r[3])}Is=new is(4),is!=Float32Array&&(Is[0]=0,Is[1]=0,Is[2]=0,Is[3]=0);class sh extends vo{}Ut("HeatmapBucket",sh,{omit:["layers"]});var lh={paint:new mr({"heatmap-radius":new Ot(ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gn(ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(ot.paint_heatmap["heatmap-opacity"])})};function ll(i,{width:e,height:r},s,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*r*s}`)}else p=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=p,i}function xo(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const p=ll({},{width:e,height:r},s);uh(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=p.data}function uh(i,e,r,s,p,m){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||s.x>e.width-p.width||s.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,I=e.data;for(let E=0;E<p.height;E++){const M=((r.y+E)*i.width+r.x)*m,L=((s.y+E)*e.width+s.x)*m;for(let F=0;F<p.width*m;F++)I[L+F]=g[M+F]}return e}class zu{constructor(e,r){ll(this,e,1,r)}resize(e){xo(this,e,1)}clone(){return new zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,p,m){uh(e,r,s,p,m,1)}}class xa{constructor(e,r){ll(this,e,4,r)}resize(e){xo(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,p,m){uh(e,r,s,p,m,4)}}function tp(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,p=i.image||new xa({width:r,height:s}),m=(g,I,E)=>{e[i.evaluationKey]=E;const M=i.expression.evaluate(e);p.data[g+I+0]=Math.floor(255*M.r/M.a),p.data[g+I+1]=Math.floor(255*M.g/M.a),p.data[g+I+2]=Math.floor(255*M.b/M.a),p.data[g+I+3]=Math.floor(255*M.a)};if(i.clips)for(let g=0,I=0;g<s;++g,I+=4*r)for(let E=0,M=0;E<r;E++,M+=4){const L=E/(r-1),{start:F,end:O}=i.clips[g];m(I,M,F*(1-L)+O*L)}else for(let g=0,I=0;g<r;g++,I+=4)m(0,I,g/(r-1));return p}Ut("AlphaImage",zu),Ut("RGBAImage",xa);var dd={paint:new mr({"hillshade-illumination-direction":new Qt(ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qt(ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(ot.paint_hillshade["hillshade-accent-color"])})};const fd=gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ch}=fd;var hh={exports:{}};function eu(i,e,r){r=r||2;var s,p,m,g,I,E,M,L=e&&e.length,F=L?e[0]*r:i.length,O=ph(i,0,F,r,!0),Z=[];if(!O||O.next===O.prev)return Z;if(L&&(O=function(te,ie,ve,Pe){var Me,Ue,qe,Ge=[];for(Me=0,Ue=ie.length;Me<Ue;Me++)(qe=ph(te,ie[Me]*Pe,Me<Ue-1?ie[Me+1]*Pe:te.length,Pe,!1))===qe.next&&(qe.steiner=!0),Ge.push(wd(qe));for(Ge.sort(vd),Me=0;Me<Ge.length;Me++)ve=Uo(ve=xd(Ge[Me],ve),ve.next);return ve}(i,e,O,r)),i.length>80*r){s=m=i[0],p=g=i[1];for(var $=r;$<F;$+=r)(I=i[$])<s&&(s=I),(E=i[$+1])<p&&(p=E),I>m&&(m=I),E>g&&(g=E);M=(M=Math.max(m-s,g-p))!==0?1/M:0}return ul(O,Z,r,s,p,M),Z}function ph(i,e,r,s,p){var m,g;if(p===Wu(i,e,r,s)>0)for(m=e;m<r;m+=s)g=mh(m,i[m],i[m+1],g);else for(m=r-s;m>=e;m-=s)g=mh(m,i[m],i[m+1],g);return g&&tu(g,g.next)&&(hl(g),g=g.next),g}function Uo(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!tu(s,s.next)&&Ni(s.prev,s,s.next)!==0)s=s.next;else{if(hl(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function ul(i,e,r,s,p,m,g){if(i){!g&&m&&function(L,F,O,Z){var $=L;do $.z===null&&($.z=$u($.x,$.y,F,O,Z)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==L);$.prevZ.nextZ=null,$.prevZ=null,function(te){var ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt=1;do{for(ve=te,te=null,Ue=null,qe=0;ve;){for(qe++,Pe=ve,Ge=0,ie=0;ie<yt&&(Ge++,Pe=Pe.nextZ);ie++);for(Qe=yt;Ge>0||Qe>0&&Pe;)Ge!==0&&(Qe===0||!Pe||ve.z<=Pe.z)?(Me=ve,ve=ve.nextZ,Ge--):(Me=Pe,Pe=Pe.nextZ,Qe--),Ue?Ue.nextZ=Me:te=Me,Me.prevZ=Ue,Ue=Me;ve=Pe}Ue.nextZ=null,yt*=2}while(qe>1)}($)}(i,s,p,m);for(var I,E,M=i;i.prev!==i.next;)if(I=i.prev,E=i.next,m?yd(i,s,p,m):md(i))e.push(I.i/r),e.push(i.i/r),e.push(E.i/r),hl(i),i=E.next,M=E.next;else if((i=E)===M){g?g===1?ul(i=gd(Uo(i),e,r),e,r,s,p,m,2):g===2&&_d(i,e,r,s,p,m):ul(Uo(i),e,r,s,p,m,1);break}}}function md(i){var e=i.prev,r=i,s=i.next;if(Ni(e,r,s)>=0)return!1;for(var p=i.next.next;p!==i.prev;){if(rs(e.x,e.y,r.x,r.y,s.x,s.y,p.x,p.y)&&Ni(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function yd(i,e,r,s){var p=i.prev,m=i,g=i.next;if(Ni(p,m,g)>=0)return!1;for(var I=p.x>m.x?p.x>g.x?p.x:g.x:m.x>g.x?m.x:g.x,E=p.y>m.y?p.y>g.y?p.y:g.y:m.y>g.y?m.y:g.y,M=$u(p.x<m.x?p.x<g.x?p.x:g.x:m.x<g.x?m.x:g.x,p.y<m.y?p.y<g.y?p.y:g.y:m.y<g.y?m.y:g.y,e,r,s),L=$u(I,E,e,r,s),F=i.prevZ,O=i.nextZ;F&&F.z>=M&&O&&O.z<=L;){if(F!==i.prev&&F!==i.next&&rs(p.x,p.y,m.x,m.y,g.x,g.y,F.x,F.y)&&Ni(F.prev,F,F.next)>=0||(F=F.prevZ,O!==i.prev&&O!==i.next&&rs(p.x,p.y,m.x,m.y,g.x,g.y,O.x,O.y)&&Ni(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;F&&F.z>=M;){if(F!==i.prev&&F!==i.next&&rs(p.x,p.y,m.x,m.y,g.x,g.y,F.x,F.y)&&Ni(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;O&&O.z<=L;){if(O!==i.prev&&O!==i.next&&rs(p.x,p.y,m.x,m.y,g.x,g.y,O.x,O.y)&&Ni(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function gd(i,e,r){var s=i;do{var p=s.prev,m=s.next.next;!tu(p,m)&&dh(p,s,s.next,m)&&cl(p,m)&&cl(m,p)&&(e.push(p.i/r),e.push(s.i/r),e.push(m.i/r),hl(s),hl(s.next),s=i=m),s=s.next}while(s!==i);return Uo(s)}function _d(i,e,r,s,p,m){var g=i;do{for(var I=g.next.next;I!==g.prev;){if(g.i!==I.i&&Td(g,I)){var E=fh(g,I);return g=Uo(g,g.next),E=Uo(E,E.next),ul(g,e,r,s,p,m),void ul(E,e,r,s,p,m)}I=I.next}g=g.next}while(g!==i)}function vd(i,e){return i.x-e.x}function xd(i,e){var r=function(m,g){var I,E=g,M=m.x,L=m.y,F=-1/0;do{if(L<=E.y&&L>=E.next.y&&E.next.y!==E.y){var O=E.x+(L-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(O<=M&&O>F){if(F=O,O===M){if(L===E.y)return E;if(L===E.next.y)return E.next}I=E.x<E.next.x?E:E.next}}E=E.next}while(E!==g);if(!I)return null;if(M===F)return I;var Z,$=I,te=I.x,ie=I.y,ve=1/0;E=I;do M>=E.x&&E.x>=te&&M!==E.x&&rs(L<ie?M:F,L,te,ie,L<ie?F:M,L,E.x,E.y)&&(Z=Math.abs(L-E.y)/(M-E.x),cl(E,m)&&(Z<ve||Z===ve&&(E.x>I.x||E.x===I.x&&bd(I,E)))&&(I=E,ve=Z)),E=E.next;while(E!==$);return I}(i,e);if(!r)return e;var s=fh(r,i),p=Uo(r,r.next);return Uo(s,s.next),e===r?p:e}function bd(i,e){return Ni(i.prev,i,e.prev)<0&&Ni(e.next,i,i.next)<0}function $u(i,e,r,s,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*p)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*p)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wd(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function rs(i,e,r,s,p,m,g,I){return(p-g)*(e-I)-(i-g)*(m-I)>=0&&(i-g)*(s-I)-(r-g)*(e-I)>=0&&(r-g)*(m-I)-(p-g)*(s-I)>=0}function Td(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==s.i&&p.next.i!==s.i&&dh(p,p.next,r,s))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(cl(i,e)&&cl(e,i)&&function(r,s){var p=r,m=!1,g=(r.x+s.x)/2,I=(r.y+s.y)/2;do p.y>I!=p.next.y>I&&p.next.y!==p.y&&g<(p.next.x-p.x)*(I-p.y)/(p.next.y-p.y)+p.x&&(m=!m),p=p.next;while(p!==r);return m}(i,e)&&(Ni(i.prev,i,e.prev)||Ni(i,e.prev,e))||tu(i,e)&&Ni(i.prev,i,i.next)>0&&Ni(e.prev,e,e.next)>0)}function Ni(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function tu(i,e){return i.x===e.x&&i.y===e.y}function dh(i,e,r,s){var p=ru(Ni(i,e,r)),m=ru(Ni(i,e,s)),g=ru(Ni(r,s,i)),I=ru(Ni(r,s,e));return p!==m&&g!==I||!(p!==0||!iu(i,r,e))||!(m!==0||!iu(i,s,e))||!(g!==0||!iu(r,i,s))||!(I!==0||!iu(r,e,s))}function iu(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function ru(i){return i>0?1:i<0?-1:0}function cl(i,e){return Ni(i.prev,i,i.next)<0?Ni(i,e,i.next)>=0&&Ni(i,i.prev,e)>=0:Ni(i,e,i.prev)<0||Ni(i,i.next,e)<0}function fh(i,e){var r=new Xu(i.i,i.x,i.y),s=new Xu(e.i,e.x,e.y),p=i.next,m=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,s.next=r,r.prev=s,m.next=s,s.prev=m,s}function mh(i,e,r,s){var p=new Xu(i,e,r);return s?(p.next=s.next,p.prev=s,s.next.prev=p,s.next=p):(p.prev=p,p.next=p),p}function hl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Xu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wu(i,e,r,s){for(var p=0,m=e,g=r-s;m<r;m+=s)p+=(i[g]-i[m])*(i[m+1]+i[g+1]),g=m;return p}hh.exports=eu,hh.exports.default=eu,eu.deviation=function(i,e,r,s){var p=e&&e.length,m=Math.abs(Wu(i,0,p?e[0]*r:i.length,r));if(p)for(var g=0,I=e.length;g<I;g++)m-=Math.abs(Wu(i,e[g]*r,g<I-1?e[g+1]*r:i.length,r));var E=0;for(g=0;g<s.length;g+=3){var M=s[g]*r,L=s[g+1]*r,F=s[g+2]*r;E+=Math.abs((i[M]-i[F])*(i[L+1]-i[M+1])-(i[M]-i[L])*(i[F+1]-i[M+1]))}return m===0&&E===0?0:Math.abs((E-m)/m)},eu.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,p=0;p<i.length;p++){for(var m=0;m<i[p].length;m++)for(var g=0;g<e;g++)r.vertices.push(i[p][m][g]);p>0&&r.holes.push(s+=i[p-1].length)}return r};var ip=hh.exports;function Hu(i,e,r,s,p){rp(i,e,r||0,s||i.length-1,p||Sd)}function rp(i,e,r,s,p){for(;s>r;){if(s-r>600){var m=s-r+1,g=e-r+1,I=Math.log(m),E=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*E*(m-E)/m)*(g-m/2<0?-1:1);rp(i,e,Math.max(r,Math.floor(e-g*E/m+M)),Math.min(s,Math.floor(e+(m-g)*E/m+M)),p)}var L=i[e],F=r,O=s;for(nu(i,r,e),p(i[s],L)>0&&nu(i,r,s);F<O;){for(nu(i,F,O),F++,O--;p(i[F],L)<0;)F++;for(;p(i[O],L)>0;)O--}p(i[r],L)===0?nu(i,r,O):nu(i,++O,s),O<=e&&(r=O+1),e<=O&&(s=O-1)}}function nu(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function Sd(i,e){return i<e?-1:i>e?1:0}function Ku(i,e){const r=i.length;if(r<=1)return[i];const s=[];let p,m;for(let g=0;g<r;g++){const I=pi(i[g]);I!==0&&(i[g].area=Math.abs(I),m===void 0&&(m=I<0),m===I<0?(p&&s.push(p),p=[i[g]]):p.push(i[g]))}if(p&&s.push(p),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(Hu(s[g],e,1,s[g].length-1,yh),s[g]=s[g].slice(0,e));return s}function yh(i,e){return e.area-i.area}function ba(i,e,r){const s=r.patternDependencies;let p=!1;for(const m of e){const g=m.paint.get(`${i}-pattern`);g.isConstant()||(p=!0);const I=g.constantOr(null);I&&(p=!0,s[I.to]=!0,s[I.from]=!0)}return p}function gh(i,e,r,s,p){const m=p.patternDependencies;for(const g of e){const I=g.paint.get(`${i}-pattern`).value;if(I.kind!=="constant"){let E=I.evaluate({zoom:s-1},r,{},p.availableImages),M=I.evaluate({zoom:s},r,{},p.availableImages),L=I.evaluate({zoom:s+1},r,{},p.availableImages);E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,L=L&&L.name?L.name:L,m[E]=!0,m[M]=!0,m[L]=!0,r.patterns[g.id]={min:E,mid:M,max:L}}}return r}class _h{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new u,this.indexArray=new se,this.indexArray2=new Se,this.programConfigurations=new un(e.layers,e.zoom),this.segments=new ge,this.segments2=new ge,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=ba("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),m=!p.isConstant(),g=[];for(const{feature:I,id:E,index:M,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,O=hn(I,F);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),O,s))continue;const Z=m?p.evaluate(O,{},s,r.availableImages):void 0,$={id:E,properties:I.properties,type:I.type,sourceLayerIndex:L,index:M,geometry:F?O.geometry:cn(I),patterns:{},sortKey:Z};g.push($)}m&&g.sort((I,E)=>I.sortKey-E.sortKey);for(const I of g){const{geometry:E,index:M,sourceLayerIndex:L}=I;if(this.hasPattern){const F=gh("fill",this.layers,I,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(I,E,M,s,{});r.featureIndex.insert(e[M].feature,E,M,L,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ch),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,p,m){for(const g of Ku(r,500)){let I=0;for(const Z of g)I+=Z.length;const E=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),M=E.vertexLength,L=[],F=[];for(const Z of g){if(Z.length===0)continue;Z!==g[0]&&F.push(L.length/2);const $=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),te=$.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(te+Z.length-1,te),L.push(Z[0].x),L.push(Z[0].y);for(let ie=1;ie<Z.length;ie++)this.layoutVertexArray.emplaceBack(Z[ie].x,Z[ie].y),this.indexArray2.emplaceBack(te+ie-1,te+ie),L.push(Z[ie].x),L.push(Z[ie].y);$.vertexLength+=Z.length,$.primitiveLength+=Z.length}const O=ip(L,F);for(let Z=0;Z<O.length;Z+=3)this.indexArray.emplaceBack(M+O[Z],M+O[Z+1],M+O[Z+2]);E.vertexLength+=I,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,p)}}Ut("FillBucket",_h,{omit:["layers","patternFeatures"]});const Id=new mr({"fill-sort-key":new Ot(ot.layout_fill["fill-sort-key"])});var Ed={paint:new mr({"fill-antialias":new Qt(ot.paint_fill["fill-antialias"]),"fill-opacity":new Ot(ot.paint_fill["fill-opacity"]),"fill-color":new Ot(ot.paint_fill["fill-color"]),"fill-outline-color":new Ot(ot.paint_fill["fill-outline-color"]),"fill-translate":new Qt(ot.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new $i(ot.paint_fill["fill-pattern"])}),layout:Id};const np=gt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:Cu}=np;var Al={},kd=Wt,vh=ou;function ou(i,e,r,s,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=p,i.readFields(Ad,this,e)}function Ad(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,p){for(var m=s.readVarint()+s.pos;s.pos<m;){var g=p._keys[s.readVarint()],I=p._values[s.readVarint()];p.properties[g]=I}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function zd(i){for(var e,r,s=0,p=0,m=i.length,g=m-1;p<m;g=p++)s+=((r=i[g]).x-(e=i[p]).x)*(e.y+r.y);return s}ou.types=["Unknown","Point","LineString","Polygon"],ou.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,p=0,m=0,g=0,I=[];i.pos<r;){if(p<=0){var E=i.readVarint();s=7&E,p=E>>3}if(p--,s===1||s===2)m+=i.readSVarint(),g+=i.readSVarint(),s===1&&(e&&I.push(e),e=[]),e.push(new kd(m,g));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&I.push(e),I},ou.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,p=0,m=0,g=1/0,I=-1/0,E=1/0,M=-1/0;i.pos<e;){if(s<=0){var L=i.readVarint();r=7&L,s=L>>3}if(s--,r===1||r===2)(p+=i.readSVarint())<g&&(g=p),p>I&&(I=p),(m+=i.readSVarint())<E&&(E=m),m>M&&(M=m);else if(r!==7)throw new Error("unknown command "+r)}return[g,E,I,M]},ou.prototype.toGeoJSON=function(i,e,r){var s,p,m=this.extent*Math.pow(2,r),g=this.extent*i,I=this.extent*e,E=this.loadGeometry(),M=ou.types[this.type];function L(Z){for(var $=0;$<Z.length;$++){var te=Z[$];Z[$]=[360*(te.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+I)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(s=0;s<E.length;s++)F[s]=E[s][0];L(E=F);break;case 2:for(s=0;s<E.length;s++)L(E[s]);break;case 3:for(E=function(Z){var $=Z.length;if($<=1)return[Z];for(var te,ie,ve=[],Pe=0;Pe<$;Pe++){var Me=zd(Z[Pe]);Me!==0&&(ie===void 0&&(ie=Me<0),ie===Me<0?(te&&ve.push(te),te=[Z[Pe]]):te.push(Z[Pe]))}return te&&ve.push(te),ve}(E),s=0;s<E.length;s++)for(p=0;p<E[s].length;p++)L(E[s][p])}E.length===1?E=E[0]:M="Multi"+M;var O={type:"Feature",geometry:{type:M,coordinates:E},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Pu=vh,op=Sc;function Sc(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ju,this,e),this.length=this._features.length}function Ju(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var p=null,m=s.readVarint()+s.pos;s.pos<m;){var g=s.readVarint()>>3;p=g===1?s.readString():g===2?s.readFloat():g===3?s.readDouble():g===4?s.readVarint64():g===5?s.readVarint():g===6?s.readSVarint():g===7?s.readBoolean():null}return p}(r))}Sc.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Pu(this._pbf,e,this.extent,this._keys,this._values)};var ns=op;function Cd(i,e,r){if(i===3){var s=new ns(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Al.VectorTile=function(i,e){this.layers=i.readFields(Cd,{},e)},Al.VectorTileFeature=vh,Al.VectorTileLayer=op;const Pd=Al.VectorTileFeature.types,xh=Math.pow(2,13);function pl(i,e,r,s,p,m,g,I){i.emplaceBack(e,r,2*Math.floor(s*xh)+g,p*xh*2,m*xh*2,Math.round(I))}class Ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new f,this.indexArray=new se,this.programConfigurations=new un(e.layers,e.zoom),this.segments=new ge,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=ba("fill-extrusion",this.layers,r);for(const{feature:p,id:m,index:g,sourceLayerIndex:I}of e){const E=this.layers[0]._featureFilter.needGeometry,M=hn(p,E);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),M,s))continue;const L={id:m,sourceLayerIndex:I,index:g,geometry:E?M.geometry:cn(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(gh("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,g,s,{}),r.featureIndex.insert(p,L.geometry,g,I,this.index,!0)}}addFeatures(e,r,s){for(const p of this.features){const{geometry:m}=p;this.addFeature(p,m,p.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,p,m){for(const g of Ku(r,500)){let I=0;for(const Z of g)I+=Z.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Z of g){if(Z.length===0||Dd(Z))continue;let $=0;for(let te=0;te<Z.length;te++){const ie=Z[te];if(te>=1){const ve=Z[te-1];if(!Md(ie,ve)){E.vertexLength+4>ge.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Pe=ie.sub(ve)._perp()._unit(),Me=ve.dist(ie);$+Me>32768&&($=0),pl(this.layoutVertexArray,ie.x,ie.y,Pe.x,Pe.y,0,0,$),pl(this.layoutVertexArray,ie.x,ie.y,Pe.x,Pe.y,0,1,$),$+=Me,pl(this.layoutVertexArray,ve.x,ve.y,Pe.x,Pe.y,0,0,$),pl(this.layoutVertexArray,ve.x,ve.y,Pe.x,Pe.y,0,1,$);const Ue=E.vertexLength;this.indexArray.emplaceBack(Ue,Ue+2,Ue+1),this.indexArray.emplaceBack(Ue+1,Ue+2,Ue+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+I>ge.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),Pd[e.type]!=="Polygon")continue;const M=[],L=[],F=E.vertexLength;for(const Z of g)if(Z.length!==0){Z!==g[0]&&L.push(M.length/2);for(let $=0;$<Z.length;$++){const te=Z[$];pl(this.layoutVertexArray,te.x,te.y,0,0,1,1,0),M.push(te.x),M.push(te.y)}}const O=ip(M,L);for(let Z=0;Z<O.length;Z+=3)this.indexArray.emplaceBack(F+O[Z],F+O[Z+2],F+O[Z+1]);E.primitiveLength+=O.length/3,E.vertexLength+=I}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,p)}}function Md(i,e){return i.x===e.x&&(i.x<0||i.x>Vi)||i.y===e.y&&(i.y<0||i.y>Vi)}function Dd(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Vi)||i.every(e=>e.y<0)||i.every(e=>e.y>Vi)}Ut("FillExtrusionBucket",Ic,{omit:["layers","features"]});var Ld={paint:new mr({"fill-extrusion-opacity":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $i(ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Yu(i,e){return i.x*e.x+i.y*e.y}function bh(i,e){if(i.length===1){let r=0;const s=e[r++];let p;for(;!p||s.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){const m=e[r],g=i[0],I=p.sub(s),E=m.sub(s),M=g.sub(s),L=Yu(I,I),F=Yu(I,E),O=Yu(E,E),Z=Yu(M,I),$=Yu(M,E),te=L*O-F*F,ie=(O*Z-F*$)/te,ve=(L*$-F*Z)/te,Pe=s.z*(1-ie-ve)+p.z*ie+m.z*ve;if(isFinite(Pe))return Pe}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const bo=gt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Rd}=bo,ap=gt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:sp}=ap,Bd=Al.VectorTileFeature.types,lp=Math.cos(Math.PI/180*37.5),up=Math.pow(2,14)/.5;class wh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new T,this.layoutVertexArray2=new z,this.indexArray=new se,this.programConfigurations=new un(e.layers,e.zoom),this.segments=new ge,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=ba("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),m=!p.isConstant(),g=[];for(const{feature:I,id:E,index:M,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,O=hn(I,F);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),O,s))continue;const Z=m?p.evaluate(O,{},s):void 0,$={id:E,properties:I.properties,type:I.type,sourceLayerIndex:L,index:M,geometry:F?O.geometry:cn(I),patterns:{},sortKey:Z};g.push($)}m&&g.sort((I,E)=>I.sortKey-E.sortKey);for(const I of g){const{geometry:E,index:M,sourceLayerIndex:L}=I;if(this.hasPattern){const F=gh("line",this.layers,I,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(I,E,M,s,{});r.featureIndex.insert(e[M].feature,E,M,L,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,p,m){const g=this.layers[0].layout,I=g.get("line-join").evaluate(e,{}),E=g.get("line-cap"),M=g.get("line-miter-limit"),L=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of r)this.addLine(F,e,I,E,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,p)}addLine(e,r,s,p,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<e.length-1;ve++)this.totalDistance+=e[ve].dist(e[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Bd[r.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let M=0;for(;M<E-1&&e[M].equals(e[M+1]);)M++;if(E<(I?3:2))return;s==="bevel"&&(m=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let O,Z,$,te,ie;this.e1=this.e2=-1,I&&(O=e[E-2],ie=e[M].sub(O)._unit()._perp());for(let ve=M;ve<E;ve++){if($=ve===E-1?I?e[M+1]:void 0:e[ve+1],$&&e[ve].equals($))continue;ie&&(te=ie),O&&(Z=O),O=e[ve],ie=$?$.sub(O)._unit()._perp():te,te=te||ie;let Pe=te.add(ie);Pe.x===0&&Pe.y===0||Pe._unit();const Me=te.x*ie.x+te.y*ie.y,Ue=Pe.x*ie.x+Pe.y*ie.y,qe=Ue!==0?1/Ue:1/0,Ge=2*Math.sqrt(2-2*Ue),Qe=Ue<lp&&Z&&$,yt=te.x*ie.y-te.y*ie.x>0;if(Qe&&ve>M){const at=O.dist(Z);if(at>2*L){const ct=O.sub(O.sub(Z)._mult(L/at)._round());this.updateDistance(Z,ct),this.addCurrentVertex(ct,te,0,0,F),Z=ct}}const nt=Z&&$;let tt=nt?s:I?"butt":p;if(nt&&tt==="round"&&(qe<g?tt="miter":qe<=2&&(tt="fakeround")),tt==="miter"&&qe>m&&(tt="bevel"),tt==="bevel"&&(qe>2&&(tt="flipbevel"),qe<m&&(tt="miter")),Z&&this.updateDistance(Z,O),tt==="miter")Pe._mult(qe),this.addCurrentVertex(O,Pe,0,0,F);else if(tt==="flipbevel"){if(qe>100)Pe=ie.mult(-1);else{const at=qe*te.add(ie).mag()/te.sub(ie).mag();Pe._perp()._mult(at*(yt?-1:1))}this.addCurrentVertex(O,Pe,0,0,F),this.addCurrentVertex(O,Pe.mult(-1),0,0,F)}else if(tt==="bevel"||tt==="fakeround"){const at=-Math.sqrt(qe*qe-1),ct=yt?at:0,pt=yt?0:at;if(Z&&this.addCurrentVertex(O,te,ct,pt,F),tt==="fakeround"){const Je=Math.round(180*Ge/Math.PI/20);for(let Tt=1;Tt<Je;Tt++){let At=Tt/Je;if(At!==.5){const fi=At-.5;At+=At*fi*(At-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*fi*fi+(.848013+Me*(.215638*Me-1.06021)))}const li=ie.sub(te)._mult(At)._add(te)._unit()._mult(yt?-1:1);this.addHalfVertex(O,li.x,li.y,!1,yt,0,F)}}$&&this.addCurrentVertex(O,ie,-ct,-pt,F)}else if(tt==="butt")this.addCurrentVertex(O,Pe,0,0,F);else if(tt==="square"){const at=Z?1:-1;this.addCurrentVertex(O,Pe,at,at,F)}else tt==="round"&&(Z&&(this.addCurrentVertex(O,te,0,0,F),this.addCurrentVertex(O,te,1,1,F,!0)),$&&(this.addCurrentVertex(O,ie,-1,-1,F,!0),this.addCurrentVertex(O,ie,0,0,F)));if(Qe&&ve<E-1){const at=O.dist($);if(at>2*L){const ct=O.add($.sub(O)._mult(L/at)._round());this.updateDistance(O,ct),this.addCurrentVertex(ct,ie,0,0,F),O=ct}}}}addCurrentVertex(e,r,s,p,m,g=!1){const I=r.y*p-r.x,E=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,g,!1,s,m),this.addHalfVertex(e,I,E,g,!0,-p,m),this.distance>up/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,s,p,m,g))}addHalfVertex({x:e,y:r},s,p,m,g,I,E){const M=.5*(this.lineClips?this.scaledDistance*(up-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),E.primitiveLength++),g?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ut("LineBucket",wh,{omit:["layers","patternFeatures"]});const Fd=new mr({"line-cap":new Qt(ot.layout_line["line-cap"]),"line-join":new Ot(ot.layout_line["line-join"]),"line-miter-limit":new Qt(ot.layout_line["line-miter-limit"]),"line-round-limit":new Qt(ot.layout_line["line-round-limit"]),"line-sort-key":new Ot(ot.layout_line["line-sort-key"])});var Th={paint:new mr({"line-opacity":new Ot(ot.paint_line["line-opacity"]),"line-color":new Ot(ot.paint_line["line-color"]),"line-translate":new Qt(ot.paint_line["line-translate"]),"line-translate-anchor":new Qt(ot.paint_line["line-translate-anchor"]),"line-width":new Ot(ot.paint_line["line-width"]),"line-gap-width":new Ot(ot.paint_line["line-gap-width"]),"line-offset":new Ot(ot.paint_line["line-offset"]),"line-blur":new Ot(ot.paint_line["line-blur"]),"line-dasharray":new Zn(ot.paint_line["line-dasharray"]),"line-pattern":new $i(ot.paint_line["line-pattern"]),"line-gradient":new Gn(ot.paint_line["line-gradient"])}),layout:Fd};const cp=new class extends Ot{possiblyEvaluate(i,e){return e=new kr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,s){return e=zt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,s)}}(Th.paint.properties["line-width"].specification);function hp(i,e){return e>0?e+2*i:i}cp.useIntegerZoom=!0;const Qu=gt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),pp=gt([{name:"a_projected_pos",components:3,type:"Float32"}],4);gt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dp=gt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);gt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ec=gt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mr=gt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fp(i,e,r){return i.sections.forEach(s=>{s.text=function(p,m,g){const I=m.layout.get("text-transform").evaluate(g,{});return I==="uppercase"?p=p.toLocaleUpperCase():I==="lowercase"&&(p=p.toLocaleLowerCase()),Br.applyArabicShaping&&(p=Br.applyArabicShaping(p)),p}(s.text,e,r)}),i}gt([{name:"triangle",components:3,type:"Uint16"}]),gt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),gt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),gt([{type:"Float32",name:"offsetX"}]),gt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const wa={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var dn=24,Ec=Dr,mp=function(i,e,r,s,p){var m,g,I=8*p-s-1,E=(1<<I)-1,M=E>>1,L=-7,F=r?p-1:0,O=r?-1:1,Z=i[e+F];for(F+=O,m=Z&(1<<-L)-1,Z>>=-L,L+=I;L>0;m=256*m+i[e+F],F+=O,L-=8);for(g=m&(1<<-L)-1,m>>=-L,L+=s;L>0;g=256*g+i[e+F],F+=O,L-=8);if(m===0)m=1-M;else{if(m===E)return g?NaN:1/0*(Z?-1:1);g+=Math.pow(2,s),m-=M}return(Z?-1:1)*g*Math.pow(2,m-s)},yp=function(i,e,r,s,p,m){var g,I,E,M=8*m-p-1,L=(1<<M)-1,F=L>>1,O=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=s?0:m-1,$=s?1:-1,te=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(I=isNaN(e)?1:0,g=L):(g=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-g))<1&&(g--,E*=2),(e+=g+F>=1?O/E:O*Math.pow(2,1-F))*E>=2&&(g++,E/=2),g+F>=L?(I=0,g=L):g+F>=1?(I=(e*E-1)*Math.pow(2,p),g+=F):(I=e*Math.pow(2,F-1)*Math.pow(2,p),g=0));p>=8;i[r+Z]=255&I,Z+=$,I/=256,p-=8);for(g=g<<p|I,M+=p;M>0;i[r+Z]=255&g,Z+=$,g/=256,M-=8);i[r+Z-$]|=128*te};function Dr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Dr.Varint=0,Dr.Fixed64=1,Dr.Bytes=2,Dr.Fixed32=5;var zl,Sh=4294967296,gp=1/Sh,_p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function dl(i){return i.type===Dr.Bytes?i.readVarint()+i.pos:i.pos+1}function Mu(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function tc(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var p=r.pos-1;p>=i;p--)r.buf[p+s]=r.buf[p]}function Du(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function vp(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Od(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Ud(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function jd(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function xp(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function kc(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function ic(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function rc(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function wo(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function os(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Qn(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Ac(i,e,r){i===1&&r.readMessage(zc,e)}function zc(i,e,r){if(i===3){const{id:s,bitmap:p,width:m,height:g,left:I,top:E,advance:M}=r.readMessage(jo,{});e.push({id:s,bitmap:new zu({width:m+6,height:g+6},p),metrics:{width:m,height:g,left:I,top:E,advance:M}})}}function jo(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Ih(i){let e=0,r=0;for(const g of i)e+=g.w*g.h,r=Math.max(r,g.w);i.sort((g,I)=>I.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let p=0,m=0;for(const g of i)for(let I=s.length-1;I>=0;I--){const E=s[I];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,m=Math.max(m,g.y+g.h),p=Math.max(p,g.x+g.w),g.w===E.w&&g.h===E.h){const M=s.pop();I<s.length&&(s[I]=M)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(s.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:p,h:m,fill:e/(p*m)||0}}Dr.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),p=s>>3,m=this.pos;this.type=7&s,i(p,e,this),this.pos===m&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=wo(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Qn(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=wo(this.buf,this.pos)+wo(this.buf,this.pos+4)*Sh;return this.pos+=8,i},readSFixed64:function(){var i=wo(this.buf,this.pos)+Qn(this.buf,this.pos+4)*Sh;return this.pos+=8,i},readFloat:function(){var i=mp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=mp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(p,m,g){var I,E,M=g.buf;if(I=(112&(E=M[g.pos++]))>>4,E<128||(I|=(127&(E=M[g.pos++]))<<3,E<128)||(I|=(127&(E=M[g.pos++]))<<10,E<128)||(I|=(127&(E=M[g.pos++]))<<17,E<128)||(I|=(127&(E=M[g.pos++]))<<24,E<128)||(I|=(1&(E=M[g.pos++]))<<31,E<128))return Mu(p,I,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&_p?function(r,s,p){return _p.decode(r.subarray(s,p))}(this.buf,e,i):function(r,s,p){for(var m="",g=s;g<p;){var I,E,M,L=r[g],F=null,O=L>239?4:L>223?3:L>191?2:1;if(g+O>p)break;O===1?L<128&&(F=L):O===2?(192&(I=r[g+1]))==128&&(F=(31&L)<<6|63&I)<=127&&(F=null):O===3?(E=r[g+2],(192&(I=r[g+1]))==128&&(192&E)==128&&((F=(15&L)<<12|(63&I)<<6|63&E)<=2047||F>=55296&&F<=57343)&&(F=null)):O===4&&(E=r[g+2],M=r[g+3],(192&(I=r[g+1]))==128&&(192&E)==128&&(192&M)==128&&((F=(15&L)<<18|(63&I)<<12|(63&E)<<6|63&M)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,O=1):F>65535&&(F-=65536,m+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),m+=String.fromCharCode(F),g+=O}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Dr.Bytes)return i.push(this.readVarint(e));var r=dl(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Dr.Bytes)return i.push(this.readSVarint());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Dr.Bytes)return i.push(this.readBoolean());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Dr.Bytes)return i.push(this.readFloat());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Dr.Bytes)return i.push(this.readDouble());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Dr.Bytes)return i.push(this.readFixed32());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Dr.Bytes)return i.push(this.readSFixed32());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Dr.Bytes)return i.push(this.readFixed64());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Dr.Bytes)return i.push(this.readSFixed64());var e=dl(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Dr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Dr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Dr.Fixed32)this.pos+=4;else{if(e!==Dr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),os(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),os(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),os(this.buf,-1&i,this.pos),os(this.buf,Math.floor(i*gp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),os(this.buf,-1&i,this.pos),os(this.buf,Math.floor(i*gp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,p;if(e>=0?(s=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,g,I){I.buf[I.pos++]=127&m|128,m>>>=7,I.buf[I.pos++]=127&m|128,m>>>=7,I.buf[I.pos++]=127&m|128,m>>>=7,I.buf[I.pos++]=127&m|128,I.buf[I.pos]=127&(m>>>=7)}(s,0,r),function(m,g){var I=(7&m)<<4;g.buf[g.pos++]|=I|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,p,m){for(var g,I,E=0;E<p.length;E++){if((g=p.charCodeAt(E))>55295&&g<57344){if(!I){g>56319||E+1===p.length?(s[m++]=239,s[m++]=191,s[m++]=189):I=g;continue}if(g<56320){s[m++]=239,s[m++]=191,s[m++]=189,I=g;continue}g=I-55296<<10|g-56320|65536,I=null}else I&&(s[m++]=239,s[m++]=191,s[m++]=189,I=null);g<128?s[m++]=g:(g<2048?s[m++]=g>>6|192:(g<65536?s[m++]=g>>12|224:(s[m++]=g>>18|240,s[m++]=g>>12&63|128),s[m++]=g>>6&63|128),s[m++]=63&g|128)}return m}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&tc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),yp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),yp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&tc(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Dr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Du,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,vp,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,jd,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Od,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Ud,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,xp,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,kc,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,ic,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,rc,e)},writeBytesField:function(i,e){this.writeTag(i,Dr.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Dr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Dr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Dr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Dr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Dr.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Dr.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Dr.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Dr.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Dr.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Cc{constructor(e,{pixelRatio:r,version:s,stretchX:p,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=m,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class bp{constructor(e,r){const s={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,s,m),this.addImages(r,p,m);const{w:g,h:I}=Ih(m),E=new xa({width:g||1,height:I||1});for(const M in e){const L=e[M],F=s[M].paddedRect;xa.copy(L.data,E,{x:0,y:0},{x:F.x+1,y:F.y+1},L.data)}for(const M in r){const L=r[M],F=p[M].paddedRect,O=F.x+1,Z=F.y+1,$=L.data.width,te=L.data.height;xa.copy(L.data,E,{x:0,y:0},{x:O,y:Z},L.data),xa.copy(L.data,E,{x:0,y:te-1},{x:O,y:Z-1},{width:$,height:1}),xa.copy(L.data,E,{x:0,y:0},{x:O,y:Z+te},{width:$,height:1}),xa.copy(L.data,E,{x:$-1,y:0},{x:O-1,y:Z},{width:1,height:te}),xa.copy(L.data,E,{x:0,y:0},{x:O+$,y:Z},{width:1,height:te})}this.image=E,this.iconPositions=s,this.patternPositions=p}addImages(e,r,s){for(const p in e){const m=e[p],g={x:0,y:0,w:m.data.width+2,h:m.data.height+2};s.push(g),r[p]=new Cc(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,m]=e.tl;s.update(r.data,void 0,{x:p,y:m})}}Ut("ImagePosition",Cc),Ut("ImageAtlas",bp),v.WritingMode=void 0,(zl=v.WritingMode||(v.WritingMode={}))[zl.none=0]="none",zl[zl.horizontal=1]="horizontal",zl[zl.vertical=2]="vertical",zl[zl.horizontalOnly=3]="horizontalOnly";const nc=-17;class au{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new au;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new au;return r.imageName=e,r}}class Cl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Cl;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?s.addImageSection(m):s.addTextSection(m,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const p=e.charCodeAt(s+1)||null,m=e.charCodeAt(s-1)||null;r+=p&&lo(p)&&!wa[e[s+1]]||m&&lo(m)&&!wa[e[s-1]]||!wa[e[s]]?e[s]:wa[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&oc[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&oc[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Cl;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(au.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Jt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(au.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Jt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pc(i,e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te){const ie=Cl.fromFeature(i,p);let ve;F===v.WritingMode.vertical&&ie.verticalizePunctuation();const{processBidirectionalText:Pe,processStyledBidirectionalText:Me}=Br;if(Pe&&ie.sections.length===1){ve=[];const Ge=Pe(ie.toString(),Dc(ie,M,m,e,s,Z,$));for(const Qe of Ge){const yt=new Cl;yt.text=Qe,yt.sections=ie.sections;for(let nt=0;nt<Qe.length;nt++)yt.sectionIndex.push(0);ve.push(yt)}}else if(Me){ve=[];const Ge=Me(ie.text,ie.sectionIndex,Dc(ie,M,m,e,s,Z,$));for(const Qe of Ge){const yt=new Cl;yt.text=Qe[0],yt.sectionIndex=Qe[1],yt.sections=ie.sections,ve.push(yt)}}else ve=function(Ge,Qe){const yt=[],nt=Ge.text;let tt=0;for(const at of Qe)yt.push(Ge.substring(tt,at)),tt=at;return tt<nt.length&&yt.push(Ge.substring(tt,nt.length)),yt}(ie,Dc(ie,M,m,e,s,Z,$));const Ue=[],qe={positionedLines:Ue,text:ie.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Ge,Qe,yt,nt,tt,at,ct,pt,Je,Tt,At,li){let fi=0,wi=nc,ki=0,er=0;const qi=pt==="right"?1:pt==="left"?0:.5;let tr=0;for(const ai of tt){ai.trim();const Pi=ai.getMaxScale(),Ci=(Pi-1)*dn,xi={positionedGlyphs:[],lineOffset:0};Ge.positionedLines[tr]=xi;const Lr=xi.positionedGlyphs;let Tr=0;if(!ai.length()){wi+=at,++tr;continue}for(let Zi=0;Zi<ai.length();Zi++){const mi=ai.getSection(Zi),Ai=ai.getSectionIndex(Zi),$r=ai.getCharCode(Zi);let Fr=0,Un=null,_r=null,Xn=null,Wn=dn;const To=!(Je===v.WritingMode.horizontal||!At&&!nn($r)||At&&(oc[$r]||(Ki=$r,Ft.Arabic(Ki)||Ft["Arabic Supplement"](Ki)||Ft["Arabic Extended-A"](Ki)||Ft["Arabic Presentation Forms-A"](Ki)||Ft["Arabic Presentation Forms-B"](Ki))));if(mi.imageName){const eo=nt[mi.imageName];if(!eo)continue;Xn=mi.imageName,Ge.iconsInText=Ge.iconsInText||!0,_r=eo.paddedRect;const Hn=eo.displaySize;mi.scale=mi.scale*dn/li,Un={width:Hn[0],height:Hn[1],left:1,top:-3,advance:To?Hn[1]:Hn[0]},Fr=Ci+(dn-Hn[1]*mi.scale),Wn=Un.advance;const So=To?Hn[0]*mi.scale-dn*Pi:Hn[1]*mi.scale-dn*Pi;So>0&&So>Tr&&(Tr=So)}else{const eo=yt[mi.fontStack],Hn=eo&&eo[$r];if(Hn&&Hn.rect)_r=Hn.rect,Un=Hn.metrics;else{const So=Qe[mi.fontStack],Ms=So&&So[$r];if(!Ms)continue;Un=Ms.metrics}Fr=(Pi-mi.scale)*dn}To?(Ge.verticalizable=!0,Lr.push({glyph:$r,imageName:Xn,x:fi,y:wi+Fr,vertical:To,scale:mi.scale,fontStack:mi.fontStack,sectionIndex:Ai,metrics:Un,rect:_r}),fi+=Wn*mi.scale+Tt):(Lr.push({glyph:$r,imageName:Xn,x:fi,y:wi+Fr,vertical:To,scale:mi.scale,fontStack:mi.fontStack,sectionIndex:Ai,metrics:Un,rect:_r}),fi+=Un.advance*mi.scale+Tt)}Lr.length!==0&&(ki=Math.max(fi-Tt,ki),Sp(Lr,0,Lr.length-1,qi,Tr)),fi=0;const Ti=at*Pi+Tr;xi.lineOffset=Math.max(Tr,Ci),wi+=Ti,er=Math.max(Ti,er),++tr}var Ki;const yr=wi-nc,{horizontalAlign:Xi,verticalAlign:gr}=Lc(ct);(function(ai,Pi,Ci,xi,Lr,Tr,Ti,Zi,mi){const Ai=(Pi-Ci)*Lr;let $r=0;$r=Tr!==Ti?-Zi*xi-nc:(-xi*mi+.5)*Ti;for(const Fr of ai)for(const Un of Fr.positionedGlyphs)Un.x+=Ai,Un.y+=$r})(Ge.positionedLines,qi,Xi,gr,ki,er,at,yr,tt.length),Ge.top+=-gr*yr,Ge.bottom=Ge.top+yr,Ge.left+=-Xi*ki,Ge.right=Ge.left+ki}(qe,e,r,s,ve,g,I,E,F,M,O,te),!function(Ge){for(const Qe of Ge)if(Qe.positionedGlyphs.length!==0)return!1;return!0}(Ue)&&qe}const oc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Mc(i,e,r,s,p,m){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*dn/m+p:0}{const g=r[e.fontStack],I=g&&g[i];return I?I.metrics.advance*e.scale+p:0}}function Eh(i,e,r,s){const p=Math.pow(i-e,2);return s?i<e?p/2:2*p:p+Math.abs(r)*r}function wp(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Tp(i,e,r,s,p,m){let g=null,I=Eh(e,r,p,m);for(const E of s){const M=Eh(e-E.x,r,p,m)+E.badness;M<=I&&(g=E,I=M)}return{index:i,x:e,priorBreak:g,badness:I}}function kh(i){return i?kh(i.priorBreak).concat(i.index):[]}function Dc(i,e,r,s,p,m,g){if(m!=="point")return[];if(!i)return[];const I=[],E=function(O,Z,$,te,ie,ve){let Pe=0;for(let Me=0;Me<O.length();Me++){const Ue=O.getSection(Me);Pe+=Mc(O.getCharCode(Me),Ue,te,ie,Z,ve)}return Pe/Math.max(1,Math.ceil(Pe/$))}(i,e,r,s,p,g),M=i.text.indexOf("\u200B")>=0;let L=0;for(let O=0;O<i.length();O++){const Z=i.getSection(O),$=i.getCharCode(O);if(oc[$]||(L+=Mc($,Z,s,p,e,g)),O<i.length()-1){const te=!((F=$)<11904||!(Ft["Bopomofo Extended"](F)||Ft.Bopomofo(F)||Ft["CJK Compatibility Forms"](F)||Ft["CJK Compatibility Ideographs"](F)||Ft["CJK Compatibility"](F)||Ft["CJK Radicals Supplement"](F)||Ft["CJK Strokes"](F)||Ft["CJK Symbols and Punctuation"](F)||Ft["CJK Unified Ideographs Extension A"](F)||Ft["CJK Unified Ideographs"](F)||Ft["Enclosed CJK Letters and Months"](F)||Ft["Halfwidth and Fullwidth Forms"](F)||Ft.Hiragana(F)||Ft["Ideographic Description Characters"](F)||Ft["Kangxi Radicals"](F)||Ft["Katakana Phonetic Extensions"](F)||Ft.Katakana(F)||Ft["Vertical Forms"](F)||Ft["Yi Radicals"](F)||Ft["Yi Syllables"](F)));(Lu[$]||te||Z.imageName)&&I.push(Tp(O+1,L,E,I,wp($,i.getCharCode(O+1),te&&M),!1))}}var F;return kh(Tp(i.length(),L,E,I,0,!0))}function Lc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Sp(i,e,r,s,p){if(!s&&!p)return;const m=i[r],g=(i[r].x+m.metrics.advance*m.scale)*s;for(let I=e;I<=r;I++)i[I].x-=g,i[I].y+=p}function Vd(i,e,r){const{horizontalAlign:s,verticalAlign:p}=Lc(r),m=e[0]-i.displaySize[0]*s,g=e[1]-i.displaySize[1]*p;return{image:i,top:g,bottom:g+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Ip(i,e,r,s,p,m){const g=i.image;let I;if(g.content){const ie=g.content,ve=g.pixelRatio||1;I=[ie[0]/ve,ie[1]/ve,g.displaySize[0]-ie[2]/ve,g.displaySize[1]-ie[3]/ve]}const E=e.left*m,M=e.right*m;let L,F,O,Z;r==="width"||r==="both"?(Z=p[0]+E-s[3],F=p[0]+M+s[1]):(Z=p[0]+(E+M-g.displaySize[0])/2,F=Z+g.displaySize[0]);const $=e.top*m,te=e.bottom*m;return r==="height"||r==="both"?(L=p[1]+$-s[0],O=p[1]+te+s[2]):(L=p[1]+($+te-g.displaySize[1])/2,O=L+g.displaySize[1]),{image:g,top:L,right:F,bottom:O,left:Z,collisionPadding:I}}const ks=128;function Ah(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new kr(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:p}=r;let m=0;for(;m<s.length&&s[m]<=i;)m++;m=Math.max(0,m-1);let g=m;for(;g<s.length&&s[g]<i+1;)g++;g=Math.min(s.length-1,g);const I=s[m],E=s[g];return r.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:I,maxZoom:E,minSize:r.evaluate(new kr(I)),maxSize:r.evaluate(new kr(E)),interpolationType:p}}}class as extends Wt{constructor(e,r,s,p){super(e,r),this.angle=s,p!==void 0&&(this.segment=p)}clone(){return new as(this.x,this.y,this.angle,this.segment)}}function zh(i,e,r,s,p){if(e.segment===void 0)return!0;let m=e,g=e.segment+1,I=0;for(;I>-r/2;){if(g--,g<0)return!1;I-=i[g].dist(m),m=i[g]}I+=i[g].dist(i[g+1]),g++;const E=[];let M=0;for(;I<r/2;){const L=i[g],F=i[g+1];if(!F)return!1;let O=i[g-1].angleTo(L)-L.angleTo(F);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:I,angleDelta:O}),M+=O;I-E[0].distance>s;)M-=E.shift().angleDelta;if(M>p)return!1;g++,I+=L.dist(F)}return!0}function ac(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function sc(i,e,r){return i?.6*e*r:0}function lc(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Ru(i,e,r,s,p,m){const g=sc(r,p,m),I=lc(r,s)*m;let E=0;const M=ac(i)/2;for(let L=0;L<i.length-1;L++){const F=i[L],O=i[L+1],Z=F.dist(O);if(E+Z>M){const $=(M-E)/Z,te=Kr(F.x,O.x,$),ie=Kr(F.y,O.y,$),ve=new as(te,ie,O.angleTo(F),L);return ve._round(),!g||zh(i,ve,I,g,e)?ve:void 0}E+=Z}}function Nd(i,e,r,s,p,m,g,I,E){const M=sc(s,m,g),L=lc(s,p),F=L*g,O=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return e-F<e/4&&(e=F+e/4),Ep(i,O?e/2*I%e:(L/2+2*m)*g*I%e,e,M,r,F,O,!1,E)}function Ep(i,e,r,s,p,m,g,I,E){const M=m/2,L=ac(i);let F=0,O=e-r,Z=[];for(let $=0;$<i.length-1;$++){const te=i[$],ie=i[$+1],ve=te.dist(ie),Pe=ie.angleTo(te);for(;O+r<F+ve;){O+=r;const Me=(O-F)/ve,Ue=Kr(te.x,ie.x,Me),qe=Kr(te.y,ie.y,Me);if(Ue>=0&&Ue<E&&qe>=0&&qe<E&&O-M>=0&&O+M<=L){const Ge=new as(Ue,qe,Pe,$);Ge._round(),s&&!zh(i,Ge,m,s,p)||Z.push(Ge)}}F+=ve}return I||Z.length||g||(Z=Ep(i,F/2,r,s,p,m,g,!0,E)),Z}function kp(i,e,r,s,p){const m=[];for(let g=0;g<i.length;g++){const I=i[g];let E;for(let M=0;M<I.length-1;M++){let L=I[M],F=I[M+1];L.x<e&&F.x<e||(L.x<e?L=new Wt(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<e&&(F=new Wt(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<r&&F.y<r||(L.y<r?L=new Wt(L.x+(r-L.y)/(F.y-L.y)*(F.x-L.x),r)._round():F.y<r&&(F=new Wt(L.x+(r-L.y)/(F.y-L.y)*(F.x-L.x),r)._round()),L.x>=s&&F.x>=s||(L.x>=s?L=new Wt(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=s&&(F=new Wt(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=p&&F.y>=p||(L.y>=p?L=new Wt(L.x+(p-L.y)/(F.y-L.y)*(F.x-L.x),p)._round():F.y>=p&&(F=new Wt(L.x+(p-L.y)/(F.y-L.y)*(F.x-L.x),p)._round()),E&&L.equals(E[E.length-1])||(E=[L],m.push(E)),E.push(F)))))}}return m}function su(i,e,r,s){const p=[],m=i.image,g=m.pixelRatio,I=m.paddedRect.w-2,E=m.paddedRect.h-2,M=i.right-i.left,L=i.bottom-i.top,F=m.stretchX||[[0,I]],O=m.stretchY||[[0,E]],Z=(at,ct)=>at+ct[1]-ct[0],$=F.reduce(Z,0),te=O.reduce(Z,0),ie=I-$,ve=E-te;let Pe=0,Me=$,Ue=0,qe=te,Ge=0,Qe=ie,yt=0,nt=ve;if(m.content&&s){const at=m.content;Pe=Bu(F,0,at[0]),Ue=Bu(O,0,at[1]),Me=Bu(F,at[0],at[2]),qe=Bu(O,at[1],at[3]),Ge=at[0]-Pe,yt=at[1]-Ue,Qe=at[2]-at[0]-Me,nt=at[3]-at[1]-qe}const tt=(at,ct,pt,Je)=>{const Tt=Fu(at.stretch-Pe,Me,M,i.left),At=uc(at.fixed-Ge,Qe,at.stretch,$),li=Fu(ct.stretch-Ue,qe,L,i.top),fi=uc(ct.fixed-yt,nt,ct.stretch,te),wi=Fu(pt.stretch-Pe,Me,M,i.left),ki=uc(pt.fixed-Ge,Qe,pt.stretch,$),er=Fu(Je.stretch-Ue,qe,L,i.top),qi=uc(Je.fixed-yt,nt,Je.stretch,te),tr=new Wt(Tt,li),Ki=new Wt(wi,li),yr=new Wt(wi,er),Xi=new Wt(Tt,er),gr=new Wt(At/g,fi/g),ai=new Wt(ki/g,qi/g),Pi=e*Math.PI/180;if(Pi){const Lr=Math.sin(Pi),Tr=Math.cos(Pi),Ti=[Tr,-Lr,Lr,Tr];tr._matMult(Ti),Ki._matMult(Ti),Xi._matMult(Ti),yr._matMult(Ti)}const Ci=at.stretch+at.fixed,xi=ct.stretch+ct.fixed;return{tl:tr,tr:Ki,bl:Xi,br:yr,tex:{x:m.paddedRect.x+1+Ci,y:m.paddedRect.y+1+xi,w:pt.stretch+pt.fixed-Ci,h:Je.stretch+Je.fixed-xi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gr,pixelOffsetBR:ai,minFontScaleX:Qe/g/M,minFontScaleY:nt/g/L,isSDF:r}};if(s&&(m.stretchX||m.stretchY)){const at=Ch(F,ie,$),ct=Ch(O,ve,te);for(let pt=0;pt<at.length-1;pt++){const Je=at[pt],Tt=at[pt+1];for(let At=0;At<ct.length-1;At++)p.push(tt(Je,ct[At],Tt,ct[At+1]))}}else p.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:E+1}));return p}function Bu(i,e,r){let s=0;for(const p of i)s+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return s}function Ch(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[p,m]of i){const g=s[s.length-1];s.push({fixed:p-g.stretch,stretch:g.stretch}),s.push({fixed:p-g.stretch,stretch:g.stretch+(m-p)})}return s.push({fixed:e+1,stretch:r}),s}function Fu(i,e,r,s){return i/e*r+s}function uc(i,e,r,s){return i-e*r/s}Ut("Anchor",as);class cc{constructor(e,r,s,p,m,g,I,E,M,L){if(this.boxStartIndex=e.length,M){let F=g.top,O=g.bottom;const Z=g.collisionPadding;Z&&(F-=Z[1],O+=Z[3]);let $=O-F;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let F=g.top*I-E,O=g.bottom*I+E,Z=g.left*I-E,$=g.right*I+E;const te=g.collisionPadding;if(te&&(Z-=te[0]*I,F-=te[1]*I,$+=te[2]*I,O+=te[3]*I),L){const ie=new Wt(Z,F),ve=new Wt($,F),Pe=new Wt(Z,O),Me=new Wt($,O),Ue=L*Math.PI/180;ie._rotate(Ue),ve._rotate(Ue),Pe._rotate(Ue),Me._rotate(Ue),Z=Math.min(ie.x,ve.x,Pe.x,Me.x),$=Math.max(ie.x,ve.x,Pe.x,Me.x),F=Math.min(ie.y,ve.y,Pe.y,Me.y),O=Math.max(ie.y,ve.y,Pe.y,Me.y)}e.emplaceBack(r.x,r.y,Z,F,$,O,s,p,m)}this.boxEndIndex=e.length}}class qd{constructor(e=[],r=Zd){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,p=r[e];for(;e>0;){const m=e-1>>1,g=r[m];if(s(p,g)>=0)break;r[e]=g,e=m}r[e]=p}_down(e){const{data:r,compare:s}=this,p=this.length>>1,m=r[e];for(;e<p;){let g=1+(e<<1),I=r[g];const E=g+1;if(E<this.length&&s(r[E],I)<0&&(g=E,I=r[E]),s(I,m)>=0)break;r[e]=I,e=g}r[e]=m}}function Zd(i,e){return i<e?-1:i>e?1:0}function Gd(i,e=1,r=!1){let s=1/0,p=1/0,m=-1/0,g=-1/0;const I=i[0];for(let Z=0;Z<I.length;Z++){const $=I[Z];(!Z||$.x<s)&&(s=$.x),(!Z||$.y<p)&&(p=$.y),(!Z||$.x>m)&&(m=$.x),(!Z||$.y>g)&&(g=$.y)}const E=Math.min(m-s,g-p);let M=E/2;const L=new qd([],Rc);if(E===0)return new Wt(s,p);for(let Z=s;Z<m;Z+=E)for(let $=p;$<g;$+=E)L.push(new Pl(Z+M,$+M,M,i));let F=function(Z){let $=0,te=0,ie=0;const ve=Z[0];for(let Pe=0,Me=ve.length,Ue=Me-1;Pe<Me;Ue=Pe++){const qe=ve[Pe],Ge=ve[Ue],Qe=qe.x*Ge.y-Ge.x*qe.y;te+=(qe.x+Ge.x)*Qe,ie+=(qe.y+Ge.y)*Qe,$+=3*Qe}return new Pl(te/$,ie/$,0,Z)}(i),O=L.length;for(;L.length;){const Z=L.pop();(Z.d>F.d||!F.d)&&(F=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,O)),Z.max-F.d<=e||(M=Z.h/2,L.push(new Pl(Z.p.x-M,Z.p.y-M,M,i)),L.push(new Pl(Z.p.x+M,Z.p.y-M,M,i)),L.push(new Pl(Z.p.x-M,Z.p.y+M,M,i)),L.push(new Pl(Z.p.x+M,Z.p.y+M,M,i)),O+=4)}return r&&(console.log(`num probes: ${O}`),console.log(`best distance: ${F.d}`)),F.p}function Rc(i,e){return e.max-i.max}function Pl(i,e,r,s){this.p=new Wt(i,e),this.h=r,this.d=function(p,m){let g=!1,I=1/0;for(let E=0;E<m.length;E++){const M=m[E];for(let L=0,F=M.length,O=F-1;L<F;O=L++){const Z=M[L],$=M[O];Z.y>p.y!=$.y>p.y&&p.x<($.x-Z.x)*(p.y-Z.y)/($.y-Z.y)+Z.x&&(g=!g),I=Math.min(I,sl(p,Z,$))}}return(g?1:-1)*Math.sqrt(I)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Ph=Number.POSITIVE_INFINITY;function lu(i,e){return e[1]!==Ph?function(r,s,p){let m=0,g=0;switch(s=Math.abs(s),p=Math.abs(p),r){case"top-right":case"top-left":case"top":g=p-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-p}switch(r){case"top-right":case"bottom-right":case"right":m=-s;break;case"top-left":case"bottom-left":case"left":m=s}return[m,g]}(i,e[0],e[1]):function(r,s){let p=0,m=0;s<0&&(s=0);const g=s/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=g-7;break;case"bottom-right":case"bottom-left":m=7-g;break;case"bottom":m=7-s;break;case"top":m=s-7}switch(r){case"top-right":case"bottom-right":p=-g;break;case"top-left":case"bottom-left":p=g;break;case"left":p=s;break;case"right":p=-s}return[p,m]}(i,e[0])}function uu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wr(i,e,r,s,p,m,g,I,E,M,L){let F=m.textMaxSize.evaluate(e,{});F===void 0&&(F=g);const O=i.layers[0].layout,Z=O.get("icon-offset").evaluate(e,{},L),$=cu(r.horizontal),te=g/24,ie=i.tilePixelRatio*te,ve=i.tilePixelRatio*F/24,Pe=i.tilePixelRatio*I,Me=i.tilePixelRatio*O.get("symbol-spacing"),Ue=O.get("text-padding")*i.tilePixelRatio,qe=O.get("icon-padding")*i.tilePixelRatio,Ge=O.get("text-max-angle")/180*Math.PI,Qe=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",yt=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",nt=O.get("symbol-placement"),tt=Me/2,at=O.get("icon-text-fit");let ct;s&&at!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ct=Ip(s,r.vertical,at,O.get("icon-text-fit-padding"),Z,te)),$&&(s=Ip(s,$,at,O.get("icon-text-fit-padding"),Z,te)));const pt=(Je,Tt)=>{Tt.x<0||Tt.x>=Vi||Tt.y<0||Tt.y>=Vi||function(At,li,fi,wi,ki,er,qi,tr,Ki,yr,Xi,gr,ai,Pi,Ci,xi,Lr,Tr,Ti,Zi,mi,Ai,$r,Fr,Un){const _r=At.addToLineVertexArray(li,fi);let Xn,Wn,To,eo,Hn=0,So=0,Ms=0,fc=0,Fl=-1,pu=-1;const Fa={};let mc=vt(""),ss=0,du=0;if(tr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ss,du]=tr.layout.get("text-offset").evaluate(mi,{},Fr).map(Kn=>Kn*dn):(ss=tr.layout.get("text-radial-offset").evaluate(mi,{},Fr)*dn,du=Ph),At.allowVerticalPlacement&&wi.vertical){const Kn=tr.layout.get("text-rotate").evaluate(mi,{},Fr)+90;To=new cc(Ki,li,yr,Xi,gr,wi.vertical,ai,Pi,Ci,Kn),qi&&(eo=new cc(Ki,li,yr,Xi,gr,qi,Lr,Tr,Ci,Kn))}if(ki){const Kn=tr.layout.get("icon-rotate").evaluate(mi,{}),Ta=tr.layout.get("icon-text-fit")!=="none",Ds=su(ki,Kn,$r,Ta),ml=qi?su(qi,Kn,$r,Ta):void 0;Wn=new cc(Ki,li,yr,Xi,gr,ki,Lr,Tr,!1,Kn),Hn=4*Ds.length;const jl=At.iconSizeData;let ls=null;jl.kind==="source"?(ls=[ks*tr.layout.get("icon-size").evaluate(mi,{})],ls[0]>Ml&&Jt(`${At.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):jl.kind==="composite"&&(ls=[ks*Ai.compositeIconSizes[0].evaluate(mi,{},Fr),ks*Ai.compositeIconSizes[1].evaluate(mi,{},Fr)],(ls[0]>Ml||ls[1]>Ml)&&Jt(`${At.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),At.addSymbols(At.icon,Ds,ls,Zi,Ti,mi,v.WritingMode.none,li,_r.lineStartIndex,_r.lineLength,-1,Fr),Fl=At.icon.placedSymbolArray.length-1,ml&&(So=4*ml.length,At.addSymbols(At.icon,ml,ls,Zi,Ti,mi,v.WritingMode.vertical,li,_r.lineStartIndex,_r.lineLength,-1,Fr),pu=At.icon.placedSymbolArray.length-1)}const fu=Object.keys(wi.horizontal);for(const Kn of fu){const Ta=wi.horizontal[Kn];if(!Xn){mc=vt(Ta.text);const ml=tr.layout.get("text-rotate").evaluate(mi,{},Fr);Xn=new cc(Ki,li,yr,Xi,gr,Ta,ai,Pi,Ci,ml)}const Ds=Ta.positionedLines.length===1;if(Ms+=Bc(At,li,Ta,er,tr,Ci,mi,xi,_r,wi.vertical?v.WritingMode.horizontal:v.WritingMode.horizontalOnly,Ds?fu:[Kn],Fa,Fl,Ai,Fr),Ds)break}wi.vertical&&(fc+=Bc(At,li,wi.vertical,er,tr,Ci,mi,xi,_r,v.WritingMode.vertical,["vertical"],Fa,pu,Ai,Fr));const Ol=Xn?Xn.boxStartIndex:At.collisionBoxArray.length,ju=Xn?Xn.boxEndIndex:At.collisionBoxArray.length,Vc=To?To.boxStartIndex:At.collisionBoxArray.length,Nc=To?To.boxEndIndex:At.collisionBoxArray.length,yc=Wn?Wn.boxStartIndex:At.collisionBoxArray.length,gc=Wn?Wn.boxEndIndex:At.collisionBoxArray.length,qc=eo?eo.boxStartIndex:At.collisionBoxArray.length,_c=eo?eo.boxEndIndex:At.collisionBoxArray.length;let Vo=-1;const Ul=(Kn,Ta)=>Kn&&Kn.circleDiameter?Math.max(Kn.circleDiameter,Ta):Ta;Vo=Ul(Xn,Vo),Vo=Ul(To,Vo),Vo=Ul(Wn,Vo),Vo=Ul(eo,Vo);const vc=Vo>-1?1:0;vc&&(Vo*=Un/dn),At.glyphOffsetArray.length>=hu.MAX_GLYPHS&&Jt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),mi.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,mi.sortKey),At.symbolInstances.emplaceBack(li.x,li.y,Fa.right>=0?Fa.right:-1,Fa.center>=0?Fa.center:-1,Fa.left>=0?Fa.left:-1,Fa.vertical||-1,Fl,pu,mc,Ol,ju,Vc,Nc,yc,gc,qc,_c,yr,Ms,fc,Hn,So,vc,0,ai,ss,du,Vo)}(i,Tt,Je,r,s,p,ct,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ie,Ue,Qe,E,Pe,qe,yt,Z,e,m,M,L,g)};if(nt==="line")for(const Je of kp(e.geometry,0,0,Vi,Vi)){const Tt=Nd(Je,Me,Ge,r.vertical||$,s,24,ve,i.overscaling,Vi);for(const At of Tt){const li=$;li&&$d(i,li.text,tt,At)||pt(Je,At)}}else if(nt==="line-center"){for(const Je of e.geometry)if(Je.length>1){const Tt=Ru(Je,Ge,r.vertical||$,s,24,ve);Tt&&pt(Je,Tt)}}else if(e.type==="Polygon")for(const Je of Ku(e.geometry,0)){const Tt=Gd(Je,16);pt(Je[0],new as(Tt.x,Tt.y,0))}else if(e.type==="LineString")for(const Je of e.geometry)pt(Je,new as(Je[0].x,Je[0].y,0));else if(e.type==="Point")for(const Je of e.geometry)for(const Tt of Je)pt([Tt],new as(Tt.x,Tt.y,0))}const Ml=32640;function Bc(i,e,r,s,p,m,g,I,E,M,L,F,O,Z,$){const te=function(Pe,Me,Ue,qe,Ge,Qe,yt,nt){const tt=qe.layout.get("text-rotate").evaluate(Qe,{})*Math.PI/180,at=[];for(const ct of Me.positionedLines)for(const pt of ct.positionedGlyphs){if(!pt.rect)continue;const Je=pt.rect||{};let Tt=4,At=!0,li=1,fi=0;const wi=(Ge||nt)&&pt.vertical,ki=pt.metrics.advance*pt.scale/2;if(nt&&Me.verticalizable){const Ti=(pt.scale-1)*dn,Zi=(dn-pt.metrics.width*pt.scale)/2;fi=ct.lineOffset/2-(pt.imageName?-Zi:Ti)}if(pt.imageName){const Ti=yt[pt.imageName];At=Ti.sdf,li=Ti.pixelRatio,Tt=1/li}const er=Ge?[pt.x+ki,pt.y]:[0,0];let qi=Ge?[0,0]:[pt.x+ki+Ue[0],pt.y+Ue[1]-fi],tr=[0,0];wi&&(tr=qi,qi=[0,0]);const Ki=(pt.metrics.left-Tt)*pt.scale-ki+qi[0],yr=(-pt.metrics.top-Tt)*pt.scale+qi[1],Xi=Ki+Je.w*pt.scale/li,gr=yr+Je.h*pt.scale/li,ai=new Wt(Ki,yr),Pi=new Wt(Xi,yr),Ci=new Wt(Ki,gr),xi=new Wt(Xi,gr);if(wi){const Ti=new Wt(-ki,ki-nc),Zi=-Math.PI/2,mi=12-ki,Ai=new Wt(22-mi,-(pt.imageName?mi:0)),$r=new Wt(...tr);ai._rotateAround(Zi,Ti)._add(Ai)._add($r),Pi._rotateAround(Zi,Ti)._add(Ai)._add($r),Ci._rotateAround(Zi,Ti)._add(Ai)._add($r),xi._rotateAround(Zi,Ti)._add(Ai)._add($r)}if(tt){const Ti=Math.sin(tt),Zi=Math.cos(tt),mi=[Zi,-Ti,Ti,Zi];ai._matMult(mi),Pi._matMult(mi),Ci._matMult(mi),xi._matMult(mi)}const Lr=new Wt(0,0),Tr=new Wt(0,0);at.push({tl:ai,tr:Pi,bl:Ci,br:xi,tex:Je,writingMode:Me.writingMode,glyphOffset:er,sectionIndex:pt.sectionIndex,isSDF:At,pixelOffsetTL:Lr,pixelOffsetBR:Tr,minFontScaleX:0,minFontScaleY:0})}return at}(0,r,I,p,m,g,s,i.allowVerticalPlacement),ie=i.textSizeData;let ve=null;ie.kind==="source"?(ve=[ks*p.layout.get("text-size").evaluate(g,{})],ve[0]>Ml&&Jt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(ve=[ks*Z.compositeTextSizes[0].evaluate(g,{},$),ks*Z.compositeTextSizes[1].evaluate(g,{},$)],(ve[0]>Ml||ve[1]>Ml)&&Jt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,te,ve,I,m,g,M,e,E.lineStartIndex,E.lineLength,O,$);for(const Pe of L)F[Pe]=i.text.placedSymbolArray.length-1;return 4*te.length}function cu(i){for(const e in i)return i[e];return null}function $d(i,e,r,s){const p=i.compareText;if(e in p){const m=p[e];for(let g=m.length-1;g>=0;g--)if(s.dist(m[g])<r)return!0}else p[e]=[];return p[e].push(s),!1}const Xd=Al.VectorTileFeature.types,Wd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fc(i,e,r,s,p,m,g,I,E,M,L,F,O){const Z=I?Math.min(Ml,Math.round(I[0])):0,$=I?Math.min(Ml,Math.round(I[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*p),m,g,(Z<<1)+(E?1:0),$,16*M,16*L,256*F,256*O)}function Mh(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Hd(i){for(const e of i.sections)if(uo(e.text))return!0;return!1}class Dh{constructor(e){this.layoutVertexArray=new B,this.indexArray=new se,this.programConfigurations=e,this.segments=new ge,this.dynamicLayoutVertexArray=new G,this.opacityVertexArray=new H,this.placedSymbolArray=new ft}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,p){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,pp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Wd,!0),this.opacityVertexBuffer.itemSize=1),(s||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ut("SymbolBuffers",Dh);class Oc{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ge,this.collisionVertexArray=new ue}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,dp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ut("CollisionBuffers",Oc);class hu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gu([]),this.placementViewportMatrix=Gu([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ah(this.zoom,r["text-size"]),this.iconSizeData=Ah(this.zoom,r["icon-size"]);const s=this.layers[0].layout,p=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=pc(s,"text-overlap","text-allow-overlap")!=="never"||pc(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(g=>v.WritingMode[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new Dh(new un(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Dh(new un(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Gt,this.lineVertexArray=new Lt,this.symbolInstances=new lt}calculateGlyphDependencies(e,r,s,p,m){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(s||p)&&m){const I=wa[e.charAt(g)];I&&(r[I.charCodeAt(0)]=!0)}}populate(e,r,s){const p=this.layers[0],m=p.layout,g=m.get("text-font"),I=m.get("text-field"),E=m.get("icon-image"),M=(I.value.kind!=="constant"||I.value.value instanceof pe&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),L=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,F=m.get("symbol-sort-key");if(this.features=[],!M&&!L)return;const O=r.iconDependencies,Z=r.glyphDependencies,$=r.availableImages,te=new kr(this.zoom);for(const{feature:ie,id:ve,index:Pe,sourceLayerIndex:Me}of e){const Ue=p._featureFilter.needGeometry,qe=hn(ie,Ue);if(!p._featureFilter.filter(te,qe,s))continue;let Ge,Qe;if(Ue||(qe.geometry=cn(ie)),M){const nt=p.getValueAndResolveTokens("text-field",qe,s,$),tt=pe.factory(nt);Hd(tt)&&(this.hasRTLText=!0),(!this.hasRTLText||ws()==="unavailable"||this.hasRTLText&&Br.isParsed())&&(Ge=fp(tt,p,qe))}if(L){const nt=p.getValueAndResolveTokens("icon-image",qe,s,$);Qe=nt instanceof Ie?nt:Ie.fromString(nt)}if(!Ge&&!Qe)continue;const yt=this.sortFeaturesByKey?F.evaluate(qe,{},s):void 0;if(this.features.push({id:ve,text:Ge,icon:Qe,index:Pe,sourceLayerIndex:Me,geometry:qe.geometry,properties:ie.properties,type:Xd[ie.type],sortKey:yt}),Qe&&(O[Qe.name]=!0),Ge){const nt=g.evaluate(qe,{},s).join(","),tt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.WritingMode.vertical)>=0;for(const at of Ge.sections)if(at.image)O[at.image.name]=!0;else{const ct=es(Ge.toString()),pt=at.fontStack||nt,Je=Z[pt]=Z[pt]||{};this.calculateGlyphDependencies(at.text,Je,tt,this.allowVerticalPlacement,ct)}}}m.get("symbol-placement")==="line"&&(this.features=function(ie){const ve={},Pe={},Me=[];let Ue=0;function qe(nt){Me.push(ie[nt]),Ue++}function Ge(nt,tt,at){const ct=Pe[nt];return delete Pe[nt],Pe[tt]=ct,Me[ct].geometry[0].pop(),Me[ct].geometry[0]=Me[ct].geometry[0].concat(at[0]),ct}function Qe(nt,tt,at){const ct=ve[tt];return delete ve[tt],ve[nt]=ct,Me[ct].geometry[0].shift(),Me[ct].geometry[0]=at[0].concat(Me[ct].geometry[0]),ct}function yt(nt,tt,at){const ct=at?tt[0][tt[0].length-1]:tt[0][0];return`${nt}:${ct.x}:${ct.y}`}for(let nt=0;nt<ie.length;nt++){const tt=ie[nt],at=tt.geometry,ct=tt.text?tt.text.toString():null;if(!ct){qe(nt);continue}const pt=yt(ct,at),Je=yt(ct,at,!0);if(pt in Pe&&Je in ve&&Pe[pt]!==ve[Je]){const Tt=Qe(pt,Je,at),At=Ge(pt,Je,Me[Tt].geometry);delete ve[pt],delete Pe[Je],Pe[yt(ct,Me[At].geometry,!0)]=At,Me[Tt].geometry=null}else pt in Pe?Ge(pt,Je,at):Je in ve?Qe(pt,Je,at):(qe(nt),ve[pt]=Ue-1,Pe[Je]=Ue-1)}return Me.filter(nt=>nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,ve)=>ie.sortKey-ve.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(r[e.segment+1]),m=e.dist(r[e.segment]);const g={};for(let I=e.segment+1;I<r.length;I++)g[I]={x:r[I].x,y:r[I].y,tileUnitDistanceFromAnchor:p},I<r.length-1&&(p+=r[I+1].dist(r[I]));for(let I=e.segment||0;I>=0;I--)g[I]={x:r[I].x,y:r[I].y,tileUnitDistanceFromAnchor:m},I>0&&(m+=r[I-1].dist(r[I]));for(let I=0;I<r.length;I++){const E=g[I];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,p,m,g,I,E,M,L,F,O){const Z=e.indexArray,$=e.layoutVertexArray,te=e.segments.prepareSegment(4*r.length,$,Z,this.canOverlap?g.sortKey:void 0),ie=this.glyphOffsetArray.length,ve=te.vertexLength,Pe=this.allowVerticalPlacement&&I===v.WritingMode.vertical?Math.PI/2:0,Me=g.text&&g.text.sections;for(let Ue=0;Ue<r.length;Ue++){const{tl:qe,tr:Ge,bl:Qe,br:yt,tex:nt,pixelOffsetTL:tt,pixelOffsetBR:at,minFontScaleX:ct,minFontScaleY:pt,glyphOffset:Je,isSDF:Tt,sectionIndex:At}=r[Ue],li=te.vertexLength,fi=Je[1];Fc($,E.x,E.y,qe.x,fi+qe.y,nt.x,nt.y,s,Tt,tt.x,tt.y,ct,pt),Fc($,E.x,E.y,Ge.x,fi+Ge.y,nt.x+nt.w,nt.y,s,Tt,at.x,tt.y,ct,pt),Fc($,E.x,E.y,Qe.x,fi+Qe.y,nt.x,nt.y+nt.h,s,Tt,tt.x,at.y,ct,pt),Fc($,E.x,E.y,yt.x,fi+yt.y,nt.x+nt.w,nt.y+nt.h,s,Tt,at.x,at.y,ct,pt),Mh(e.dynamicLayoutVertexArray,E,Pe),Z.emplaceBack(li,li+1,li+2),Z.emplaceBack(li+1,li+2,li+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),Ue!==r.length-1&&At===r[Ue+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,g,g.index,{},O,Me&&Me[At])}e.placedSymbolArray.emplaceBack(E.x,E.y,ie,this.glyphOffsetArray.length-ie,ve,M,L,E.segment,s?s[0]:0,s?s[1]:0,p[0],p[1],I,0,!1,0,F)}_addCollisionDebugVertex(e,r,s,p,m,g){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,p,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,r,s,p,m,g,I){const E=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),M=E.vertexLength,L=m.layoutVertexArray,F=m.collisionVertexArray,O=I.anchorX,Z=I.anchorY;this._addCollisionDebugVertex(L,F,g,O,Z,new Wt(e,r)),this._addCollisionDebugVertex(L,F,g,O,Z,new Wt(s,r)),this._addCollisionDebugVertex(L,F,g,O,Z,new Wt(s,p)),this._addCollisionDebugVertex(L,F,g,O,Z,new Wt(e,p)),E.vertexLength+=4;const $=m.indexArray;$.emplaceBack(M,M+1),$.emplaceBack(M+1,M+2),$.emplaceBack(M+2,M+3),$.emplaceBack(M+3,M),E.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,p){for(let m=e;m<r;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,p?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Oc(oe,ec.members,Se),this.iconCollisionBox=new Oc(oe,ec.members,Se);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,p,m,g,I,E,M){const L={};for(let F=r;F<s;F++){const O=e.get(F);L.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},L.textFeatureIndex=O.featureIndex;break}for(let F=p;F<m;F++){const O=e.get(F);L.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},L.verticalTextFeatureIndex=O.featureIndex;break}for(let F=g;F<I;F++){const O=e.get(F);L.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},L.iconFeatureIndex=O.featureIndex;break}for(let F=E;F<M;F++){const O=e.get(F);L.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},L.verticalIconFeatureIndex=O.featureIndex;break}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),p=s.vertexStartIndex+4*s.numGlyphs;for(let m=s.vertexStartIndex;m<p;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),p=[],m=[],g=[];for(let I=0;I<this.symbolInstances.length;++I){g.push(I);const E=this.symbolInstances.get(I);p.push(0|Math.round(r*E.anchorX+s*E.anchorY)),m.push(E.featureIndex)}return g.sort((I,E)=>p[I]-p[E]||m[E]-m[I]),g}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((p,m,g)=>{p>=0&&g.indexOf(p)===m&&this.addIndicesForPlacedSymbol(this.text,p)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ut("SymbolBucket",hu,{omit:["layers","collisionBoxArray","features","compareText"]}),hu.MAX_GLYPHS=65535,hu.addDynamicAttributes=Mh;const Ap=new mr({"symbol-placement":new Qt(ot.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qt(ot.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qt(ot.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qt(ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(ot.layout_symbol["icon-size"]),"icon-text-fit":new Qt(ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(ot.layout_symbol["icon-image"]),"icon-rotate":new Ot(ot.layout_symbol["icon-rotate"]),"icon-padding":new Qt(ot.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(ot.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(ot.layout_symbol["icon-offset"]),"icon-anchor":new Ot(ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(ot.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(ot.layout_symbol["text-field"]),"text-font":new Ot(ot.layout_symbol["text-font"]),"text-size":new Ot(ot.layout_symbol["text-size"]),"text-max-width":new Ot(ot.layout_symbol["text-max-width"]),"text-line-height":new Qt(ot.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(ot.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(ot.layout_symbol["text-justify"]),"text-radial-offset":new Ot(ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(ot.layout_symbol["text-variable-anchor"]),"text-anchor":new Ot(ot.layout_symbol["text-anchor"]),"text-max-angle":new Qt(ot.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(ot.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(ot.layout_symbol["text-rotate"]),"text-padding":new Qt(ot.layout_symbol["text-padding"]),"text-keep-upright":new Qt(ot.layout_symbol["text-keep-upright"]),"text-transform":new Ot(ot.layout_symbol["text-transform"]),"text-offset":new Ot(ot.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(ot.layout_symbol["text-allow-overlap"]),"text-overlap":new Qt(ot.layout_symbol["text-overlap"]),"text-ignore-placement":new Qt(ot.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(ot.layout_symbol["text-optional"])});var Uc={paint:new mr({"icon-opacity":new Ot(ot.paint_symbol["icon-opacity"]),"icon-color":new Ot(ot.paint_symbol["icon-color"]),"icon-halo-color":new Ot(ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(ot.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ot(ot.paint_symbol["text-opacity"]),"text-color":new Ot(ot.paint_symbol["text-color"],{runtimeType:tn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ot(ot.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(ot.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(ot.paint_symbol["text-halo-blur"]),"text-translate":new Qt(ot.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(ot.paint_symbol["text-translate-anchor"])}),layout:Ap};class hc{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut("FormatSectionOverride",hc,{omit:["defaultValue"]});class As extends Gr{constructor(e){super(e,Uc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const p=[];for(const m of s)p.indexOf(m)<0&&p.push(m);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,p){const m=this.layout.get(e).evaluate(r,{},s,p),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||ms(g.value)||!m?m:function(I,E){return E.replace(/{([^{}]+)}/g,(M,L)=>L in I?String(I[L]):"")}(r.properties,m)}createBucket(e){return new hu(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Uc.paint.overridableProperties){if(!As.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new hc(r),p=new la(s,r.property.specification);let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new ua("source",p):new Na("composite",p,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Lo(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&As.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),p=Uc.paint.properties[r];let m=!1;const g=I=>{for(const E of I)if(p.overrides&&p.overrides.hasOverride(E))return void(m=!0)};if(s.value.kind==="constant"&&s.value.value instanceof pe)g(s.value.value.sections);else if(s.value.kind==="source"){const I=M=>{m||(M instanceof Ke&&de(M.value)===Vn?g(M.value.sections):M instanceof bt?g(M.sections):M.eachChild(I))},E=s.value;E._styleExpression&&I(E._styleExpression.expression)}return m}}function pc(i,e,r){let s="never";const p=i.get(e);return p?s=p:i.get(r)&&(s="always"),s}var Ou={paint:new mr({"background-color":new Qt(ot.paint_background["background-color"]),"background-pattern":new Zn(ot.paint_background["background-pattern"]),"background-opacity":new Qt(ot.paint_background["background-opacity"])})},zp={paint:new mr({"raster-opacity":new Qt(ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qt(ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(ot.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(ot.paint_raster["raster-saturation"]),"raster-contrast":new Qt(ot.paint_raster["raster-contrast"]),"raster-resampling":new Qt(ot.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(ot.paint_raster["raster-fade-duration"])})};class xn extends Gr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const Ur={circle:class extends Gr{constructor(i){super(i,Yl)}createBucket(i){return new vo(i)}queryRadius(i){const e=i;return va("circle-radius",this,e)+va("circle-stroke-width",this,e)+qr(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,s,p,m,g,I){const E=Or(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,g),M=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),L=this.paint.get("circle-pitch-alignment")==="map",F=L?E:function(Z,$){return Z.map(te=>kl(te,$))}(E,I),O=L?M*g:M;for(const Z of s)for(const $ of Z){const te=L?$:kl($,I);let ie=O;const ve=Es([],[$.x,$.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ve[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=m.cameraToCenterDistance/ve[3]),Ss(F,te,ie))return!0}return!1}},heatmap:class extends Gr{constructor(i){super(i,lh),this._updateColorRamp()}createBucket(i){return new sh(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Gr{constructor(i){super(i,dd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Gr{constructor(i){super(i,Ed)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new _h(i)}queryRadius(){return qr(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,s,p,m,g){return nl(Or(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,g),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Gr{constructor(i){super(i,Ld)}createBucket(i){return new Ic(i)}queryRadius(){return qr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,s,p,m,g,I){const E=Or(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,g),M=this.paint.get("fill-extrusion-height").evaluate(e,r),L=this.paint.get("fill-extrusion-base").evaluate(e,r),F=function(Z,$,te,ie){const ve=[];for(const Pe of Z){const Me=[Pe.x,Pe.y,0,1];Es(Me,Me,$),ve.push(new Wt(Me[0]/Me[3],Me[1]/Me[3]))}return ve}(E,I),O=function(Z,$,te,ie){const ve=[],Pe=[],Me=ie[8]*$,Ue=ie[9]*$,qe=ie[10]*$,Ge=ie[11]*$,Qe=ie[8]*te,yt=ie[9]*te,nt=ie[10]*te,tt=ie[11]*te;for(const at of Z){const ct=[],pt=[];for(const Je of at){const Tt=Je.x,At=Je.y,li=ie[0]*Tt+ie[4]*At+ie[12],fi=ie[1]*Tt+ie[5]*At+ie[13],wi=ie[2]*Tt+ie[6]*At+ie[14],ki=ie[3]*Tt+ie[7]*At+ie[15],er=wi+qe,qi=ki+Ge,tr=li+Qe,Ki=fi+yt,yr=wi+nt,Xi=ki+tt,gr=new Wt((li+Me)/qi,(fi+Ue)/qi);gr.z=er/qi,ct.push(gr);const ai=new Wt(tr/Xi,Ki/Xi);ai.z=yr/Xi,pt.push(ai)}ve.push(ct),Pe.push(pt)}return[ve,Pe]}(s,L,M,I);return function(Z,$,te){let ie=1/0;nl(te,$)&&(ie=bh(te,$[0]));for(let ve=0;ve<$.length;ve++){const Pe=$[ve],Me=Z[ve];for(let Ue=0;Ue<Pe.length-1;Ue++){const qe=Pe[Ue],Ge=[qe,Pe[Ue+1],Me[Ue+1],Me[Ue],qe];Au(te,Ge)&&(ie=Math.min(ie,bh(te,Ge)))}}return ie!==1/0&&ie}(O[0],O[1],F)}},line:class extends Gr{constructor(i){super(i,Th),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Bs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=cp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new wh(i)}queryRadius(i){const e=i,r=hp(va("line-width",this,e),va("line-gap-width",this,e)),s=va("line-offset",this,e);return r/2+Math.abs(s)+qr(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,s,p,m,g){const I=Or(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,g),E=g/2*hp(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),M=this.paint.get("line-offset").evaluate(e,r);return M&&(s=function(L,F){const O=[];for(let Z=0;Z<L.length;Z++){const $=L[Z],te=[];for(let ie=0;ie<$.length;ie++){const ve=$[ie-1],Pe=$[ie],Me=$[ie+1],Ue=ie===0?new Wt(0,0):Pe.sub(ve)._unit()._perp(),qe=ie===$.length-1?new Wt(0,0):Me.sub(Pe)._unit()._perp(),Ge=Ue._add(qe)._unit(),Qe=Ge.x*qe.x+Ge.y*qe.y;Qe!==0&&Ge._mult(1/Qe),te.push(Ge._mult(F)._add(Pe))}O.push(te)}return O}(s,M*g)),function(L,F,O){for(let Z=0;Z<F.length;Z++){const $=F[Z];if(L.length>=3){for(let te=0;te<$.length;te++)if(Ro(L,$[te]))return!0}if(ol(L,$,O))return!0}return!1}(I,s,E)}isTileClipped(){return!0}},symbol:As,background:class extends Gr{constructor(i){super(i,Ou)}},raster:class extends Gr{constructor(i){super(i,zp)}}};class Cp{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Lh=63710088e-1;class on{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new on(dt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,p=e.lat*r,m=Math.sin(s)*Math.sin(p)+Math.cos(s)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return Lh*Math.acos(Math.min(m,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new Dl(new on(this.lng-s,this.lat-r),new on(this.lng+s,this.lat+r))}static convert(e){if(e instanceof on)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new on(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new on(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Dl{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof on?new on(e.lng,e.lat):on.convert(e),this}setSouthWest(e){return this._sw=e instanceof on?new on(e.lng,e.lat):on.convert(e),this}extend(e){const r=this._sw,s=this._ne;let p,m;if(e instanceof on)p=e,m=e;else{if(!(e instanceof Dl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Dl.convert(e)):this.extend(on.convert(e)):this;if(p=e._sw,m=e._ne,!p||!m)return this}return r||s?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),s.lng=Math.max(m.lng,s.lng),s.lat=Math.max(m.lat,s.lat)):(this._sw=new on(p.lng,p.lat),this._ne=new on(m.lng,m.lat)),this}getCenter(){return new on((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new on(this.getWest(),this.getNorth())}getSouthEast(){return new on(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=on.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&p}static convert(e){return e instanceof Dl?e:e&&new Dl(e)}}const Rh=2*Math.PI*Lh;function jc(i){return Rh*Math.cos(i*Math.PI/180)}function Ll(i){return(180+i)/360}function Rl(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Bh(i,e){return i/jc(e)}function an(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Bl{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=on.convert(e);return new Bl(Ll(s.lng),Rl(s.lat),Bh(r,s.lat))}toLngLat(){return new on(360*this.x-180,an(this.y))}toAltitude(){return this.z*jc(an(this.y))}meterInMercatorCoordinateUnits(){return 1/Rh*(e=an(this.y),1/Math.cos(e*Math.PI/180));var e}}function zs(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Uu{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=Cs(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const p=(g=this.y,I=this.z,E=zs(256*(m=this.x),256*(g=Math.pow(2,I)-g-1),I),M=zs(256*(m+1),256*(g+1),I),E[0]+","+E[1]+","+M[0]+","+M[1]);var m,g,I,E,M;const L=function(F,O,Z){let $,te="";for(let ie=F;ie>0;ie--)$=1<<ie-1,te+=(O&$?1:0)+(Z&$?2:0);return te}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}getTilePoint(e){const r=Math.pow(2,this.z);return new Wt((e.x*r-this.x)*Vi,(e.y*r-this.y)*Vi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dc{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Cs(e,r.z,r.z,r.x,r.y)}}class ea{constructor(e,r,s,p,m){this.overscaledZ=e,this.wrap=r,this.canonical=new Uu(s,+p,+m),this.key=Cs(r,e,s,p,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ea(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ea(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){const s=this.canonical.z-e;return e>this.canonical.z?Cs(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Cs(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ea(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,p=2*this.canonical.y;return[new ea(r,this.wrap,r,s,p),new ea(r,this.wrap,r,s+1,p),new ea(r,this.wrap,r,s,p+1),new ea(r,this.wrap,r,s+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ea(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ea(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Bl(e.x-this.wrap,e.y))}}function Cs(i,e,r,s,p){(i*=2)<0&&(i=-1*i-1);const m=1<<r;return(m*m*i+m*p+s).toString(36)+r.toString(36)+e.toString(36)}Ut("CanonicalTileID",Uu),Ut("OverscaledTileID",ea,{omit:["posMatrix"]});class Ps{constructor(e,r,s){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Jt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox";for(let m=0;m<p;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(p,m)]=this.data[this._idx(p-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,p)]=this.data[this._idx(m,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]}get(e,r){const s=new Uint8Array(this.data.buffer),p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[p],s[p+1],s[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}getPixels(){return new xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,m=r*this.dim+this.dim,g=s*this.dim,I=s*this.dim+this.dim;switch(r){case-1:p=m-1;break;case 1:m=p+1}switch(s){case-1:g=I-1;break;case 1:I=g+1}const E=-r*this.dim,M=-s*this.dim;for(let L=g;L<I;L++)for(let F=p;F<m;F++)this.data[this._idx(F,L)]=e.data[this._idx(F+E,L+M)]}}Ut("DEMData",Ps);class Fh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Oh{constructor(e,r,s,p,m){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=p,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Pp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gi(Vi,16,0),this.grid3D=new Gi(Vi,16,0),this.featureIndexArray=new l,this.promoteId=r}insert(e,r,s,p,m,g){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,p,m);const E=g?this.grid3D:this.grid;for(let M=0;M<r.length;M++){const L=r[M],F=[1/0,1/0,-1/0,-1/0];for(let O=0;O<L.length;O++){const Z=L[O];F[0]=Math.min(F[0],Z.x),F[1]=Math.min(F[1],Z.y),F[2]=Math.max(F[2],Z.x),F[3]=Math.max(F[3],Z.y)}F[0]<Vi&&F[1]<Vi&&F[2]>=0&&F[3]>=0&&E.insert(I,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Al.VectorTile(new Ec(this.rawTileData)).layers,this.sourceLayerCoder=new Fh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,p){this.loadVTLayers();const m=e.params||{},g=Vi/e.tileSize/e.scale,I=Ga(m.filter),E=e.queryGeometry,M=e.queryPadding*g,L=fl(E),F=this.grid.query(L.minX-M,L.minY-M,L.maxX+M,L.maxY+M),O=fl(e.cameraQueryGeometry),Z=this.grid3D.query(O.minX-M,O.minY-M,O.maxX+M,O.maxY+M,(ie,ve,Pe,Me)=>function(Ue,qe,Ge,Qe,yt){for(const tt of Ue)if(qe<=tt.x&&Ge<=tt.y&&Qe>=tt.x&&yt>=tt.y)return!0;const nt=[new Wt(qe,Ge),new Wt(qe,yt),new Wt(Qe,yt),new Wt(Qe,Ge)];if(Ue.length>2){for(const tt of nt)if(Ro(Ue,tt))return!0}for(let tt=0;tt<Ue.length-1;tt++)if(_a(Ue[tt],Ue[tt+1],nt))return!0;return!1}(e.cameraQueryGeometry,ie-M,ve-M,Pe+M,Me+M));for(const ie of Z)F.push(ie);F.sort(Mp);const $={};let te;for(let ie=0;ie<F.length;ie++){const ve=F[ie];if(ve===te)continue;te=ve;const Pe=this.featureIndexArray.get(ve);let Me=null;this.loadMatchingFeature($,Pe.bucketIndex,Pe.sourceLayerIndex,Pe.featureIndex,I,m.layers,m.availableImages,r,s,p,(Ue,qe,Ge)=>(Me||(Me=cn(Ue)),qe.queryIntersectsFeature(E,Ue,Ge,Me,this.z,e.transform,g,e.pixelPosMatrix)))}return $}loadMatchingFeature(e,r,s,p,m,g,I,E,M,L,F){const O=this.bucketLayerIDs[r];if(g&&!function(ie,ve){for(let Pe=0;Pe<ie.length;Pe++)if(ve.indexOf(ie[Pe])>=0)return!0;return!1}(g,O))return;const Z=this.sourceLayerCoder.decode(s),$=this.vtLayers[Z].feature(p);if(m.needGeometry){const ie=hn($,!0);if(!m.filter(new kr(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!m.filter(new kr(this.tileID.overscaledZ),$))return;const te=this.getId($,Z);for(let ie=0;ie<O.length;ie++){const ve=O[ie];if(g&&g.indexOf(ve)<0)continue;const Pe=E[ve];if(!Pe)continue;let Me={};te&&L&&(Me=L.getState(Pe.sourceLayer||"_geojsonTileLayer",te));const Ue=zt({},M[ve]);Ue.paint=En(Ue.paint,Pe.paint,$,Me,I),Ue.layout=En(Ue.layout,Pe.layout,$,Me,I);const qe=!F||F($,Pe,Me);if(!qe)continue;const Ge=new Oh($,this.z,this.x,this.y,te);Ge.layer=Ue;let Qe=e[ve];Qe===void 0&&(Qe=e[ve]=[]),Qe.push({featureIndex:p,feature:Ge,intersectionZ:qe})}}lookupSymbolFeatures(e,r,s,p,m,g,I,E){const M={};this.loadVTLayers();const L=Ga(m);for(const F of e)this.loadMatchingFeature(M,s,p,F,L,g,I,E,r);return M}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function En(i,e,r,s,p){return hr(i,(m,g)=>{const I=e instanceof co?e.get(g):null;return I&&I.evaluate?I.evaluate(r,s,p):I})}function fl(i){let e=1/0,r=1/0,s=-1/0,p=-1/0;for(const m of i)e=Math.min(e,m.x),r=Math.min(r,m.y),s=Math.max(s,m.x),p=Math.max(p,m.y);return{minX:e,minY:r,maxX:s,maxY:p}}function Mp(i,e){return e-i}var t;Ut("FeatureIndex",Pp,{omit:["rawTileData","sourceLayerCoder"]}),v.PerformanceMarkers=void 0,(t=v.PerformanceMarkers||(v.PerformanceMarkers={})).create="create",t.load="load",t.fullLoad="fullLoad";let n=null,a=[];const d=1e3/30,_={mark(i){performance.mark(i)},frame(i){const e=i;n!=null&&a.push(e-n),n=e},clearMetrics(){n=null,a=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in v.PerformanceMarkers)performance.clearMarks(v.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",v.PerformanceMarkers.create,v.PerformanceMarkers.load),performance.measure("fullLoadTime",v.PerformanceMarkers.create,v.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=a.length,s=1/(a.reduce((m,g)=>m+g,0)/r/1e3),p=a.filter(m=>m>d).reduce((m,g)=>m+(g-d)/d,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:p/(r+p)*100}}};v.AJAXError=Ht,v.ARRAY_TYPE=is,v.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ct(["receive","process"],this),this.invoker=new Cp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=or()?i:window}send(i,e,r,s,p=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[m]=r);const g=lr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:i,hasCallback:!!r,targetMapId:s,mustQueue:p,sourceMapId:this.mapId,data:bs(e,g)},g),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s()}else or()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Mo(e.error)):r(null,Mo(e.data)))}else{let r=!1;const s=lr(this.globalScope)?void 0:[],p=e.hasCallback?(I,E)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:I?bs(I):null,data:bs(E,s)},s)}:I=>{r=!0};let m=null;const g=Mo(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,g,p);else if(this.parent.getWorkerSource){const I=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,I[0],g.source)[I[1]](g,p)}else p(new Error(`Could not find function ${e.type}`));!r&&m&&m.cancel&&(this.cancelCallbacks[i]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},v.AlphaImage=zu,v.CanonicalTileID=Uu,v.CollisionBoxArray=it,v.CollisionCircleLayoutArray=class extends X{},v.Color=j,v.DEMData=Ps,v.DataConstantProperty=Qt,v.DictionaryCoder=Fh,v.EXTENT=Vi,v.ErrorEvent=zn,v.EvaluationParameters=kr,v.Event=io,v.Evented=Sa,v.FeatureIndex=Pp,v.FillBucket=_h,v.FillExtrusionBucket=Ic,v.GeoJSONFeature=Oh,v.ImageAtlas=bp,v.ImagePosition=Cc,v.LineBucket=wh,v.LineStripIndexArray=class extends We{},v.LngLat=on,v.LngLatBounds=Dl,v.MercatorCoordinate=Bl,v.ONE_EM=dn,v.OverscaledTileID=ea,v.PerformanceUtils=_,v.PosArray=class extends _n{},v.Properties=mr,v.QuadTriangleArray=class extends ae{},v.RGBAImage=xa,v.RasterBoundsArray=class extends $n{},v.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},v.ResourceType=zr,v.SegmentVector=ge,v.SymbolBucket=hu,v.Transitionable=Bn,v.TriangleIndexArray=se,v.Uniform1f=Bi,v.Uniform1i=class extends Nt{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},v.Uniform2f=class extends Nt{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},v.Uniform3f=class extends Nt{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},v.Uniform4f=jt,v.UniformColor=bi,v.UniformMatrix4f=class extends Nt{constructor(i,e){super(i,e),this.current=Di}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},v.UnwrappedTileID=dc,v.ValidationError=Mt,v.ZoomHistory=fa,v.addDynamicAttributes=Mh,v.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const p=new Array(i.length);let m=null;i.forEach((g,I)=>{e(g,(E,M)=>{E&&(m=E),p[I]=M,--s==0&&r(m,p)})})},v.bezier=Oe,v.bindAll=Ct,v.cacheEntryPossiblyAdded=function(i){Qi++,Qi>Fi&&(i.getActor().send("enforceCacheSizeLimit",si),Qi=0)},v.clamp=xe,v.clearTileCache=function(i){const e=caches.delete(Jn);i&&e.catch(i).then(()=>i())},v.clipLine=kp,v.clone=function(i){var e=new is(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},v.clone$1=Et,v.collisionCircleLayout=Mr,v.config=An,v.create=function(){var i=new is(16);return is!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},v.createExpression=Ko,v.createFilter=Ga,v.createLayout=gt,v.createStyleLayer=function(i){return i.type==="custom"?new xn(i):new Ur[i.type](i)},v.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},v.ease=Xe,v.emitValidationErrors=da,v.enforceCacheSizeLimit=function(i){Oi(),kt&&kt.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-i;s++)e.delete(r[s])})})},v.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:p}){return i.kind==="source"?s/ks:i.kind==="composite"?Kr(s/ks,p/ks,r):e},v.evaluateSizeForZoom=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:g}=i,I=p?xe(rr.interpolationFactor(p,e,m,g),0,1):0;i.kind==="camera"?s=Kr(i.minSize,i.maxSize,I):r=I}return{uSizeT:r,uSize:s}},v.evaluateVariableOffset=lu,v.evented=ma,v.exported=Yr,v.exported$1=Ui,v.extend=zt,v.filterObject=wt,v.getAnchorAlignment=Lc,v.getAnchorJustification=uu,v.getArrayBuffer=Eo,v.getImage=Go,v.getJSON=function(i,e){return Wr(zt(i,{type:"json"}),e)},v.getOverlapMode=pc,v.getRTLTextPluginStatus=ws,v.getReferrer=jr,v.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const p=window.document.createElement("source");to(i[s])||(r.crossOrigin="Anonymous"),p.src=i[s],r.appendChild(p)}return{cancel:()=>{}}},v.identity=Gu,v.invert=function(i,e){var r=e[0],s=e[1],p=e[2],m=e[3],g=e[4],I=e[5],E=e[6],M=e[7],L=e[8],F=e[9],O=e[10],Z=e[11],$=e[12],te=e[13],ie=e[14],ve=e[15],Pe=r*I-s*g,Me=r*E-p*g,Ue=r*M-m*g,qe=s*E-p*I,Ge=s*M-m*I,Qe=p*M-m*E,yt=L*te-F*$,nt=L*ie-O*$,tt=L*ve-Z*$,at=F*ie-O*te,ct=F*ve-Z*te,pt=O*ve-Z*ie,Je=Pe*pt-Me*ct+Ue*at+qe*tt-Ge*nt+Qe*yt;return Je?(i[0]=(I*pt-E*ct+M*at)*(Je=1/Je),i[1]=(p*ct-s*pt-m*at)*Je,i[2]=(te*Qe-ie*Ge+ve*qe)*Je,i[3]=(O*Ge-F*Qe-Z*qe)*Je,i[4]=(E*tt-g*pt-M*nt)*Je,i[5]=(r*pt-p*tt+m*nt)*Je,i[6]=(ie*Ue-$*Qe-ve*Me)*Je,i[7]=(L*Qe-O*Ue+Z*Me)*Je,i[8]=(g*ct-I*tt+M*yt)*Je,i[9]=(s*tt-r*ct-m*yt)*Je,i[10]=($*Ge-te*Ue+ve*Pe)*Je,i[11]=(F*Ue-L*Ge-Z*Pe)*Je,i[12]=(I*nt-g*at-E*yt)*Je,i[13]=(r*at-s*nt+p*yt)*Je,i[14]=(te*Me-$*qe-ie*Pe)*Je,i[15]=(L*qe-F*Me+O*Pe)*Je,i):null},v.isImageBitmap=Li,v.isSafari=lr,v.keysDifference=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},v.lazyLoadRTLTextPlugin=function(){Br.isLoading()||Br.isLoaded()||ws()!=="deferred"||Yn()},v.makeRequest=Wr,v.mapObject=hr,v.mercatorXfromLng=Ll,v.mercatorYfromLat=Rl,v.mercatorZfromAltitude=Bh,v.mul=Tc,v.multiply=Ql,v.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},v.number=Kr,v.ortho=function(i,e,r,s,p,m,g){var I=1/(e-r),E=1/(s-p),M=1/(m-g);return i[0]=-2*I,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(e+r)*I,i[13]=(p+s)*E,i[14]=(g+m)*M,i[15]=1,i},v.parseCacheControl=zi,v.parseGlyphPBF=function(i){return new Ec(i).readFields(Ac,[])},v.pbf=Ec,v.performSymbolLayout=function(i,e,r,s,p,m,g){i.createArrays(),i.tilePixelRatio=Vi/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const I=i.layers[0].layout,E=i.layers[0]._unevaluatedLayout._values,M={layoutIconSize:E["icon-size"].possiblyEvaluate(new kr(i.zoom+1),g),layoutTextSize:E["text-size"].possiblyEvaluate(new kr(i.zoom+1),g),textMaxSize:E["text-size"].possiblyEvaluate(new kr(18))};if(i.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:te}=i.textSizeData;M.compositeTextSizes=[E["text-size"].possiblyEvaluate(new kr($),g),E["text-size"].possiblyEvaluate(new kr(te),g)]}if(i.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:te}=i.iconSizeData;M.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new kr($),g),E["icon-size"].possiblyEvaluate(new kr(te),g)]}const L=I.get("text-line-height")*dn,F=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",O=I.get("text-keep-upright"),Z=I.get("text-size");for(const $ of i.features){const te=I.get("text-font").evaluate($,{},g).join(","),ie=Z.evaluate($,{},g),ve=M.layoutTextSize.evaluate($,{},g),Pe=M.layoutIconSize.evaluate($,{},g),Me={horizontal:{},vertical:void 0},Ue=$.text;let qe,Ge=[0,0];if(Ue){const nt=Ue.toString(),tt=I.get("text-letter-spacing").evaluate($,{},g)*dn,at=el(nt)?tt:0,ct=I.get("text-anchor").evaluate($,{},g),pt=I.get("text-variable-anchor");if(!pt){const fi=I.get("text-radial-offset").evaluate($,{},g);Ge=fi?lu(ct,[fi*dn,Ph]):I.get("text-offset").evaluate($,{},g).map(wi=>wi*dn)}let Je=F?"center":I.get("text-justify").evaluate($,{},g);const Tt=I.get("symbol-placement"),At=Tt==="point"?I.get("text-max-width").evaluate($,{},g)*dn:0,li=()=>{i.allowVerticalPlacement&&es(nt)&&(Me.vertical=Pc(Ue,e,r,p,te,At,L,ct,"left",at,Ge,v.WritingMode.vertical,!0,Tt,ve,ie))};if(!F&&pt){const fi=Je==="auto"?pt.map(ki=>uu(ki)):[Je];let wi=!1;for(let ki=0;ki<fi.length;ki++){const er=fi[ki];if(!Me.horizontal[er])if(wi)Me.horizontal[er]=Me.horizontal[0];else{const qi=Pc(Ue,e,r,p,te,At,L,"center",er,at,Ge,v.WritingMode.horizontal,!1,Tt,ve,ie);qi&&(Me.horizontal[er]=qi,wi=qi.positionedLines.length===1)}}li()}else{Je==="auto"&&(Je=uu(ct));const fi=Pc(Ue,e,r,p,te,At,L,ct,Je,at,Ge,v.WritingMode.horizontal,!1,Tt,ve,ie);fi&&(Me.horizontal[Je]=fi),li(),es(nt)&&F&&O&&(Me.vertical=Pc(Ue,e,r,p,te,At,L,ct,Je,at,Ge,v.WritingMode.vertical,!1,Tt,ve,ie))}}let Qe=!1;if($.icon&&$.icon.name){const nt=s[$.icon.name];nt&&(qe=Vd(p[$.icon.name],I.get("icon-offset").evaluate($,{},g),I.get("icon-anchor").evaluate($,{},g)),Qe=!!nt.sdf,i.sdfIcons===void 0?i.sdfIcons=Qe:i.sdfIcons!==Qe&&Jt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==i.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const yt=cu(Me.horizontal)||Me.vertical;i.iconsInText=!!yt&&yt.iconsInText,(yt||qe)&&wr(i,$,Me,qe,s,M,ve,Pe,Ge,Qe,g)}m&&i.generateCollisionDebugBuffers()},v.perspective=function(i,e,r,s,p){var m,g=1/Math.tan(e/2);return i[0]=g/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+s)*(m=1/(s-p)),i[14]=2*p*s*m):(i[10]=-1,i[14]=-2*s),i},v.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const p=e[s];p in i&&(r[p]=i[p])}return r},v.plugin=Br,v.pointGeometry=Wt,v.polygonIntersectsPolygon=Au,v.potpack=Ih,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=Ut,v.registerForPluginStateChange=function(i){return i({pluginStatus:Pr,pluginURL:Do}),ma.on("pluginStateChange",i),i},v.renderColorRamp=tp,v.rotateX=function(i,e,r){var s=Math.sin(r),p=Math.cos(r),m=e[4],g=e[5],I=e[6],E=e[7],M=e[8],L=e[9],F=e[10],O=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*p+M*s,i[5]=g*p+L*s,i[6]=I*p+F*s,i[7]=E*p+O*s,i[8]=M*p-m*s,i[9]=L*p-g*s,i[10]=F*p-I*s,i[11]=O*p-E*s,i},v.rotateZ=function(i,e,r){var s=Math.sin(r),p=Math.cos(r),m=e[0],g=e[1],I=e[2],E=e[3],M=e[4],L=e[5],F=e[6],O=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*p+M*s,i[1]=g*p+L*s,i[2]=I*p+F*s,i[3]=E*p+O*s,i[4]=M*p-m*s,i[5]=L*p-g*s,i[6]=F*p-I*s,i[7]=O*p-E*s,i},v.scale=function(i,e,r){var s=r[0],p=r[1],m=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},v.setCacheLimits=function(i,e){si=i,Fi=e},v.setRTLTextPlugin=function(i,e,r=!1){if(Pr===Dt||Pr===ts||Pr===Ra)throw new Error("setRTLTextPlugin cannot be called multiple times.");Do=Yr.resolveURL(i),Pr=Dt,Yo=e,Bt(),r||Yn()},v.spec=ot,v.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},v.toEvaluationFeature=hn,v.transformMat4=Es,v.translate=function(i,e,r){var s,p,m,g,I,E,M,L,F,O,Z,$,te=r[0],ie=r[1],ve=r[2];return e===i?(i[12]=e[0]*te+e[4]*ie+e[8]*ve+e[12],i[13]=e[1]*te+e[5]*ie+e[9]*ve+e[13],i[14]=e[2]*te+e[6]*ie+e[10]*ve+e[14],i[15]=e[3]*te+e[7]*ie+e[11]*ve+e[15]):(p=e[1],m=e[2],g=e[3],I=e[4],E=e[5],M=e[6],L=e[7],F=e[8],O=e[9],Z=e[10],$=e[11],i[0]=s=e[0],i[1]=p,i[2]=m,i[3]=g,i[4]=I,i[5]=E,i[6]=M,i[7]=L,i[8]=F,i[9]=O,i[10]=Z,i[11]=$,i[12]=s*te+I*ie+F*ve+e[12],i[13]=p*te+E*ie+O*ve+e[13],i[14]=m*te+M*ie+Z*ve+e[14],i[15]=g*te+L*ie+$*ve+e[15]),i},v.triggerPluginCompletionEvent=qn,v.unicodeBlockLookup=Ft,v.uniqueId=function(){return ci++},v.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},v.validateLight=fr,v.validateStyle=pa,v.vectorTile=Al,v.warnOnce=Jt,v.wrap=dt}),Y(["./shared"],function(v){function ce(ee){const V=typeof ee;if(V==="number"||V==="boolean"||V==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let ne="[";for(const pe of ee)ne+=`${ce(pe)},`;return`${ne}]`}const j=Object.keys(ee).sort();let J="{";for(let ne=0;ne<j.length;ne++)J+=`${JSON.stringify(j[ne])}:${ce(ee[j[ne]])},`;return`${J}}`}function Te(ee){let V="";for(const j of v.refProperties)V+=`/${ce(ee[j])}`;return V}class Oe{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,j){for(const ne of V){this._layerConfigs[ne.id]=ne;const pe=this._layers[ne.id]=v.createStyleLayer(ne);pe._featureFilter=v.createFilter(pe.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of j)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const J=function(ne,pe){const Ie={};for(let _e=0;_e<ne.length;_e++){const de=pe&&pe[ne[_e].id]||Te(ne[_e]);pe&&(pe[ne[_e].id]=de);let $e=Ie[de];$e||($e=Ie[de]=[]),$e.push(ne[_e])}const le=[];for(const _e in Ie)le.push(Ie[_e]);return le}(Object.values(this._layerConfigs),this.keyCache);for(const ne of J){const pe=ne.map(Ke=>this._layers[Ke.id]),Ie=pe[0];if(Ie.visibility==="none")continue;const le=Ie.source||"";let _e=this.familiesBySource[le];_e||(_e=this.familiesBySource[le]={});const de=Ie.sourceLayer||"_geojsonTileLayer";let $e=_e[de];$e||($e=_e[de]=[]),$e.push(pe)}}}class Xe{constructor(V){const j={},J=[];for(const le in V){const _e=V[le],de=j[le]={};for(const $e in _e){const Ke=_e[+$e];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Be={x:0,y:0,w:Ke.bitmap.width+2,h:Ke.bitmap.height+2};J.push(Be),de[$e]={rect:Be,metrics:Ke.metrics}}}const{w:ne,h:pe}=v.potpack(J),Ie=new v.AlphaImage({width:ne||1,height:pe||1});for(const le in V){const _e=V[le];for(const de in _e){const $e=_e[+de];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Ke=j[le][de].rect;v.AlphaImage.copy($e.bitmap,Ie,{x:0,y:0},{x:Ke.x+1,y:Ke.y+1},$e.bitmap)}}this.image=Ie,this.positions=j}}v.register("GlyphAtlas",Xe);class xe{constructor(V){this.tileID=new v.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId}parse(V,j,J,ne,pe){this.status="parsing",this.data=V,this.collisionBoxArray=new v.CollisionBoxArray;const Ie=new v.DictionaryCoder(Object.keys(V.layers).sort()),le=new v.FeatureIndex(this.tileID,this.promoteId);le.bucketLayerIDs=[];const _e={},de={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},$e=j.familiesBySource[this.source];for(const ii in $e){const qt=V.layers[ii];if(!qt)continue;qt.version===1&&v.warnOnce(`Vector tile source "${this.source}" layer "${ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const It=Ie.encode(ii),Rr=[];for(let ri=0;ri<qt.length;ri++){const Vr=qt.feature(ri),ln=le.getId(Vr,ii);Rr.push({feature:Vr,id:ln,index:ri,sourceLayerIndex:It})}for(const ri of $e[ii]){const Vr=ri[0];Vr.minzoom&&this.zoom<Math.floor(Vr.minzoom)||Vr.maxzoom&&this.zoom>=Vr.maxzoom||Vr.visibility!=="none"&&(dt(ri,this.zoom,J),(_e[Vr.id]=Vr.createBucket({index:le.bucketLayerIDs.length,layers:ri,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:It,sourceID:this.source})).populate(Rr,de,this.tileID.canonical),le.bucketLayerIDs.push(ri.map(ln=>ln.id)))}}let Ke,Be,xt,ht;const bt=v.mapObject(de.glyphDependencies,ii=>Object.keys(ii).map(Number));Object.keys(bt).length?ne.send("getGlyphs",{uid:this.uid,stacks:bt},(ii,qt)=>{Ke||(Ke=ii,Be=qt,Yt.call(this))}):Be={};const Rt=Object.keys(de.iconDependencies);Rt.length?ne.send("getImages",{icons:Rt,source:this.source,tileID:this.tileID,type:"icons"},(ii,qt)=>{Ke||(Ke=ii,xt=qt,Yt.call(this))}):xt={};const Zt=Object.keys(de.patternDependencies);function Yt(){if(Ke)return pe(Ke);if(Be&&xt&&ht){const ii=new Xe(Be),qt=new v.ImageAtlas(xt,ht);for(const It in _e){const Rr=_e[It];Rr instanceof v.SymbolBucket?(dt(Rr.layers,this.zoom,J),v.performSymbolLayout(Rr,Be,ii.positions,xt,qt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Rr.hasPattern&&(Rr instanceof v.LineBucket||Rr instanceof v.FillBucket||Rr instanceof v.FillExtrusionBucket)&&(dt(Rr.layers,this.zoom,J),Rr.addFeatures(de,this.tileID.canonical,qt.patternPositions))}this.status="done",pe(null,{buckets:Object.values(_e).filter(It=>!It.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ii.image,imageAtlas:qt,glyphMap:this.returnDependencies?Be:null,iconMap:this.returnDependencies?xt:null,glyphPositions:this.returnDependencies?ii.positions:null})}}Zt.length?ne.send("getImages",{icons:Zt,source:this.source,tileID:this.tileID,type:"patterns"},(ii,qt)=>{Ke||(Ke=ii,ht=qt,Yt.call(this))}):ht={},Yt.call(this)}}function dt(ee,V,j){const J=new v.EvaluationParameters(V);for(const ne of ee)ne.recalculate(J,j)}function zt(ee,V){const j=v.getArrayBuffer(ee.request,(J,ne,pe,Ie)=>{J?V(J):ne&&V(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(ne)),rawData:ne,cacheControl:pe,expires:Ie})});return()=>{j.cancel(),V()}}class ci{constructor(V,j,J,ne){this.actor=V,this.layerIndex=j,this.availableImages=J,this.loadVectorData=ne||zt,this.loading={},this.loaded={}}loadTile(V,j){const J=V.uid;this.loading||(this.loading={});const ne=!!(V&&V.request&&V.request.collectResourceTiming)&&new v.RequestPerformance(V.request),pe=this.loading[J]=new xe(V);pe.abort=this.loadVectorData(V,(Ie,le)=>{if(delete this.loading[J],Ie||!le)return pe.status="done",this.loaded[J]=pe,j(Ie);const _e=le.rawData,de={};le.expires&&(de.expires=le.expires),le.cacheControl&&(de.cacheControl=le.cacheControl);const $e={};if(ne){const Ke=ne.finish();Ke&&($e.resourceTiming=JSON.parse(JSON.stringify(Ke)))}pe.vectorTile=le.vectorTile,pe.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ke,Be)=>{if(Ke||!Be)return j(Ke);j(null,v.extend({rawTileData:_e.slice(0)},Be,de,$e))}),this.loaded=this.loaded||{},this.loaded[J]=pe})}reloadTile(V,j){const J=this.loaded,ne=V.uid,pe=this;if(J&&J[ne]){const Ie=J[ne];Ie.showCollisionBoxes=V.showCollisionBoxes;const le=(_e,de)=>{const $e=Ie.reloadCallback;$e&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,pe.layerIndex,this.availableImages,pe.actor,$e)),j(_e,de)};Ie.status==="parsing"?Ie.reloadCallback=le:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,le):le())}}abortTile(V,j){const J=this.loading,ne=V.uid;J&&J[ne]&&J[ne].abort&&(J[ne].abort(),delete J[ne]),j()}removeTile(V,j){const J=this.loaded,ne=V.uid;J&&J[ne]&&delete J[ne],j()}}class Ct{constructor(){this.loaded={}}loadTile(V,j){const{uid:J,encoding:ne,rawImageData:pe}=V,Ie=v.isImageBitmap(pe)?this.getImageData(pe):pe,le=new v.DEMData(J,Ie,ne);this.loaded=this.loaded||{},this.loaded[J]=le,j(null,le)}getImageData(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const j=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:j.width,height:j.height},j.data)}removeTile(V){const j=this.loaded,J=V.uid;j&&j[J]&&delete j[J]}}var hr=function ee(V,j){var J,ne=V&&V.type;if(ne==="FeatureCollection")for(J=0;J<V.features.length;J++)ee(V.features[J],j);else if(ne==="GeometryCollection")for(J=0;J<V.geometries.length;J++)ee(V.geometries[J],j);else if(ne==="Feature")ee(V.geometry,j);else if(ne==="Polygon")wt(V.coordinates,j);else if(ne==="MultiPolygon")for(J=0;J<V.coordinates.length;J++)wt(V.coordinates[J],j);return V};function wt(ee,V){if(ee.length!==0){Et(ee[0],V);for(var j=1;j<ee.length;j++)Et(ee[j],!V)}}function Et(ee,V){for(var j=0,J=0,ne=0,pe=ee.length,Ie=pe-1;ne<pe;Ie=ne++){var le=(ee[ne][0]-ee[Ie][0])*(ee[Ie][1]+ee[ne][1]),_e=j+le;J+=Math.abs(j)>=Math.abs(le)?j-_e+le:le-_e+j,j=_e}j+J>=0!=!!V&&ee.reverse()}const oi=v.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Jt{constructor(V){this._feature=V,this.extent=v.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const j of this._feature.geometry)V.push([new v.pointGeometry(j[0],j[1])]);return V}{const V=[];for(const j of this._feature.geometry){const J=[];for(const ne of j)J.push(new v.pointGeometry(ne[0],ne[1]));V.push(J)}return V}}toGeoJSON(V,j,J){return oi.call(this,V,j,J)}}class Kt{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=V.length,this._features=V}feature(V){return new Jt(this._features[V])}}var pi={exports:{}},or=v.pointGeometry,zi=v.vectorTile.VectorTileFeature,sn=Xr;function Xr(ee,V){this.options=V||{},this.features=ee,this.length=ee.length}function fn(ee,V){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=V||4096}Xr.prototype.feature=function(ee){return new fn(this.features[ee],this.options.extent)},fn.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var V=0;V<ee.length;V++){for(var j=ee[V],J=[],ne=0;ne<j.length;ne++)J.push(new or(j[ne][0],j[ne][1]));this.geometry.push(J)}return this.geometry},fn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,V=1/0,j=-1/0,J=1/0,ne=-1/0,pe=0;pe<ee.length;pe++)for(var Ie=ee[pe],le=0;le<Ie.length;le++){var _e=Ie[le];V=Math.min(V,_e.x),j=Math.max(j,_e.x),J=Math.min(J,_e.y),ne=Math.max(ne,_e.y)}return[V,J,j,ne]},fn.prototype.toGeoJSON=zi.prototype.toGeoJSON;var lr=v.pbf,Li=sn;function Yr(ee){var V=new lr;return function(j,J){for(var ne in j.layers)J.writeMessage(3,Wt,j.layers[ne])}(ee,V),V.finish()}function Wt(ee,V){var j;V.writeVarintField(15,ee.version||1),V.writeStringField(1,ee.name||""),V.writeVarintField(5,ee.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ee.length;j++)J.feature=ee.feature(j),V.writeMessage(2,Qr,J);var ne=J.keys;for(j=0;j<ne.length;j++)V.writeStringField(3,ne[j]);var pe=J.values;for(j=0;j<pe.length;j++)V.writeMessage(4,si,pe[j])}function Qr(ee,V){var j=ee.feature;j.id!==void 0&&V.writeVarintField(1,j.id),V.writeMessage(2,An,ee),V.writeVarintField(3,j.type),V.writeMessage(4,ti,j)}function An(ee,V){var j=ee.feature,J=ee.keys,ne=ee.values,pe=ee.keycache,Ie=ee.valuecache;for(var le in j.properties){var _e=j.properties[le],de=pe[le];if(_e!==null){de===void 0&&(J.push(le),pe[le]=de=J.length-1),V.writeVarint(de);var $e=typeof _e;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(_e=JSON.stringify(_e));var Ke=$e+":"+_e,Be=Ie[Ke];Be===void 0&&(ne.push(_e),Ie[Ke]=Be=ne.length-1),V.writeVarint(Be)}}}function Jn(ee,V){return(V<<3)+(7&ee)}function kt(ee){return ee<<1^ee>>31}function ti(ee,V){for(var j=ee.loadGeometry(),J=ee.type,ne=0,pe=0,Ie=j.length,le=0;le<Ie;le++){var _e=j[le],de=1;J===1&&(de=_e.length),V.writeVarint(Jn(1,de));for(var $e=J===3?_e.length-1:_e.length,Ke=0;Ke<$e;Ke++){Ke===1&&J!==1&&V.writeVarint(Jn(2,$e-1));var Be=_e[Ke].x-ne,xt=_e[Ke].y-pe;V.writeVarint(kt(Be)),V.writeVarint(kt(xt)),ne+=Be,pe+=xt}J===3&&V.writeVarint(Jn(7,1))}}function si(ee,V){var j=typeof ee;j==="string"?V.writeStringField(1,ee):j==="boolean"?V.writeBooleanField(7,ee):j==="number"&&(ee%1!=0?V.writeDoubleField(3,ee):ee<0?V.writeSVarintField(6,ee):V.writeVarintField(5,ee))}pi.exports=Yr,pi.exports.fromVectorTileJs=Yr,pi.exports.fromGeojsonVt=function(ee,V){V=V||{};var j={};for(var J in ee)j[J]=new Li(ee[J].features,V),j[J].name=J,j[J].version=V.version,j[J].extent=V.extent;return Yr({layers:j})},pi.exports.GeoJSONWrapper=Li;var Fi=pi.exports;function Oi(ee,V,j,J,ne,pe){if(ne-J<=j)return;const Ie=J+ne>>1;Qi(ee,V,Ie,J,ne,pe%2),Oi(ee,V,j,J,Ie-1,pe+1),Oi(ee,V,j,Ie+1,ne,pe+1)}function Qi(ee,V,j,J,ne,pe){for(;ne>J;){if(ne-J>600){const de=ne-J+1,$e=j-J+1,Ke=Math.log(de),Be=.5*Math.exp(2*Ke/3),xt=.5*Math.sqrt(Ke*Be*(de-Be)/de)*($e-de/2<0?-1:1);Qi(ee,V,j,Math.max(J,Math.floor(j-$e*Be/de+xt)),Math.min(ne,Math.floor(j+(de-$e)*Be/de+xt)),pe)}const Ie=V[2*j+pe];let le=J,_e=ne;for(Ui(ee,V,J,j),V[2*ne+pe]>Ie&&Ui(ee,V,J,ne);le<_e;){for(Ui(ee,V,le,_e),le++,_e--;V[2*le+pe]<Ie;)le++;for(;V[2*_e+pe]>Ie;)_e--}V[2*J+pe]===Ie?Ui(ee,V,J,_e):(_e++,Ui(ee,V,_e,ne)),_e<=j&&(J=_e+1),j<=_e&&(ne=_e-1)}}function Ui(ee,V,j,J){ji(ee,j,J),ji(V,2*j,2*J),ji(V,2*j+1,2*J+1)}function ji(ee,V,j){const J=ee[V];ee[V]=ee[j],ee[j]=J}function ir(ee,V,j,J){const ne=ee-j,pe=V-J;return ne*ne+pe*pe}const gi=ee=>ee[0],vr=ee=>ee[1];class Ar{constructor(V,j=gi,J=vr,ne=64,pe=Float64Array){this.nodeSize=ne,this.points=V;const Ie=V.length<65536?Uint16Array:Uint32Array,le=this.ids=new Ie(V.length),_e=this.coords=new pe(2*V.length);for(let de=0;de<V.length;de++)le[de]=de,_e[2*de]=j(V[de]),_e[2*de+1]=J(V[de]);Oi(le,_e,ne,0,le.length-1,0)}range(V,j,J,ne){return function(pe,Ie,le,_e,de,$e,Ke){const Be=[0,pe.length-1,0],xt=[];let ht,bt;for(;Be.length;){const Rt=Be.pop(),Zt=Be.pop(),Yt=Be.pop();if(Zt-Yt<=Ke){for(let It=Yt;It<=Zt;It++)ht=Ie[2*It],bt=Ie[2*It+1],ht>=le&&ht<=de&&bt>=_e&&bt<=$e&&xt.push(pe[It]);continue}const ii=Math.floor((Yt+Zt)/2);ht=Ie[2*ii],bt=Ie[2*ii+1],ht>=le&&ht<=de&&bt>=_e&&bt<=$e&&xt.push(pe[ii]);const qt=(Rt+1)%2;(Rt===0?le<=ht:_e<=bt)&&(Be.push(Yt),Be.push(ii-1),Be.push(qt)),(Rt===0?de>=ht:$e>=bt)&&(Be.push(ii+1),Be.push(Zt),Be.push(qt))}return xt}(this.ids,this.coords,V,j,J,ne,this.nodeSize)}within(V,j,J){return function(ne,pe,Ie,le,_e,de){const $e=[0,ne.length-1,0],Ke=[],Be=_e*_e;for(;$e.length;){const xt=$e.pop(),ht=$e.pop(),bt=$e.pop();if(ht-bt<=de){for(let qt=bt;qt<=ht;qt++)ir(pe[2*qt],pe[2*qt+1],Ie,le)<=Be&&Ke.push(ne[qt]);continue}const Rt=Math.floor((bt+ht)/2),Zt=pe[2*Rt],Yt=pe[2*Rt+1];ir(Zt,Yt,Ie,le)<=Be&&Ke.push(ne[Rt]);const ii=(xt+1)%2;(xt===0?Ie-_e<=Zt:le-_e<=Yt)&&($e.push(bt),$e.push(Rt-1),$e.push(ii)),(xt===0?Ie+_e>=Zt:le+_e>=Yt)&&($e.push(Rt+1),$e.push(ht),$e.push(ii))}return Ke}(this.ids,this.coords,V,j,J,this.nodeSize)}}const zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},Ht=Math.fround||(jr=new Float32Array(1),ee=>(jr[0]=+ee,jr[0]));var jr;class Sr{constructor(V){this.options=Si(Object.create(zr),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:j,minZoom:J,maxZoom:ne,nodeSize:pe}=this.options;j&&console.time("total time");const Ie=`prepare ${V.length} points`;j&&console.time(Ie),this.points=V;let le=[];for(let _e=0;_e<V.length;_e++)V[_e].geometry&&le.push(Eo(V[_e],_e));this.trees[ne+1]=new Ar(le,wn,io,pe,Float32Array),j&&console.timeEnd(Ie);for(let _e=ne;_e>=J;_e--){const de=+Date.now();le=this._cluster(le,_e),this.trees[_e]=new Ar(le,wn,io,pe,Float32Array),j&&console.log("z%d: %d clusters in %dms",_e,le.length,+Date.now()-de)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let J=((V[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,V[1]));let pe=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)J=-180,pe=180;else if(J>pe){const $e=this.getClusters([J,ne,180,Ie],j),Ke=this.getClusters([-180,ne,pe,Ie],j);return $e.concat(Ke)}const le=this.trees[this._limitZoom(j)],_e=le.range(en(J),jn(Ie),en(pe),jn(ne)),de=[];for(const $e of _e){const Ke=le.points[$e];de.push(Ke.numPoints?to(Ke):this.points[Ke.index])}return de}getChildren(V){const j=this._getOriginId(V),J=this._getOriginZoom(V),ne="No cluster with the specified id.",pe=this.trees[J];if(!pe)throw new Error(ne);const Ie=pe.points[j];if(!Ie)throw new Error(ne);const le=this.options.radius/(this.options.extent*Math.pow(2,J-1)),_e=pe.within(Ie.x,Ie.y,le),de=[];for(const $e of _e){const Ke=pe.points[$e];Ke.parentId===V&&de.push(Ke.numPoints?to(Ke):this.points[Ke.index])}if(de.length===0)throw new Error(ne);return de}getLeaves(V,j,J){const ne=[];return this._appendLeaves(ne,V,j=j||10,J=J||0,0),ne}getTile(V,j,J){const ne=this.trees[this._limitZoom(V)],pe=Math.pow(2,V),{extent:Ie,radius:le}=this.options,_e=le/Ie,de=(J-_e)/pe,$e=(J+1+_e)/pe,Ke={features:[]};return this._addTileFeatures(ne.range((j-_e)/pe,de,(j+1+_e)/pe,$e),ne.points,j,J,pe,Ke),j===0&&this._addTileFeatures(ne.range(1-_e/pe,de,1,$e),ne.points,pe,J,pe,Ke),j===pe-1&&this._addTileFeatures(ne.range(0,de,_e/pe,$e),ne.points,-1,J,pe,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const J=this.getChildren(V);if(j++,J.length!==1)break;V=J[0].properties.cluster_id}return j}_appendLeaves(V,j,J,ne,pe){const Ie=this.getChildren(j);for(const le of Ie){const _e=le.properties;if(_e&&_e.cluster?pe+_e.point_count<=ne?pe+=_e.point_count:pe=this._appendLeaves(V,_e.cluster_id,J,ne,pe):pe<ne?pe++:V.push(le),V.length===J)break}return pe}_addTileFeatures(V,j,J,ne,pe,Ie){for(const le of V){const _e=j[le],de=_e.numPoints;let $e,Ke,Be;if(de)$e=po(_e),Ke=_e.x,Be=_e.y;else{const bt=this.points[_e.index];$e=bt.properties,Ke=en(bt.geometry.coordinates[0]),Be=jn(bt.geometry.coordinates[1])}const xt={type:1,geometry:[[Math.round(this.options.extent*(Ke*pe-J)),Math.round(this.options.extent*(Be*pe-ne))]],tags:$e};let ht;de?ht=_e.id:this.options.generateId?ht=_e.index:this.points[_e.index].id&&(ht=this.points[_e.index].id),ht!==void 0&&(xt.id=ht),Ie.features.push(xt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,j){const J=[],{radius:ne,extent:pe,reduce:Ie,minPoints:le}=this.options,_e=ne/(pe*Math.pow(2,j));for(let de=0;de<V.length;de++){const $e=V[de];if($e.zoom<=j)continue;$e.zoom=j;const Ke=this.trees[j+1],Be=Ke.within($e.x,$e.y,_e),xt=$e.numPoints||1;let ht=xt;for(const bt of Be){const Rt=Ke.points[bt];Rt.zoom>j&&(ht+=Rt.numPoints||1)}if(ht>xt&&ht>=le){let bt=$e.x*xt,Rt=$e.y*xt,Zt=Ie&&xt>1?this._map($e,!0):null;const Yt=(de<<5)+(j+1)+this.points.length;for(const ii of Be){const qt=Ke.points[ii];if(qt.zoom<=j)continue;qt.zoom=j;const It=qt.numPoints||1;bt+=qt.x*It,Rt+=qt.y*It,qt.parentId=Yt,Ie&&(Zt||(Zt=this._map($e,!0)),Ie(Zt,this._map(qt)))}$e.parentId=Yt,J.push(Wr(bt/ht,Rt/ht,Yt,ht,Zt))}else if(J.push($e),ht>1)for(const bt of Be){const Rt=Ke.points[bt];Rt.zoom<=j||(Rt.zoom=j,J.push(Rt))}}return J}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j){if(V.numPoints)return j?Si({},V.properties):V.properties;const J=this.points[V.index].properties,ne=this.options.map(J);return j&&ne===J?Si({},ne):ne}}function Wr(ee,V,j,J,ne){return{x:Ht(ee),y:Ht(V),zoom:1/0,id:j,parentId:-1,numPoints:J,properties:ne}}function Eo(ee,V){const[j,J]=ee.geometry.coordinates;return{x:Ht(en(j)),y:Ht(jn(J)),zoom:1/0,index:V,parentId:-1}}function to(ee){return{type:"Feature",id:ee.id,properties:po(ee),geometry:{type:"Point",coordinates:[(V=ee.x,360*(V-.5)),Go(ee.y)]}};var V}function po(ee){const V=ee.numPoints,j=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return Si(Si({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:V,point_count_abbreviated:j})}function en(ee){return ee/360+.5}function jn(ee){const V=Math.sin(ee*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function Go(ee){const V=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Si(ee,V){for(const j in V)ee[j]=V[j];return ee}function wn(ee){return ee.x}function io(ee){return ee.y}function zn(ee,V,j,J){for(var ne,pe=J,Ie=j-V>>1,le=j-V,_e=ee[V],de=ee[V+1],$e=ee[j],Ke=ee[j+1],Be=V+3;Be<j;Be+=3){var xt=Sa(ee[Be],ee[Be+1],_e,de,$e,Ke);if(xt>pe)ne=Be,pe=xt;else if(xt===pe){var ht=Math.abs(Be-Ie);ht<le&&(ne=Be,le=ht)}}pe>J&&(ne-V>3&&zn(ee,V,ne,J),ee[ne+2]=pe,j-ne>3&&zn(ee,ne,j,J))}function Sa(ee,V,j,J,ne,pe){var Ie=ne-j,le=pe-J;if(Ie!==0||le!==0){var _e=((ee-j)*Ie+(V-J)*le)/(Ie*Ie+le*le);_e>1?(j=ne,J=pe):_e>0&&(j+=Ie*_e,J+=le*_e)}return(Ie=ee-j)*Ie+(le=V-J)*le}function ot(ee,V,j,J){var ne={id:ee===void 0?null:ee,type:V,geometry:j,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pe){var Ie=pe.geometry,le=pe.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")Mt(pe,Ie);else if(le==="Polygon"||le==="MultiLineString")for(var _e=0;_e<Ie.length;_e++)Mt(pe,Ie[_e]);else if(le==="MultiPolygon")for(_e=0;_e<Ie.length;_e++)for(var de=0;de<Ie[_e].length;de++)Mt(pe,Ie[_e][de])}(ne),ne}function Mt(ee,V){for(var j=0;j<V.length;j+=3)ee.minX=Math.min(ee.minX,V[j]),ee.minY=Math.min(ee.minY,V[j+1]),ee.maxX=Math.max(ee.maxX,V[j]),ee.maxY=Math.max(ee.maxY,V[j+1])}function Bo(ee,V,j,J){if(V.geometry){var ne=V.geometry.coordinates,pe=V.geometry.type,Ie=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),le=[],_e=V.id;if(j.promoteId?_e=V.properties[j.promoteId]:j.generateId&&(_e=J||0),pe==="Point")ro(ne,le);else if(pe==="MultiPoint")for(var de=0;de<ne.length;de++)ro(ne[de],le);else if(pe==="LineString")pr(ne,le,Ie,!1);else if(pe==="MultiLineString"){if(j.lineMetrics){for(de=0;de<ne.length;de++)pr(ne[de],le=[],Ie,!1),ee.push(ot(_e,"LineString",le,V.properties));return}Cn(ne,le,Ie,!1)}else if(pe==="Polygon")Cn(ne,le,Ie,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(de=0;de<V.geometry.geometries.length;de++)Bo(ee,{id:_e,geometry:V.geometry.geometries[de],properties:V.properties},j,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(de=0;de<ne.length;de++){var $e=[];Cn(ne[de],$e,Ie,!0),le.push($e)}}ee.push(ot(_e,pe,le,V.properties))}}function ro(ee,V){V.push(mn(ee[0])),V.push(fo(ee[1])),V.push(0)}function pr(ee,V,j,J){for(var ne,pe,Ie=0,le=0;le<ee.length;le++){var _e=mn(ee[le][0]),de=fo(ee[le][1]);V.push(_e),V.push(de),V.push(0),le>0&&(Ie+=J?(ne*de-_e*pe)/2:Math.sqrt(Math.pow(_e-ne,2)+Math.pow(de-pe,2))),ne=_e,pe=de}var $e=V.length-3;V[2]=1,zn(V,0,$e,j),V[$e+2]=1,V.size=Math.abs(Ie),V.start=0,V.end=V.size}function Cn(ee,V,j,J){for(var ne=0;ne<ee.length;ne++){var pe=[];pr(ee[ne],pe,j,J),V.push(pe)}}function mn(ee){return ee/360+.5}function fo(ee){var V=Math.sin(ee*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function xr(ee,V,j,J,ne,pe,Ie,le){if(J/=V,pe>=(j/=V)&&Ie<J)return ee;if(Ie<j||pe>=J)return null;for(var _e=[],de=0;de<ee.length;de++){var $e=ee[de],Ke=$e.geometry,Be=$e.type,xt=ne===0?$e.minX:$e.minY,ht=ne===0?$e.maxX:$e.maxY;if(xt>=j&&ht<J)_e.push($e);else if(!(ht<j||xt>=J)){var bt=[];if(Be==="Point"||Be==="MultiPoint")St(Ke,bt,j,J,ne);else if(Be==="LineString")Mi(Ke,bt,j,J,ne,!1,le.lineMetrics);else if(Be==="MultiLineString")tn(Ke,bt,j,J,ne,!1);else if(Be==="Polygon")tn(Ke,bt,j,J,ne,!0);else if(Be==="MultiPolygon")for(var Rt=0;Rt<Ke.length;Rt++){var Zt=[];tn(Ke[Rt],Zt,j,J,ne,!0),Zt.length&&bt.push(Zt)}if(bt.length){if(le.lineMetrics&&Be==="LineString"){for(Rt=0;Rt<bt.length;Rt++)_e.push(ot($e.id,Be,bt[Rt],$e.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(bt.length===1?(Be="LineString",bt=bt[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=bt.length===3?"Point":"MultiPoint"),_e.push(ot($e.id,Be,bt,$e.tags))}}}return _e.length?_e:null}function St(ee,V,j,J,ne){for(var pe=0;pe<ee.length;pe+=3){var Ie=ee[pe+ne];Ie>=j&&Ie<=J&&(V.push(ee[pe]),V.push(ee[pe+1]),V.push(ee[pe+2]))}}function Mi(ee,V,j,J,ne,pe,Ie){for(var le,_e,de=Ii(ee),$e=ne===0?_i:mo,Ke=ee.start,Be=0;Be<ee.length-3;Be+=3){var xt=ee[Be],ht=ee[Be+1],bt=ee[Be+2],Rt=ee[Be+3],Zt=ee[Be+4],Yt=ne===0?xt:ht,ii=ne===0?Rt:Zt,qt=!1;Ie&&(le=Math.sqrt(Math.pow(xt-Rt,2)+Math.pow(ht-Zt,2))),Yt<j?ii>j&&(_e=$e(de,xt,ht,Rt,Zt,j),Ie&&(de.start=Ke+le*_e)):Yt>J?ii<J&&(_e=$e(de,xt,ht,Rt,Zt,J),Ie&&(de.start=Ke+le*_e)):Pn(de,xt,ht,bt),ii<j&&Yt>=j&&(_e=$e(de,xt,ht,Rt,Zt,j),qt=!0),ii>J&&Yt<=J&&(_e=$e(de,xt,ht,Rt,Zt,J),qt=!0),!pe&&qt&&(Ie&&(de.end=Ke+le*_e),V.push(de),de=Ii(ee)),Ie&&(Ke+=le)}var It=ee.length-3;xt=ee[It],ht=ee[It+1],bt=ee[It+2],(Yt=ne===0?xt:ht)>=j&&Yt<=J&&Pn(de,xt,ht,bt),It=de.length-3,pe&&It>=3&&(de[It]!==de[0]||de[It+1]!==de[1])&&Pn(de,de[0],de[1],de[2]),de.length&&V.push(de)}function Ii(ee){var V=[];return V.size=ee.size,V.start=ee.start,V.end=ee.end,V}function tn(ee,V,j,J,ne,pe){for(var Ie=0;Ie<ee.length;Ie++)Mi(ee[Ie],V,j,J,ne,pe,!1)}function Pn(ee,V,j,J){ee.push(V),ee.push(j),ee.push(J)}function _i(ee,V,j,J,ne,pe){var Ie=(pe-V)/(J-V);return ee.push(pe),ee.push(j+(ne-j)*Ie),ee.push(1),Ie}function mo(ee,V,j,J,ne,pe){var Ie=(pe-j)/(ne-j);return ee.push(V+(J-V)*Ie),ee.push(pe),ee.push(1),Ie}function Vn(ee,V){for(var j=[],J=0;J<ee.length;J++){var ne,pe=ee[J],Ie=pe.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")ne=ar(pe.geometry,V);else if(Ie==="MultiLineString"||Ie==="Polygon"){ne=[];for(var le=0;le<pe.geometry.length;le++)ne.push(ar(pe.geometry[le],V))}else if(Ie==="MultiPolygon")for(ne=[],le=0;le<pe.geometry.length;le++){for(var _e=[],de=0;de<pe.geometry[le].length;de++)_e.push(ar(pe.geometry[le][de],V));ne.push(_e)}j.push(ot(pe.id,Ie,ne,pe.tags))}return j}function ar(ee,V){var j=[];j.size=ee.size,ee.start!==void 0&&(j.start=ee.start,j.end=ee.end);for(var J=0;J<ee.length;J+=3)j.push(ee[J]+V,ee[J+1],ee[J+2]);return j}function W(ee,V){if(ee.transformed)return ee;var j,J,ne,pe=1<<ee.z,Ie=ee.x,le=ee.y;for(j=0;j<ee.features.length;j++){var _e=ee.features[j],de=_e.geometry,$e=_e.type;if(_e.geometry=[],$e===1)for(J=0;J<de.length;J+=2)_e.geometry.push(Q(de[J],de[J+1],V,pe,Ie,le));else for(J=0;J<de.length;J++){var Ke=[];for(ne=0;ne<de[J].length;ne+=2)Ke.push(Q(de[J][ne],de[J][ne+1],V,pe,Ie,le));_e.geometry.push(Ke)}}return ee.transformed=!0,ee}function Q(ee,V,j,J,ne,pe){return[Math.round(j*(ee*J-ne)),Math.round(j*(V*J-pe))]}function re(ee,V,j,J,ne){for(var pe=V===ne.maxZoom?0:ne.tolerance/((1<<V)*ne.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:J,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},le=0;le<ee.length;le++){Ie.numFeatures++,he(Ie,ee[le],pe,ne);var _e=ee[le].minX,de=ee[le].minY,$e=ee[le].maxX,Ke=ee[le].maxY;_e<Ie.minX&&(Ie.minX=_e),de<Ie.minY&&(Ie.minY=de),$e>Ie.maxX&&(Ie.maxX=$e),Ke>Ie.maxY&&(Ie.maxY=Ke)}return Ie}function he(ee,V,j,J){var ne=V.geometry,pe=V.type,Ie=[];if(pe==="Point"||pe==="MultiPoint")for(var le=0;le<ne.length;le+=3)Ie.push(ne[le]),Ie.push(ne[le+1]),ee.numPoints++,ee.numSimplified++;else if(pe==="LineString")be(Ie,ne,ee,j,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(le=0;le<ne.length;le++)be(Ie,ne[le],ee,j,pe==="Polygon",le===0);else if(pe==="MultiPolygon")for(var _e=0;_e<ne.length;_e++){var de=ne[_e];for(le=0;le<de.length;le++)be(Ie,de[le],ee,j,!0,le===0)}if(Ie.length){var $e=V.tags||null;if(pe==="LineString"&&J.lineMetrics){for(var Ke in $e={},V.tags)$e[Ke]=V.tags[Ke];$e.mapbox_clip_start=ne.start/ne.size,$e.mapbox_clip_end=ne.end/ne.size}var Be={geometry:Ie,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:$e};V.id!==null&&(Be.id=V.id),ee.features.push(Be)}}function be(ee,V,j,J,ne,pe){var Ie=J*J;if(J>0&&V.size<(ne?Ie:J))j.numPoints+=V.length/3;else{for(var le=[],_e=0;_e<V.length;_e+=3)(J===0||V[_e+2]>Ie)&&(j.numSimplified++,le.push(V[_e]),le.push(V[_e+1])),j.numPoints++;ne&&function(de,$e){for(var Ke=0,Be=0,xt=de.length,ht=xt-2;Be<xt;ht=Be,Be+=2)Ke+=(de[Be]-de[ht])*(de[Be+1]+de[ht+1]);if(Ke>0===$e)for(Be=0,xt=de.length;Be<xt/2;Be+=2){var bt=de[Be],Rt=de[Be+1];de[Be]=de[xt-2-Be],de[Be+1]=de[xt-1-Be],de[xt-2-Be]=bt,de[xt-1-Be]=Rt}}(le,pe),ee.push(le)}}function De(ee,V){var j=(V=this.options=function(ne,pe){for(var Ie in pe)ne[Ie]=pe[Ie];return ne}(Object.create(this.options),V)).debug;if(j&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ne,pe){var Ie=[];if(ne.type==="FeatureCollection")for(var le=0;le<ne.features.length;le++)Bo(Ie,ne.features[le],pe,le);else Bo(Ie,ne.type==="Feature"?ne:{geometry:ne},pe);return Ie}(ee,V);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(ne,pe){var Ie=pe.buffer/pe.extent,le=ne,_e=xr(ne,1,-1-Ie,Ie,0,-1,2,pe),de=xr(ne,1,1-Ie,2+Ie,0,-1,2,pe);return(_e||de)&&(le=xr(ne,1,-Ie,1+Ie,0,-1,2,pe)||[],_e&&(le=Vn(_e,1).concat(le)),de&&(le=le.concat(Vn(de,-1)))),le}(J,V),J.length&&this.splitTile(J,0,0,0),j&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fe(ee,V,j){return 32*((1<<ee)*j+V)+ee}function Le(ee,V){const j=ee.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const J=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!J)return V(null,null);const ne=new Kt(J.features);let pe=Fi(ne);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),V(null,{vectorTile:ne,rawData:pe.buffer})}De.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},De.prototype.splitTile=function(ee,V,j,J,ne,pe,Ie){for(var le=[ee,V,j,J],_e=this.options,de=_e.debug;le.length;){J=le.pop(),j=le.pop(),V=le.pop(),ee=le.pop();var $e=1<<V,Ke=Fe(V,j,J),Be=this.tiles[Ke];if(!Be&&(de>1&&console.time("creation"),Be=this.tiles[Ke]=re(ee,V,j,J,_e),this.tileCoords.push({z:V,x:j,y:J}),de)){de>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,j,J,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var xt="z"+V;this.stats[xt]=(this.stats[xt]||0)+1,this.total++}if(Be.source=ee,ne){if(V===_e.maxZoom||V===ne)continue;var ht=1<<ne-V;if(j!==Math.floor(pe/ht)||J!==Math.floor(Ie/ht))continue}else if(V===_e.indexMaxZoom||Be.numPoints<=_e.indexMaxPoints)continue;if(Be.source=null,ee.length!==0){de>1&&console.time("clipping");var bt,Rt,Zt,Yt,ii,qt,It=.5*_e.buffer/_e.extent,Rr=.5-It,ri=.5+It,Vr=1+It;bt=Rt=Zt=Yt=null,ii=xr(ee,$e,j-It,j+ri,0,Be.minX,Be.maxX,_e),qt=xr(ee,$e,j+Rr,j+Vr,0,Be.minX,Be.maxX,_e),ee=null,ii&&(bt=xr(ii,$e,J-It,J+ri,1,Be.minY,Be.maxY,_e),Rt=xr(ii,$e,J+Rr,J+Vr,1,Be.minY,Be.maxY,_e),ii=null),qt&&(Zt=xr(qt,$e,J-It,J+ri,1,Be.minY,Be.maxY,_e),Yt=xr(qt,$e,J+Rr,J+Vr,1,Be.minY,Be.maxY,_e),qt=null),de>1&&console.timeEnd("clipping"),le.push(bt||[],V+1,2*j,2*J),le.push(Rt||[],V+1,2*j,2*J+1),le.push(Zt||[],V+1,2*j+1,2*J),le.push(Yt||[],V+1,2*j+1,2*J+1)}}},De.prototype.getTile=function(ee,V,j){var J=this.options,ne=J.extent,pe=J.debug;if(ee<0||ee>24)return null;var Ie=1<<ee,le=Fe(ee,V=(V%Ie+Ie)%Ie,j);if(this.tiles[le])return W(this.tiles[le],ne);pe>1&&console.log("drilling down to z%d-%d-%d",ee,V,j);for(var _e,de=ee,$e=V,Ke=j;!_e&&de>0;)de--,$e=Math.floor($e/2),Ke=Math.floor(Ke/2),_e=this.tiles[Fe(de,$e,Ke)];return _e&&_e.source?(pe>1&&console.log("found parent tile z%d-%d-%d",de,$e,Ke),pe>1&&console.time("drilling down"),this.splitTile(_e.source,de,$e,Ke,ee,V,j),pe>1&&console.timeEnd("drilling down"),this.tiles[le]?W(this.tiles[le],ne):null):null};class ye extends ci{constructor(V,j,J,ne){super(V,j,J,Le),ne&&(this.loadGeoJSON=ne)}loadData(V,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=j,this._pendingLoadDataParams=V,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const V=this._pendingCallback,j=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const J=!!(j&&j.request&&j.request.collectResourceTiming)&&new v.RequestPerformance(j.request);this.loadGeoJSON(j,(ne,pe)=>{if(ne||!pe)return V(ne);if(typeof pe!="object")return V(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{hr(pe,!0);try{if(j.filter){const le=v.createExpression(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(de=>`${de.key}: ${de.message}`).join(", "));const _e=pe.features.filter(de=>le.value.evaluate({zoom:0},de));pe={type:"FeatureCollection",features:_e}}this._geoJSONIndex=j.cluster?new Sr(function({superclusterOptions:le,clusterProperties:_e}){if(!_e||!le)return le;const de={},$e={},Ke={accumulated:null,zoom:0},Be={properties:null},xt=Object.keys(_e);for(const ht of xt){const[bt,Rt]=_e[ht],Zt=v.createExpression(Rt),Yt=v.createExpression(typeof bt=="string"?[bt,["accumulated"],["get",ht]]:bt);de[ht]=Zt.value,$e[ht]=Yt.value}return le.map=ht=>{Be.properties=ht;const bt={};for(const Rt of xt)bt[Rt]=de[Rt].evaluate(Ke,Be);return bt},le.reduce=(ht,bt)=>{Be.properties=bt;for(const Rt of xt)Ke.accumulated=ht[Rt],ht[Rt]=$e[Rt].evaluate(Ke,Be)},le}(j)).load(pe.features):function(le,_e){return new De(le,_e)}(pe,j.geojsonVtOptions)}catch(le){return V(le)}this.loaded={};const Ie={};if(J){const le=J.finish();le&&(Ie.resourceTiming={},Ie.resourceTiming[j.source]=JSON.parse(JSON.stringify(le)))}V(null,Ie)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(V,j){const J=this.loaded;return J&&J[V.uid]?super.reloadTile(V,j):this.loadTile(V,j)}loadGeoJSON(V,j){if(V.request)v.getJSON(V.request,j);else{if(typeof V.data!="string")return j(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(V.data))}catch{return j(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}removeSource(V,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),j()}getClusterExpansionZoom(V,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(J){j(J)}}getClusterChildren(V,j){try{j(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(J){j(J)}}getClusterLeaves(V,j){try{j(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(J){j(J)}}}class ke{constructor(V){this.self=V,this.actor=new v.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ci,geojson:ye},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,J)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=J},this.self.registerRTLTextPlugin=j=>{if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=j.applyArabicShaping,v.plugin.processBidirectionalText=j.processBidirectionalText,v.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}setReferrer(V,j){this.referrer=j}setImages(V,j,J){this.availableImages[V]=j;for(const ne in this.workerSources[V]){const pe=this.workerSources[V][ne];for(const Ie in pe)pe[Ie].availableImages=j}J()}setLayers(V,j,J){this.getLayerIndex(V).replace(j),J()}updateLayers(V,j,J){this.getLayerIndex(V).update(j.layers,j.removedIds),J()}loadTile(V,j,J){this.getWorkerSource(V,j.type,j.source).loadTile(j,J)}loadDEMTile(V,j,J){this.getDEMWorkerSource(V,j.source).loadTile(j,J)}reloadTile(V,j,J){this.getWorkerSource(V,j.type,j.source).reloadTile(j,J)}abortTile(V,j,J){this.getWorkerSource(V,j.type,j.source).abortTile(j,J)}removeTile(V,j,J){this.getWorkerSource(V,j.type,j.source).removeTile(j,J)}removeDEMTile(V,j){this.getDEMWorkerSource(V,j.source).removeTile(j)}removeSource(V,j,J){if(!this.workerSources[V]||!this.workerSources[V][j.type]||!this.workerSources[V][j.type][j.source])return;const ne=this.workerSources[V][j.type][j.source];delete this.workerSources[V][j.type][j.source],ne.removeSource!==void 0?ne.removeSource(j,J):J()}loadWorkerSource(V,j,J){try{this.self.importScripts(j.url),J()}catch(ne){J(ne.toString())}}syncRTLPluginState(V,j,J){try{v.plugin.setState(j);const ne=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const pe=v.plugin.isParsed();J(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),pe)}}catch(ne){J(ne.toString())}}getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new Oe),j}getWorkerSource(V,j,J){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][J]){const ne={send:(pe,Ie,le)=>{this.actor.send(pe,Ie,le,V)}};this.workerSources[V][j][J]=new this.workerSourceTypes[j](ne,this.getLayerIndex(V),this.getAvailableImages(V))}return this.workerSources[V][j][J]}getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new Ct),this.demWorkerSources[V][j]}enforceCacheSizeLimit(V,j){v.enforceCacheSizeLimit(j)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ke(self)),ke}),Y(["./shared"],function(v){var ce=Te;function Te(b){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,S,k=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(k);try{S=new Worker(D),x=!0}catch{x=!1}return S&&S.terminate(),URL.revokeObjectURL(D),x}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var x=document.createElement("canvas");x.width=x.height=1;var S=x.getContext("2d");if(!S)return!1;var k=S.getImageData(0,0,1,1);return k&&k.width===x.width}()?(Oe[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(Oe[h]=function(x){var S,k=function(D){var U=document.createElement("canvas"),N=Object.create(Te.webGLContextAttributes);return N.failIfMajorPerformanceCaveat=D,U.getContext("webgl",N)||U.getContext("experimental-webgl",N)}(x);if(!k)return!1;try{S=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!S||k.isContextLost())&&(k.shaderSource(S,"void main() {}"),k.compileShader(S),k.getShaderParameter(S,k.COMPILE_STATUS)===!0)}(h)),Oe[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(b)}var Oe={};function Xe(b,o){if(Array.isArray(b)){if(!Array.isArray(o)||b.length!==o.length)return!1;for(let h=0;h<b.length;h++)if(!Xe(b[h],o[h]))return!1;return!0}if(typeof b=="object"&&b!==null&&o!==null){if(typeof o!="object"||Object.keys(b).length!==Object.keys(o).length)return!1;for(const h in b)if(!Xe(b[h],o[h]))return!1;return!0}return b===o}Te.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class xe{static testProp(o){if(!xe.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in xe.docStyle)return o[h];return o[0]}static create(o,h,x){const S=window.document.createElement(o);return h!==void 0&&(S.className=h),x&&x.appendChild(S),S}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){xe.docStyle&&xe.selectProp&&(xe.userSelect=xe.docStyle[xe.selectProp],xe.docStyle[xe.selectProp]="none")}static enableDrag(){xe.docStyle&&xe.selectProp&&(xe.docStyle[xe.selectProp]=xe.userSelect)}static setTransform(o,h){o.style[xe.transformProp]=h}static addEventListener(o,h,x,S={}){o.addEventListener(h,x,"passive"in S?S:S.capture)}static removeEventListener(o,h,x,S={}){o.removeEventListener(h,x,"passive"in S?S:S.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",xe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",xe.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",xe.suppressClickInternal,!0)},0)}static mousePos(o,h){const x=o.getBoundingClientRect();return new v.pointGeometry(h.clientX-x.left-o.clientLeft,h.clientY-x.top-o.clientTop)}static touchPos(o,h){const x=o.getBoundingClientRect(),S=[];for(let k=0;k<h.length;k++)S.push(new v.pointGeometry(h[k].clientX-x.left-o.clientLeft,h[k].clientY-x.top-o.clientTop));return S}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}xe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,xe.selectProp=xe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),xe.transformProp=xe.testProp(["transform","WebkitTransform"]);class dt{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,x){const S=function(k){const D=k.match(zt);if(!D)throw new Error(`Unable to parse URL "${k}"`);return{protocol:D[1],authority:D[2],path:D[3]||"/",params:D[4]?D[4].split("&"):[]}}(o);return S.path+=`${h}${x}`,function(k){const D=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${D}`}(S)}setTransformRequest(o){this._transformRequestFn=o}}const zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ci(b){var o=new v.ARRAY_TYPE(3);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o}var Ct,hr=function(b,o,h){return b[0]=o[0]-h[0],b[1]=o[1]-h[1],b[2]=o[2]-h[2],b};Ct=new v.ARRAY_TYPE(3),v.ARRAY_TYPE!=Float32Array&&(Ct[0]=0,Ct[1]=0,Ct[2]=0);var wt=function(b){var o=b[0],h=b[1];return o*o+h*h};(function(){var b=new v.ARRAY_TYPE(2);v.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0)})();class Et{constructor(o,h,x,S){this.context=o,this.format=x,this.texture=o.gl.createTexture(),this.update(h,S)}update(o,h,x){const{width:S,height:k}=o,D=!(this.size&&this.size[0]===S&&this.size[1]===k||x),{context:U}=this,{gl:N}=U;if(this.useMipmap=Boolean(h&&h.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),U.pixelStoreUnpackFlipY.set(!1),U.pixelStoreUnpack.set(1),U.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!h||h.premultiply!==!1)),D)this.size=[S,k],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||v.isImageBitmap(o)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,o):N.texImage2D(N.TEXTURE_2D,0,this.format,S,k,0,this.format,N.UNSIGNED_BYTE,o.data);else{const{x:X,y:K}=x||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||v.isImageBitmap(o)?N.texSubImage2D(N.TEXTURE_2D,0,X,K,N.RGBA,N.UNSIGNED_BYTE,o):N.texSubImage2D(N.TEXTURE_2D,0,X,K,S,k,N.RGBA,N.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(o,h,x){const{context:S}=this,{gl:k}=S;k.bindTexture(k.TEXTURE_2D,this.texture),x!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(x=k.LINEAR),o!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,o),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,x||o),this.filter=o),h!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,h),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function oi(b){const{userImage:o}=b;return!!(o&&o.render&&o.render())&&(b.data.replace(new Uint8Array(o.data.buffer)),!0)}class Jt extends v.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:x}of this.requestors)this._notify(h,x);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,h){this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new v.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new v.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),x=!1),this._validateContent(h.content,h)||(this.fire(new v.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),x=!1),x}_validateStretch(o,h){if(!o)return!0;let x=0;for(const S of o){if(S[0]<x||S[1]<S[0]||h<S[1])return!1;x=S[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let x=!0;if(!this.isLoaded())for(const S of o)this.images[S]||(x=!1);this.isLoaded()||x?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const x={};for(const S of o){this.images[S]||this.fire(new v.Event("styleimagemissing",{id:S}));const k=this.images[S];k?x[S]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:Boolean(k.userImage&&k.userImage.render)}:v.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,x)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],x=this.getImage(o);if(!x)return null;if(h&&h.position.version===x.version)return h.position;if(h)h.position.version=x.version;else{const S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new v.ImagePosition(S,x);this.patterns[o]={bin:S,position:k}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Et(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const k in this.patterns)o.push(this.patterns[k].bin);const{w:h,h:x}=v.potpack(o),S=this.atlasImage;S.resize({width:h||1,height:x||1});for(const k in this.patterns){const{bin:D}=this.patterns[k],U=D.x+1,N=D.y+1,X=this.images[k].data,K=X.width,ae=X.height;v.RGBAImage.copy(X,S,{x:0,y:0},{x:U,y:N},{width:K,height:ae}),v.RGBAImage.copy(X,S,{x:0,y:ae-1},{x:U,y:N-1},{width:K,height:1}),v.RGBAImage.copy(X,S,{x:0,y:0},{x:U,y:N+ae},{width:K,height:1}),v.RGBAImage.copy(X,S,{x:K-1,y:0},{x:U-1,y:N},{width:1,height:ae}),v.RGBAImage.copy(X,S,{x:0,y:0},{x:U+K,y:N},{width:1,height:ae})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const x=this.images[h];oi(x)&&this.updateImage(h,x)}}}const Kt=1e20;function pi(b,o,h,x,S,k,D,U,N){for(let X=o;X<o+x;X++)or(b,h*k+X,k,S,D,U,N);for(let X=h;X<h+S;X++)or(b,X*k+o,1,x,D,U,N)}function or(b,o,h,x,S,k,D){k[0]=0,D[0]=-Kt,D[1]=Kt,S[0]=b[o];for(let U=1,N=0,X=0;U<x;U++){S[U]=b[o+U*h];const K=U*U;do{const ae=k[N];X=(S[U]-S[ae]+K-ae*ae)/(U-ae)/2}while(X<=D[N]&&--N>-1);N++,k[N]=U,D[N]=X,D[N+1]=Kt}for(let U=0,N=0;U<x;U++){for(;D[N+1]<U;)N++;const X=k[N],K=U-X;b[o+U*h]=S[X]+K*K}}class zi{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o,h){const x=[];for(const S in o)for(const k of o[S])x.push({stack:S,id:k});v.asyncAll(x,({stack:S,id:k},D)=>{let U=this.entries[S];U||(U=this.entries[S]={glyphs:{},requests:{},ranges:{}});let N=U.glyphs[k];if(N!==void 0)return void D(null,{stack:S,id:k,glyph:N});if(N=this._tinySDF(U,S,k),N)return U.glyphs[k]=N,void D(null,{stack:S,id:k,glyph:N});const X=Math.floor(k/256);if(256*X>65535)return void D(new Error("glyphs > 65535 not supported"));if(U.ranges[X])return void D(null,{stack:S,id:k,glyph:N});let K=U.requests[X];K||(K=U.requests[X]=[],zi.loadGlyphRange(S,X,this.url,this.requestManager,(ae,fe)=>{if(fe){for(const ze in fe)this._doesCharSupportLocalGlyph(+ze)||(U.glyphs[+ze]=fe[+ze]);U.ranges[X]=!0}for(const ze of K)ze(ae,fe);delete U.requests[X]})),K.push((ae,fe)=>{ae?D(ae):fe&&D(null,{stack:S,id:k,glyph:fe[k]||null})})},(S,k)=>{if(S)h(S);else if(k){const D={};for(const{stack:U,id:N,glyph:X}of k)(D[U]||(D[U]={}))[N]=X&&{id:X.id,bitmap:X.bitmap.clone(),metrics:X.metrics};h(null,D)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(v.unicodeBlockLookup["CJK Unified Ideographs"](o)||v.unicodeBlockLookup["Hangul Syllables"](o)||v.unicodeBlockLookup.Hiragana(o)||v.unicodeBlockLookup.Katakana(o))}_tinySDF(o,h,x){const S=this.localIdeographFontFamily;if(!S||!this._doesCharSupportLocalGlyph(x))return;let k=o.tinySDF;if(!k){let U="400";/bold/i.test(h)?U="900":/medium/i.test(h)?U="500":/light/i.test(h)&&(U="200"),k=o.tinySDF=new zi.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:S,fontWeight:U})}const D=k.draw(String.fromCharCode(x));return{id:x,bitmap:new v.AlphaImage({width:D.width||30,height:D.height||30},D.data),metrics:{width:D.glyphWidth||24,height:D.glyphHeight||24,left:D.glyphLeft||0,top:D.glyphTop-27||-8,advance:D.glyphAdvance||24}}}}zi.loadGlyphRange=function(b,o,h,x,S){const k=256*o,D=k+255,U=x.transformRequest(h.replace("{fontstack}",b).replace("{range}",`${k}-${D}`),v.ResourceType.Glyphs);v.getArrayBuffer(U,(N,X)=>{if(N)S(N);else if(X){const K={};for(const ae of v.parseGlyphPBF(X))K[ae.id]=ae;S(null,K)}})},zi.TinySDF=class{constructor({fontSize:b=24,buffer:o=3,radius:h=8,cutoff:x=.25,fontFamily:S="sans-serif",fontWeight:k="normal",fontStyle:D="normal"}={}){this.buffer=o,this.cutoff=x,this.radius=h;const U=this.size=b+4*o,N=this._createCanvas(U),X=this.ctx=N.getContext("2d",{willReadFrequently:!0});X.font=`${D} ${k} ${b}px ${S}`,X.textBaseline="alphabetic",X.textAlign="left",X.fillStyle="black",this.gridOuter=new Float64Array(U*U),this.gridInner=new Float64Array(U*U),this.f=new Float64Array(U),this.z=new Float64Array(U+1),this.v=new Uint16Array(U)}_createCanvas(b){const o=document.createElement("canvas");return o.width=o.height=b,o}draw(b){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:x,actualBoundingBoxLeft:S,actualBoundingBoxRight:k}=this.ctx.measureText(b),D=Math.ceil(h),U=Math.min(this.size-this.buffer,Math.ceil(k-S)),N=Math.min(this.size-this.buffer,D+Math.ceil(x)),X=U+2*this.buffer,K=N+2*this.buffer,ae=Math.max(X*K,0),fe=new Uint8ClampedArray(ae),ze={data:fe,width:X,height:K,glyphWidth:U,glyphHeight:N,glyphTop:D,glyphLeft:0,glyphAdvance:o};if(U===0||N===0)return ze;const{ctx:me,buffer:Ce,gridInner:Ne,gridOuter:Ve}=this;me.clearRect(Ce,Ce,U,N),me.fillText(b,Ce,Ce+D);const We=me.getImageData(Ce,Ce,U,N);Ve.fill(Kt,0,ae),Ne.fill(0,0,ae);for(let Ze=0;Ze<N;Ze++)for(let ut=0;ut<U;ut++){const it=We.data[4*(Ze*U+ut)+3]/255;if(it===0)continue;const rt=(Ze+Ce)*X+ut+Ce;if(it===1)Ve[rt]=0,Ne[rt]=Kt;else{const ft=.5-it;Ve[rt]=ft>0?ft*ft:0,Ne[rt]=ft<0?ft*ft:0}}pi(Ve,0,0,X,K,X,this.f,this.v,this.z),pi(Ne,Ce,Ce,U,N,X,this.f,this.v,this.z);for(let Ze=0;Ze<ae;Ze++){const ut=Math.sqrt(Ve[Ze])-Math.sqrt(Ne[Ze]);fe[Ze]=Math.round(255-255*(ut/this.radius+this.cutoff))}return ze}};const sn=new v.Properties({anchor:new v.DataConstantProperty(v.spec.light.anchor),position:new class{constructor(){this.specification=v.spec.light.position}possiblyEvaluate(b,o){return v.sphericalToCartesian(b.expression.evaluate(o))}interpolate(b,o,h){return{x:v.number(b.x,o.x,h),y:v.number(b.y,o.y,h),z:v.number(b.z,o.z,h)}}},color:new v.DataConstantProperty(v.spec.light.color),intensity:new v.DataConstantProperty(v.spec.light.intensity)}),Xr="-transition";class fn extends v.Evented{constructor(o){super(),this._transitionable=new v.Transitionable(sn),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(v.validateLight,o,h))for(const x in o){const S=o[x];x.endsWith(Xr)?this._transitionable.setTransition(x.slice(0,-Xr.length),S):this._transitionable.setValue(x,S)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,x){return(!x||x.validate!==!1)&&v.emitValidationErrors(this,o.call(v.validateStyle,v.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:v.spec})))}}class lr{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const x=o.join(",")+String(h);return this.dashEntry[x]||(this.dashEntry[x]=this.addDash(o,h)),this.dashEntry[x]}getDashRanges(o,h,x){const S=[];let k=o.length%2==1?-o[o.length-1]*x:0,D=o[0]*x,U=!0;S.push({left:k,right:D,isDash:U,zeroLength:o[0]===0});let N=o[0];for(let X=1;X<o.length;X++){U=!U;const K=o[X];k=N*x,N+=K,D=N*x,S.push({left:k,right:D,isDash:U,zeroLength:K===0})}return S}addRoundDash(o,h,x){const S=h/2;for(let k=-x;k<=x;k++){const D=this.width*(this.nextRow+x+k);let U=0,N=o[U];for(let X=0;X<this.width;X++){X/N.right>1&&(N=o[++U]);const K=Math.abs(X-N.left),ae=Math.abs(X-N.right),fe=Math.min(K,ae);let ze;const me=k/x*(S+1);if(N.isDash){const Ce=S-Math.abs(me);ze=Math.sqrt(fe*fe+Ce*Ce)}else ze=S-Math.sqrt(fe*fe+me*me);this.data[D+X]=Math.max(0,Math.min(255,ze+128))}}}addRegularDash(o){for(let U=o.length-1;U>=0;--U){const N=o[U],X=o[U+1];N.zeroLength?o.splice(U,1):X&&X.isDash===N.isDash&&(X.left=N.left,o.splice(U,1))}const h=o[0],x=o[o.length-1];h.isDash===x.isDash&&(h.left=x.left-this.width,x.right=h.right+this.width);const S=this.width*this.nextRow;let k=0,D=o[k];for(let U=0;U<this.width;U++){U/D.right>1&&(D=o[++k]);const N=Math.abs(U-D.left),X=Math.abs(U-D.right),K=Math.min(N,X);this.data[S+U]=Math.max(0,Math.min(255,(D.isDash?K:-K)+128))}}addDash(o,h){const x=h?7:0,S=2*x+1;if(this.nextRow+S>this.height)return v.warnOnce("LineAtlas out of space"),null;let k=0;for(let U=0;U<o.length;U++)k+=o[U];if(k!==0){const U=this.width/k,N=this.getDashRanges(o,this.width,U);h?this.addRoundDash(N,U,x):this.addRegularDash(N)}const D={y:(this.nextRow+x+.5)/this.height,height:2*x/this.height,width:k};return this.nextRow+=S,this.dirty=!0,D}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Li{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=v.uniqueId();const x=this.workerPool.acquire(this.id);for(let S=0;S<x.length;S++){const k=new Li.Actor(x[S],h,this.id);k.name=`Worker ${S}`,this.actors.push(k)}}broadcast(o,h,x){v.asyncAll(this.actors,(S,k)=>{S.send(o,h,k)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yr(b,o,h){const x=function(S,k){if(S)return h(S);if(k){const D=v.pick(v.extend(k,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(D.vectorLayers=k.vector_layers,D.vectorLayerIds=D.vectorLayers.map(U=>U.id)),h(null,D)}};return b.url?v.getJSON(o.transformRequest(b.url,v.ResourceType.Source),x):v.exported.frame(()=>x(null,b))}Li.Actor=v.Actor;class Wt{constructor(o,h,x){this.bounds=v.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=x||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),x=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*h),S=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*h),k=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*h),D=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=x&&o.x<k&&o.y>=S&&o.y<D}}class Qr extends v.Evented{constructor(o,h,x,S){if(super(),this.id=o,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(h,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}load(){this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yr(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new v.ErrorEvent(o)):h&&(v.extend(this,h),h.bounds&&(this.tileBounds=new Wt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return v.extend({},this._options)}loadTile(o,h){const x=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),S={request:this.map._requestManager.transformRequest(x,v.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function k(D,U){return delete o.request,o.aborted?h(null):D&&D.status!==404?h(D):(U&&U.resourceTiming&&(o.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&o.setExpiryData(U),o.loadVectorData(U,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",S,k.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",S,k.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class An extends v.Evented{constructor(o,h,x,S){super(),this.id=o,this.dispatcher=x,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},h),v.extend(this,v.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yr(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new v.ErrorEvent(o)):h&&(v.extend(this,h),h.bounds&&(this.tileBounds=new Wt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return v.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const x=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=v.getImage(this.map._requestManager.transformRequest(x,v.ResourceType.Tile),(S,k,D)=>{if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(S)o.state="errored",h(S);else if(k){this.map._refreshExpiredTiles&&o.setExpiryData(D);const U=this.map.painter.context,N=U.gl;o.texture=this.map.painter.getTileTexture(k.width),o.texture?o.texture.update(k,{useMipmap:!0}):(o.texture=new Et(U,k,N.RGBA,{useMipmap:!0}),o.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),o.state="loaded",v.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let Jn;class kt extends An{constructor(o,h,x,S){super(o,h,x,S),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,h){const x=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function S(k,D){k&&(o.state="errored",h(k)),D&&(o.dem=D,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=v.getImage(this.map._requestManager.transformRequest(x,v.ResourceType.Tile),function(k,D){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(k)o.state="errored",h(k);else if(D){this.map._refreshExpiredTiles&&o.setExpiryData(D),delete D.cacheControl,delete D.expires;const U=v.isImageBitmap(D)&&(Jn==null&&(Jn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Jn)?D:v.exported.getImageData(D,1),N={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:U,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",N,S.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const h=o.canonical,x=Math.pow(2,h.z),S=(h.x-1+x)%x,k=h.x===0?o.wrap-1:o.wrap,D=(h.x+1+x)%x,U=h.x+1===x?o.wrap+1:o.wrap,N={};return N[new v.OverscaledTileID(o.overscaledZ,k,h.z,S,h.y).key]={backfilled:!1},N[new v.OverscaledTileID(o.overscaledZ,U,h.z,D,h.y).key]={backfilled:!1},h.y>0&&(N[new v.OverscaledTileID(o.overscaledZ,k,h.z,S,h.y-1).key]={backfilled:!1},N[new v.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},N[new v.OverscaledTileID(o.overscaledZ,U,h.z,D,h.y-1).key]={backfilled:!1}),h.y+1<x&&(N[new v.OverscaledTileID(o.overscaledZ,k,h.z,S,h.y+1).key]={backfilled:!1},N[new v.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},N[new v.OverscaledTileID(o.overscaledZ,U,h.z,D,h.y+1).key]={backfilled:!1}),N}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class ti extends v.Evented{constructor(o,h,x,S){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=x.getActor(),this.setEventedParent(S),this._data=h.data,this._options=v.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const k=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*k,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*k,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:v.EXTENT,radius:(h.clusterRadius||50)*k,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this}getClusterChildren(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this}getClusterLeaves(o,h,x,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:x},S),this}_updateWorkerData(o){const h=v.extend({},this.workerOptions),x=this._data;typeof x=="string"?(h.request=this.map._requestManager.transformRequest(v.exported.resolveURL(x),v.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(x),this._pendingLoads++,this.fire(new v.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(S,k)=>{if(this._pendingLoads--,this._removed||k&&k.abandoned)return;let D=null;if(k&&k.resourceTiming&&k.resourceTiming[this.id]&&(D=k.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:h.source},null),S)return void this.fire(new v.ErrorEvent(S));const U={dataType:"source",sourceDataType:o};this._collectResourceTiming&&D&&D.length>0&&v.extend(U,{resourceTiming:D}),this.fire(new v.Event("data",U))})}loaded(){return this._pendingLoads===0}loadTile(o,h){const x=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const S={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(x,S,(k,D)=>(delete o.request,o.unloadVectorData(),o.aborted?h(null):k?h(k):(o.loadVectorData(D,this.map.painter,x==="reloadTile"),h(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return v.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var si=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Fi extends v.Evented{constructor(o,h,x,S){super(),this.id=o,this.dispatcher=x,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}load(o,h){this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),(x,S)=>{this._loaded=!0,x?this.fire(new v.ErrorEvent(x)):S&&(this.image=S,o&&(this.coordinates=o),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const h=o.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(S){let k=1/0,D=1/0,U=-1/0,N=-1/0;for(const fe of S)k=Math.min(k,fe.x),D=Math.min(D,fe.y),U=Math.max(U,fe.x),N=Math.max(N,fe.y);const X=Math.max(U-k,N-D),K=Math.max(0,Math.floor(-Math.log(X)/Math.LN2)),ae=Math.pow(2,K);return new v.CanonicalTileID(K,Math.floor((k+U)/2*ae),Math.floor((D+N)/2*ae))}(h),this.minzoom=this.maxzoom=this.tileID.z;const x=h.map(S=>this.tileID.getTilePoint(S)._round());return this._boundsArray=new v.RasterBoundsArray,this._boundsArray.emplaceBack(x[0].x,x[0].y,0,0),this._boundsArray.emplaceBack(x[1].x,x[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(x[3].x,x[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(x[2].x,x[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Et(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Oi extends Fi{constructor(o,h,x,S){super(o,h,x,S),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,v.ResourceType.Source).url);v.getVideo(this.urls,(h,x)=>{this._loaded=!0,h?this.fire(new v.ErrorEvent(h)):x&&(this.video=x,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new Et(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Qi extends Fi{constructor(o,h,x,S){super(o,h,x,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(D=>typeof D!="number"))||this.fire(new v.ErrorEvent(new v.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,x=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Et(h,this.canvas,x.RGBA,{premultiply:!0});for(const S in this.tiles){const k=this.tiles[S];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ui={vector:Qr,raster:An,"raster-dem":kt,geojson:ti,video:Oi,image:Fi,canvas:Qi};function ji(b,o){const h=v.create();return v.translate(h,h,[1,1,0]),v.scale(h,h,[.5*b.width,.5*b.height,1]),v.multiply(h,h,b.calculatePosMatrix(o.toUnwrapped()))}function ir(b,o,h,x,S,k){const D=function(ae,fe,ze){if(ae)for(const me of ae){const Ce=fe[me];if(Ce&&Ce.source===ze&&Ce.type==="fill-extrusion")return!0}else for(const me in fe){const Ce=fe[me];if(Ce.source===ze&&Ce.type==="fill-extrusion")return!0}return!1}(S&&S.layers,o,b.id),U=k.maxPitchScaleFactor(),N=b.tilesIn(x,U,D);N.sort(gi);const X=[];for(const ae of N)X.push({wrappedTileID:ae.tileID.wrapped().key,queryResults:ae.tile.queryRenderedFeatures(o,h,b._state,ae.queryGeometry,ae.cameraQueryGeometry,ae.scale,S,k,U,ji(b.transform,ae.tileID))});const K=function(ae){const fe={},ze={};for(const me of ae){const Ce=me.queryResults,Ne=me.wrappedTileID,Ve=ze[Ne]=ze[Ne]||{};for(const We in Ce){const Ze=Ce[We],ut=Ve[We]=Ve[We]||{},it=fe[We]=fe[We]||[];for(const rt of Ze)ut[rt.featureIndex]||(ut[rt.featureIndex]=!0,it.push(rt))}}return fe}(X);for(const ae in K)K[ae].forEach(fe=>{const ze=fe.feature,me=b.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=me});return K}function gi(b,o){const h=b.tileID,x=o.tileID;return h.overscaledZ-x.overscaledZ||h.canonical.y-x.canonical.y||h.wrap-x.wrap||h.canonical.x-x.canonical.x}class vr{constructor(o,h){this.tileID=o,this.uid=v.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<v.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(o,h,x){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(S,k){const D={};if(!k)return D;for(const U of S){const N=U.layerIds.map(X=>k.getLayer(X)).filter(Boolean);if(N.length!==0){U.layers=N,U.stateDependentLayerIds&&(U.stateDependentLayers=U.stateDependentLayerIds.map(X=>N.filter(K=>K.id===X)[0]));for(const X of N)D[X.id]=U}}return D}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const S in this.buckets){const k=this.buckets[S];if(k instanceof v.SymbolBucket){if(this.hasSymbolBuckets=!0,!x)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const S in this.buckets){const k=this.buckets[S];if(k instanceof v.SymbolBucket&&k.hasRTLText){this.hasRTLText=!0,v.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const S in this.buckets){const k=this.buckets[S];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(S).queryRadius(k))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const x in this.buckets){const S=this.buckets[x];S.uploadPending()&&S.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Et(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Et(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,x,S,k,D,U,N,X,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:S,cameraQueryGeometry:k,scale:D,tileSize:this.tileSize,pixelPosMatrix:K,transform:N,params:U,queryPadding:this.queryPadding*X},o,h,x):{}}querySourceFeatures(o,h){const x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;const S=x.loadVTLayers(),k=h?h.sourceLayer:"",D=S._geojsonTileLayer||S[k];if(!D)return;const U=v.createFilter(h&&h.filter),{z:N,x:X,y:K}=this.tileID.canonical,ae={z:N,x:X,y:K};for(let fe=0;fe<D.length;fe++){const ze=D.feature(fe);if(U.needGeometry){const Ne=v.toEvaluationFeature(ze,!0);if(!U.filter(new v.EvaluationParameters(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!U.filter(new v.EvaluationParameters(this.tileID.overscaledZ),ze))continue;const me=x.getId(ze,k),Ce=new v.GeoJSONFeature(ze,N,X,K,me);Ce.tile=ae,o.push(Ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const x=v.parseCacheControl(o.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const x=Date.now();let S=!1;if(this.expirationTime>x)S=!1;else if(h)if(this.expirationTime<h)S=!0;else{const k=this.expirationTime-h;k?this.expirationTime=x+Math.max(k,3e4):S=!0}else S=!0;S?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const x=this.latestFeatureIndex.loadVTLayers();for(const S in this.buckets){if(!h.style.hasLayer(S))continue;const k=this.buckets[S],D=k.layers[0].sourceLayer||"_geojsonTileLayer",U=x[D],N=o[D];if(!U||!N||Object.keys(N).length===0)continue;k.update(N,U,this.imageAtlas&&this.imageAtlas.patternPositions||{});const X=h&&h.style&&h.style.getLayer(S);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<v.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=v.exported.now()+o}setDependencies(o,h){const x={};for(const S of h)x[S]=!0;this.dependencies[o]=x}hasDependency(o,h){for(const x of o){const S=this.dependencies[x];if(S){for(const k of h)if(S[k])return!0}}return!1}}class Ar{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,x){const S=o.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);const k={value:h,timeout:void 0};if(x!==void 0&&(k.timeout=setTimeout(()=>{this.remove(o,k)},x)),this.data[S].push(k),this.order.push(S),this.order.length>this.max){const D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const x=o.wrapped().key,S=h===void 0?0:this.data[x].indexOf(h),k=this.data[x][S];return this.data[x].splice(S,1),k.timeout&&clearTimeout(k.timeout),this.data[x].length===0&&delete this.data[x],this.onRemove(k.value),this.order.splice(this.order.indexOf(x),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const x in this.data)for(const S of this.data[x])o(S.value)||h.push(S);for(const x of h)this.remove(x.value.tileID,x)}}class zr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,x){const S=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][S]=this.stateChanges[o][S]||{},v.extend(this.stateChanges[o][S],x),this.deletedStates[o]===null){this.deletedStates[o]={};for(const k in this.state[o])k!==S&&(this.deletedStates[o][k]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][S]===null){this.deletedStates[o][S]={};for(const k in this.state[o][S])x[k]||(this.deletedStates[o][S][k]=null)}else for(const k in x)this.deletedStates[o]&&this.deletedStates[o][S]&&this.deletedStates[o][S][k]===null&&delete this.deletedStates[o][S][k]}removeFeatureState(o,h,x){if(this.deletedStates[o]===null)return;const S=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},x&&h!==void 0)this.deletedStates[o][S]!==null&&(this.deletedStates[o][S]=this.deletedStates[o][S]||{},this.deletedStates[o][S][x]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][S])for(x in this.deletedStates[o][S]={},this.stateChanges[o][S])this.deletedStates[o][S][x]=null;else this.deletedStates[o][S]=null;else this.deletedStates[o]=null}getState(o,h){const x=String(h),S=v.extend({},(this.state[o]||{})[x],(this.stateChanges[o]||{})[x]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const k=this.deletedStates[o][h];if(k===null)return{};for(const D in k)delete S[D]}return S}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const x={};for(const S in this.stateChanges){this.state[S]=this.state[S]||{};const k={};for(const D in this.stateChanges[S])this.state[S][D]||(this.state[S][D]={}),v.extend(this.state[S][D],this.stateChanges[S][D]),k[D]=this.state[S][D];x[S]=k}for(const S in this.deletedStates){this.state[S]=this.state[S]||{};const k={};if(this.deletedStates[S]===null)for(const D in this.state[S])k[D]={},this.state[S][D]={};else for(const D in this.deletedStates[S]){if(this.deletedStates[S][D]===null)this.state[S][D]={};else for(const U of Object.keys(this.deletedStates[S][D]))delete this.state[S][D][U];k[D]=this.state[S][D]}x[S]=x[S]||{},v.extend(x[S],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0)for(const S in o)o[S].setFeatureState(x,h)}}class Ht extends v.Evented{constructor(o,h,x){super(),this.id=o,this.dispatcher=x,this.on("data",S=>{S.dataType==="source"&&S.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(S,k,D,U){const N=new Ui[k.type](S,k,D,U);if(N.id!==S)throw new Error(`Expected Source id to be ${S} instead of ${N.id}`);return v.bindAll(["load","abort","unload","serialize","prepare"],N),N}(o,h,x,this),this._tiles={},this._cache=new Ar(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new zr}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,h){return this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new v.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const x=this._tiles[h];x.upload(o),x.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(jr).map(o=>o.key)}getRenderableIds(o){const h=[];for(const x in this._tiles)this._isIdRenderable(x,o)&&h.push(this._tiles[x]);return o?h.sort((x,S)=>{const k=x.tileID,D=S.tileID,U=new v.pointGeometry(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),N=new v.pointGeometry(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-D.overscaledZ||N.y-U.y||N.x-U.x}).map(x=>x.tileID.key):h.map(x=>x.tileID).sort(jr).map(x=>x.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){const x=this._tiles[o];x&&(x.state!=="loading"&&(x.state=h),this._loadTile(x,this._tileLoaded.bind(this,x,o,h)))}_tileLoaded(o,h,x,S){if(S)return o.state="errored",void(S.status!==404?this._source.fire(new v.ErrorEvent(S,{tile:o})):this.update(this.transform));o.timeAdded=v.exported.now(),x==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new v.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let S=0;S<h.length;S++){const k=h[S];if(o.neighboringTiles&&o.neighboringTiles[k]){const D=this.getTileByID(k);x(o,D),x(D,o)}}function x(S,k){S.needsHillshadePrepare=!0;let D=k.tileID.canonical.x-S.tileID.canonical.x;const U=k.tileID.canonical.y-S.tileID.canonical.y,N=Math.pow(2,S.tileID.canonical.z),X=k.tileID.key;D===0&&U===0||Math.abs(U)>1||(Math.abs(D)>1&&(Math.abs(D+N)===1?D+=N:Math.abs(D-N)===1&&(D-=N)),k.dem&&S.dem&&(S.dem.backfillBorder(k.dem,D,U),S.neighboringTiles&&S.neighboringTiles[X]&&(S.neighboringTiles[X].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,x,S){for(const k in this._tiles){let D=this._tiles[k];if(S[k]||!D.hasData()||D.tileID.overscaledZ<=h||D.tileID.overscaledZ>x)continue;let U=D.tileID;for(;D&&D.tileID.overscaledZ>h+1;){const X=D.tileID.scaledTo(D.tileID.overscaledZ-1);D=this._tiles[X.key],D&&D.hasData()&&(U=X)}let N=U;for(;N.overscaledZ>h;)if(N=N.scaledTo(N.overscaledZ-1),o[N.key]){S[U.key]=U;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const x=this._loadedParentTiles[o.key];return x&&x.tileID.overscaledZ>=h?x:null}for(let x=o.overscaledZ-1;x>=h;x--){const S=o.scaledTo(x),k=this._getLoadedTile(S);if(k)return k}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,x=Math.ceil(o.height/this._source.tileSize)+1,S=Math.floor(h*x*5),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(k)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const x={};for(const S in this._tiles){const k=this._tiles[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),x[k.tileID.key]=k}this._tiles=x;for(const S in this._timers)clearTimeout(this._timers[S]),delete this._timers[S];for(const S in this._tiles)this._setTileReloadTimer(S,this._tiles[S])}}update(o){if(this.transform=o,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?h=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new v.OverscaledTileID(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y)):(h=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(h=h.filter(N=>this._source.hasTile(N)))):h=[];const x=o.coveringZoomLevel(this._source),S=Math.max(x-Ht.maxOverzooming,this._source.minzoom),k=Math.max(x+Ht.maxUnderzooming,this._source.minzoom),D=this._updateRetainedTiles(h,x);if(Sr(this._source.type)){const N={},X={},K=Object.keys(D);for(const ae of K){const fe=D[ae],ze=this._tiles[ae];if(!ze||ze.fadeEndTime&&ze.fadeEndTime<=v.exported.now())continue;const me=this.findLoadedParent(fe,S);me&&(this._addTile(me.tileID),N[me.tileID.key]=me.tileID),X[ae]=fe}this._retainLoadedChildren(X,x,k,D);for(const ae in N)D[ae]||(this._coveredTiles[ae]=!0,D[ae]=N[ae])}for(const N in D)this._tiles[N].clearFadeHold();const U=v.keysDifference(this._tiles,D);for(const N of U){const X=this._tiles[N];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(N)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const x={},S={},k=Math.max(h-Ht.maxOverzooming,this._source.minzoom),D=Math.max(h+Ht.maxUnderzooming,this._source.minzoom),U={};for(const N of o){const X=this._addTile(N);x[N.key]=N,X.hasData()||h<this._source.maxzoom&&(U[N.key]=N)}this._retainLoadedChildren(U,h,D,x);for(const N of o){let X=this._tiles[N.key];if(X.hasData())continue;if(h+1>this._source.maxzoom){const ae=N.children(this._source.maxzoom)[0],fe=this.getTile(ae);if(fe&&fe.hasData()){x[ae.key]=ae;continue}}else{const ae=N.children(this._source.maxzoom);if(x[ae[0].key]&&x[ae[1].key]&&x[ae[2].key]&&x[ae[3].key])continue}let K=X.wasRequested();for(let ae=N.overscaledZ-1;ae>=k;--ae){const fe=N.scaledTo(ae);if(S[fe.key]||(S[fe.key]=!0,X=this.getTile(fe),!X&&K&&(X=this._addTile(fe)),X&&(x[fe.key]=fe,K=X.wasRequested(),X.hasData())))break}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let x,S=this._tiles[o].tileID;for(;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){x=this._loadedParentTiles[S.key];break}h.push(S.key);const k=S.scaledTo(S.overscaledZ-1);if(x=this._getLoadedTile(k),x)break;S=k}for(const k of h)this._loadedParentTiles[k]=x}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const x=h;return h||(h=new vr(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h.uses++,this._tiles[o.key]=h,x||this._source.fire(new v.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const x=h.getExpiryTimeout();x&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},x))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,x){const S=[],k=this.transform;if(!k)return S;const D=x?k.getCameraQueryGeometry(o):o,U=o.map(me=>k.pointCoordinate(me)),N=D.map(me=>k.pointCoordinate(me)),X=this.getIds();let K=1/0,ae=1/0,fe=-1/0,ze=-1/0;for(const me of N)K=Math.min(K,me.x),ae=Math.min(ae,me.y),fe=Math.max(fe,me.x),ze=Math.max(ze,me.y);for(let me=0;me<X.length;me++){const Ce=this._tiles[X[me]];if(Ce.holdingForFade())continue;const Ne=Ce.tileID,Ve=Math.pow(2,k.zoom-Ce.tileID.overscaledZ),We=h*Ce.queryPadding*v.EXTENT/Ce.tileSize/Ve,Ze=[Ne.getTilePoint(new v.MercatorCoordinate(K,ae)),Ne.getTilePoint(new v.MercatorCoordinate(fe,ze))];if(Ze[0].x-We<v.EXTENT&&Ze[0].y-We<v.EXTENT&&Ze[1].x+We>=0&&Ze[1].y+We>=0){const ut=U.map(rt=>Ne.getTilePoint(rt)),it=N.map(rt=>Ne.getTilePoint(rt));S.push({tile:Ce,tileID:Ne,queryGeometry:ut,cameraQueryGeometry:it,scale:Ve})}}return S}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(x=>this._tiles[x].tileID);for(const x of h)x.posMatrix=this.transform.calculatePosMatrix(x.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Sr(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=v.exported.now())return!0}return!1}setFeatureState(o,h,x){this._state.updateState(o=o||"_geojsonTileLayer",h,x)}removeFeatureState(o,h,x){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,x)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,x){const S=this._tiles[o];S&&S.setDependencies(h,x)}reloadTilesForDependencies(o,h){for(const x in this._tiles)this._tiles[x].hasDependency(o,h)&&this._reloadTile(x,"reloading");this._cache.filter(x=>!x.hasDependency(o,h))}}function jr(b,o){const h=Math.abs(2*b.wrap)-+(b.wrap<0),x=Math.abs(2*o.wrap)-+(o.wrap<0);return b.overscaledZ-o.overscaledZ||x-h||o.canonical.y-b.canonical.y||o.canonical.x-b.canonical.x}function Sr(b){return b==="raster"||b==="image"||b==="video"}Ht.maxOverzooming=10,Ht.maxUnderzooming=3;const Wr="mapboxgl_preloaded_worker_pool";class Eo{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Eo.workerCount;)this.workers.push(new Worker($n.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Wr]}numActive(){return Object.keys(this.active).length}}const to=Math.floor(v.exported.hardwareConcurrency/2);let po;function en(){return po||(po=new Eo),po}function jn(b,o){const h={};for(const x in b)x!=="ref"&&(h[x]=b[x]);return v.refProperties.forEach(x=>{x in o&&(h[x]=o[x])}),h}function Go(b){b=b.slice();const o=Object.create(null);for(let h=0;h<b.length;h++)o[b[h].id]=b[h];for(let h=0;h<b.length;h++)"ref"in b[h]&&(b[h]=jn(b[h],o[b[h].ref]));return b}Eo.workerCount=Math.max(Math.min(to,6),1);const Si={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wn(b,o,h){h.push({command:Si.addSource,args:[b,o[b]]})}function io(b,o,h){o.push({command:Si.removeSource,args:[b]}),h[b]=!0}function zn(b,o,h,x){io(b,h,x),wn(b,o,h)}function Sa(b,o,h){let x;for(x in b[h])if(Object.prototype.hasOwnProperty.call(b[h],x)&&x!=="data"&&!Xe(b[h][x],o[h][x]))return!1;for(x in o[h])if(Object.prototype.hasOwnProperty.call(o[h],x)&&x!=="data"&&!Xe(b[h][x],o[h][x]))return!1;return!0}function ot(b,o,h,x,S,k){let D;for(D in o=o||{},b=b||{})Object.prototype.hasOwnProperty.call(b,D)&&(Xe(b[D],o[D])||h.push({command:k,args:[x,D,o[D],S]}));for(D in o)Object.prototype.hasOwnProperty.call(o,D)&&!Object.prototype.hasOwnProperty.call(b,D)&&(Xe(b[D],o[D])||h.push({command:k,args:[x,D,o[D],S]}))}function Mt(b){return b.id}function Bo(b,o){return b[o.id]=o,b}class ro{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=v.clamp(o,0,1);let h=1,x=this._distances[h];const S=o*this.paddedLength+this.padding;for(;x<S&&h<this._distances.length;)x=this._distances[++h];const k=h-1,D=this._distances[k],U=x-D,N=U>0?(S-D)/U:0;return this.points[k].mult(1-N).add(this.points[h].mult(N))}}function pr(b,o){let h=!0;return b==="always"||b!=="never"&&o!=="never"||(h=!1),h}class Cn{constructor(o,h,x){const S=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(o/x),this.yCellCount=Math.ceil(h/x);for(let D=0;D<this.xCellCount*this.yCellCount;D++)S.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,x,S,k){this._forEachCell(h,x,S,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(x),this.bboxes.push(S),this.bboxes.push(k)}insertCircle(o,h,x,S){this._forEachCell(h-S,x-S,h+S,x+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(x),this.circles.push(S)}_insertBoxCell(o,h,x,S,k,D){this.boxCells[k].push(D)}_insertCircleCell(o,h,x,S,k,D){this.circleCells[k].push(D)}_query(o,h,x,S,k,D,U){if(x<0||o>this.width||S<0||h>this.height)return[];const N=[];if(o<=0&&h<=0&&this.width<=x&&this.height<=S){if(k)return[{key:null,x1:o,y1:h,x2:x,y2:S}];for(let X=0;X<this.boxKeys.length;X++)N.push({key:this.boxKeys[X],x1:this.bboxes[4*X],y1:this.bboxes[4*X+1],x2:this.bboxes[4*X+2],y2:this.bboxes[4*X+3]});for(let X=0;X<this.circleKeys.length;X++){const K=this.circles[3*X],ae=this.circles[3*X+1],fe=this.circles[3*X+2];N.push({key:this.circleKeys[X],x1:K-fe,y1:ae-fe,x2:K+fe,y2:ae+fe})}}else this._forEachCell(o,h,x,S,this._queryCell,N,{hitTest:k,overlapMode:D,seenUids:{box:{},circle:{}}},U);return N}query(o,h,x,S){return this._query(o,h,x,S,!1,null)}hitTest(o,h,x,S,k,D){return this._query(o,h,x,S,!0,k,D).length>0}hitTestCircle(o,h,x,S,k){const D=o-x,U=o+x,N=h-x,X=h+x;if(U<0||D>this.width||X<0||N>this.height)return!1;const K=[];return this._forEachCell(D,N,U,X,this._queryCellCircle,K,{hitTest:!0,overlapMode:S,circle:{x:o,y:h,radius:x},seenUids:{box:{},circle:{}}},k),K.length>0}_queryCell(o,h,x,S,k,D,U,N){const{seenUids:X,hitTest:K,overlapMode:ae}=U,fe=this.boxCells[k];if(fe!==null){const me=this.bboxes;for(const Ce of fe)if(!X.box[Ce]){X.box[Ce]=!0;const Ne=4*Ce,Ve=this.boxKeys[Ce];if(o<=me[Ne+2]&&h<=me[Ne+3]&&x>=me[Ne+0]&&S>=me[Ne+1]&&(!N||N(Ve))&&(!K||!pr(ae,Ve.overlapMode))&&(D.push({key:Ve,x1:me[Ne],y1:me[Ne+1],x2:me[Ne+2],y2:me[Ne+3]}),K))return!0}}const ze=this.circleCells[k];if(ze!==null){const me=this.circles;for(const Ce of ze)if(!X.circle[Ce]){X.circle[Ce]=!0;const Ne=3*Ce,Ve=this.circleKeys[Ce];if(this._circleAndRectCollide(me[Ne],me[Ne+1],me[Ne+2],o,h,x,S)&&(!N||N(Ve))&&(!K||!pr(ae,Ve.overlapMode))){const We=me[Ne],Ze=me[Ne+1],ut=me[Ne+2];if(D.push({key:Ve,x1:We-ut,y1:Ze-ut,x2:We+ut,y2:Ze+ut}),K)return!0}}}return!1}_queryCellCircle(o,h,x,S,k,D,U,N){const{circle:X,seenUids:K,overlapMode:ae}=U,fe=this.boxCells[k];if(fe!==null){const me=this.bboxes;for(const Ce of fe)if(!K.box[Ce]){K.box[Ce]=!0;const Ne=4*Ce,Ve=this.boxKeys[Ce];if(this._circleAndRectCollide(X.x,X.y,X.radius,me[Ne+0],me[Ne+1],me[Ne+2],me[Ne+3])&&(!N||N(Ve))&&!pr(ae,Ve.overlapMode))return D.push(!0),!0}}const ze=this.circleCells[k];if(ze!==null){const me=this.circles;for(const Ce of ze)if(!K.circle[Ce]){K.circle[Ce]=!0;const Ne=3*Ce,Ve=this.circleKeys[Ce];if(this._circlesCollide(me[Ne],me[Ne+1],me[Ne+2],X.x,X.y,X.radius)&&(!N||N(Ve))&&!pr(ae,Ve.overlapMode))return D.push(!0),!0}}}_forEachCell(o,h,x,S,k,D,U,N){const X=this._convertToXCellCoord(o),K=this._convertToYCellCoord(h),ae=this._convertToXCellCoord(x),fe=this._convertToYCellCoord(S);for(let ze=X;ze<=ae;ze++)for(let me=K;me<=fe;me++)if(k.call(this,o,h,x,S,this.xCellCount*me+ze,D,U,N))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,x,S,k,D){const U=S-o,N=k-h,X=x+D;return X*X>U*U+N*N}_circleAndRectCollide(o,h,x,S,k,D,U){const N=(D-S)/2,X=Math.abs(o-(S+N));if(X>N+x)return!1;const K=(U-k)/2,ae=Math.abs(h-(k+K));if(ae>K+x)return!1;if(X<=N||ae<=K)return!0;const fe=X-N,ze=ae-K;return fe*fe+ze*ze<=x*x}}function mn(b,o,h,x,S){const k=v.create();return o?(v.scale(k,k,[1/S,1/S,1]),h||v.rotateZ(k,k,x.angle)):v.multiply(k,x.labelPlaneMatrix,b),k}function fo(b,o,h,x,S){if(o){const k=v.clone(b);return v.scale(k,k,[S,S,1]),h||v.rotateZ(k,k,-x.angle),k}return x.glCoordMatrix}function xr(b,o){const h=[b.x,b.y,0,1];Q(h,h,o);const x=h[3];return{point:new v.pointGeometry(h[0]/x,h[1]/x),signedDistanceFromCamera:x}}function St(b,o){return .5+b/o*.5}function Mi(b,o){const h=b[0]/b[3],x=b[1]/b[3];return h>=-o[0]&&h<=o[0]&&x>=-o[1]&&x<=o[1]}function Ii(b,o,h,x,S,k,D,U,N){const X=x?b.textSizeData:b.iconSizeData,K=v.evaluateSizeForZoom(X,h.transform.zoom),ae=[256/h.width*2+1,256/h.height*2+1],fe=x?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;fe.clear();const ze=b.lineVertexArray,me=x?b.text.placedSymbolArray:b.icon.placedSymbolArray,Ce=h.transform.width/h.transform.height;let Ne=!1;for(let Ve=0;Ve<me.length;Ve++){const We=me.get(Ve);if(We.hidden||We.writingMode===v.WritingMode.vertical&&!Ne){W(We.numGlyphs,fe);continue}Ne=!1;const Ze=[We.anchorX,We.anchorY,0,1];if(v.transformMat4(Ze,Ze,o),!Mi(Ze,ae)){W(We.numGlyphs,fe);continue}const ut=St(h.transform.cameraToCenterDistance,Ze[3]),it=v.evaluateSizeForFeature(X,K,We),rt=D?it/ut:it*ut,ft=new v.pointGeometry(We.anchorX,We.anchorY),_t=xr(ft,S).point,lt={},Gt=_i(We,rt,!1,U,o,S,k,b.glyphOffsetArray,ze,fe,_t,ft,lt,Ce,N);Ne=Gt.useVertical,(Gt.notEnoughRoom||Ne||Gt.needsFlipping&&_i(We,rt,!0,U,o,S,k,b.glyphOffsetArray,ze,fe,_t,ft,lt,Ce,N).notEnoughRoom)&&W(We.numGlyphs,fe)}x?b.text.dynamicLayoutVertexBuffer.updateData(fe):b.icon.dynamicLayoutVertexBuffer.updateData(fe)}function tn(b,o,h,x,S,k,D,U,N,X,K,ae){const fe=U.glyphStartIndex+U.numGlyphs,ze=U.lineStartIndex,me=U.lineStartIndex+U.lineLength,Ce=o.getoffsetX(U.glyphStartIndex),Ne=o.getoffsetX(fe-1),Ve=Vn(b*Ce,h,x,S,k,D,U.segment,ze,me,N,X,K,ae);if(!Ve)return null;const We=Vn(b*Ne,h,x,S,k,D,U.segment,ze,me,N,X,K,ae);return We?{first:Ve,last:We}:null}function Pn(b,o,h,x){return b===v.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*x?{useVertical:!0}:(b===v.WritingMode.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function _i(b,o,h,x,S,k,D,U,N,X,K,ae,fe,ze,me){const Ce=o/24,Ne=b.lineOffsetX*Ce,Ve=b.lineOffsetY*Ce;let We;if(b.numGlyphs>1){const Ze=b.glyphStartIndex+b.numGlyphs,ut=b.lineStartIndex,it=b.lineStartIndex+b.lineLength,rt=tn(Ce,U,Ne,Ve,h,K,ae,b,N,k,fe,me);if(!rt)return{notEnoughRoom:!0};const ft=xr(rt.first.point,D).point,_t=xr(rt.last.point,D).point;if(x&&!h){const lt=Pn(b.writingMode,ft,_t,ze);if(lt)return lt}We=[rt.first];for(let lt=b.glyphStartIndex+1;lt<Ze-1;lt++)We.push(Vn(Ce*U.getoffsetX(lt),Ne,Ve,h,K,ae,b.segment,ut,it,N,k,fe,me));We.push(rt.last)}else{if(x&&!h){const ut=xr(ae,S).point,it=b.lineStartIndex+b.segment+1,rt=new v.pointGeometry(N.getx(it),N.gety(it)),ft=xr(rt,S),_t=ft.signedDistanceFromCamera>0?ft.point:mo(ae,rt,ut,1,S),lt=Pn(b.writingMode,ut,_t,ze);if(lt)return lt}const Ze=Vn(Ce*U.getoffsetX(b.glyphStartIndex),Ne,Ve,h,K,ae,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,N,k,fe,me);if(!Ze)return{notEnoughRoom:!0};We=[Ze]}for(const Ze of We)v.addDynamicAttributes(X,Ze.point,Ze.angle);return{}}function mo(b,o,h,x,S){const k=xr(b.add(b.sub(o)._unit()),S).point,D=h.sub(k);return h.add(D._mult(x/D.mag()))}function Vn(b,o,h,x,S,k,D,U,N,X,K,ae,fe){const ze=x?b-o:b+o;let me=ze>0?1:-1,Ce=0;x&&(me*=-1,Ce=Math.PI),me<0&&(Ce+=Math.PI);let Ne=me>0?U+D:U+D+1,Ve=S,We=S,Ze=0,ut=0;const it=Math.abs(ze),rt=[];for(;Ze+ut<=it;){if(Ne+=me,Ne<U||Ne>=N)return null;if(We=Ve,rt.push(Ve),Ve=ae[Ne],Ve===void 0){const Lt=new v.pointGeometry(X.getx(Ne),X.gety(Ne)),yi=xr(Lt,K);if(yi.signedDistanceFromCamera>0)Ve=ae[Ne]=yi.point;else{const l=Ne-me;Ve=mo(Ze===0?k:new v.pointGeometry(X.getx(l),X.gety(l)),Lt,We,it-Ze+1,K)}}Ze+=ut,ut=We.dist(Ve)}const ft=(it-Ze)/ut,_t=Ve.sub(We),lt=_t.mult(ft)._add(We);lt._add(_t._unit()._perp()._mult(h*me));const Gt=Ce+Math.atan2(Ve.y-We.y,Ve.x-We.x);return rt.push(lt),{point:lt,angle:fe?Gt:0,path:rt}}const ar=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function W(b,o){for(let h=0;h<b;h++){const x=o.length;o.resize(x+4),o.float32.set(ar,3*x)}}function Q(b,o,h){const x=o[0],S=o[1];return b[0]=h[0]*x+h[4]*S+h[12],b[1]=h[1]*x+h[5]*S+h[13],b[3]=h[3]*x+h[7]*S+h[15],b}const re=100;class he{constructor(o,h=new Cn(o.width+200,o.height+200,25),x=new Cn(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=x,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+re,this.screenBottomBoundary=o.height+re,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200}placeCollisionBox(o,h,x,S,k){const D=this.projectAndGetPerspectiveRatio(S,o.anchorPointX,o.anchorPointY),U=x*D.perspectiveRatio,N=o.x1*U+D.point.x,X=o.y1*U+D.point.y,K=o.x2*U+D.point.x,ae=o.y2*U+D.point.y;return!this.isInsideGrid(N,X,K,ae)||h!=="always"&&this.grid.hitTest(N,X,K,ae,h,k)?{box:[],offscreen:!1}:{box:[N,X,K,ae],offscreen:this.isOffscreen(N,X,K,ae)}}placeCollisionCircles(o,h,x,S,k,D,U,N,X,K,ae,fe,ze){const me=[],Ce=new v.pointGeometry(h.anchorX,h.anchorY),Ne=xr(Ce,D),Ve=St(this.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),We=(K?k/Ve:k*Ve)/v.ONE_EM,Ze=xr(Ce,U).point,ut=tn(We,S,h.lineOffsetX*We,h.lineOffsetY*We,!1,Ze,Ce,h,x,U,{},!1);let it=!1,rt=!1,ft=!0;if(ut){const _t=.5*fe*Ve+ze,lt=new v.pointGeometry(-100,-100),Gt=new v.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Lt=new ro,yi=ut.first,l=ut.last;let c=[];for(let T=yi.path.length-1;T>=1;T--)c.push(yi.path[T]);for(let T=1;T<l.path.length;T++)c.push(l.path[T]);const u=2.5*_t;if(N){const T=c.map(z=>xr(z,N));c=T.some(z=>z.signedDistanceFromCamera<=0)?[]:T.map(z=>z.point)}let f=[];if(c.length>0){const T=c[0].clone(),z=c[0].clone();for(let P=1;P<c.length;P++)T.x=Math.min(T.x,c[P].x),T.y=Math.min(T.y,c[P].y),z.x=Math.max(z.x,c[P].x),z.y=Math.max(z.y,c[P].y);f=T.x>=lt.x&&z.x<=Gt.x&&T.y>=lt.y&&z.y<=Gt.y?[c]:z.x<lt.x||T.x>Gt.x||z.y<lt.y||T.y>Gt.y?[]:v.clipLine([c],lt.x,lt.y,Gt.x,Gt.y)}for(const T of f){Lt.reset(T,.25*_t);let z=0;z=Lt.length<=.5*_t?1:Math.ceil(Lt.paddedLength/u)+1;for(let P=0;P<z;P++){const B=P/Math.max(z-1,1),G=Lt.lerp(B),H=G.x+re,oe=G.y+re;me.push(H,oe,_t,0);const ue=H-_t,se=oe-_t,Se=H+_t,we=oe+_t;if(ft=ft&&this.isOffscreen(ue,se,Se,we),rt=rt||this.isInsideGrid(ue,se,Se,we),o!=="always"&&this.grid.hitTestCircle(H,oe,_t,o,ae)&&(it=!0,!X))return{circles:[],offscreen:!1,collisionDetected:it}}}}return{circles:!X&&it||!rt?[]:me,offscreen:ft,collisionDetected:it}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let x=1/0,S=1/0,k=-1/0,D=-1/0;for(const K of o){const ae=new v.pointGeometry(K.x+re,K.y+re);x=Math.min(x,ae.x),S=Math.min(S,ae.y),k=Math.max(k,ae.x),D=Math.max(D,ae.y),h.push(ae)}const U=this.grid.query(x,S,k,D).concat(this.ignoredGrid.query(x,S,k,D)),N={},X={};for(const K of U){const ae=K.key;if(N[ae.bucketInstanceId]===void 0&&(N[ae.bucketInstanceId]={}),N[ae.bucketInstanceId][ae.featureIndex])continue;const fe=[new v.pointGeometry(K.x1,K.y1),new v.pointGeometry(K.x2,K.y1),new v.pointGeometry(K.x2,K.y2),new v.pointGeometry(K.x1,K.y2)];v.polygonIntersectsPolygon(h,fe)&&(N[ae.bucketInstanceId][ae.featureIndex]=!0,X[ae.bucketInstanceId]===void 0&&(X[ae.bucketInstanceId]=[]),X[ae.bucketInstanceId].push(ae.featureIndex))}return X}insertCollisionBox(o,h,x,S,k,D){(x?this.ignoredGrid:this.grid).insert({bucketInstanceId:S,featureIndex:k,collisionGroupID:D,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,x,S,k,D){const U=x?this.ignoredGrid:this.grid,N={bucketInstanceId:S,featureIndex:k,collisionGroupID:D,overlapMode:h};for(let X=0;X<o.length;X+=4)U.insertCircle(N,o[X],o[X+1],o[X+2])}projectAndGetPerspectiveRatio(o,h,x){const S=[h,x,0,1];return Q(S,S,o),{point:new v.pointGeometry((S[0]/S[3]+1)/2*this.transform.width+re,(-S[1]/S[3]+1)/2*this.transform.height+re),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S[3]*.5}}isOffscreen(o,h,x,S){return x<re||o>=this.screenRightBoundary||S<re||h>this.screenBottomBoundary}isInsideGrid(o,h,x,S){return x>=0&&o<this.gridRightBoundary&&S>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=v.identity([]);return v.translate(o,o,[-100,-100,0]),o}}function be(b,o,h){return o*(v.EXTENT/(b.tileSize*Math.pow(2,h-b.tileID.overscaledZ)))}class De{constructor(o,h,x,S){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):S&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Fe{constructor(o,h,x,S,k){this.text=new De(o?o.text:null,h,x,k),this.icon=new De(o?o.icon:null,h,S,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Le{constructor(o,h,x){this.text=o,this.icon=h,this.skipFade=x}}class ye{constructor(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]}}class ke{constructor(o,h,x,S,k){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=x,this.bucketIndex=S,this.tileID=k}}class ee{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:x=>x.collisionGroupID===h}}return this.collisionGroups[o]}}function V(b,o,h,x,S){const{horizontalAlign:k,verticalAlign:D}=v.getAnchorAlignment(b),U=-(k-.5)*o,N=-(D-.5)*h,X=v.evaluateVariableOffset(b,x);return new v.pointGeometry(U+X[0]*S,N+X[1]*S)}function j(b,o,h,x,S,k){const{x1:D,x2:U,y1:N,y2:X,anchorPointX:K,anchorPointY:ae}=b,fe=new v.pointGeometry(o,h);return x&&fe._rotate(S?k:-k),{x1:D+fe.x,y1:N+fe.y,x2:U+fe.x,y2:X+fe.y,anchorPointX:K,anchorPointY:ae}}class J{constructor(o,h,x,S){this.transform=o.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ee(x),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,x,S){const k=x.getBucket(h),D=x.latestFeatureIndex;if(!k||!D||h.id!==k.layerIds[0])return;const U=x.collisionBoxArray,N=k.layers[0].layout,X=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),K=x.tileSize/v.EXTENT,ae=this.transform.calculatePosMatrix(x.tileID.toUnwrapped()),fe=N.get("text-pitch-alignment")==="map",ze=N.get("text-rotation-alignment")==="map",me=be(x,1,this.transform.zoom),Ce=mn(ae,fe,ze,this.transform,me);let Ne=null;if(fe){const We=fo(ae,fe,ze,this.transform,me);Ne=v.multiply([],this.transform.labelPlaneMatrix,We)}this.retainedQueryData[k.bucketInstanceId]=new ke(k.bucketInstanceId,D,k.sourceLayerIndex,k.index,x.tileID);const Ve={bucket:k,layout:N,posMatrix:ae,textLabelPlaneMatrix:Ce,labelToScreenMatrix:Ne,scale:X,textPixelRatio:K,holdingForFade:x.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(S)for(const We of k.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:ut,symbolInstanceEnd:it}=We;o.push({sortKey:Ze,symbolInstanceStart:ut,symbolInstanceEnd:it,parameters:Ve})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(o,h,x,S,k,D,U,N,X,K,ae,fe,ze,me,Ce){const Ne=[fe.textOffset0,fe.textOffset1],Ve=V(o,x,S,Ne,k),We=this.collisionIndex.placeCollisionBox(j(h,Ve.x,Ve.y,D,U,this.transform.angle),ae,N,X,K.predicate);if((!Ce||this.collisionIndex.placeCollisionBox(j(Ce,Ve.x,Ve.y,D,U,this.transform.angle),ae,N,X,K.predicate).box.length!==0)&&We.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:Ne,width:x,height:S,anchor:o,textBoxScale:k,prevAnchor:Ze},this.markUsedJustification(ze,o,fe,me),ze.allowVerticalPlacement&&(this.markUsedOrientation(ze,me,fe),this.placedOrientations[fe.crossTileID]=me),{shift:Ve,placedGlyphBoxes:We}}}placeLayerBucketPart(o,h,x){const{bucket:S,layout:k,posMatrix:D,textLabelPlaneMatrix:U,labelToScreenMatrix:N,textPixelRatio:X,holdingForFade:K,collisionBoxArray:ae,partiallyEvaluatedTextSize:fe,collisionGroup:ze}=o.parameters,me=k.get("text-optional"),Ce=k.get("icon-optional"),Ne=v.getOverlapMode(k,"text-overlap","text-allow-overlap"),Ve=Ne==="always",We=v.getOverlapMode(k,"icon-overlap","icon-allow-overlap"),Ze=We==="always",ut=k.get("text-rotation-alignment")==="map",it=k.get("text-pitch-alignment")==="map",rt=k.get("icon-text-fit")!=="none",ft=k.get("symbol-z-order")==="viewport-y",_t=Ve&&(Ze||!S.hasIconData()||Ce),lt=Ze&&(Ve||!S.hasTextData()||me);!S.collisionArrays&&ae&&S.deserializeCollisionBoxes(ae);const Gt=(Lt,yi)=>{if(h[Lt.crossTileID])return;if(K)return void(this.placements[Lt.crossTileID]=new Le(!1,!1,!1));let l=!1,c=!1,u=!0,f=null,T={box:null,offscreen:null},z={box:null,offscreen:null},P=null,B=null,G=null,H=0,oe=0,ue=0;yi.textFeatureIndex?H=yi.textFeatureIndex:Lt.useRuntimeCollisionCircles&&(H=Lt.featureIndex),yi.verticalTextFeatureIndex&&(oe=yi.verticalTextFeatureIndex);const se=yi.textBox;if(se){const Ae=Ee=>{let Re=v.WritingMode.horizontal;if(S.allowVerticalPlacement&&!Ee&&this.prevPlacement){const je=this.prevPlacement.placedOrientations[Lt.crossTileID];je&&(this.placedOrientations[Lt.crossTileID]=je,Re=je,this.markUsedOrientation(S,Re,Lt))}return Re},ge=(Ee,Re)=>{if(S.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&yi.verticalTextBox){for(const je of S.writingModes)if(je===v.WritingMode.vertical?(T=Re(),z=T):T=Ee(),T&&T.box&&T.box.length)break}else T=Ee()};if(k.get("text-variable-anchor")){let Ee=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt.crossTileID]){const He=this.prevPlacement.variableOffsets[Lt.crossTileID];Ee.indexOf(He.anchor)>0&&(Ee=Ee.filter(Ye=>Ye!==He.anchor),Ee.unshift(He.anchor))}const Re=(He,Ye,et)=>{const st=He.x2-He.x1,vt=He.y2-He.y1,mt=Lt.textBoxScale,Pt=rt&&We==="never"?Ye:null;let $t={box:[],offscreen:!1};const ei=Ne!=="never"?2*Ee.length:Ee.length;for(let Nt=0;Nt<ei;++Nt){const Bi=this.attemptAnchorPlacement(Ee[Nt%Ee.length],He,st,vt,mt,ut,it,X,D,ze,Nt>=Ee.length?Ne:"never",Lt,S,et,Pt);if(Bi&&($t=Bi.placedGlyphBoxes,$t&&$t.box&&$t.box.length)){l=!0,f=Bi.shift;break}}return $t};ge(()=>Re(se,yi.iconBox,v.WritingMode.horizontal),()=>{const He=yi.verticalTextBox;return S.allowVerticalPlacement&&!(T&&T.box&&T.box.length)&&Lt.numVerticalGlyphVertices>0&&He?Re(He,yi.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),T&&(l=T.box,u=T.offscreen);const je=Ae(T&&T.box);if(!l&&this.prevPlacement){const He=this.prevPlacement.variableOffsets[Lt.crossTileID];He&&(this.variableOffsets[Lt.crossTileID]=He,this.markUsedJustification(S,He.anchor,Lt,je))}}else{const Ee=(Re,je)=>{const He=this.collisionIndex.placeCollisionBox(Re,Ne,X,D,ze.predicate);return He&&He.box&&He.box.length&&(this.markUsedOrientation(S,je,Lt),this.placedOrientations[Lt.crossTileID]=je),He};ge(()=>Ee(se,v.WritingMode.horizontal),()=>{const Re=yi.verticalTextBox;return S.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&Re?Ee(Re,v.WritingMode.vertical):{box:null,offscreen:null}}),Ae(T&&T.box&&T.box.length)}}if(P=T,l=P&&P.box&&P.box.length>0,u=P&&P.offscreen,Lt.useRuntimeCollisionCircles){const Ae=S.text.placedSymbolArray.get(Lt.centerJustifiedTextSymbolIndex),ge=v.evaluateSizeForFeature(S.textSizeData,fe,Ae),Ee=k.get("text-padding");B=this.collisionIndex.placeCollisionCircles(Ne,Ae,S.lineVertexArray,S.glyphOffsetArray,ge,D,U,N,x,it,ze.predicate,Lt.collisionCircleDiameter,Ee),l=Ve||B.circles.length>0&&!B.collisionDetected,u=u&&B.offscreen}if(yi.iconFeatureIndex&&(ue=yi.iconFeatureIndex),yi.iconBox){const Ae=ge=>{const Ee=rt&&f?j(ge,f.x,f.y,ut,it,this.transform.angle):ge;return this.collisionIndex.placeCollisionBox(Ee,We,X,D,ze.predicate)};z&&z.box&&z.box.length&&yi.verticalIconBox?(G=Ae(yi.verticalIconBox),c=G.box.length>0):(G=Ae(yi.iconBox),c=G.box.length>0),u=u&&G.offscreen}const Se=me||Lt.numHorizontalGlyphVertices===0&&Lt.numVerticalGlyphVertices===0,we=Ce||Lt.numIconVertices===0;if(Se||we?we?Se||(c=c&&l):l=c&&l:c=l=c&&l,l&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,Ne,k.get("text-ignore-placement"),S.bucketInstanceId,z&&z.box&&oe?oe:H,ze.ID),c&&G&&this.collisionIndex.insertCollisionBox(G.box,We,k.get("icon-ignore-placement"),S.bucketInstanceId,ue,ze.ID),B&&(l&&this.collisionIndex.insertCollisionCircles(B.circles,Ne,k.get("text-ignore-placement"),S.bucketInstanceId,H,ze.ID),x)){const Ae=S.bucketInstanceId;let ge=this.collisionCircleArrays[Ae];ge===void 0&&(ge=this.collisionCircleArrays[Ae]=new ye);for(let Ee=0;Ee<B.circles.length;Ee+=4)ge.circles.push(B.circles[Ee+0]),ge.circles.push(B.circles[Ee+1]),ge.circles.push(B.circles[Ee+2]),ge.circles.push(B.collisionDetected?1:0)}this.placements[Lt.crossTileID]=new Le(l||_t,c||lt,u||S.justReloaded),h[Lt.crossTileID]=!0};if(ft){const Lt=S.getSortedSymbolIndexes(this.transform.angle);for(let yi=Lt.length-1;yi>=0;--yi){const l=Lt[yi];Gt(S.symbolInstances.get(l),S.collisionArrays[l])}}else for(let Lt=o.symbolInstanceStart;Lt<o.symbolInstanceEnd;Lt++)Gt(S.symbolInstances.get(Lt),S.collisionArrays[Lt]);if(x&&S.bucketInstanceId in this.collisionCircleArrays){const Lt=this.collisionCircleArrays[S.bucketInstanceId];v.invert(Lt.invProjMatrix,D),Lt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(o,h,x,S){let k;k=S===v.WritingMode.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(h)];const D=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const U of D)U>=0&&(o.text.placedSymbolArray.get(U).crossTileID=k>=0&&U!==k?0:x.crossTileID)}markUsedOrientation(o,h,x){const S=h===v.WritingMode.horizontal||h===v.WritingMode.horizontalOnly?h:0,k=h===v.WritingMode.vertical?h:0,D=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const U of D)o.text.placedSymbolArray.get(U).placedOrientation=S;x.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let x=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const S=h?h.symbolFadeChange(o):1,k=h?h.opacities:{},D=h?h.variableOffsets:{},U=h?h.placedOrientations:{};for(const N in this.placements){const X=this.placements[N],K=k[N];K?(this.opacities[N]=new Fe(K,S,X.text,X.icon),x=x||X.text!==K.text.placed||X.icon!==K.icon.placed):(this.opacities[N]=new Fe(null,S,X.text,X.icon,X.skipFade),x=x||X.text||X.icon)}for(const N in k){const X=k[N];if(!this.opacities[N]){const K=new Fe(X,S,!1,!1);K.isHidden()||(this.opacities[N]=K,x=x||X.text.placed||X.icon.placed)}}for(const N in D)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=D[N]);for(const N in U)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=U[N]);x?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const x={};for(const S of h){const k=S.getBucket(o);k&&S.latestFeatureIndex&&o.id===k.layerIds[0]&&this.updateBucketOpacities(k,x,S.collisionBoxArray)}}updateBucketOpacities(o,h,x){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const S=o.layers[0].layout,k=new Fe(null,0,!1,!1,!0),D=S.get("text-allow-overlap"),U=S.get("icon-allow-overlap"),N=S.get("text-variable-anchor"),X=S.get("text-rotation-alignment")==="map",K=S.get("text-pitch-alignment")==="map",ae=S.get("icon-text-fit")!=="none",fe=new Fe(null,0,D&&(U||!o.hasIconData()||S.get("icon-optional")),U&&(D||!o.hasTextData()||S.get("text-optional")),!0);!o.collisionArrays&&x&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(x);const ze=(me,Ce,Ne)=>{for(let Ve=0;Ve<Ce/4;Ve++)me.opacityVertexArray.emplaceBack(Ne)};for(let me=0;me<o.symbolInstances.length;me++){const Ce=o.symbolInstances.get(me),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:Ve,crossTileID:We}=Ce;let Ze=this.opacities[We];h[We]?Ze=k:Ze||(Ze=fe,this.opacities[We]=Ze),h[We]=!0;const ut=Ce.numIconVertices>0,it=this.placedOrientations[Ce.crossTileID],rt=it===v.WritingMode.vertical,ft=it===v.WritingMode.horizontal||it===v.WritingMode.horizontalOnly;if(Ne>0||Ve>0){const _t=Be(Ze.text);ze(o.text,Ne,rt?xt:_t),ze(o.text,Ve,ft?xt:_t);const lt=Ze.text.isHidden();[Ce.rightJustifiedTextSymbolIndex,Ce.centerJustifiedTextSymbolIndex,Ce.leftJustifiedTextSymbolIndex].forEach(yi=>{yi>=0&&(o.text.placedSymbolArray.get(yi).hidden=lt||rt?1:0)}),Ce.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Ce.verticalPlacedTextSymbolIndex).hidden=lt||ft?1:0);const Gt=this.variableOffsets[Ce.crossTileID];Gt&&this.markUsedJustification(o,Gt.anchor,Ce,it);const Lt=this.placedOrientations[Ce.crossTileID];Lt&&(this.markUsedJustification(o,"left",Ce,Lt),this.markUsedOrientation(o,Lt,Ce))}if(ut){const _t=Be(Ze.icon),lt=!(ae&&Ce.verticalPlacedIconSymbolIndex&&rt);Ce.placedIconSymbolIndex>=0&&(ze(o.icon,Ce.numIconVertices,lt?_t:xt),o.icon.placedSymbolArray.get(Ce.placedIconSymbolIndex).hidden=Ze.icon.isHidden()),Ce.verticalPlacedIconSymbolIndex>=0&&(ze(o.icon,Ce.numVerticalIconVertices,lt?xt:_t),o.icon.placedSymbolArray.get(Ce.verticalPlacedIconSymbolIndex).hidden=Ze.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const _t=o.collisionArrays[me];if(_t){let lt=new v.pointGeometry(0,0);if(_t.textBox||_t.verticalTextBox){let Lt=!0;if(N){const yi=this.variableOffsets[We];yi?(lt=V(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textBoxScale),X&&lt._rotate(K?this.transform.angle:-this.transform.angle)):Lt=!1}_t.textBox&&ne(o.textCollisionBox.collisionVertexArray,Ze.text.placed,!Lt||rt,lt.x,lt.y),_t.verticalTextBox&&ne(o.textCollisionBox.collisionVertexArray,Ze.text.placed,!Lt||ft,lt.x,lt.y)}const Gt=Boolean(!ft&&_t.verticalIconBox);_t.iconBox&&ne(o.iconCollisionBox.collisionVertexArray,Ze.icon.placed,Gt,ae?lt.x:0,ae?lt.y:0),_t.verticalIconBox&&ne(o.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!Gt,ae?lt.x:0,ae?lt.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=me.invProjMatrix,o.placementViewportMatrix=me.viewportMatrix,o.collisionCircleArray=me.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const x=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*x>o}setStale(){this.stale=!0}}function ne(b,o,h,x,S){b.emplaceBack(o?1:0,h?1:0,x||0,S||0),b.emplaceBack(o?1:0,h?1:0,x||0,S||0),b.emplaceBack(o?1:0,h?1:0,x||0,S||0),b.emplaceBack(o?1:0,h?1:0,x||0,S||0)}const pe=Math.pow(2,25),Ie=Math.pow(2,24),le=Math.pow(2,17),_e=Math.pow(2,16),de=Math.pow(2,9),$e=Math.pow(2,8),Ke=Math.pow(2,1);function Be(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const o=b.placed?1:0,h=Math.floor(127*b.opacity);return h*pe+o*Ie+h*le+o*_e+h*de+o*$e+h*Ke+o}const xt=0;class ht{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,x,S,k){const D=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(D,S,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((U,N)=>U.sortKey-N.sortKey));this._currentPartIndex<D.length;)if(h.placeLayerBucketPart(D[this._currentPartIndex],this._seenCrossTileIDs,x),this._currentPartIndex++,k())return!0;return!1}}class bt{constructor(o,h,x,S,k,D,U){this.placement=new J(o,k,D,U),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(o,h,x){const S=v.exported.now(),k=()=>{const D=v.exported.now()-S;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=h[o[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=U)&&(!D.maxzoom||D.maxzoom>U)){if(this._inProgressLayer||(this._inProgressLayer=new ht(D)),this._inProgressLayer.continuePlacement(x[D.source],this.placement,this._showCollisionBoxes,D,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Rt=512/v.EXTENT/2;class Zt{constructor(o,h,x){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let S=0;S<h.length;S++){const k=h.get(S),D=k.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:k.crossTileID,coord:this.getScaledCoordinates(k,o)})}}getScaledCoordinates(o,h){const x=Rt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*v.EXTENT+o.anchorX)*x),y:Math.floor((h.canonical.y*v.EXTENT+o.anchorY)*x)}}findMatches(o,h,x){const S=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let k=0;k<o.length;k++){const D=o.get(k);if(D.crossTileID)continue;const U=this.indexedSymbolInstances[D.key];if(!U)continue;const N=this.getScaledCoordinates(D,h);for(const X of U)if(Math.abs(X.coord.x-N.x)<=S&&Math.abs(X.coord.y-N.y)<=S&&!x[X.crossTileID]){x[X.crossTileID]=!0,D.crossTileID=X.crossTileID;break}}}}class Yt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ii{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const x in this.indexes){const S=this.indexes[x],k={};for(const D in S){const U=S[D];U.tileID=U.tileID.unwrapTo(U.tileID.wrap+h),k[U.tileID.key]=U}this.indexes[x]=k}this.lng=o}addBucket(o,h,x){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let k=0;k<h.symbolInstances.length;k++)h.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const S=this.usedCrossTileIDs[o.overscaledZ];for(const k in this.indexes){const D=this.indexes[k];if(Number(k)>o.overscaledZ)for(const U in D){const N=D[U];N.tileID.isChildOf(o)&&N.findMatches(h.symbolInstances,o,S)}else{const U=D[o.scaledTo(Number(k)).key];U&&U.findMatches(h.symbolInstances,o,S)}}for(let k=0;k<h.symbolInstances.length;k++){const D=h.symbolInstances.get(k);D.crossTileID||(D.crossTileID=x.generate(),S[D.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Zt(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const x in h.indexedSymbolInstances)for(const S of h.indexedSymbolInstances[x])delete this.usedCrossTileIDs[o][S.crossTileID]}removeStaleBuckets(o){let h=!1;for(const x in this.indexes){const S=this.indexes[x];for(const k in S)o[S[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,S[k]),delete S[k],h=!0)}return h}}class qt{constructor(){this.layerIndexes={},this.crossTileIDs=new Yt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,x){let S=this.layerIndexes[o.id];S===void 0&&(S=this.layerIndexes[o.id]=new ii);let k=!1;const D={};S.handleWrapJump(x);for(const U of h){const N=U.getBucket(o);N&&o.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(U.tileID,N,this.crossTileIDs)&&(k=!0),D[N.bucketInstanceId]=!0)}return S.removeStaleBuckets(D)&&(k=!0),k}pruneUnusedLayers(o){const h={};o.forEach(x=>{h[x]=!0});for(const x in this.layerIndexes)h[x]||delete this.layerIndexes[x]}}const It=(b,o)=>v.emitValidationErrors(b,o&&o.filter(h=>h.identifier!=="source.canvas")),Rr=v.pick(Si,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ri=v.pick(Si,["setCenter","setZoom","setBearing","setPitch"]),Vr=function(){const b={},o=v.spec.$version;for(const h in v.spec.$root){const x=v.spec.$root[h];if(x.required){let S=null;S=h==="version"?o:x.type==="array"?[]:{},S!=null&&(b[h]=S)}}return b}();class ln extends v.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new Li(en(),this),this.imageManager=new Jt,this.imageManager.setEventedParent(this),this.glyphManager=new zi(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new lr(256,512),this.crossTileSymbolIndex=new qt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());const x=this;this._rtlTextPluginCallback=ln.registerForPluginStateChange(S=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},(k,D)=>{if(v.triggerPluginCompletionEvent(k),D&&D.every(U=>U))for(const U in x.sourceCaches)x.sourceCaches[U].reload()})}),this.on("data",S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const k=this.sourceCaches[S.sourceId];if(!k)return;const D=k.getSource();if(D&&D.vectorLayerIds)for(const U in this._layers){const N=this._layers[U];N.source===D.id&&this._validateLayer(N)}})}loadURL(o,h={}){this.fire(new v.Event("dataloading",{dataType:"style"}));const x=typeof h.validate!="boolean"||h.validate,S=this.map._requestManager.transformRequest(o,v.ResourceType.Style);this._request=v.getJSON(S,(k,D)=>{this._request=null,k?this.fire(new v.ErrorEvent(k)):D&&this._load(D,x)})}loadJSON(o,h={}){this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.exported.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(Vr,!1)}_load(o,h){if(h&&It(this,v.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const S in o.sources)this.addSource(S,o.sources[S],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const x=Go(this.stylesheet.layers);this._order=x.map(S=>S.id),this._layers={},this._serializedLayers={};for(let S of x)S=v.createStyleLayer(S),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new fn(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(h,x,S,k){let D,U,N;const X=S>1?"@2x":"";let K=v.getJSON(x.transformRequest(x.normalizeSpriteURL(h,X,".json"),v.ResourceType.SpriteJSON),(ze,me)=>{K=null,N||(N=ze,D=me,fe())}),ae=v.getImage(x.transformRequest(x.normalizeSpriteURL(h,X,".png"),v.ResourceType.SpriteImage),(ze,me)=>{ae=null,N||(N=ze,U=me,fe())});function fe(){if(N)k(N);else if(D&&U){const ze=v.exported.getImageData(U),me={};for(const Ce in D){const{width:Ne,height:Ve,x:We,y:Ze,sdf:ut,pixelRatio:it,stretchX:rt,stretchY:ft,content:_t}=D[Ce],lt=new v.RGBAImage({width:Ne,height:Ve});v.RGBAImage.copy(ze,lt,{x:We,y:Ze},{x:0,y:0},{width:Ne,height:Ve}),me[Ce]={data:lt,pixelRatio:it,sdf:ut,stretchX:rt,stretchY:ft,content:_t}}k(null,me)}}return{cancel(){K&&(K.cancel(),K=null),ae&&(ae.cancel(),ae=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(h,x)=>{if(this._spriteRequest=null,h)this.fire(new v.ErrorEvent(h));else if(x)for(const S in x)this.imageManager.addImage(S,x[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const x=o.sourceLayer;if(!x)return;const S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(x)===-1)&&this.fire(new v.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${S.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const x of o){const S=this._layers[x];S.type!=="custom"&&h.push(S.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(S.length||k.length)&&this._updateWorkerLayers(S,k);for(const D in this._updatedSources){const U=this._updatedSources[D];U==="reload"?this._reloadSource(D):U==="clear"&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const x={};for(const S in this.sourceCaches){const k=this.sourceCaches[S];x[S]=k.used,k.used=!1}for(const S of this._order){const k=this._layers[S];k.recalculate(o,this._availableImages),!k.isHidden(o.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const S in x){const k=this.sourceCaches[S];x[S]!==k.used&&k.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new v.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),It(this,v.validateStyle(o)))return!1;(o=v.clone$1(o)).layers=Go(o.layers);const h=function(S,k){if(!S)return[{command:Si.setStyle,args:[k]}];let D=[];try{if(!Xe(S.version,k.version))return[{command:Si.setStyle,args:[k]}];Xe(S.center,k.center)||D.push({command:Si.setCenter,args:[k.center]}),Xe(S.zoom,k.zoom)||D.push({command:Si.setZoom,args:[k.zoom]}),Xe(S.bearing,k.bearing)||D.push({command:Si.setBearing,args:[k.bearing]}),Xe(S.pitch,k.pitch)||D.push({command:Si.setPitch,args:[k.pitch]}),Xe(S.sprite,k.sprite)||D.push({command:Si.setSprite,args:[k.sprite]}),Xe(S.glyphs,k.glyphs)||D.push({command:Si.setGlyphs,args:[k.glyphs]}),Xe(S.transition,k.transition)||D.push({command:Si.setTransition,args:[k.transition]}),Xe(S.light,k.light)||D.push({command:Si.setLight,args:[k.light]});const U={},N=[];(function(K,ae,fe,ze){let me;for(me in ae=ae||{},K=K||{})Object.prototype.hasOwnProperty.call(K,me)&&(Object.prototype.hasOwnProperty.call(ae,me)||io(me,fe,ze));for(me in ae)Object.prototype.hasOwnProperty.call(ae,me)&&(Object.prototype.hasOwnProperty.call(K,me)?Xe(K[me],ae[me])||(K[me].type==="geojson"&&ae[me].type==="geojson"&&Sa(K,ae,me)?fe.push({command:Si.setGeoJSONSourceData,args:[me,ae[me].data]}):zn(me,ae,fe,ze)):wn(me,ae,fe))})(S.sources,k.sources,N,U);const X=[];S.layers&&S.layers.forEach(K=>{U[K.source]?D.push({command:Si.removeLayer,args:[K.id]}):X.push(K)}),D=D.concat(N),function(K,ae,fe){ae=ae||[];const ze=(K=K||[]).map(Mt),me=ae.map(Mt),Ce=K.reduce(Bo,{}),Ne=ae.reduce(Bo,{}),Ve=ze.slice(),We=Object.create(null);let Ze,ut,it,rt,ft,_t,lt;for(Ze=0,ut=0;Ze<ze.length;Ze++)it=ze[Ze],Object.prototype.hasOwnProperty.call(Ne,it)?ut++:(fe.push({command:Si.removeLayer,args:[it]}),Ve.splice(Ve.indexOf(it,ut),1));for(Ze=0,ut=0;Ze<me.length;Ze++)it=me[me.length-1-Ze],Ve[Ve.length-1-Ze]!==it&&(Object.prototype.hasOwnProperty.call(Ce,it)?(fe.push({command:Si.removeLayer,args:[it]}),Ve.splice(Ve.lastIndexOf(it,Ve.length-ut),1)):ut++,_t=Ve[Ve.length-Ze],fe.push({command:Si.addLayer,args:[Ne[it],_t]}),Ve.splice(Ve.length-Ze,0,it),We[it]=!0);for(Ze=0;Ze<me.length;Ze++)if(it=me[Ze],rt=Ce[it],ft=Ne[it],!We[it]&&!Xe(rt,ft))if(Xe(rt.source,ft.source)&&Xe(rt["source-layer"],ft["source-layer"])&&Xe(rt.type,ft.type)){for(lt in ot(rt.layout,ft.layout,fe,it,null,Si.setLayoutProperty),ot(rt.paint,ft.paint,fe,it,null,Si.setPaintProperty),Xe(rt.filter,ft.filter)||fe.push({command:Si.setFilter,args:[it,ft.filter]}),Xe(rt.minzoom,ft.minzoom)&&Xe(rt.maxzoom,ft.maxzoom)||fe.push({command:Si.setLayerZoomRange,args:[it,ft.minzoom,ft.maxzoom]}),rt)Object.prototype.hasOwnProperty.call(rt,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?ot(rt[lt],ft[lt],fe,it,lt.slice(6),Si.setPaintProperty):Xe(rt[lt],ft[lt])||fe.push({command:Si.setLayerProperty,args:[it,lt,ft[lt]]}));for(lt in ft)Object.prototype.hasOwnProperty.call(ft,lt)&&!Object.prototype.hasOwnProperty.call(rt,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?ot(rt[lt],ft[lt],fe,it,lt.slice(6),Si.setPaintProperty):Xe(rt[lt],ft[lt])||fe.push({command:Si.setLayerProperty,args:[it,lt,ft[lt]]}))}else fe.push({command:Si.removeLayer,args:[it]}),_t=Ve[Ve.lastIndexOf(it)+1],fe.push({command:Si.addLayer,args:[ft,_t]})}(X,k.layers,D)}catch(U){console.warn("Unable to compute style diff:",U),D=[{command:Si.setStyle,args:[k]}]}return D}(this.serialize(),o).filter(S=>!(S.command in ri));if(h.length===0)return!1;const x=h.filter(S=>!(S.command in Rr));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);return h.forEach(S=>{S.command!=="setTransition"&&this[S.command].apply(this,S.args)}),this.stylesheet=o,!0}addImage(o,h){if(this.getImage(o))return this.fire(new v.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new v.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,x={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(v.validateStyle.source,`sources.${o}`,h,null,x))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const S=this.sourceCaches[o]=new Ht(o,h,this.dispatcher);S.style=this,S.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:S.serialize(),sourceId:o})),S.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===o)return this.fire(new v.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${x}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,x={}){this._checkLoaded();const S=o.id;if(this.getLayer(S))return void this.fire(new v.ErrorEvent(new Error(`Layer "${S}" already exists on this map.`)));let k;if(o.type==="custom"){if(It(this,v.validateCustomStyleLayer(o)))return;k=v.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(S,o.source),o=v.clone$1(o),o=v.extend(o,{source:S})),this._validate(v.validateStyle.layer,`layers.${S}`,o,{arrayIndex:-1},x))return;k=v.createStyleLayer(o),this._validateLayer(k),k.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[k.id]=k.serialize()}const D=h?this._order.indexOf(h):this._order.length;if(h&&D===-1)this.fire(new v.ErrorEvent(new Error(`Cannot add layer "${S}" before non-existing layer "${h}".`)));else{if(this._order.splice(D,0,S),this._layerOrderChanged=!0,this._layers[S]=k,this._removedLayers[S]&&k.source&&k.type!=="custom"){const U=this._removedLayers[S];delete this._removedLayers[S],U.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new v.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const x=this._order.indexOf(o);this._order.splice(x,1);const S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new v.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(S,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new v.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const x=this._order.indexOf(o);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,x){this._checkLoaded();const S=this.getLayer(o);S?S.minzoom===h&&S.maxzoom===x||(h!=null&&(S.minzoom=h),x!=null&&(S.maxzoom=x),this._updateLayer(S)):this.fire(new v.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,x={}){this._checkLoaded();const S=this.getLayer(o);if(S){if(!Xe(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(v.validateStyle.filter,`layers.${S.id}.filter`,h,null,x)||(S.filter=v.clone$1(h),this._updateLayer(S)))}else this.fire(new v.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return v.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,h,x,S={}){this._checkLoaded();const k=this.getLayer(o);k?Xe(k.getLayoutProperty(h),x)||(k.setLayoutProperty(h,x,S),this._updateLayer(k)):this.fire(new v.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const x=this.getLayer(o);if(x)return x.getLayoutProperty(h);this.fire(new v.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,x,S={}){this._checkLoaded();const k=this.getLayer(o);k?Xe(k.getPaintProperty(h),x)||(k.setPaintProperty(h,x,S)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new v.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const x=o.source,S=o.sourceLayer,k=this.sourceCaches[x];if(k===void 0)return void this.fire(new v.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const D=k.getSource().type;D==="geojson"&&S?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||S?(o.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),k.setFeatureState(S,o.id,h)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const x=o.source,S=this.sourceCaches[x];if(S===void 0)return void this.fire(new v.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const k=S.getSource().type,D=k==="vector"?o.sourceLayer:void 0;k!=="vector"||D?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(D,o.id,h):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,x=o.sourceLayer,S=this.sourceCaches[h];if(S!==void 0)return S.getSource().type!=="vector"||x?(o.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(x,o.id)):void this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new v.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=D=>this._layers[D].type==="fill-extrusion",x={},S=[];for(let D=this._order.length-1;D>=0;D--){const U=this._order[D];if(h(U)){x[U]=D;for(const N of o){const X=N[U];if(X)for(const K of X)S.push(K)}}}S.sort((D,U)=>U.intersectionZ-D.intersectionZ);const k=[];for(let D=this._order.length-1;D>=0;D--){const U=this._order[D];if(h(U))for(let N=S.length-1;N>=0;N--){const X=S[N].feature;if(x[X.layer.id]<D)break;k.push(X),S.pop()}else for(const N of o){const X=N[U];if(X)for(const K of X)k.push(K.feature)}}return k}queryRenderedFeatures(o,h,x){h&&h.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const U=this._layers[D];if(!U)return this.fire(new v.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];S[U.source]=!0}}const k=[];h.availableImages=this._availableImages;for(const D in this.sourceCaches)h.layers&&!S[D]||k.push(ir(this.sourceCaches[D],this._layers,this._serializedLayers,o,h,x));return this.placement&&k.push(function(D,U,N,X,K,ae,fe){const ze={},me=ae.queryRenderedSymbols(X),Ce=[];for(const Ne of Object.keys(me).map(Number))Ce.push(fe[Ne]);Ce.sort(gi);for(const Ne of Ce){const Ve=Ne.featureIndex.lookupSymbolFeatures(me[Ne.bucketInstanceId],U,Ne.bucketIndex,Ne.sourceLayerIndex,K.filter,K.layers,K.availableImages,D);for(const We in Ve){const Ze=ze[We]=ze[We]||[],ut=Ve[We];ut.sort((it,rt)=>{const ft=Ne.featureSortOrder;if(ft){const _t=ft.indexOf(it.featureIndex);return ft.indexOf(rt.featureIndex)-_t}return rt.featureIndex-it.featureIndex});for(const it of ut)Ze.push(it)}}for(const Ne in ze)ze[Ne].forEach(Ve=>{const We=Ve.feature,Ze=N[D[Ne].source].getFeatureState(We.layer["source-layer"],We.id);We.source=We.layer.source,We.layer["source-layer"]&&(We.sourceLayer=We.layer["source-layer"]),We.state=Ze});return ze}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(o,h){h&&h.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const x=this.sourceCaches[o];return x?function(S,k){const D=S.getRenderableIds().map(X=>S.getTileByID(X)),U=[],N={};for(let X=0;X<D.length;X++){const K=D[X],ae=K.tileID.canonical.key;N[ae]||(N[ae]=!0,K.querySourceFeatures(U,k))}return U}(x,h):[]}addSourceType(o,h,x){return ln.getSourceType(o)?x(new Error(`A source type called "${o}" already exists.`)):(ln.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const D in o)if(!Xe(o[D],x[D])){S=!0;break}if(!S)return;const k={now:v.exported.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(k)}_validate(o,h,x,S,k={}){return(!k||k.validate!==!1)&&It(this,o.call(v.validateStyle,v.extend({key:h,style:this.serialize(),value:x,styleSpec:v.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,x,S,k=!1){let D=!1,U=!1;const N={};for(const X of this._order){const K=this._layers[X];if(K.type!=="symbol")continue;if(!N[K.source]){const fe=this.sourceCaches[K.source];N[K.source]=fe.getRenderableIds(!0).map(ze=>fe.getTileByID(ze)).sort((ze,me)=>me.tileID.overscaledZ-ze.tileID.overscaledZ||(ze.tileID.isLessThan(me.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(K,N[K.source],o.center.lng);D=D||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.exported.now(),o.zoom))&&(this.pauseablePlacement=new bt(o,this._order,k,h,x,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.exported.now()),U=!0),D&&this.pauseablePlacement.placement.setStale()),U||D)for(const X of this._order){const K=this._layers[X];K.type==="symbol"&&this.placement.updateLayerOpacities(K,N[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,x){this.imageManager.getImages(h.icons,x),this._updateTilesForChangedImages();const S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(o,h,x){this.glyphManager.getGlyphs(h.stacks,x)}getResource(o,h,x){return v.makeRequest(h,x)}}ln.getSourceType=function(b){return Ui[b]},ln.setSourceType=function(b,o){Ui[b]=o},ln.registerForPluginStateChange=v.registerForPluginStateChange;var rn=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),Mn={prelude:br(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:br(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:br(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:br(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:br("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:br(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:br("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:br("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:br("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:br(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:br(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:br(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:br(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:br(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:br(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:br(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:br(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:br(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:br(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:br(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:br(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:br(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function br(b,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=o.match(/attribute ([\w]+) ([\w]+)/g),S=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=k?k.concat(S):S,U={};return{fragmentSource:b=b.replace(h,(N,X,K,ae,fe)=>(U[fe]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${fe}
varying ${K} ${ae} ${fe};
#else
uniform ${K} ${ae} u_${fe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${fe}
    ${K} ${ae} ${fe} = u_${fe};
#endif
`)),vertexSource:o=o.replace(h,(N,X,K,ae,fe)=>{const ze=ae==="float"?"vec2":"vec4",me=fe.match(/color/)?"color":ze;return U[fe]?X==="define"?`
#ifndef HAS_UNIFORM_u_${fe}
uniform lowp float u_${fe}_t;
attribute ${K} ${ze} a_${fe};
varying ${K} ${ae} ${fe};
#else
uniform ${K} ${ae} u_${fe};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${fe}
    ${fe} = a_${fe};
#else
    ${K} ${ae} ${fe} = u_${fe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${fe}
    ${fe} = unpack_mix_${me}(a_${fe}, u_${fe}_t);
#else
    ${K} ${ae} ${fe} = u_${fe};
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_${fe}
uniform lowp float u_${fe}_t;
attribute ${K} ${ze} a_${fe};
#else
uniform ${K} ${ae} u_${fe};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${fe}
    ${K} ${ae} ${fe} = a_${fe};
#else
    ${K} ${ae} ${fe} = u_${fe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${fe}
    ${K} ${ae} ${fe} = unpack_mix_${me}(a_${fe}, u_${fe}_t);
#else
    ${K} ${ae} ${fe} = u_${fe};
#endif
`}),staticAttributes:x,staticUniforms:D}}class ja{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,x,S,k,D,U,N){this.context=o;let X=this.boundPaintVertexBuffers.length!==S.length;for(let K=0;!X&&K<S.length;K++)this.boundPaintVertexBuffers[K]!==S[K]&&(X=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===x&&!X&&this.boundIndexBuffer===k&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===U&&this.boundDynamicVertexBuffer2===N?(o.bindVertexArrayOES.set(this.vao),U&&U.bind(),k&&k.dynamicDraw&&k.bind(),N&&N.bind()):this.freshBind(h,x,S,k,D,U,N)}freshBind(o,h,x,S,k,D,U){let N;const X=o.numAttributes,K=this.context,ae=K.gl;if(K.extVertexArrayObject)this.vao&&this.destroy(),this.vao=K.extVertexArrayObject.createVertexArrayOES(),K.bindVertexArrayOES.set(this.vao),N=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=S,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=U;else{N=K.currentNumAttributes||0;for(let fe=X;fe<N;fe++)ae.disableVertexAttribArray(fe)}h.enableAttributes(ae,o);for(const fe of x)fe.enableAttributes(ae,o);D&&D.enableAttributes(ae,o),U&&U.enableAttributes(ae,o),h.bind(),h.setVertexAttribPointers(ae,o,k);for(const fe of x)fe.bind(),fe.setVertexAttribPointers(ae,o,k);D&&(D.bind(),D.setVertexAttribPointers(ae,o,k)),S&&S.bind(),U&&(U.bind(),U.setVertexAttribPointers(ae,o,k)),K.currentNumAttributes=X}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hr(b){const o=[];for(let h=0;h<b.length;h++){if(b[h]===null)continue;const x=b[h].split(" ");o.push(x.pop())}return o}class $o{constructor(o,h,x,S,k,D){const U=o.gl;this.program=U.createProgram();const N=Hr(x.staticAttributes),X=S?S.getBinderAttributes():[],K=N.concat(X),ae=x.staticUniforms?Hr(x.staticUniforms):[],fe=S?S.getBinderUniforms():[],ze=ae.concat(fe),me=[];for(const it of ze)me.indexOf(it)<0&&me.push(it);const Ce=S?S.defines():[];D&&Ce.push("#define OVERDRAW_INSPECTOR;");const Ne=Ce.concat(Mn.prelude.fragmentSource,x.fragmentSource).join(`
`),Ve=Ce.concat(Mn.prelude.vertexSource,x.vertexSource).join(`
`),We=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);U.shaderSource(We,Ne),U.compileShader(We),U.attachShader(this.program,We);const Ze=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);U.shaderSource(Ze,Ve),U.compileShader(Ze),U.attachShader(this.program,Ze),this.attributes={};const ut={};this.numAttributes=K.length;for(let it=0;it<this.numAttributes;it++)K[it]&&(U.bindAttribLocation(this.program,it,K[it]),this.attributes[K[it]]=it);U.linkProgram(this.program),U.deleteShader(Ze),U.deleteShader(We);for(let it=0;it<me.length;it++){const rt=me[it];if(rt&&!ut[rt]){const ft=U.getUniformLocation(this.program,rt);ft&&(ut[rt]=ft)}}this.fixedUniforms=k(o,ut),this.binderUniforms=S?S.getUniforms(o,ut):[]}draw(o,h,x,S,k,D,U,N,X,K,ae,fe,ze,me,Ce,Ne){const Ve=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(x),o.setStencilMode(S),o.setColorMode(k),o.setCullFace(D);for(const Ze in this.fixedUniforms)this.fixedUniforms[Ze].set(U[Ze]);me&&me.setUniforms(o,this.binderUniforms,fe,{zoom:ze});const We={[Ve.LINES]:2,[Ve.TRIANGLES]:3,[Ve.LINE_STRIP]:1}[h];for(const Ze of ae.get()){const ut=Ze.vaos||(Ze.vaos={});(ut[N]||(ut[N]=new ja)).bind(o,this,X,me?me.getPaintVertexBuffers():[],K,Ze.vertexOffset,Ce,Ne),Ve.drawElements(h,Ze.primitiveLength*We,Ve.UNSIGNED_SHORT,Ze.primitiveOffset*We*2)}}}function no(b,o,h){const x=1/be(h,1,o.transform.tileZoom),S=Math.pow(2,h.tileID.overscaledZ),k=h.tileSize*Math.pow(2,o.transform.tileZoom)/S,D=k*(h.tileID.canonical.x+h.tileID.wrap*S),U=k*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[x,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[D>>16,U>>16],u_pixel_coord_lower:[65535&D,65535&U]}}const Ir=(b,o,h,x)=>{const S=o.style.light,k=S.properties.get("position"),D=[k.x,k.y,k.z],U=function(){var X=new v.ARRAY_TYPE(9);return v.ARRAY_TYPE!=Float32Array&&(X[1]=0,X[2]=0,X[3]=0,X[5]=0,X[6]=0,X[7]=0),X[0]=1,X[4]=1,X[8]=1,X}();S.properties.get("anchor")==="viewport"&&function(X,K){var ae=Math.sin(K),fe=Math.cos(K);X[0]=fe,X[1]=ae,X[2]=0,X[3]=-ae,X[4]=fe,X[5]=0,X[6]=0,X[7]=0,X[8]=1}(U,-o.transform.angle),function(X,K,ae){var fe=K[0],ze=K[1],me=K[2];X[0]=fe*ae[0]+ze*ae[3]+me*ae[6],X[1]=fe*ae[1]+ze*ae[4]+me*ae[7],X[2]=fe*ae[2]+ze*ae[5]+me*ae[8]}(D,D,U);const N=S.properties.get("color");return{u_matrix:b,u_lightpos:D,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+h,u_opacity:x}},Dn=(b,o,h,x,S,k,D)=>v.extend(Ir(b,o,h,x),no(k,o,D),{u_height_factor:-Math.pow(2,S.overscaledZ)/D.tileSize/8}),yn=b=>({u_matrix:b}),Nn=(b,o,h,x)=>v.extend(yn(b),no(h,o,x)),Xo=(b,o)=>({u_matrix:b,u_world:o}),xu=(b,o,h,x,S)=>v.extend(Nn(b,o,h,x),{u_world:S}),Tn=(b,o,h,x)=>{const S=b.transform;let k,D;if(x.paint.get("circle-pitch-alignment")==="map"){const U=be(h,1,S.zoom);k=!0,D=[U,U]}else k=!1,D=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(x.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(o.posMatrix,h,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:D}},Rs=(b,o,h)=>{const x=be(h,1,o.zoom),S=Math.pow(2,o.zoom-h.tileID.overscaledZ),k=h.tileID.overscaleFactor();return{u_matrix:b,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:x,u_extrude_scale:[o.pixelsToGLUnits[0]/(x*S),o.pixelsToGLUnits[1]/(x*S)],u_overscale_factor:k}},oo=(b,o,h=1)=>({u_matrix:b,u_color:o,u_overlay:0,u_overlay_scale:h}),Zr=b=>({u_matrix:b}),Nr=(b,o,h,x)=>({u_matrix:b,u_extrude_scale:be(o,1,h),u_intensity:x});function ia(b,o){const h=Math.pow(2,o.canonical.z),x=o.canonical.y;return[new v.MercatorCoordinate(0,x/h).toLngLat().lat,new v.MercatorCoordinate(0,(x+1)/h).toLngLat().lat]}const Ia=(b,o,h)=>{const x=b.transform;return{u_matrix:xl(b,o,h),u_ratio:1/be(o,1,x.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},vl=(b,o,h,x)=>v.extend(Ia(b,o,h),{u_image:0,u_image_height:x}),Bs=(b,o,h,x)=>{const S=b.transform,k=Fs(o,S);return{u_matrix:xl(b,o,h),u_texsize:o.imageAtlasTexture.size,u_ratio:1/be(o,1,S.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[k,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Kr=(b,o,h,x,S)=>{const k=b.lineAtlas,D=Fs(o,b.transform),U=h.layout.get("line-cap")==="round",N=k.getDash(x.from,U),X=k.getDash(x.to,U),K=N.width*S.fromScale,ae=X.width*S.toScale;return v.extend(Ia(b,o,h),{u_patternscale_a:[D/K,-N.height/2],u_patternscale_b:[D/ae,-X.height/2],u_sdfgamma:k.width/(256*Math.min(K,ae)*b.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:X.y,u_mix:S.t})};function Fs(b,o){return 1/be(b,1,o.tileZoom)}function xl(b,o,h){return b.translatePosMatrix(o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const bu=(b,o,h,x,S)=>{return{u_matrix:b,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(D=S.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(k=S.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:bl(S.paint.get("raster-hue-rotate"))};var k,D};function bl(b){b*=Math.PI/180;const o=Math.sin(b),h=Math.cos(b);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Va=(b,o,h,x,S,k,D,U,N,X)=>{const K=S.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_pitch:K.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:K.width/K.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:D,u_coord_matrix:U,u_is_text:+N,u_pitch_with_map:+x,u_texsize:X,u_texture:0}},hs=(b,o,h,x,S,k,D,U,N,X,K)=>{const ae=S.transform;return v.extend(Va(b,o,h,x,S,k,D,U,N,X),{u_gamma_scale:x?Math.cos(ae._pitch)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:+K})},Os=(b,o,h,x,S,k,D,U,N,X)=>v.extend(hs(b,o,h,x,S,k,D,U,!0,N,!0),{u_texsize_icon:X,u_texture_icon:1}),wu=(b,o,h)=>({u_matrix:b,u_opacity:o,u_color:h}),ps=(b,o,h,x,S,k)=>v.extend(function(D,U,N,X){const K=N.imageManager.getPattern(D.from.toString()),ae=N.imageManager.getPattern(D.to.toString()),{width:fe,height:ze}=N.imageManager.getPixelSize(),me=Math.pow(2,X.tileID.overscaledZ),Ce=X.tileSize*Math.pow(2,N.transform.tileZoom)/me,Ne=Ce*(X.tileID.canonical.x+X.tileID.wrap*me),Ve=Ce*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:K.tl,u_pattern_br_a:K.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[fe,ze],u_mix:U.t,u_pattern_size_a:K.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:U.fromScale,u_scale_b:U.toScale,u_tile_units_to_pixels:1/be(X,1,N.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,Ve>>16],u_pixel_coord_lower:[65535&Ne,65535&Ve]}}(x,k,h,S),{u_matrix:b,u_opacity:o}),Us={fillExtrusion:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_lightpos:new v.Uniform3f(b,o.u_lightpos),u_lightintensity:new v.Uniform1f(b,o.u_lightintensity),u_lightcolor:new v.Uniform3f(b,o.u_lightcolor),u_vertical_gradient:new v.Uniform1f(b,o.u_vertical_gradient),u_opacity:new v.Uniform1f(b,o.u_opacity)}),fillExtrusionPattern:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_lightpos:new v.Uniform3f(b,o.u_lightpos),u_lightintensity:new v.Uniform1f(b,o.u_lightintensity),u_lightcolor:new v.Uniform3f(b,o.u_lightcolor),u_vertical_gradient:new v.Uniform1f(b,o.u_vertical_gradient),u_height_factor:new v.Uniform1f(b,o.u_height_factor),u_image:new v.Uniform1i(b,o.u_image),u_texsize:new v.Uniform2f(b,o.u_texsize),u_pixel_coord_upper:new v.Uniform2f(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(b,o.u_pixel_coord_lower),u_scale:new v.Uniform3f(b,o.u_scale),u_fade:new v.Uniform1f(b,o.u_fade),u_opacity:new v.Uniform1f(b,o.u_opacity)}),fill:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix)}),fillPattern:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_image:new v.Uniform1i(b,o.u_image),u_texsize:new v.Uniform2f(b,o.u_texsize),u_pixel_coord_upper:new v.Uniform2f(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(b,o.u_pixel_coord_lower),u_scale:new v.Uniform3f(b,o.u_scale),u_fade:new v.Uniform1f(b,o.u_fade)}),fillOutline:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_world:new v.Uniform2f(b,o.u_world)}),fillOutlinePattern:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_world:new v.Uniform2f(b,o.u_world),u_image:new v.Uniform1i(b,o.u_image),u_texsize:new v.Uniform2f(b,o.u_texsize),u_pixel_coord_upper:new v.Uniform2f(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(b,o.u_pixel_coord_lower),u_scale:new v.Uniform3f(b,o.u_scale),u_fade:new v.Uniform1f(b,o.u_fade)}),circle:(b,o)=>({u_camera_to_center_distance:new v.Uniform1f(b,o.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(b,o.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(b,o.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(b,o.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(b,o.u_matrix)}),collisionBox:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_camera_to_center_distance:new v.Uniform1f(b,o.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(b,o.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(b,o.u_extrude_scale),u_overscale_factor:new v.Uniform1f(b,o.u_overscale_factor)}),collisionCircle:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_inv_matrix:new v.UniformMatrix4f(b,o.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(b,o.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(b,o.u_viewport_size)}),debug:(b,o)=>({u_color:new v.UniformColor(b,o.u_color),u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_overlay:new v.Uniform1i(b,o.u_overlay),u_overlay_scale:new v.Uniform1f(b,o.u_overlay_scale)}),clippingMask:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix)}),heatmap:(b,o)=>({u_extrude_scale:new v.Uniform1f(b,o.u_extrude_scale),u_intensity:new v.Uniform1f(b,o.u_intensity),u_matrix:new v.UniformMatrix4f(b,o.u_matrix)}),heatmapTexture:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_world:new v.Uniform2f(b,o.u_world),u_image:new v.Uniform1i(b,o.u_image),u_color_ramp:new v.Uniform1i(b,o.u_color_ramp),u_opacity:new v.Uniform1f(b,o.u_opacity)}),hillshade:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_image:new v.Uniform1i(b,o.u_image),u_latrange:new v.Uniform2f(b,o.u_latrange),u_light:new v.Uniform2f(b,o.u_light),u_shadow:new v.UniformColor(b,o.u_shadow),u_highlight:new v.UniformColor(b,o.u_highlight),u_accent:new v.UniformColor(b,o.u_accent)}),hillshadePrepare:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_image:new v.Uniform1i(b,o.u_image),u_dimension:new v.Uniform2f(b,o.u_dimension),u_zoom:new v.Uniform1f(b,o.u_zoom),u_unpack:new v.Uniform4f(b,o.u_unpack)}),line:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_ratio:new v.Uniform1f(b,o.u_ratio),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(b,o.u_units_to_pixels)}),lineGradient:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_ratio:new v.Uniform1f(b,o.u_ratio),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(b,o.u_units_to_pixels),u_image:new v.Uniform1i(b,o.u_image),u_image_height:new v.Uniform1f(b,o.u_image_height)}),linePattern:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_texsize:new v.Uniform2f(b,o.u_texsize),u_ratio:new v.Uniform1f(b,o.u_ratio),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_image:new v.Uniform1i(b,o.u_image),u_units_to_pixels:new v.Uniform2f(b,o.u_units_to_pixels),u_scale:new v.Uniform3f(b,o.u_scale),u_fade:new v.Uniform1f(b,o.u_fade)}),lineSDF:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_ratio:new v.Uniform1f(b,o.u_ratio),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(b,o.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(b,o.u_patternscale_a),u_patternscale_b:new v.Uniform2f(b,o.u_patternscale_b),u_sdfgamma:new v.Uniform1f(b,o.u_sdfgamma),u_image:new v.Uniform1i(b,o.u_image),u_tex_y_a:new v.Uniform1f(b,o.u_tex_y_a),u_tex_y_b:new v.Uniform1f(b,o.u_tex_y_b),u_mix:new v.Uniform1f(b,o.u_mix)}),raster:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_tl_parent:new v.Uniform2f(b,o.u_tl_parent),u_scale_parent:new v.Uniform1f(b,o.u_scale_parent),u_buffer_scale:new v.Uniform1f(b,o.u_buffer_scale),u_fade_t:new v.Uniform1f(b,o.u_fade_t),u_opacity:new v.Uniform1f(b,o.u_opacity),u_image0:new v.Uniform1i(b,o.u_image0),u_image1:new v.Uniform1i(b,o.u_image1),u_brightness_low:new v.Uniform1f(b,o.u_brightness_low),u_brightness_high:new v.Uniform1f(b,o.u_brightness_high),u_saturation_factor:new v.Uniform1f(b,o.u_saturation_factor),u_contrast_factor:new v.Uniform1f(b,o.u_contrast_factor),u_spin_weights:new v.Uniform3f(b,o.u_spin_weights)}),symbolIcon:(b,o)=>({u_is_size_zoom_constant:new v.Uniform1i(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(b,o.u_is_size_feature_constant),u_size_t:new v.Uniform1f(b,o.u_size_t),u_size:new v.Uniform1f(b,o.u_size),u_camera_to_center_distance:new v.Uniform1f(b,o.u_camera_to_center_distance),u_pitch:new v.Uniform1f(b,o.u_pitch),u_rotate_symbol:new v.Uniform1i(b,o.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(b,o.u_aspect_ratio),u_fade_change:new v.Uniform1f(b,o.u_fade_change),u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(b,o.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(b,o.u_coord_matrix),u_is_text:new v.Uniform1i(b,o.u_is_text),u_pitch_with_map:new v.Uniform1i(b,o.u_pitch_with_map),u_texsize:new v.Uniform2f(b,o.u_texsize),u_texture:new v.Uniform1i(b,o.u_texture)}),symbolSDF:(b,o)=>({u_is_size_zoom_constant:new v.Uniform1i(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(b,o.u_is_size_feature_constant),u_size_t:new v.Uniform1f(b,o.u_size_t),u_size:new v.Uniform1f(b,o.u_size),u_camera_to_center_distance:new v.Uniform1f(b,o.u_camera_to_center_distance),u_pitch:new v.Uniform1f(b,o.u_pitch),u_rotate_symbol:new v.Uniform1i(b,o.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(b,o.u_aspect_ratio),u_fade_change:new v.Uniform1f(b,o.u_fade_change),u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(b,o.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(b,o.u_coord_matrix),u_is_text:new v.Uniform1i(b,o.u_is_text),u_pitch_with_map:new v.Uniform1i(b,o.u_pitch_with_map),u_texsize:new v.Uniform2f(b,o.u_texsize),u_texture:new v.Uniform1i(b,o.u_texture),u_gamma_scale:new v.Uniform1f(b,o.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(b,o.u_is_halo)}),symbolTextAndIcon:(b,o)=>({u_is_size_zoom_constant:new v.Uniform1i(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(b,o.u_is_size_feature_constant),u_size_t:new v.Uniform1f(b,o.u_size_t),u_size:new v.Uniform1f(b,o.u_size),u_camera_to_center_distance:new v.Uniform1f(b,o.u_camera_to_center_distance),u_pitch:new v.Uniform1f(b,o.u_pitch),u_rotate_symbol:new v.Uniform1i(b,o.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(b,o.u_aspect_ratio),u_fade_change:new v.Uniform1f(b,o.u_fade_change),u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(b,o.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(b,o.u_coord_matrix),u_is_text:new v.Uniform1i(b,o.u_is_text),u_pitch_with_map:new v.Uniform1i(b,o.u_pitch_with_map),u_texsize:new v.Uniform2f(b,o.u_texsize),u_texsize_icon:new v.Uniform2f(b,o.u_texsize_icon),u_texture:new v.Uniform1i(b,o.u_texture),u_texture_icon:new v.Uniform1i(b,o.u_texture_icon),u_gamma_scale:new v.Uniform1f(b,o.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(b,o.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(b,o.u_is_halo)}),background:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_opacity:new v.Uniform1f(b,o.u_opacity),u_color:new v.UniformColor(b,o.u_color)}),backgroundPattern:(b,o)=>({u_matrix:new v.UniformMatrix4f(b,o.u_matrix),u_opacity:new v.Uniform1f(b,o.u_opacity),u_image:new v.Uniform1i(b,o.u_image),u_pattern_tl_a:new v.Uniform2f(b,o.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(b,o.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(b,o.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(b,o.u_pattern_br_b),u_texsize:new v.Uniform2f(b,o.u_texsize),u_mix:new v.Uniform1f(b,o.u_mix),u_pattern_size_a:new v.Uniform2f(b,o.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(b,o.u_pattern_size_b),u_scale_a:new v.Uniform1f(b,o.u_scale_a),u_scale_b:new v.Uniform1f(b,o.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(b,o.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(b,o.u_tile_units_to_pixels)})};class Ln{constructor(o,h,x){this.context=o;const S=o.gl;this.buffer=S.createBuffer(),this.dynamicDraw=Boolean(x),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class na{constructor(o,h,x,S){this.length=h.length,this.attributes=x,this.itemSize=h.bytesPerElement,this.dynamicDraw=S,this.context=o;const k=o.gl;this.buffer=k.createBuffer(),o.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let x=0;x<this.attributes.length;x++){const S=h.attributes[this.attributes[x].name];S!==void 0&&o.enableVertexAttribArray(S)}}setVertexAttribPointers(o,h,x){for(let S=0;S<this.attributes.length;S++){const k=this.attributes[S],D=h.attributes[k.name];D!==void 0&&o.vertexAttribPointer(D,k.components,o[ra[k.type]],!1,this.itemSize,k.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ea extends Wi{getDefault(){return v.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ko extends Wi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class yo extends Wi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ao extends Wi{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class rr extends Wi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ds extends Wi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class js extends Wi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class wl extends Wi{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Gl extends Wi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Vs extends Wi{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class fs extends Wi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ns extends Wi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class qs extends Wi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Zs extends Wi{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class $l extends Wi{getDefault(){return v.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Tu extends Wi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Wo extends Wi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Gs extends Wi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Su extends Wi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Sn extends Wi{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Xl extends Wi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class ka extends Wi{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Aa extends Wi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class oa extends Wi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class aa extends Wi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class go extends Wi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class za extends Wi{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Ca extends Wi{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ho extends Wi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Pa extends Wi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Er extends Wi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class zo extends Wi{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class sa extends zo{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Wl extends zo{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Tl{constructor(o,h,x,S){this.context=o,this.width=h,this.height=x;const k=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new sa(o,k),S&&(this.depthAttachment=new Wl(o,k))}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const x=this.depthAttachment.get();x&&o.deleteRenderbuffer(x)}o.deleteFramebuffer(this.framebuffer)}}class Ei{constructor(o,h,x){this.blendFunction=o,this.blendColor=h,this.mask=x}}Ei.Replace=[1,0],Ei.disabled=new Ei(Ei.Replace,v.Color.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,771],v.Color.transparent,[!0,!0,!0,!0]);class $s{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ea(this),this.clearDepth=new ko(this),this.clearStencil=new yo(this),this.colorMask=new Ao(this),this.depthMask=new rr(this),this.stencilMask=new ds(this),this.stencilFunc=new js(this),this.stencilOp=new wl(this),this.stencilTest=new Gl(this),this.depthRange=new Vs(this),this.depthTest=new fs(this),this.depthFunc=new Ns(this),this.blend=new qs(this),this.blendFunc=new Zs(this),this.blendColor=new $l(this),this.blendEquation=new Tu(this),this.cullFace=new Wo(this),this.cullFaceSide=new Gs(this),this.frontFace=new Su(this),this.program=new Sn(this),this.activeTexture=new Xl(this),this.viewport=new ka(this),this.bindFramebuffer=new Aa(this),this.bindRenderbuffer=new oa(this),this.bindTexture=new aa(this),this.bindVertexBuffer=new go(this),this.bindElementBuffer=new za(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ca(this),this.pixelStoreUnpack=new Ho(this),this.pixelStoreUnpackPremultiplyAlpha=new Pa(this),this.pixelStoreUnpackFlipY=new Er(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Ln(this,o,h)}createVertexBuffer(o,h,x){return new na(this,o,h,x)}createRenderbuffer(o,h,x){const S=this.gl,k=S.createRenderbuffer();return this.bindRenderbuffer.set(k),S.renderbufferStorage(S.RENDERBUFFER,o,h,x),this.bindRenderbuffer.set(null),k}createFramebuffer(o,h,x){return new Tl(this,o,h,x)}clear({color:o,depth:h}){const x=this.gl;let S=0;o&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),x.clear(S)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){Xe(o.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class dr{constructor(o,h,x){this.func=o,this.mask=h,this.range=x}}dr.ReadOnly=!1,dr.ReadWrite=!0,dr.disabled=new dr(519,dr.ReadOnly,[0,1]);const Fo=7680;class ur{constructor(o,h,x,S,k,D){this.test=o,this.ref=h,this.mask=x,this.fail=S,this.depthFail=k,this.pass=D}}ur.disabled=new ur({func:519,mask:0},0,0,Fo,Fo,Fo);class Cr{constructor(o,h,x){this.enable=o,this.mode=h,this.frontFace=x}}let Xs;function Sl(b,o,h,x,S,k,D){const U=b.context,N=U.gl,X=b.useProgram("collisionBox"),K=[];let ae=0,fe=0;for(let Ze=0;Ze<x.length;Ze++){const ut=x[Ze],it=o.getTile(ut),rt=it.getBucket(h);if(!rt)continue;let ft=ut.posMatrix;S[0]===0&&S[1]===0||(ft=b.translatePosMatrix(ut.posMatrix,it,S,k));const _t=D?rt.textCollisionBox:rt.iconCollisionBox,lt=rt.collisionCircleArray;if(lt.length>0){const Gt=v.create(),Lt=ft;v.mul(Gt,rt.placementInvProjMatrix,b.transform.glCoordMatrix),v.mul(Gt,Gt,rt.placementViewportMatrix),K.push({circleArray:lt,circleOffset:fe,transform:Lt,invTransform:Gt}),ae+=lt.length/4,fe=ae}_t&&X.draw(U,N.LINES,dr.disabled,ur.disabled,b.colorModeForRenderPass(),Cr.disabled,Rs(ft,b.transform,it),h.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,b.transform.zoom,null,null,_t.collisionVertexBuffer)}if(!D||!K.length)return;const ze=b.useProgram("collisionCircle"),me=new v.CollisionCircleLayoutArray;me.resize(4*ae),me._trim();let Ce=0;for(const Ze of K)for(let ut=0;ut<Ze.circleArray.length/4;ut++){const it=4*ut,rt=Ze.circleArray[it+0],ft=Ze.circleArray[it+1],_t=Ze.circleArray[it+2],lt=Ze.circleArray[it+3];me.emplace(Ce++,rt,ft,_t,lt,0),me.emplace(Ce++,rt,ft,_t,lt,1),me.emplace(Ce++,rt,ft,_t,lt,2),me.emplace(Ce++,rt,ft,_t,lt,3)}(!Xs||Xs.length<2*ae)&&(Xs=function(Ze){const ut=2*Ze,it=new v.QuadTriangleArray;it.resize(ut),it._trim();for(let rt=0;rt<ut;rt++){const ft=6*rt;it.uint16[ft+0]=4*rt+0,it.uint16[ft+1]=4*rt+1,it.uint16[ft+2]=4*rt+2,it.uint16[ft+3]=4*rt+2,it.uint16[ft+4]=4*rt+3,it.uint16[ft+5]=4*rt+0}return it}(ae));const Ne=U.createIndexBuffer(Xs,!0),Ve=U.createVertexBuffer(me,v.collisionCircleLayout.members,!0);for(const Ze of K){const ut={u_matrix:Ze.transform,u_inv_matrix:Ze.invTransform,u_camera_to_center_distance:(We=b.transform).cameraToCenterDistance,u_viewport_size:[We.width,We.height]};ze.draw(U,N.TRIANGLES,dr.disabled,ur.disabled,b.colorModeForRenderPass(),Cr.disabled,ut,h.id,Ve,Ne,v.SegmentVector.simpleSegment(0,2*Ze.circleOffset,Ze.circleArray.length,Ze.circleArray.length/2),null,b.transform.zoom,null,null,null)}var We;Ve.destroy(),Ne.destroy()}Cr.disabled=new Cr(!1,1029,2305),Cr.backCCW=new Cr(!0,1029,2305);const Hl=v.identity(new Float32Array(16));function la(b,o,h,x,S,k){const{horizontalAlign:D,verticalAlign:U}=v.getAnchorAlignment(b),N=-(D-.5)*o,X=-(U-.5)*h,K=v.evaluateVariableOffset(b,x);return new v.pointGeometry((N/S+K[0])*k,(X/S+K[1])*k)}function ms(b,o,h,x,S,k,D,U,N,X){const K=b.text.placedSymbolArray,ae=b.text.dynamicLayoutVertexArray,fe=b.icon.dynamicLayoutVertexArray,ze={};ae.clear();for(let me=0;me<K.length;me++){const Ce=K.get(me),Ne=b.allowVerticalPlacement&&!Ce.placedOrientation,Ve=Ce.hidden||!Ce.crossTileID||Ne?null:x[Ce.crossTileID];if(Ve){const We=new v.pointGeometry(Ce.anchorX,Ce.anchorY),Ze=xr(We,h?D:k),ut=St(S.cameraToCenterDistance,Ze.signedDistanceFromCamera);let it=v.evaluateSizeForFeature(b.textSizeData,N,Ce)*ut/v.ONE_EM;h&&(it*=b.tilePixelRatio/U);const{width:rt,height:ft,anchor:_t,textOffset:lt,textBoxScale:Gt}=Ve,Lt=la(_t,rt,ft,lt,Gt,it),yi=h?xr(We.add(Lt),k).point:Ze.point.add(o?Lt.rotate(-S.angle):Lt),l=b.allowVerticalPlacement&&Ce.placedOrientation===v.WritingMode.vertical?Math.PI/2:0;for(let c=0;c<Ce.numGlyphs;c++)v.addDynamicAttributes(ae,yi,l);X&&Ce.associatedIconIndex>=0&&(ze[Ce.associatedIconIndex]={shiftedAnchor:yi,angle:l})}else W(Ce.numGlyphs,ae)}if(X){fe.clear();const me=b.icon.placedSymbolArray;for(let Ce=0;Ce<me.length;Ce++){const Ne=me.get(Ce);if(Ne.hidden)W(Ne.numGlyphs,fe);else{const Ve=ze[Ce];if(Ve)for(let We=0;We<Ne.numGlyphs;We++)v.addDynamicAttributes(fe,Ve.shiftedAnchor,Ve.angle);else W(Ne.numGlyphs,fe)}}b.icon.dynamicLayoutVertexBuffer.updateData(fe)}b.text.dynamicLayoutVertexBuffer.updateData(ae)}function Ko(b,o,h){return h.iconsInText&&o?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function ua(b,o,h,x,S,k,D,U,N,X,K,ae){const fe=b.context,ze=fe.gl,me=b.transform,Ce=U==="map",Ne=N==="map",Ve=U!=="viewport"&&h.layout.get("symbol-placement")!=="point",We=Ce&&!Ne&&!Ve,Ze=!h.layout.get("symbol-sort-key").isConstant();let ut=!1;const it=b.depthModeForSublayer(0,dr.ReadOnly),rt=h.layout.get("text-variable-anchor"),ft=[];for(const _t of x){const lt=o.getTile(_t),Gt=lt.getBucket(h);if(!Gt)continue;const Lt=S?Gt.text:Gt.icon;if(!Lt||!Lt.segments.get().length)continue;const yi=Lt.programConfigurations.get(h.id),l=S||Gt.sdfIcons,c=S?Gt.textSizeData:Gt.iconSizeData,u=Ne||me.pitch!==0,f=b.useProgram(Ko(l,S,Gt),yi),T=v.evaluateSizeForZoom(c,me.zoom);let z,P,B,G,H=[0,0],oe=null;if(S){if(P=lt.glyphAtlasTexture,B=ze.LINEAR,z=lt.glyphAtlasTexture.size,Gt.iconsInText){H=lt.imageAtlasTexture.size,oe=lt.imageAtlasTexture;const et=c.kind==="composite"||c.kind==="camera";G=u||b.options.rotating||b.options.zooming||et?ze.LINEAR:ze.NEAREST}}else{const et=h.layout.get("icon-size").constantOr(0)!==1||Gt.iconsNeedLinear;P=lt.imageAtlasTexture,B=l||b.options.rotating||b.options.zooming||et||u?ze.LINEAR:ze.NEAREST,z=lt.imageAtlasTexture.size}const ue=be(lt,1,b.transform.zoom),se=mn(_t.posMatrix,Ne,Ce,b.transform,ue),Se=fo(_t.posMatrix,Ne,Ce,b.transform,ue),we=rt&&Gt.hasTextData(),Ae=h.layout.get("icon-text-fit")!=="none"&&we&&Gt.hasIconData();if(Ve){const et=h.layout.get("text-rotation-alignment")==="map";Ii(Gt,_t.posMatrix,b,S,se,Se,Ne,X,et)}const ge=b.translatePosMatrix(_t.posMatrix,lt,k,D),Ee=Ve||S&&rt||Ae?Hl:se,Re=b.translatePosMatrix(Se,lt,k,D,!0),je=l&&h.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let He;He=l?Gt.iconsInText?Os(c.kind,T,We,Ne,b,ge,Ee,Re,z,H):hs(c.kind,T,We,Ne,b,ge,Ee,Re,S,z,!0):Va(c.kind,T,We,Ne,b,ge,Ee,Re,S,z);const Ye={program:f,buffers:Lt,uniformValues:He,atlasTexture:P,atlasTextureIcon:oe,atlasInterpolation:B,atlasInterpolationIcon:G,isSDF:l,hasHalo:je};if(Ze&&Gt.canOverlap){ut=!0;const et=Lt.segments.get();for(const st of et)ft.push({segments:new v.SegmentVector([st]),sortKey:st.sortKey,state:Ye})}else ft.push({segments:Lt.segments,sortKey:0,state:Ye})}ut&&ft.sort((_t,lt)=>_t.sortKey-lt.sortKey);for(const _t of ft){const lt=_t.state;if(fe.activeTexture.set(ze.TEXTURE0),lt.atlasTexture.bind(lt.atlasInterpolation,ze.CLAMP_TO_EDGE),lt.atlasTextureIcon&&(fe.activeTexture.set(ze.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,ze.CLAMP_TO_EDGE)),lt.isSDF){const Gt=lt.uniformValues;lt.hasHalo&&(Gt.u_is_halo=1,Na(lt.buffers,_t.segments,h,b,lt.program,it,K,ae,Gt)),Gt.u_is_halo=0}Na(lt.buffers,_t.segments,h,b,lt.program,it,K,ae,lt.uniformValues)}}function Na(b,o,h,x,S,k,D,U,N){const X=x.context;S.draw(X,X.gl.TRIANGLES,k,D,U,Cr.disabled,N,h.id,b.layoutVertexBuffer,b.indexBuffer,o,h.paint,x.transform.zoom,b.programConfigurations.get(h.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Ws(b,o,h,x,S,k,D){const U=b.context.gl,N=h.paint.get("fill-pattern"),X=N&&N.constantOr(1),K=h.getCrossfadeParameters();let ae,fe,ze,me,Ce;D?(fe=X&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=U.LINES):(fe=X?"fillPattern":"fill",ae=U.TRIANGLES);for(const Ne of x){const Ve=o.getTile(Ne);if(X&&!Ve.patternsLoaded())continue;const We=Ve.getBucket(h);if(!We)continue;const Ze=We.programConfigurations.get(h.id),ut=b.useProgram(fe,Ze);X&&(b.context.activeTexture.set(U.TEXTURE0),Ve.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ze.updatePaintBuffers(K));const it=N.constantOr(null);if(it&&Ve.imageAtlas){const ft=Ve.imageAtlas,_t=ft.patternPositions[it.to.toString()],lt=ft.patternPositions[it.from.toString()];_t&&lt&&Ze.setConstantPatternPositions(_t,lt)}const rt=b.translatePosMatrix(Ne.posMatrix,Ve,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(D){me=We.indexBuffer2,Ce=We.segments2;const ft=[U.drawingBufferWidth,U.drawingBufferHeight];ze=fe==="fillOutlinePattern"&&X?xu(rt,b,K,Ve,ft):Xo(rt,ft)}else me=We.indexBuffer,Ce=We.segments,ze=X?Nn(rt,b,K,Ve):yn(rt);ut.draw(b.context,ae,S,b.stencilModeForClipping(Ne),k,Cr.disabled,ze,h.id,We.layoutVertexBuffer,me,Ce,h.paint,b.transform.zoom,Ze)}}function nr(b,o,h,x,S,k,D){const U=b.context,N=U.gl,X=h.paint.get("fill-extrusion-pattern"),K=X.constantOr(1),ae=h.getCrossfadeParameters(),fe=h.paint.get("fill-extrusion-opacity");for(const ze of x){const me=o.getTile(ze),Ce=me.getBucket(h);if(!Ce)continue;const Ne=Ce.programConfigurations.get(h.id),Ve=b.useProgram(K?"fillExtrusionPattern":"fillExtrusion",Ne);K&&(b.context.activeTexture.set(N.TEXTURE0),me.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ne.updatePaintBuffers(ae));const We=X.constantOr(null);if(We&&me.imageAtlas){const rt=me.imageAtlas,ft=rt.patternPositions[We.to.toString()],_t=rt.patternPositions[We.from.toString()];ft&&_t&&Ne.setConstantPatternPositions(ft,_t)}const Ze=b.translatePosMatrix(ze.posMatrix,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ut=h.paint.get("fill-extrusion-vertical-gradient"),it=K?Dn(Ze,b,ut,fe,ze,ae,me):Ir(Ze,b,ut,fe);Ve.draw(U,U.gl.TRIANGLES,S,k,D,Cr.backCCW,it,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,h.paint,b.transform.zoom,Ne)}}function qa(b,o,h,x,S,k){const D=b.context,U=D.gl,N=o.fbo;if(!N)return;const X=b.useProgram("hillshade");D.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,N.colorAttachment.get());const K=((ae,fe,ze)=>{const me=ze.paint.get("hillshade-shadow-color"),Ce=ze.paint.get("hillshade-highlight-color"),Ne=ze.paint.get("hillshade-accent-color");let Ve=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);ze.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=ae.transform.angle);const We=!ae.options.moving;return{u_matrix:ae.transform.calculatePosMatrix(fe.tileID.toUnwrapped(),We),u_image:0,u_latrange:ia(0,fe.tileID),u_light:[ze.paint.get("hillshade-exaggeration"),Ve],u_shadow:me,u_highlight:Ce,u_accent:Ne}})(b,o,h);X.draw(D,U.TRIANGLES,x,S,k,Cr.disabled,K,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function Co(b,o,h,x,S,k){const D=b.context,U=D.gl,N=o.dem;if(N&&N.data){const X=N.dim,K=N.stride,ae=N.getPixels();if(D.activeTexture.set(U.TEXTURE1),D.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||b.getTileTexture(K),o.demTexture){const ze=o.demTexture;ze.update(ae,{premultiply:!1}),ze.bind(U.NEAREST,U.CLAMP_TO_EDGE)}else o.demTexture=new Et(D,ae,U.RGBA,{premultiply:!1}),o.demTexture.bind(U.NEAREST,U.CLAMP_TO_EDGE);D.activeTexture.set(U.TEXTURE0);let fe=o.fbo;if(!fe){const ze=new Et(D,{width:X,height:X,data:null},U.RGBA);ze.bind(U.LINEAR,U.CLAMP_TO_EDGE),fe=o.fbo=D.createFramebuffer(X,X,!0),fe.colorAttachment.set(ze.texture)}D.bindFramebuffer.set(fe.framebuffer),D.viewport.set([0,0,X,X]),b.useProgram("hillshadePrepare").draw(D,U.TRIANGLES,x,S,k,Cr.disabled,((ze,me)=>{const Ce=me.stride,Ne=v.create();return v.ortho(Ne,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Ne,Ne,[0,-v.EXTENT,0]),{u_matrix:Ne,u_image:1,u_dimension:[Ce,Ce],u_zoom:ze.overscaledZ,u_unpack:me.getUnpackVector()}})(o.tileID,N),h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Za(b,o,h,x,S){const k=x.paint.get("raster-fade-duration");if(k>0){const D=v.exported.now(),U=(D-b.timeAdded)/k,N=o?(D-o.timeAdded)/k:-1,X=h.getSource(),K=S.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),ae=!o||Math.abs(o.tileID.overscaledZ-K)>Math.abs(b.tileID.overscaledZ-K),fe=ae&&b.refreshedUponExpiration?1:v.clamp(ae?U:1-N,0,1);return b.refreshedUponExpiration&&U>=1&&(b.refreshedUponExpiration=!1),o?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}const Iu=new v.Color(1,0,0,1),Eu=new v.Color(0,1,0,1),Jo=new v.Color(0,0,1,1),Hs=new v.Color(1,0,1,1),Ma=new v.Color(0,1,1,1);function Ks(b,o,h,x){Da(b,0,o+h/2,b.transform.width,h,x)}function Ga(b,o,h,x){Da(b,o-h/2,0,h,b.transform.height,x)}function Da(b,o,h,x,S,k){const D=b.context,U=D.gl;U.enable(U.SCISSOR_TEST),U.scissor(o*b.pixelRatio,h*b.pixelRatio,x*b.pixelRatio,S*b.pixelRatio),D.clear({color:k}),U.disable(U.SCISSOR_TEST)}function $a(b,o,h){const x=b.context,S=x.gl,k=h.posMatrix,D=b.useProgram("debug"),U=dr.disabled,N=ur.disabled,X=b.colorModeForRenderPass(),K="$debug";x.activeTexture.set(S.TEXTURE0),b.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),D.draw(x,S.LINE_STRIP,U,N,X,Cr.disabled,oo(k,v.Color.red),K,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments);const ae=o.getTileByID(h.key).latestRawTileData,fe=Math.floor((ae&&ae.byteLength||0)/1024),ze=o.getTile(h).tileSize,me=512/Math.min(ze,512)*(h.overscaledZ/b.transform.zoom)*.5;let Ce=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ce+=` => ${h.overscaledZ}`),function(Ne,Ve){Ne.initDebugOverlayCanvas();const We=Ne.debugOverlayCanvas,Ze=Ne.context.gl,ut=Ne.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,We.width,We.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(Ve,5,5),ut.strokeText(Ve,5,5),Ne.debugOverlayTexture.update(We),Ne.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(b,`${Ce} ${fe}kb`),D.draw(x,S.TRIANGLES,U,N,Ei.alphaBlended,Cr.disabled,oo(k,v.Color.transparent,me),K,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments)}const Xa={symbol:function(b,o,h,x,S){if(b.renderPass!=="translucent")return;const k=ur.disabled,D=b.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(U,N,X,K,ae,fe,ze){const me=N.transform,Ce=ae==="map",Ne=fe==="map";for(const Ve of U){const We=K.getTile(Ve),Ze=We.getBucket(X);if(!Ze||!Ze.text||!Ze.text.segments.get().length)continue;const ut=v.evaluateSizeForZoom(Ze.textSizeData,me.zoom),it=be(We,1,N.transform.zoom),rt=mn(Ve.posMatrix,Ne,Ce,N.transform,it),ft=X.layout.get("icon-text-fit")!=="none"&&Ze.hasIconData();if(ut){const _t=Math.pow(2,me.zoom-We.tileID.overscaledZ);ms(Ze,Ce,Ne,ze,me,rt,Ve.posMatrix,_t,ut,ft)}}}(x,b,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),S),h.paint.get("icon-opacity").constantOr(1)!==0&&ua(b,o,h,x,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),k,D),h.paint.get("text-opacity").constantOr(1)!==0&&ua(b,o,h,x,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),k,D),o.map.showCollisionBoxes&&(Sl(b,o,h,x,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Sl(b,o,h,x,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(b,o,h,x){if(b.renderPass!=="translucent")return;const S=h.paint.get("circle-opacity"),k=h.paint.get("circle-stroke-width"),D=h.paint.get("circle-stroke-opacity"),U=!h.layout.get("circle-sort-key").isConstant();if(S.constantOr(1)===0&&(k.constantOr(1)===0||D.constantOr(1)===0))return;const N=b.context,X=N.gl,K=b.depthModeForSublayer(0,dr.ReadOnly),ae=ur.disabled,fe=b.colorModeForRenderPass(),ze=[];for(let me=0;me<x.length;me++){const Ce=x[me],Ne=o.getTile(Ce),Ve=Ne.getBucket(h);if(!Ve)continue;const We=Ve.programConfigurations.get(h.id),Ze={programConfiguration:We,program:b.useProgram("circle",We),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Tn(b,Ce,Ne,h)};if(U){const ut=Ve.segments.get();for(const it of ut)ze.push({segments:new v.SegmentVector([it]),sortKey:it.sortKey,state:Ze})}else ze.push({segments:Ve.segments,sortKey:0,state:Ze})}U&&ze.sort((me,Ce)=>me.sortKey-Ce.sortKey);for(const me of ze){const{programConfiguration:Ce,program:Ne,layoutVertexBuffer:Ve,indexBuffer:We,uniformValues:Ze}=me.state;Ne.draw(N,X.TRIANGLES,K,ae,fe,Cr.disabled,Ze,h.id,Ve,We,me.segments,h.paint,b.transform.zoom,Ce)}},heatmap:function(b,o,h,x){if(h.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const S=b.context,k=S.gl,D=ur.disabled,U=new Ei([k.ONE,k.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(N,X,K){const ae=N.gl;N.activeTexture.set(ae.TEXTURE1),N.viewport.set([0,0,X.width/4,X.height/4]);let fe=K.heatmapFbo;if(fe)ae.bindTexture(ae.TEXTURE_2D,fe.colorAttachment.get()),N.bindFramebuffer.set(fe.framebuffer);else{const ze=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,ze),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),fe=K.heatmapFbo=N.createFramebuffer(X.width/4,X.height/4,!1),function(me,Ce,Ne,Ve){const We=me.gl;We.texImage2D(We.TEXTURE_2D,0,We.RGBA,Ce.width/4,Ce.height/4,0,We.RGBA,me.extRenderToTextureHalfFloat?me.extTextureHalfFloat.HALF_FLOAT_OES:We.UNSIGNED_BYTE,null),Ve.colorAttachment.set(Ne)}(N,X,ze,fe)}})(S,b,h),S.clear({color:v.Color.transparent});for(let N=0;N<x.length;N++){const X=x[N];if(o.hasRenderableParent(X))continue;const K=o.getTile(X),ae=K.getBucket(h);if(!ae)continue;const fe=ae.programConfigurations.get(h.id),ze=b.useProgram("heatmap",fe),{zoom:me}=b.transform;ze.draw(S,k.TRIANGLES,dr.disabled,D,U,Cr.disabled,Nr(X.posMatrix,K,me,h.paint.get("heatmap-intensity")),h.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,h.paint,b.transform.zoom,fe)}S.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(S,k){const D=S.context,U=D.gl,N=k.heatmapFbo;if(!N)return;D.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,N.colorAttachment.get()),D.activeTexture.set(U.TEXTURE1);let X=k.colorRampTexture;X||(X=k.colorRampTexture=new Et(D,k.colorRamp,U.RGBA)),X.bind(U.LINEAR,U.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(D,U.TRIANGLES,dr.disabled,ur.disabled,S.colorModeForRenderPass(),Cr.disabled,((K,ae,fe,ze)=>{const me=v.create();v.ortho(me,0,K.width,K.height,0,0,1);const Ce=K.context.gl;return{u_matrix:me,u_world:[Ce.drawingBufferWidth,Ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ae.paint.get("heatmap-opacity")}})(S,k),k.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,k.paint,S.transform.zoom)}(b,h))},line:function(b,o,h,x){if(b.renderPass!=="translucent")return;const S=h.paint.get("line-opacity"),k=h.paint.get("line-width");if(S.constantOr(1)===0||k.constantOr(1)===0)return;const D=b.depthModeForSublayer(0,dr.ReadOnly),U=b.colorModeForRenderPass(),N=h.paint.get("line-dasharray"),X=h.paint.get("line-pattern"),K=X.constantOr(1),ae=h.paint.get("line-gradient"),fe=h.getCrossfadeParameters(),ze=K?"linePattern":N?"lineSDF":ae?"lineGradient":"line",me=b.context,Ce=me.gl;let Ne=!0;for(const Ve of x){const We=o.getTile(Ve);if(K&&!We.patternsLoaded())continue;const Ze=We.getBucket(h);if(!Ze)continue;const ut=Ze.programConfigurations.get(h.id),it=b.context.program.get(),rt=b.useProgram(ze,ut),ft=Ne||rt.program!==it,_t=X.constantOr(null);if(_t&&We.imageAtlas){const Gt=We.imageAtlas,Lt=Gt.patternPositions[_t.to.toString()],yi=Gt.patternPositions[_t.from.toString()];Lt&&yi&&ut.setConstantPatternPositions(Lt,yi)}const lt=K?Bs(b,We,h,fe):N?Kr(b,We,h,N,fe):ae?vl(b,We,h,Ze.lineClipsArray.length):Ia(b,We,h);if(K)me.activeTexture.set(Ce.TEXTURE0),We.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),ut.updatePaintBuffers(fe);else if(N&&(ft||b.lineAtlas.dirty))me.activeTexture.set(Ce.TEXTURE0),b.lineAtlas.bind(me);else if(ae){const Gt=Ze.gradients[h.id];let Lt=Gt.texture;if(h.gradientVersion!==Gt.version){let yi=256;if(h.stepInterpolant){const l=o.getSource().maxzoom,c=Ve.canonical.z===l?Math.ceil(1<<b.transform.maxZoom-Ve.canonical.z):1;yi=v.clamp(v.nextPowerOfTwo(Ze.maxLineLength/v.EXTENT*1024*c),256,me.maxTextureSize)}Gt.gradient=v.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:yi,image:Gt.gradient||void 0,clips:Ze.lineClipsArray}),Gt.texture?Gt.texture.update(Gt.gradient):Gt.texture=new Et(me,Gt.gradient,Ce.RGBA),Gt.version=h.gradientVersion,Lt=Gt.texture}me.activeTexture.set(Ce.TEXTURE0),Lt.bind(h.stepInterpolant?Ce.NEAREST:Ce.LINEAR,Ce.CLAMP_TO_EDGE)}rt.draw(me,Ce.TRIANGLES,D,b.stencilModeForClipping(Ve),U,Cr.disabled,lt,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,b.transform.zoom,ut,Ze.layoutVertexBuffer2),Ne=!1}},fill:function(b,o,h,x){const S=h.paint.get("fill-color"),k=h.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const D=b.colorModeForRenderPass(),U=h.paint.get("fill-pattern"),N=b.opaquePassEnabledForLayer()&&!U.constantOr(1)&&S.constantOr(v.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===N){const X=b.depthModeForSublayer(1,b.renderPass==="opaque"?dr.ReadWrite:dr.ReadOnly);Ws(b,o,h,x,X,D,!1)}if(b.renderPass==="translucent"&&h.paint.get("fill-antialias")){const X=b.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,dr.ReadOnly);Ws(b,o,h,x,X,D,!0)}},"fill-extrusion":function(b,o,h,x){const S=h.paint.get("fill-extrusion-opacity");if(S!==0&&b.renderPass==="translucent"){const k=new dr(b.context.gl.LEQUAL,dr.ReadWrite,b.depthRangeFor3D);if(S!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))nr(b,o,h,x,k,ur.disabled,Ei.disabled),nr(b,o,h,x,k,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const D=b.colorModeForRenderPass();nr(b,o,h,x,k,ur.disabled,D)}}},hillshade:function(b,o,h,x){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const S=b.context,k=b.depthModeForSublayer(0,dr.ReadOnly),D=b.colorModeForRenderPass(),[U,N]=b.renderPass==="translucent"?b.stencilConfigForOverlap(x):[{},x];for(const X of N){const K=o.getTile(X);K.needsHillshadePrepare&&b.renderPass==="offscreen"?Co(b,K,h,k,ur.disabled,D):b.renderPass==="translucent"&&qa(b,K,h,k,U[X.overscaledZ],D)}S.viewport.set([0,0,b.width,b.height])},raster:function(b,o,h,x){if(b.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!x.length)return;const S=b.context,k=S.gl,D=o.getSource(),U=b.useProgram("raster"),N=b.colorModeForRenderPass(),[X,K]=D instanceof Fi?[{},x]:b.stencilConfigForOverlap(x),ae=K[K.length-1].overscaledZ,fe=!b.options.moving;for(const ze of K){const me=b.depthModeForSublayer(ze.overscaledZ-ae,h.paint.get("raster-opacity")===1?dr.ReadWrite:dr.ReadOnly,k.LESS),Ce=o.getTile(ze),Ne=b.transform.calculatePosMatrix(ze.toUnwrapped(),fe);Ce.registerFadeDuration(h.paint.get("raster-fade-duration"));const Ve=o.findLoadedParent(ze,0),We=Za(Ce,Ve,o,h,b.transform);let Ze,ut;const it=h.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;S.activeTexture.set(k.TEXTURE0),Ce.texture.bind(it,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(k.TEXTURE1),Ve?(Ve.texture.bind(it,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),Ze=Math.pow(2,Ve.tileID.overscaledZ-Ce.tileID.overscaledZ),ut=[Ce.tileID.canonical.x*Ze%1,Ce.tileID.canonical.y*Ze%1]):Ce.texture.bind(it,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const rt=bu(Ne,ut||[0,0],Ze||1,We,h);D instanceof Fi?U.draw(S,k.TRIANGLES,me,ur.disabled,N,Cr.disabled,rt,h.id,D.boundsBuffer,b.quadTriangleIndexBuffer,D.boundsSegments):U.draw(S,k.TRIANGLES,me,X[ze.overscaledZ],N,Cr.disabled,rt,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}},background:function(b,o,h){const x=h.paint.get("background-color"),S=h.paint.get("background-opacity");if(S===0)return;const k=b.context,D=k.gl,U=b.transform,N=U.tileSize,X=h.paint.get("background-pattern");if(b.isPatternMissing(X))return;const K=!X&&x.a===1&&S===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==K)return;const ae=ur.disabled,fe=b.depthModeForSublayer(0,K==="opaque"?dr.ReadWrite:dr.ReadOnly),ze=b.colorModeForRenderPass(),me=b.useProgram(X?"backgroundPattern":"background"),Ce=U.coveringTiles({tileSize:N});X&&(k.activeTexture.set(D.TEXTURE0),b.imageManager.bind(b.context));const Ne=h.getCrossfadeParameters();for(const Ve of Ce){const We=b.transform.calculatePosMatrix(Ve.toUnwrapped()),Ze=X?ps(We,S,b,X,{tileID:Ve,tileSize:N},Ne):wu(We,S,x);me.draw(k,D.TRIANGLES,fe,ae,ze,Cr.disabled,Ze,h.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}},debug:function(b,o,h){for(let x=0;x<h.length;x++)$a(b,o,h[x])},custom:function(b,o,h){const x=b.context,S=h.implementation;if(b.renderPass==="offscreen"){const k=S.prerender;k&&(b.setCustomLayerDefaults(),x.setColorMode(b.colorModeForRenderPass()),k.call(S,x.gl,b.transform.customLayerMatrix()),x.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),x.setColorMode(b.colorModeForRenderPass()),x.setStencilMode(ur.disabled);const k=S.renderingMode==="3d"?new dr(b.context.gl.LEQUAL,dr.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,dr.ReadOnly);x.setDepthMode(k),S.render(x.gl,b.transform.customLayerMatrix()),x.setDirty(),b.setBaseState(),x.bindFramebuffer.set(null)}}};class Wa{constructor(o,h){this.context=new $s(o),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Ht.maxUnderzooming+Ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qt,this.gpuTimers={}}resize(o,h,x){if(this.width=o*x,this.height=h*x,this.pixelRatio=x,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const S of this.style._order)this.style._layers[S].resize()}setup(){const o=this.context,h=new v.PosArray;h.emplaceBack(0,0),h.emplaceBack(v.EXTENT,0),h.emplaceBack(0,v.EXTENT),h.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,rn.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);const x=new v.PosArray;x.emplaceBack(0,0),x.emplaceBack(v.EXTENT,0),x.emplaceBack(0,v.EXTENT),x.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=o.createVertexBuffer(x,rn.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);const S=new v.RasterBoundsArray;S.emplaceBack(0,0,0,0),S.emplaceBack(v.EXTENT,0,v.EXTENT,0),S.emplaceBack(0,v.EXTENT,0,v.EXTENT),S.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(S,si.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);const k=new v.PosArray;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(k,rn.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);const D=new v.LineStripIndexArray;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(D);const U=new v.TriangleIndexArray;U.emplaceBack(0,1,2),U.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(U),this.emptyTexture=new Et(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const N=this.context.gl;this.stencilClearMode=new ur({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const x=v.create();v.ortho(x,0,this.width,this.height,0,0,1),v.scale(x,x,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,dr.disabled,this.stencilClearMode,Ei.disabled,Cr.disabled,Zr(x),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const x=this.context,S=x.gl;this.nextStencilID+h.length>256&&this.clearStencil(),x.setColorMode(Ei.disabled),x.setDepthMode(dr.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of h){const U=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;k.draw(x,S.TRIANGLES,dr.disabled,new ur({func:S.ALWAYS,mask:0},U,255,S.KEEP,S.KEEP,S.REPLACE),Ei.disabled,Cr.disabled,Zr(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new ur({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new ur({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,x=o.sort((D,U)=>U.overscaledZ-D.overscaledZ),S=x[x.length-1].overscaledZ,k=x[0].overscaledZ-S+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const D={};for(let U=0;U<k;U++)D[U+S]=new ur({func:h.GEQUAL,mask:255},U+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=k,[D,x]}return[{[S]:ur.disabled},x]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Ei([o.CONSTANT_COLOR,o.ONE],new v.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ei.unblended:Ei.alphaBlended}depthModeForSublayer(o,h,x){if(!this.opaquePassEnabledForLayer())return dr.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new dr(x||this.context.gl.LEQUAL,h,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(v.exported.now()),this.imageManager.beginFrame();const x=this.style._order,S=this.style.sourceCaches;for(const N in S){const X=S[N];X.used&&X.prepare(this.context)}const k={},D={},U={};for(const N in S){const X=S[N];k[N]=X.getVisibleCoordinates(),D[N]=k[N].slice().reverse(),U[N]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<x.length;N++)if(this.style._layers[x[N]].is3D()){this.opaquePassCutoff=N;break}this.renderPass="offscreen";for(const N of x){const X=this.style._layers[N];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const K=D[X.source];(X.type==="custom"||K.length)&&this.renderLayer(this,S[X.source],X,K)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[x[this.currentLayer]],X=S[N.source],K=k[N.source];this._renderTileClippingMasks(N,K),this.renderLayer(this,X,N,K)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const N=this.style._layers[x[this.currentLayer]],X=S[N.source],K=(N.type==="symbol"?U:D)[N.source];this._renderTileClippingMasks(N,k[N.source]),this.renderLayer(this,X,N,K)}if(this.options.showTileBoundaries){let N,X;Object.values(this.style._layers).forEach(K=>{K.source&&!K.isHidden(this.transform.zoom)&&(K.source!==(X&&X.id)&&(X=this.style.sourceCaches[K.source]),(!N||N.getSource().maxzoom<X.getSource().maxzoom)&&(N=X))}),N&&Xa.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const X=N.transform.padding;Ks(N,N.transform.height-(X.top||0),3,Iu),Ks(N,X.bottom||0,3,Eu),Ga(N,X.left||0,3,Jo),Ga(N,N.transform.width-(X.right||0),3,Hs);const K=N.transform.centerPoint;(function(ae,fe,ze,me){Da(ae,fe-1,ze-10,2,20,me),Da(ae,fe-10,ze-1,20,2,me)})(N,K.x,N.transform.height-K.y,Ma)}(this),this.context.setDefault()}renderLayer(o,h,x,S){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="custom"||S.length)&&(this.id=x.id,this.gpuTimingStart(x),Xa[x.type](o,h,x,S,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let x=this.gpuTimers[o.id];x||(x=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),x.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,x.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const h={};for(const x in o){const S=o[x],k=this.context.extTimerQuery,D=k.getQueryObjectEXT(S.query,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(S.query),h[x]=D}return h}translatePosMatrix(o,h,x,S,k){if(!x[0]&&!x[1])return o;const D=k?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(D){const X=Math.sin(D),K=Math.cos(D);x=[x[0]*K-x[1]*X,x[0]*X+x[1]*K]}const U=[k?x[0]:be(h,x[0],this.transform.zoom),k?x[1]:be(h,x[1],this.transform.zoom),0],N=new Float32Array(16);return v.translate(N,o,U),N}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),x=this.imageManager.getPattern(o.to.toString());return!h||!x}useProgram(o,h){this.cache=this.cache||{};const x=`${o}${h?h.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[x]||(this.cache[x]=new $o(this.context,o,Mn[o],h,Us[o],this._showOverdrawInspector)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Et(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class ao{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,x){const S=Math.pow(2,x),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(U=>v.transformMat4([],U,o)).map(U=>v.scale$1([],U,1/U[3]/h*S)),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(U=>{const N=function(fe,ze){var me=ze[0],Ce=ze[1],Ne=ze[2],Ve=me*me+Ce*Ce+Ne*Ne;return Ve>0&&(Ve=1/Math.sqrt(Ve)),fe[0]=ze[0]*Ve,fe[1]=ze[1]*Ve,fe[2]=ze[2]*Ve,fe}([],function(fe,ze,me){var Ce=ze[0],Ne=ze[1],Ve=ze[2],We=me[0],Ze=me[1],ut=me[2];return fe[0]=Ne*ut-Ve*Ze,fe[1]=Ve*We-Ce*ut,fe[2]=Ce*Ze-Ne*We,fe}([],hr([],k[U[0]],k[U[1]]),hr([],k[U[2]],k[U[1]]))),X=-((K=N)[0]*(ae=k[U[1]])[0]+K[1]*ae[1]+K[2]*ae[2]);var K,ae;return N.concat(X)});return new ao(k,D)}}class Js{constructor(o,h){this.min=o,this.max=h,this.center=function(x,S,k){return x[0]=.5*S[0],x[1]=.5*S[1],x[2]=.5*S[2],x}([],function(x,S,k){return x[0]=S[0]+k[0],x[1]=S[1]+k[1],x[2]=S[2]+k[2],x}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],x=ci(this.min),S=ci(this.max);for(let k=0;k<h.length;k++)x[k]=h[k]?this.min[k]:this.center[k],S[k]=h[k]?this.center[k]:this.max[k];return S[2]=this.max[2],new Js(x,S)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let x=!0;for(let S=0;S<o.planes.length;S++){const k=o.planes[S];let D=0;for(let U=0;U<h.length;U++)v.dot(k,h[U])>=0&&D++;if(D===0)return 0;D!==h.length&&(x=!1)}if(x)return 2;for(let S=0;S<3;S++){let k=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let U=0;U<o.points.length;U++){const N=o.points[U][S]-this.min[S];k=Math.min(k,N),D=Math.max(D,N)}if(D<0||k>this.max[S]-this.min[S])return 0}return 1}}class Ha{constructor(o=0,h=0,x=0,S=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(x)||x<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=x,this.right=S}interpolate(o,h,x){return h.top!=null&&o.top!=null&&(this.top=v.number(o.top,h.top,x)),h.bottom!=null&&o.bottom!=null&&(this.bottom=v.number(o.bottom,h.bottom,x)),h.left!=null&&o.left!=null&&(this.left=v.number(o.left,h.left,x)),h.right!=null&&o.right!=null&&(this.right=v.number(o.right,h.right,x)),this}getCenter(o,h){const x=v.clamp((this.left+o-this.right)/2,0,o),S=v.clamp((this.top+h-this.bottom)/2,0,h);return new v.pointGeometry(x,S)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ha(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Ka{constructor(o,h,x,S,k){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=k===void 0||!!k,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=x==null?0:x,this._maxPitch=S==null?60:S,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ha,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new Ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new v.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-v.wrap(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var x=new v.ARRAY_TYPE(4);return v.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}(),function(x,S,k){var D=S[0],U=S[1],N=S[2],X=S[3],K=Math.sin(k),ae=Math.cos(k);x[0]=D*ae+N*K,x[1]=U*ae+X*K,x[2]=D*-K+N*ae,x[3]=U*-K+X*ae}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=v.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,x){this._unmodified=!1,this._edgeInsets.interpolate(o,h,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new v.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const x=this.pointCoordinate(new v.pointGeometry(0,0)),S=this.pointCoordinate(new v.pointGeometry(this.width,0)),k=this.pointCoordinate(new v.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new v.pointGeometry(0,this.height)),U=Math.floor(Math.min(x.x,S.x,k.x,D.x)),N=Math.floor(Math.max(x.x,S.x,k.x,D.x)),X=1;for(let K=U-X;K<=N+X;K++)K!==0&&h.push(new v.UnwrappedTileID(K,o))}return h}coveringTiles(o){let h=this.coveringZoomLevel(o);const x=h;if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);const S=v.MercatorCoordinate.fromLngLat(this.center),k=Math.pow(2,h),D=[k*S.x,k*S.y,0],U=ao.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let N=o.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(N=h);const X=me=>({aabb:new Js([me*k,0,0],[(me+1)*k,k,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),K=[],ae=[],fe=h,ze=o.reparseOverscaled?x:h;if(this._renderWorldCopies)for(let me=1;me<=3;me++)K.push(X(-me)),K.push(X(me));for(K.push(X(0));K.length>0;){const me=K.pop(),Ce=me.x,Ne=me.y;let Ve=me.fullyVisible;if(!Ve){const rt=me.aabb.intersects(U);if(rt===0)continue;Ve=rt===2}const We=me.aabb.distanceX(D),Ze=me.aabb.distanceY(D),ut=Math.max(Math.abs(We),Math.abs(Ze)),it=3+(1<<fe-me.zoom)-2;if(me.zoom===fe||ut>it&&me.zoom>=N)ae.push({tileID:new v.OverscaledTileID(me.zoom===fe?ze:me.zoom,me.wrap,me.zoom,Ce,Ne),distanceSq:wt([D[0]-.5-Ce,D[1]-.5-Ne])});else for(let rt=0;rt<4;rt++){const ft=(Ce<<1)+rt%2,_t=(Ne<<1)+(rt>>1);K.push({aabb:me.aabb.quadrant(rt),zoom:me.zoom+1,x:ft,y:_t,wrap:me.wrap,fullyVisible:Ve})}}return ae.sort((me,Ce)=>me.distanceSq-Ce.distanceSq).map(me=>me.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=v.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.pointGeometry(v.mercatorXfromLng(o.lng)*this.worldSize,v.mercatorYfromLat(h)*this.worldSize)}unproject(o){return new v.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(o,h){const x=this.pointCoordinate(h),S=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(o),D=new v.MercatorCoordinate(k.x-(x.x-S.x),k.y-(x.y-S.y));this.center=this.coordinateLocation(D),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o){return this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}locationCoordinate(o){return v.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o.toLngLat()}pointCoordinate(o){const h=[o.x,o.y,0,1],x=[o.x,o.y,1,1];v.transformMat4(h,h,this.pixelMatrixInverse),v.transformMat4(x,x,this.pixelMatrixInverse);const S=h[3],k=x[3],D=h[1]/S,U=x[1]/k,N=h[2]/S,X=x[2]/k,K=N===X?0:(0-N)/(X-N);return new v.MercatorCoordinate(v.number(h[0]/S,x[0]/k,K)/this.worldSize,v.number(D,U,K)/this.worldSize)}coordinatePoint(o){const h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return v.transformMat4(h,h,this.pixelMatrix),new v.pointGeometry(h[0]/h[3],h[1]/h[3])}getBounds(){return new v.LngLatBounds().extend(this.pointLocation(new v.pointGeometry(0,0))).extend(this.pointLocation(new v.pointGeometry(this.width,0))).extend(this.pointLocation(new v.pointGeometry(this.width,this.height))).extend(this.pointLocation(new v.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,h=!1){const x=o.key,S=h?this._alignedPosMatrixCache:this._posMatrixCache;if(S[x])return S[x];const k=o.canonical,D=this.worldSize/this.zoomScale(k.z),U=k.x+Math.pow(2,k.z)*o.wrap,N=v.identity(new Float64Array(16));return v.translate(N,N,[U*D,k.y*D,0]),v.scale(N,N,[D/v.EXTENT,D/v.EXTENT,1]),v.multiply(N,h?this.alignedProjMatrix:this.projMatrix,N),S[x]=new Float32Array(N),S[x]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,h,x,S,k=-90,D=90,U=-180,N=180;const X=this.size,K=this._unmodified;if(this.latRange){const ze=this.latRange;k=v.mercatorYfromLat(ze[1])*this.worldSize,D=v.mercatorYfromLat(ze[0])*this.worldSize,o=D-k<X.y?X.y/(D-k):0}if(this.lngRange){const ze=this.lngRange;U=v.mercatorXfromLng(ze[0])*this.worldSize,N=v.mercatorXfromLng(ze[1])*this.worldSize,h=N-U<X.x?X.x/(N-U):0}const ae=this.point,fe=Math.max(h||0,o||0);if(fe)return this.center=this.unproject(new v.pointGeometry(h?(N+U)/2:ae.x,o?(D+k)/2:ae.y)),this.zoom+=this.scaleZoom(fe),this._unmodified=K,void(this._constraining=!1);if(this.latRange){const ze=ae.y,me=X.y/2;ze-me<k&&(S=k+me),ze+me>D&&(S=D-me)}if(this.lngRange){const ze=ae.x,me=X.x/2;ze-me<U&&(x=U+me),ze+me>N&&(x=N-me)}x===void 0&&S===void 0||(this.center=this.unproject(new v.pointGeometry(x!==void 0?x:ae.x,S!==void 0?S:ae.y))),this._unmodified=K,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=Math.PI/2+this._pitch,x=this._fov*(.5+o.y/this.height),S=Math.sin(x)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-h-x,.01,Math.PI-.01)),k=this.point,D=k.x,U=k.y,N=1.01*(Math.cos(Math.PI/2-this._pitch)*S+this.cameraToCenterDistance),X=this.height/50;let K=new Float64Array(16);v.perspective(K,this._fov,this.width/this.height,X,N),K[8]=2*-o.x/this.width,K[9]=2*o.y/this.height,v.scale(K,K,[1,-1,1]),v.translate(K,K,[0,0,-this.cameraToCenterDistance]),v.rotateX(K,K,this._pitch),v.rotateZ(K,K,this.angle),v.translate(K,K,[-D,-U,0]),this.mercatorMatrix=v.scale([],K,[this.worldSize,this.worldSize,this.worldSize]),v.scale(K,K,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=K,this.invProjMatrix=v.invert([],this.projMatrix);const ae=this.width%2/2,fe=this.height%2/2,ze=Math.cos(this.angle),me=Math.sin(this.angle),Ce=D-Math.round(D)+ze*ae+me*fe,Ne=U-Math.round(U)+ze*fe+me*ae,Ve=new Float64Array(K);if(v.translate(Ve,Ve,[Ce>.5?Ce-1:Ce,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=Ve,K=v.create(),v.scale(K,K,[this.width/2,-this.height/2,1]),v.translate(K,K,[1,-1,0]),this.labelPlaneMatrix=K,K=v.create(),v.scale(K,K,[1,-1,1]),v.translate(K,K,[-1,-1,0]),v.scale(K,K,[2/this.width,2/this.height,1]),this.glCoordMatrix=K,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),K=v.invert(new Float64Array(16),this.pixelMatrix),!K)throw new Error("failed to invert matrix");this.pixelMatrixInverse=K,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new v.pointGeometry(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return v.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.pointGeometry(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let x=h.x,S=h.y,k=h.x,D=h.y;for(const U of o)x=Math.min(x,U.x),S=Math.min(S,U.y),k=Math.max(k,U.x),D=Math.max(D,U.y);return[new v.pointGeometry(x,S),new v.pointGeometry(k,S),new v.pointGeometry(k,D),new v.pointGeometry(x,D),new v.pointGeometry(x,S)]}}}class La{constructor(o){this._hashName=o&&encodeURIComponent(o),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,x){let S=!1,k=null;const D=()=>{k=null,S&&(h(),k=setTimeout(D,300),S=!1)};return()=>(S=!0,k||D(),k)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,S=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,S),D=Math.round(h.lng*k)/k,U=Math.round(h.lat*k)/k,N=this._map.getBearing(),X=this._map.getPitch();let K="";if(K+=o?`/${D}/${U}/${x}`:`${x}/${U}/${D}`,(N||X)&&(K+="/"+Math.round(10*N)/10),X&&(K+=`/${Math.round(X)}`),this._hashName){const ae=this._hashName;let fe=!1;const ze=window.location.hash.slice(1).split("&").map(me=>{const Ce=me.split("=")[0];return Ce===ae?(fe=!0,`${Ce}=${K}`):me}).filter(me=>me);return fe||ze.push(`${ae}=${K}`),`#${ze.join("&")}`}return`#${K}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(h=x)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const ca={linearity:.3,easing:v.bezier(0,0,.3,1)},ys=v.extend({deceleration:2500,maxSpeed:1400},ca),ku=v.extend({deceleration:20,maxSpeed:1400},ca),Ys=v.extend({deceleration:1e3,maxSpeed:360},ca),gs=v.extend({deceleration:1e3,maxSpeed:90},ca);class Qs{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=v.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new v.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)h.zoom+=k.zoomDelta||0,h.bearing+=k.bearingDelta||0,h.pitch+=k.pitchDelta||0,k.panDelta&&h.pan._add(k.panDelta),k.around&&(h.around=k.around),k.pinchAround&&(h.pinchAround=k.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(h.pan.mag()){const k=_s(h.pan.mag(),x,v.extend({},ys,o||{}));S.offset=h.pan.mult(k.amount/h.pan.mag()),S.center=this._map.transform.center,Ja(S,k)}if(h.zoom){const k=_s(h.zoom,x,ku);S.zoom=this._map.transform.zoom+k.amount,Ja(S,k)}if(h.bearing){const k=_s(h.bearing,x,Ys);S.bearing=this._map.transform.bearing+v.clamp(k.amount,-179,179),Ja(S,k)}if(h.pitch){const k=_s(h.pitch,x,gs);S.pitch=this._map.transform.pitch+k.amount,Ja(S,k)}if(S.zoom||S.bearing){const k=h.pinchAround===void 0?h.around:h.pinchAround;S.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),v.extend(S,{noMoveStart:!0})}}function Ja(b,o){(!b.duration||b.duration<o.duration)&&(b.duration=o.duration,b.easing=o.easing)}function _s(b,o,h){const{maxSpeed:x,linearity:S,deceleration:k}=h,D=v.clamp(b*S/(o/1e3),-x,x),U=Math.abs(D)/(k*S);return{easing:h.easing,duration:1e3*U,amount:D*(U/2)}}class so extends v.Event{constructor(o,h,x,S={}){const k=xe.mousePos(h.getCanvasContainer(),x),D=h.unproject(k);super(o,v.extend({point:k,lngLat:D,originalEvent:x},S)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Rn extends v.Event{constructor(o,h,x){const S=o==="touchend"?x.changedTouches:x.touches,k=xe.touchPos(h.getCanvasContainer(),S),D=k.map(N=>h.unproject(N)),U=k.reduce((N,X,K,ae)=>N.add(X.div(ae.length)),new v.pointGeometry(0,0));super(o,{points:k,point:U,lngLats:D,lngLat:h.unproject(U),originalEvent:x}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Il extends v.Event{constructor(o,h,x){super(o,{originalEvent:x}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ha{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Il(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new so(o.type,this._map,o))}mouseup(o){this._map.fire(new so(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new so(o.type,this._map,o))}dblclick(o){return this._firePreventable(new so(o.type,this._map,o))}mouseover(o){this._map.fire(new so(o.type,this._map,o))}mouseout(o){this._map.fire(new so(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Rn(o.type,this._map,o))}touchmove(o){this._map.fire(new Rn(o.type,this._map,o))}touchend(o){this._map.fire(new Rn(o.type,this._map,o))}touchcancel(o){this._map.fire(new Rn(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vs{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new so(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new so("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new so(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ya{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(xe.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const x=h;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const S=this._startPos;this._lastPos=x,this._box||(this._box=xe.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const k=Math.min(S.x,x.x),D=Math.max(S.x,x.x),U=Math.min(S.y,x.y),N=Math.max(S.y,x.y);xe.setTransform(this._box,`translate(${k}px,${U}px)`),this._box.style.width=D-k+"px",this._box.style.height=N-U+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const x=this._startPos,S=h;if(this.reset(),xe.suppressClick(),x.x!==S.x||x.y!==S.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:k=>k.fitScreenCoordinates(x,S,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(xe.remove(this._box),this._box=null),xe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new v.Event(o,{originalEvent:h}))}}function pa(b,o){const h={};for(let x=0;x<b.length;x++)h[b[x].identifier]=o[x];return h}class fr{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),x.length===this.numTouches&&(this.centroid=function(S){const k=new v.pointGeometry(0,0);for(const D of S)k._add(D);return k.div(S.length)}(h),this.touches=pa(x,h)))}touchmove(o,h,x){if(this.aborted||!this.centroid)return;const S=pa(x,h);for(const k in this.touches){const D=this.touches[k],U=S[k];(!U||U.dist(D)>30)&&(this.aborted=!0)}}touchend(o,h,x){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class xs{constructor(o){this.singleTap=new fr(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,x){this.singleTap.touchstart(o,h,x)}touchmove(o,h,x){this.singleTap.touchmove(o,h,x)}touchend(o,h,x){const S=this.singleTap.touchend(o,h,x);if(S){const k=o.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(S)<30;if(k&&D||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Qa{constructor(){this._zoomIn=new xs({numTouches:1,numTaps:2}),this._zoomOut=new xs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,x){this._zoomIn.touchstart(o,h,x),this._zoomOut.touchstart(o,h,x)}touchmove(o,h,x){this._zoomIn.touchmove(o,h,x),this._zoomOut.touchmove(o,h,x)}touchend(o,h,x){const S=this._zoomIn.touchend(o,h,x),k=this._zoomOut.touchend(o,h,x);return S?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(S)},{originalEvent:o})}):k?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(k)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const da={0:1,2:2};class Gi{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const x=xe.mouseButton(o);this._correctButton(o,x)&&(this._lastPoint=h,this._eventButton=x)}mousemoveWindow(o,h){const x=this._lastPoint;if(x){if(o.preventDefault(),function(S,k){const D=da[k];return S.buttons===void 0||(S.buttons&D)!==D}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(x,h)}}mouseupWindow(o){this._lastPoint&&xe.mouseButton(o)===this._eventButton&&(this._moved&&xe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ri extends Gi{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class Ut extends Gi{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const x=.8*(h.x-o.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(o){o.preventDefault()}}class Po extends Gi{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){const x=-.5*(h.y-o.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(o){o.preventDefault()}}class bs{constructor(o){this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new v.pointGeometry(0,0)}touchstart(o,h,x){return this._calculateTransform(o,h,x)}touchmove(o,h,x){if(this._active&&!(x.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,h,x)}touchend(o,h,x){this._calculateTransform(o,h,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,x){x.length>0&&(this._active=!0);const S=pa(x,h),k=new v.pointGeometry(0,0),D=new v.pointGeometry(0,0);let U=0;for(const X in S){const K=S[X],ae=this._touches[X];ae&&(k._add(K),D._add(K.sub(ae)),U++,S[X]=K)}if(this._touches=S,U<this._minTouches||!D.mag())return;const N=D.div(U);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(U),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,h,x){return{}}touchstart(o,h,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,x){if(!this._firstTwoTouches)return;o.preventDefault();const[S,k]=this._firstTwoTouches,D=fa(x,h,S),U=fa(x,h,k);if(!D||!U)return;const N=this._aroundCenter?null:D.add(U).div(2);return this._move([D,U],N,o)}touchend(o,h,x){if(!this._firstTwoTouches)return;const[S,k]=this._firstTwoTouches,D=fa(x,h,S),U=fa(x,h,k);D&&U||(this._active&&xe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fa(b,o,h){for(let x=0;x<b.length;x++)if(b[x].identifier===h)return o[x]}function Ft(b,o){return Math.log(b/o)/Math.LN2}class es extends Mo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const x=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Ft(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ft(this._distance,x),pinchAround:h}}}function el(b,o){return 180*b.angleWith(o)/Math.PI}class tl extends Mo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const x=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:el(this._vector,x),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,x=el(o,this._startVector);return Math.abs(x)<h}}function nn(b){return Math.abs(b.y)>Math.abs(b.x)}class lo extends Mo{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,nn(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,x){const S=o[0].sub(this._lastPoints[0]),k=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,k,x.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(S.y+k.y)/2*-.5}}gestureBeginsVertically(o,h,x){if(this._valid!==void 0)return this._valid;const S=o.mag()>=2,k=h.mag()>=2;if(!S&&!k)return;if(!S||!k)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;const D=o.y>0==h.y>0;return nn(o)&&nn(h)&&D}}const Kl={panStep:100,bearingStep:15,pitchStep:10};class gn{constructor(){const o=Kl;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,x=0,S=0,k=0,D=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?x=-1:(o.preventDefault(),k=-1);break;case 39:o.shiftKey?x=1:(o.preventDefault(),k=1);break;case 38:o.shiftKey?S=1:(o.preventDefault(),D=-1);break;case 40:o.shiftKey?S=-1:(o.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(x=0,S=0),{cameraAnimation:U=>{const N=U.getZoom();U.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:h?Math.round(N)+h*(o.shiftKey?2:1):N,bearing:U.getBearing()+x*this._bearingStep,pitch:U.getPitch()+S*this._pitchStep,offset:[-k*this._panStep,-D*this._panStep],center:U.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(b){return b*(2-b)}const Dt=4.000244140625;class ts{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,v.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const x=v.exported.now(),S=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,h!==0&&h%Dt==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(S*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=xe.mousePos(this._el,o);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const U=this._type==="wheel"&&Math.abs(this._delta)>Dt?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&N!==0&&(N=1/N);const X=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(X*N))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,x=this._startZoom,S=this._easing;let k,D=!1;if(this._type==="wheel"&&x&&S){const U=Math.min((v.exported.now()-this._lastWheelEventTime)/200,1),N=S(U);k=v.number(x,h,N),U<1?this._frameId||(this._frameId=!0):D=!0}else k=h,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:k-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=v.ease;if(this._prevEase){const x=this._prevEase,S=(v.exported.now()-x.start)/x.duration,k=x.easing(S+.01)-x.easing(S),D=.27/Math.sqrt(k*k+1e-4)*.01,U=Math.sqrt(.0729-D*D);h=v.bezier(D,U,.25,1)}return this._prevEase={start:v.exported.now(),duration:o,easing:h},h}reset(){this._active=!1}}class Ra{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yo{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(o.shiftKey?-1:1),around:x.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pr{constructor(){this._tap=new xs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,h,x){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=h[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(o,h,x))}touchmove(o,h,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const S=h[0],k=S.y-this._swipePoint.y;return this._swipePoint=S,o.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(o,h,x)}touchend(o,h,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(o,h,x)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Do{constructor(o,h,x){this._el=o,this._mousePan=h,this._touchPan=x}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qn{constructor(o,h,x){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bt{constructor(o,h,x,S){this._el=o,this._touchZoom=h,this._touchRotate=x,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ma=b=>b.zoom||b.drag||b.pitch||b.rotate;class ws extends v.Event{}function Yn(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class Br{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qs(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),v.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(const[S,k,D]of this._listeners)xe.addEventListener(S,k,S===document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[o,h,x]of this._listeners)xe.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(o){const h=this._map,x=h.getCanvasContainer();this._add("mapEvent",new ha(h,o));const S=h.boxZoom=new Ya(h,o);this._add("boxZoom",S);const k=new Qa,D=new Yo;h.doubleClickZoom=new Ra(D,k),this._add("tapZoom",k),this._add("clickZoom",D);const U=new Pr;this._add("tapDragZoom",U);const N=h.touchPitch=new lo;this._add("touchPitch",N);const X=new Ut(o),K=new Po(o);h.dragRotate=new qn(o,X,K),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",K,["mouseRotate"]);const ae=new Ri(o),fe=new bs(o);h.dragPan=new Do(x,ae,fe),this._add("mousePan",ae),this._add("touchPan",fe,["touchZoom","touchRotate"]);const ze=new tl,me=new es;h.touchZoomRotate=new Bt(x,me,ze,U),this._add("touchRotate",ze,["touchPan","touchZoom"]),this._add("touchZoom",me,["touchPan","touchRotate"]);const Ce=h.scrollZoom=new ts(h,this);this._add("scrollZoom",Ce,["mousePan"]);const Ne=h.keyboard=new gn;this._add("keyboard",Ne),this._add("blockableMapEvent",new vs(h));for(const Ve of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Ve]&&h[Ve].enable(o[Ve])}_add(o,h,x){this._handlers.push({handlerName:o,handler:h,allowed:x}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ma(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,h,x){for(const S in o)if(S!==x&&(!h||h.indexOf(S)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const x of o)this._el.contains(x.target)&&h.push(x);return h}handleEvent(o,h){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=o.type==="renderFrame"?void 0:o,S={needsRenderFrame:!1},k={},D={},U=o.touches,N=U?this._getMapTouches(U):void 0,X=N?xe.touchPos(this._el,N):xe.mousePos(this._el,o);for(const{handlerName:fe,handler:ze,allowed:me}of this._handlers){if(!ze.isEnabled())continue;let Ce;this._blockedByActive(D,me,fe)?ze.reset():ze[h||o.type]&&(Ce=ze[h||o.type](o,X,N),this.mergeHandlerResult(S,k,Ce,fe,x),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||ze.isActive())&&(D[fe]=ze)}const K={};for(const fe in this._previousActiveHandlers)D[fe]||(K[fe]=x);this._previousActiveHandlers=D,(Object.keys(K).length||Yn(S))&&(this._changes.push([S,k,K]),this._triggerRenderFrame()),(Object.keys(D).length||Yn(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ae}=S;ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ae(this._map))}mergeHandlerResult(o,h,x,S,k){if(!x)return;v.extend(o,x);const D={handlerName:S,originalEvent:x.originalEvent||k};x.zoomDelta!==void 0&&(h.zoom=D),x.panDelta!==void 0&&(h.drag=D),x.pitchDelta!==void 0&&(h.pitch=D),x.bearingDelta!==void 0&&(h.rotate=D)}_applyChanges(){const o={},h={},x={};for(const[S,k,D]of this._changes)S.panDelta&&(o.panDelta=(o.panDelta||new v.pointGeometry(0,0))._add(S.panDelta)),S.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(o.around=S.around),S.pinchAround!==void 0&&(o.pinchAround=S.pinchAround),S.noInertia&&(o.noInertia=S.noInertia),v.extend(h,k),v.extend(x,D);this._updateMapTransform(o,h,x),this._changes=[]}_updateMapTransform(o,h,x){const S=this._map,k=S.transform;if(!Yn(o))return this._fireEvents(h,x,!0);let{panDelta:D,zoomDelta:U,bearingDelta:N,pitchDelta:X,around:K,pinchAround:ae}=o;ae!==void 0&&(K=ae),S._stop(!0),K=K||S.transform.centerPoint;const fe=k.pointLocation(D?K.sub(D):K);N&&(k.bearing+=N),X&&(k.pitch+=X),U&&(k.zoom+=U),k.setLocationAtPoint(fe,K),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,x,!0)}_fireEvents(o,h,x){const S=ma(this._eventsInProgress),k=ma(o),D={};for(const K in o){const{originalEvent:ae}=o[K];this._eventsInProgress[K]||(D[`${K}start`]=ae),this._eventsInProgress[K]=o[K]}!S&&k&&this._fireEvent("movestart",k.originalEvent);for(const K in D)this._fireEvent(K,D[K]);k&&this._fireEvent("move",k.originalEvent);for(const K in o){const{originalEvent:ae}=o[K];this._fireEvent(K,ae)}const U={};let N;for(const K in this._eventsInProgress){const{handlerName:ae,originalEvent:fe}=this._eventsInProgress[K];this._handlersById[ae].isActive()||(delete this._eventsInProgress[K],N=h[ae]||fe,U[`${K}end`]=N)}for(const K in U)this._fireEvent(K,U[K]);const X=ma(this._eventsInProgress);if(x&&(S||k)&&!X){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=fe=>fe!==0&&-this._bearingSnap<fe&&fe<this._bearingSnap;K?(ae(K.bearing||this._map.getBearing())&&(K.bearing=0),this._map.easeTo(K,{originalEvent:N})):(this._map.fire(new v.Event("moveend",{originalEvent:N})),ae(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new v.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new ws("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const kr={extend:(b,...o)=>v.extend(b,...o),run(b){b()},logToElement(b,o=!1,h="log"){const x=window.document.getElementById(h);x&&(o&&(x.innerHTML=""),x.innerHTML+=`<br>${b}`)}};class il extends v.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}getCenter(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,x){return o=v.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,v.extend({offset:o},h),x)}panTo(o,h,x){return this.easeTo(v.extend({center:o},h),x)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,x){return this.easeTo(v.extend({zoom:o},h),x)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,x){return this.easeTo(v.extend({bearing:o},h),x)}resetNorth(o,h){return this.rotateTo(0,v.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=v.LngLatBounds.convert(o);const x=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),x,h)}_cameraForBoxAndBearing(o,h,x,S){const k={top:0,bottom:0,right:0,left:0};if(typeof(S=v.extend({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){const it=S.padding;S.padding={top:it,bottom:it,right:it,left:it}}S.padding=v.extend(k,S.padding);const D=this.transform,U=D.padding,N=D.project(v.LngLat.convert(o)),X=D.project(v.LngLat.convert(h)),K=N.rotate(-x*Math.PI/180),ae=X.rotate(-x*Math.PI/180),fe=new v.pointGeometry(Math.max(K.x,ae.x),Math.max(K.y,ae.y)),ze=new v.pointGeometry(Math.min(K.x,ae.x),Math.min(K.y,ae.y)),me=fe.sub(ze),Ce=(D.width-(U.left+U.right+S.padding.left+S.padding.right))/me.x,Ne=(D.height-(U.top+U.bottom+S.padding.top+S.padding.bottom))/me.y;if(Ne<0||Ce<0)return void v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ve=Math.min(D.scaleZoom(D.scale*Math.min(Ce,Ne)),S.maxZoom),We=v.pointGeometry.convert(S.offset),Ze=new v.pointGeometry((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(x*Math.PI/180),ut=We.add(Ze).mult(D.scale/D.zoomScale(Ve));return{center:D.unproject(N.add(X).div(2).sub(ut)),zoom:Ve,bearing:x}}fitBounds(o,h,x){return this._fitInternal(this.cameraForBounds(o,h),h,x)}fitScreenCoordinates(o,h,x,S,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.pointGeometry.convert(o)),this.transform.pointLocation(v.pointGeometry.convert(h)),x,S),S,k)}_fitInternal(o,h,x){return o?(delete(h=v.extend(o,h)).padding,h.linear?this.easeTo(h,x):this.flyTo(h,x)):this}jumpTo(o,h){this.stop();const x=this.transform;let S=!1,k=!1,D=!1;return"zoom"in o&&x.zoom!==+o.zoom&&(S=!0,x.zoom=+o.zoom),o.center!==void 0&&(x.center=v.LngLat.convert(o.center)),"bearing"in o&&x.bearing!==+o.bearing&&(k=!0,x.bearing=+o.bearing),"pitch"in o&&x.pitch!==+o.pitch&&(D=!0,x.pitch=+o.pitch),o.padding==null||x.isPaddingEqual(o.padding)||(x.padding=o.padding),this.fire(new v.Event("movestart",h)).fire(new v.Event("move",h)),S&&this.fire(new v.Event("zoomstart",h)).fire(new v.Event("zoom",h)).fire(new v.Event("zoomend",h)),k&&this.fire(new v.Event("rotatestart",h)).fire(new v.Event("rotate",h)).fire(new v.Event("rotateend",h)),D&&this.fire(new v.Event("pitchstart",h)).fire(new v.Event("pitch",h)).fire(new v.Event("pitchend",h)),this.fire(new v.Event("moveend",h))}easeTo(o,h){this._stop(!1,o.easeId),((o=v.extend({offset:[0,0],duration:500,easing:v.ease},o)).animate===!1||!o.essential&&v.exported.prefersReducedMotion)&&(o.duration=0);const x=this.transform,S=this.getZoom(),k=this.getBearing(),D=this.getPitch(),U=this.getPadding(),N="zoom"in o?+o.zoom:S,X="bearing"in o?this._normalizeBearing(o.bearing,k):k,K="pitch"in o?+o.pitch:D,ae="padding"in o?o.padding:x.padding,fe=v.pointGeometry.convert(o.offset);let ze=x.centerPoint.add(fe);const me=x.pointLocation(ze),Ce=v.LngLat.convert(o.center||me);this._normalizeCenter(Ce);const Ne=x.project(me),Ve=x.project(Ce).sub(Ne),We=x.zoomScale(N-S);let Ze,ut;o.around&&(Ze=v.LngLat.convert(o.around),ut=x.locationPoint(Ze));const it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==S,this._rotating=this._rotating||k!==X,this._pitching=this._pitching||K!==D,this._padding=!x.isPaddingEqual(ae),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,it),this._ease(rt=>{if(this._zooming&&(x.zoom=v.number(S,N,rt)),this._rotating&&(x.bearing=v.number(k,X,rt)),this._pitching&&(x.pitch=v.number(D,K,rt)),this._padding&&(x.interpolatePadding(U,ae,rt),ze=x.centerPoint.add(fe)),Ze)x.setLocationAtPoint(Ze,ut);else{const ft=x.zoomScale(x.zoom-S),_t=N>S?Math.min(2,We):Math.max(.5,We),lt=Math.pow(_t,1-rt),Gt=x.unproject(Ne.add(Ve.mult(rt*lt)).mult(ft));x.setLocationAtPoint(x.renderWorldCopies?Gt.wrap():Gt,ze)}this._fireMoveEvents(h)},rt=>{this._afterEase(h,rt)},o),this}_prepareEase(o,h,x={}){this._moving=!0,h||x.moving||this.fire(new v.Event("movestart",o)),this._zooming&&!x.zooming&&this.fire(new v.Event("zoomstart",o)),this._rotating&&!x.rotating&&this.fire(new v.Event("rotatestart",o)),this._pitching&&!x.pitching&&this.fire(new v.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new v.Event("move",o)),this._zooming&&this.fire(new v.Event("zoom",o)),this._rotating&&this.fire(new v.Event("rotate",o)),this._pitching&&this.fire(new v.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const x=this._zooming,S=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new v.Event("zoomend",o)),S&&this.fire(new v.Event("rotateend",o)),k&&this.fire(new v.Event("pitchend",o)),this.fire(new v.Event("moveend",o))}flyTo(o,h){if(!o.essential&&v.exported.prefersReducedMotion){const u=v.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(u,h)}this.stop(),o=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},o);const x=this.transform,S=this.getZoom(),k=this.getBearing(),D=this.getPitch(),U=this.getPadding(),N="zoom"in o?v.clamp(+o.zoom,x.minZoom,x.maxZoom):S,X="bearing"in o?this._normalizeBearing(o.bearing,k):k,K="pitch"in o?+o.pitch:D,ae="padding"in o?o.padding:x.padding,fe=x.zoomScale(N-S),ze=v.pointGeometry.convert(o.offset);let me=x.centerPoint.add(ze);const Ce=x.pointLocation(me),Ne=v.LngLat.convert(o.center||Ce);this._normalizeCenter(Ne);const Ve=x.project(Ce),We=x.project(Ne).sub(Ve);let Ze=o.curve;const ut=Math.max(x.width,x.height),it=ut/fe,rt=We.mag();if("minZoom"in o){const u=v.clamp(Math.min(o.minZoom,S,N),x.minZoom,x.maxZoom),f=ut/x.zoomScale(u-S);Ze=Math.sqrt(f/rt*2)}const ft=Ze*Ze;function _t(u){const f=(it*it-ut*ut+(u?-1:1)*ft*ft*rt*rt)/(2*(u?it:ut)*ft*rt);return Math.log(Math.sqrt(f*f+1)-f)}function lt(u){return(Math.exp(u)-Math.exp(-u))/2}function Gt(u){return(Math.exp(u)+Math.exp(-u))/2}const Lt=_t(0);let yi=function(u){return Gt(Lt)/Gt(Lt+Ze*u)},l=function(u){return ut*((Gt(Lt)*(lt(f=Lt+Ze*u)/Gt(f))-lt(Lt))/ft)/rt;var f},c=(_t(1)-Lt)/Ze;if(Math.abs(rt)<1e-6||!isFinite(c)){if(Math.abs(ut-it)<1e-6)return this.easeTo(o,h);const u=it<ut?-1:1;c=Math.abs(Math.log(it/ut))/Ze,l=function(){return 0},yi=function(f){return Math.exp(u*Ze*f)}}return o.duration="duration"in o?+o.duration:1e3*c/("screenSpeed"in o?+o.screenSpeed/Ze:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=k!==X,this._pitching=K!==D,this._padding=!x.isPaddingEqual(ae),this._prepareEase(h,!1),this._ease(u=>{const f=u*c,T=1/yi(f);x.zoom=u===1?N:S+x.scaleZoom(T),this._rotating&&(x.bearing=v.number(k,X,u)),this._pitching&&(x.pitch=v.number(D,K,u)),this._padding&&(x.interpolatePadding(U,ae,u),me=x.centerPoint.add(ze));const z=u===1?Ne:x.unproject(Ve.add(We.mult(l(f))).mult(T));x.setLocationAtPoint(x.renderWorldCopies?z.wrap():z,me),this._fireMoveEvents(h)},()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,h)}if(!o){const x=this.handlers;x&&x.stop(!1)}return this}_ease(o,h,x){x.animate===!1||x.duration===0?(o(1),h()):(this._easeStart=v.exported.now(),this._easeOptions=x,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((v.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=v.wrap(o,-180,180);const x=Math.abs(o-h);return Math.abs(o-360-h)<x&&(o-=360),Math.abs(o+360-h)<x&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const x=o.lng-h.center.lng;o.lng+=x>180?-360:x<-180?360:0}}class Ts{constructor(o={}){this.options=o,v.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=xe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xe.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){xe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const x=this._map._getUIString(`AttributionControl.${h}`);o.title=x,o.setAttribute("aria-label",x)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(S=>typeof S!="string"?"":S)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const h=this._map.style.sourceCaches;for(const S in h){const k=h[S];if(k.used){const D=k.getSource();D.attribution&&o.indexOf(D.attribution)<0&&o.push(D.attribution)}}o=o.filter(S=>String(S).trim()),o.sort((S,k)=>S.length-k.length),o=o.filter((S,k)=>{for(let D=k+1;D<o.length;D++)if(o[D].indexOf(S)>=0)return!1;return!0});const x=o.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,o.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Bn{constructor(o={}){this.options=o,v.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=xe.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=xe.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){xe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class ya{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,x=h?this._queue.concat(h):this._queue;for(const S of x)if(S.id===o)return void(S.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const x of h)if(!x.cancelled&&(x.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const rl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Jl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Lo={showCompass:!0,showZoom:!0,visualizePitch:!1};class co{constructor(o,h,x=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Ut({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,x&&(this.mousePitch=new Po({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),xe.addEventListener(h,"mousedown",this.mousedown),xe.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),xe.addEventListener(h,"touchmove",this.touchmove),xe.addEventListener(h,"touchend",this.touchend),xe.addEventListener(h,"touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),xe.disableDrag()}move(o,h){const x=this.map,S=this.mouseRotate.mousemoveWindow(o,h);if(S&&S.bearingDelta&&x.setBearing(x.getBearing()+S.bearingDelta),this.mousePitch){const k=this.mousePitch.mousemoveWindow(o,h);k&&k.pitchDelta&&x.setPitch(x.getPitch()+k.pitchDelta)}}off(){const o=this.element;xe.removeEventListener(o,"mousedown",this.mousedown),xe.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),xe.removeEventListener(o,"touchmove",this.touchmove),xe.removeEventListener(o,"touchend",this.touchend),xe.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){xe.enableDrag(),xe.removeEventListener(window,"mousemove",this.mousemove),xe.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(v.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),xe.mousePos(this.element,o)),xe.addEventListener(window,"mousemove",this.mousemove),xe.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,xe.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=xe.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=xe.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Qt(b,o,h){if(b=new v.LngLat(b.lng,b.lat),o){const x=new v.LngLat(b.lng-360,b.lat),S=new v.LngLat(b.lng+360,b.lat),k=h.locationPoint(b).distSqr(o);h.locationPoint(x).distSqr(o)<k?b=x:h.locationPoint(S).distSqr(o)<k&&(b=S)}for(;Math.abs(b.lng-h.center.lng)>180;){const x=h.locationPoint(b);if(x.x>=0&&x.y>=0&&x.x<=h.width&&x.y<=h.height)break;b.lng>h.center.lng?b.lng-=360:b.lng+=360}return b}const Ot={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $i(b,o,h){const x=b.classList;for(const S in Ot)x.remove(`maplibregl-${h}-anchor-${S}`,`mapboxgl-${h}-anchor-${S}`);x.add(`maplibregl-${h}-anchor-${o}`,`mapboxgl-${h}-anchor-${o}`)}class Zn extends v.Evented{constructor(o,h){if(super(),(o instanceof HTMLElement||h)&&(o=v.extend({element:o},h)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=v.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=xe.create("div"),this._element.setAttribute("aria-label","Map marker");const x=xe.createNS("http://www.w3.org/2000/svg","svg"),S=41,k=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${S}px`),x.setAttributeNS(null,"width",`${k}px`),x.setAttributeNS(null,"viewBox",`0 0 ${k} ${S}`);const D=xe.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");const U=xe.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill-rule","nonzero");const N=xe.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");const X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const We of X){const Ze=xe.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",We.rx),Ze.setAttributeNS(null,"ry",We.ry),N.appendChild(Ze)}const K=xe.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"fill",this._color);const ae=xe.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),K.appendChild(ae);const fe=xe.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"fill","#000000");const ze=xe.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),fe.appendChild(ze);const me=xe.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");const Ce=xe.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ne=xe.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#000000"),Ne.setAttributeNS(null,"opacity","0.25"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962");const Ve=xe.createNS("http://www.w3.org/2000/svg","circle");Ve.setAttributeNS(null,"fill","#FFFFFF"),Ve.setAttributeNS(null,"cx","5.5"),Ve.setAttributeNS(null,"cy","5.5"),Ve.setAttributeNS(null,"r","5.4999962"),Ce.appendChild(Ne),Ce.appendChild(Ve),U.appendChild(N),U.appendChild(K),U.appendChild(fe),U.appendChild(me),U.appendChild(Ce),x.appendChild(U),x.setAttributeNS(null,"height",S*this._scale+"px"),x.setAttributeNS(null,"width",k*this._scale+"px"),this._element.appendChild(x),this._offset=v.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),$i(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),xe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=v.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const h=o.code,x=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Qt(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),xe.setTransform(this._element,`${Ot[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${h}`)}getOffset(){return this._offset}setOffset(o){return this._offset=v.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Gn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mr,_o=0,Gr=!1;const Ba={maxWidth:100,unit:"metric"};function Fn(b,o,h){const x=h&&h.maxWidth||100,S=b._container.clientHeight/2,k=b.unproject([0,S]),D=b.unproject([x,S]),U=k.distanceTo(D);if(h&&h.unit==="imperial"){const N=3.2808*U;N>5280?cr(o,x,N/5280,b._getUIString("ScaleControl.Miles")):cr(o,x,N,b._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?cr(o,x,U/1852,b._getUIString("ScaleControl.NauticalMiles")):U>=1e3?cr(o,x,U/1e3,b._getUIString("ScaleControl.Kilometers")):cr(o,x,U,b._getUIString("ScaleControl.Meters"))}function cr(b,o,h,x){const S=function(k){const D=Math.pow(10,`${Math.floor(k)}`.length-1);let U=k/D;return U=U>=10?10:U>=5?5:U>=3?3:U>=2?2:U>=1?1:function(N){const X=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*X)/X}(U),D*U}(h);b.style.width=o*(S/h)+"px",b.innerHTML=`${S}&nbsp;${x}`}const gt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ui=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _n(b){if(b){if(typeof b=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new v.pointGeometry(0,0),top:new v.pointGeometry(0,b),"top-left":new v.pointGeometry(o,o),"top-right":new v.pointGeometry(-o,o),bottom:new v.pointGeometry(0,-b),"bottom-left":new v.pointGeometry(o,-o),"bottom-right":new v.pointGeometry(-o,-o),left:new v.pointGeometry(b,0),right:new v.pointGeometry(-b,0)}}if(b instanceof v.pointGeometry||Array.isArray(b)){const o=v.pointGeometry.convert(b);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:v.pointGeometry.convert(b.center||[0,0]),top:v.pointGeometry.convert(b.top||[0,0]),"top-left":v.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":v.pointGeometry.convert(b["top-right"]||[0,0]),bottom:v.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":v.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":v.pointGeometry.convert(b["bottom-right"]||[0,0]),left:v.pointGeometry.convert(b.left||[0,0]),right:v.pointGeometry.convert(b.right||[0,0])}}return _n(new v.pointGeometry(0,0))}const $n={supported:ce,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:class extends il{constructor(b){var o;if(v.PerformanceUtils.mark(v.PerformanceMarkers.create),(b=v.extend({},Jl,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ka(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),{bearingSnap:b.bearingSnap}),this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new ya,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},rl,b.locale),this._clickTolerance=b.clickTolerance,this._pixelRatio=(o=b.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new dt(b.transformRequest),typeof b.container=="string"){if(this._container=document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Br(this,b),this._hash=b.hash&&new La(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,v.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new Ts({customAttribution:b.customAttribution})),b.maplibreLogo&&this.addControl(new Bn,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new v.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new v.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new v.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(b,o){if(o===void 0&&(o=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=b.onAdd(this);this._controls.push(b);const x=this._controlPositions[o];return o.indexOf("bottom")!==-1?x.insertBefore(h,x.firstChild):x.appendChild(h),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(b);return o>-1&&this._controls.splice(o,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}resize(b){const o=this._containerDimensions(),h=o[0],x=o[1];this._resizeCanvas(h,x,this.getPixelRatio()),this.transform.resize(h,x),this.painter.resize(h,x,this.getPixelRatio());const S=!this._moving;return S&&(this.stop(),this.fire(new v.Event("movestart",b)).fire(new v.Event("move",b))),this.fire(new v.Event("resize",b)),S&&this.fire(new v.Event("moveend",b)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(b){const[o,h]=this._containerDimensions();this._pixelRatio=b,this._resizeCanvas(o,h,b),this.painter.resize(o,h,b)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(v.LngLatBounds.convert(b)),this._update()}setMinZoom(b){if((b=b==null?-2:b)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b==null?22:b)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b==null?0:b)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b==null?60:b)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(v.LngLat.convert(b))}unproject(b){return this.transform.pointLocation(v.pointGeometry.convert(b))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(b,o,h){if(b==="mouseenter"||b==="mouseover"){let x=!1;return{layer:o,listener:h,delegates:{mousemove:k=>{const D=this.getLayer(o)?this.queryRenderedFeatures(k.point,{layers:[o]}):[];D.length?x||(x=!0,h.call(this,new so(b,this,k.originalEvent,{features:D}))):x=!1},mouseout:()=>{x=!1}}}}if(b==="mouseleave"||b==="mouseout"){let x=!1;return{layer:o,listener:h,delegates:{mousemove:D=>{(this.getLayer(o)?this.queryRenderedFeatures(D.point,{layers:[o]}):[]).length?x=!0:x&&(x=!1,h.call(this,new so(b,this,D.originalEvent)))},mouseout:D=>{x&&(x=!1,h.call(this,new so(b,this,D.originalEvent)))}}}}{const x=S=>{const k=this.getLayer(o)?this.queryRenderedFeatures(S.point,{layers:[o]}):[];k.length&&(S.features=k,h.call(this,S),delete S.features)};return{layer:o,listener:h,delegates:{[b]:x}}}}on(b,o,h){if(h===void 0)return super.on(b,o);const x=this._createDelegatedListener(b,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(x);for(const S in x.delegates)this.on(S,x.delegates[S]);return this}once(b,o,h){if(h===void 0)return super.once(b,o);const x=this._createDelegatedListener(b,o,h);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(b,o,h){return h===void 0?super.off(b,o):(this._delegatedListeners&&this._delegatedListeners[b]&&(x=>{const S=this._delegatedListeners[b];for(let k=0;k<S.length;k++){const D=S[k];if(D.layer===o&&D.listener===h){for(const U in D.delegates)this.off(U,D.delegates[U]);return S.splice(k,1),this}}})(),this)}queryRenderedFeatures(b,o){if(!this.style)return[];let h;if(o!==void 0||b===void 0||b instanceof v.pointGeometry||Array.isArray(b)||(o=b,b=void 0),o=o||{},(b=b||[[0,0],[this.transform.width,this.transform.height]])instanceof v.pointGeometry||typeof b[0]=="number")h=[v.pointGeometry.convert(b)];else{const x=v.pointGeometry.convert(b[0]),S=v.pointGeometry.convert(b[1]);h=[x,new v.pointGeometry(S.x,x.y),S,new v.pointGeometry(x.x,S.y),x]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(b,o){return this.style.querySourceFeatures(b,o)}setStyle(b,o){return(o=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(b,o))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const o=this._locale[b];if(o==null)throw new Error(`Missing UI string '${b}'`);return o}_updateStyle(b,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),b?(this.style=new ln(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b):this.style.loadJSON(b),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,o){if(typeof b=="string"){const h=this._requestManager.transformRequest(b,v.ResourceType.Style);v.getJSON(h,(x,S)=>{x?this.fire(new v.ErrorEvent(x)):S&&this._updateDiff(S,o)})}else typeof b=="object"&&this._updateDiff(b,o)}_updateDiff(b,o){try{this.style.setState(b)&&this._update(!0)}catch(h){v.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(b,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")}addSource(b,o){return this._lazyInitEmptyStyle(),this.style.addSource(b,o),this._update(!0)}isSourceLoaded(b){const o=this.style&&this.style.sourceCaches[b];if(o!==void 0)return o.loaded();this.fire(new v.ErrorEvent(new Error(`There is no source with ID '${b}'`)))}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const o in b){const h=b[o]._tiles;for(const x in h){const S=h[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(b,o,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(b,o,h)}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,o,{pixelRatio:h=1,sdf:x=!1,stretchX:S,stretchY:k,content:D}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||v.isImageBitmap(o)){const{width:U,height:N,data:X}=v.exported.getImageData(o);this.style.addImage(b,{data:new v.RGBAImage({width:U,height:N},X),pixelRatio:h,stretchX:S,stretchY:k,content:D,sdf:x,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:N,data:X}=o,K=o;this.style.addImage(b,{data:new v.RGBAImage({width:U,height:N},new Uint8Array(X)),pixelRatio:h,stretchX:S,stretchY:k,content:D,sdf:x,version:0,userImage:K}),K.onAdd&&K.onAdd(this,b)}}}updateImage(b,o){const h=this.style.getImage(b);if(!h)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=o instanceof HTMLImageElement||v.isImageBitmap(o)?v.exported.getImageData(o):o,{width:S,height:k,data:D}=x;if(S===void 0||k===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==h.data.width||k!==h.data.height)return this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const U=!(o instanceof HTMLImageElement||v.isImageBitmap(o));h.data.replace(D,U),this.style.updateImage(b,h)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b,o){v.getImage(this._requestManager.transformRequest(b,v.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(b,o){return this._lazyInitEmptyStyle(),this.style.addLayer(b,o),this._update(!0)}moveLayer(b,o){return this.style.moveLayer(b,o),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}setLayerZoomRange(b,o,h){return this.style.setLayerZoomRange(b,o,h),this._update(!0)}setFilter(b,o,h={}){return this.style.setFilter(b,o,h),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,o,h,x={}){return this.style.setPaintProperty(b,o,h,x),this._update(!0)}getPaintProperty(b,o){return this.style.getPaintProperty(b,o)}setLayoutProperty(b,o,h,x={}){return this.style.setLayoutProperty(b,o,h,x),this._update(!0)}getLayoutProperty(b,o){return this.style.getLayoutProperty(b,o)}setLight(b,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(b,o){return this.style.setFeatureState(b,o),this._update()}removeFeatureState(b,o){return this.style.removeFeatureState(b,o),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,o=0;return this._container&&(b=this._container.clientWidth||400,o=this._container.clientHeight||300),[b,o]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=xe.create("div","maplibregl-canvas-container mapboxgl-canvas-container",b);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=xe.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const x=this._controlContainer=xe.create("div","maplibregl-control-container mapboxgl-control-container",b),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(k=>{S[k]=xe.create("div",`maplibregl-ctrl-${k} mapboxgl-ctrl-${k}`,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,o,h){this._canvas.width=h*b,this._canvas.height=h*o,this._canvas.style.width=`${b}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const b=v.extend({},ce.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",b)||this._canvas.getContext("experimental-webgl",b);o?(this.painter=new Wa(o,this.transform),v.exported$1.testSupport(o)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:b}))}_onMapScroll(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){let o,h=0;const x=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=x.createQueryEXT(),x.beginQueryEXT(x.TIME_ELAPSED_EXT,o),h=v.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,U=v.exported.now();this.style.zoomHistory.update(D,U);const N=new v.EvaluationParameters(D,{now:U,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=N.crossFadingFactor();X===1&&X===this._crossFadingFactor||(S=!0,this._crossFadingFactor=X),this.style.update(N)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,v.PerformanceUtils.mark(v.PerformanceMarkers.load),this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const D=v.exported.now()-h;x.endQueryEXT(x.TIME_ELAPSED_EXT,o),setTimeout(()=>{const U=x.getQueryObjectEXT(o,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(o),this.fire(new v.Event("gpu-timing-frame",{cpuTime:D,gpuTime:U}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(D);this.fire(new v.Event("gpu-timing-layer",{layerTimes:U}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty;return k||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,v.PerformanceUtils.mark(v.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),xe.remove(this._canvasContainer),xe.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),v.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new v.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=v.exported.frame(b=>{v.PerformanceUtils.frame(b),this._frame=null,this._render(b)}))}_onWindowOnline(){this._update()}_onWindowResize(b){this._trackResize&&this.resize({originalEvent:b})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}_setCacheLimits(b,o){v.setCacheLimits(b,o)}},NavigationControl:class{constructor(b){this.options=v.extend({},Lo,b),this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const b=this._map.getZoom(),o=b===this._map.getMaxZoom(),h=b===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const b=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=b}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new co(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){xe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,o){const h=xe.create("button",b,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(b,o){const h=this._map._getUIString(`NavigationControl.${o}`);b.title=h,b.setAttribute("aria-label",h)}},GeolocateControl:class extends v.Evented{constructor(b){super(),this.options=v.extend({},Gn,b),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(b){var o;return this._map=b,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,mr!==void 0?o(mr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{mr=h.state!=="denied",o(mr)}):(mr=!!window.navigator.geolocation,o(mr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),xe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_o=0,Gr=!1}_isOutOfMapMaxBounds(b){const o=this._map.getMaxBounds(),h=b.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(b),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(b),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",b)),this._finish()}}_updateCamera(b){const o=new v.LngLat(b.coords.longitude,b.coords.latitude),h=b.coords.accuracy,x=this._map.getBearing(),S=v.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),S,{geolocateSource:!0})}_updateMarker(b){if(b){const o=new v.LngLat(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const b=this._map._container.clientHeight/2,o=this._map.unproject([0,b]),h=this._map.unproject([1,b]),x=o.distanceTo(h),S=Math.ceil(2*this._accuracy/x);this._circleElement.style.width=`${S}px`,this._circleElement.style.height=`${S}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(b){if(this._map){if(this.options.trackUserLocation)if(b.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(b.code===3&&Gr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(b){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=xe.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",b===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Zn(this._dotElement),this._circleElement=xe.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new v.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_o--,Gr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_o++,_o>1?(b={maximumAge:6e5,timeout:0},Gr=!0):(b=this.options.positionOptions,Gr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ts,LogoControl:Bn,ScaleControl:class{constructor(b){this.options=v.extend({},Ba,b),v.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Fn(this._map,this._container,this.options)}onAdd(b){return this._map=b,this._container=xe.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){xe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(b){this.options.unit=b,Fn(this._map,this._container,this.options)}},FullscreenControl:class{constructor(b){this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){xe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const b=this._fullscreenButton=xe.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);xe.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends v.Evented{constructor(b){super(),this.options=v.extend(Object.create(gt),b),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&xe.remove(this._content),this._container&&(xe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=v.LngLat.convert(b),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const o=document.createDocumentFragment(),h=document.createElement("body");let x;for(h.innerHTML=b;x=h.firstChild,x;)o.appendChild(x);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=xe.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){this._container&&this._container.classList.add(b)}removeClassName(b){this._container&&this._container.classList.remove(b)}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}_createCloseButton(){this.options.closeButton&&(this._closeButton=xe.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(b){this._update(b.point)}_onMouseMove(b){this._update(b.point)}_onDrag(b){this._update(b.point)}_update(b){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=xe.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=xe.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(k=>this._container.classList.add(k)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qt(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!b))return;const o=this._pos=this._trackPointer&&b?b:this._map.project(this._lngLat);let h=this.options.anchor;const x=_n(this.options.offset);if(!h){const k=this._container.offsetWidth,D=this._container.offsetHeight;let U;U=o.y+x.bottom.y<D?["top"]:o.y>this._map.transform.height-D?["bottom"]:[],o.x<k/2?U.push("left"):o.x>this._map.transform.width-k/2&&U.push("right"),h=U.length===0?"bottom":U.join("-")}const S=o.add(x[h]).round();xe.setTransform(this._container,`${Ot[h]} translate(${S.x}px,${S.y}px)`),$i(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(ui);b&&b.focus()}_onClose(){this.remove()}},Marker:Zn,Style:ln,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.pointGeometry,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,AJAXError:v.AJAXError,config:v.config,CanvasSource:Qi,GeoJSONSource:ti,ImageSource:Fi,RasterDEMTileSource:kt,RasterTileSource:An,VectorTileSource:Qr,VideoSource:Oi,prewarm:function(){en().acquire(Wr)},clearPrewarmedResources:function(){const b=po;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(Wr),po=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return Eo.workerCount},set workerCount(b){Eo.workerCount=b},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(b){v.config.MAX_PARALLEL_IMAGE_REQUESTS=b},clearStorage(b){v.clearTileCache(b)},workerUrl:"",addProtocol(b,o){v.config.REGISTERED_PROTOCOLS[b]=o},removeProtocol(b){delete v.config.REGISTERED_PROTOCOLS[b]}};return kr.extend($n,{isSafari:v.isSafari,getPerformanceMetrics:v.PerformanceUtils.getPerformanceMetrics}),$n});var y=q;return y})})(qu);const e_=()=>{const C=Og("__svelte__");return{page:{subscribe:C.page.subscribe},navigating:{subscribe:C.navigating.subscribe},get preloading(){return console.error("stores.preloading is deprecated; use stores.navigating instead"),{subscribe:C.navigating.subscribe}},session:C.session,updated:C.updated}},t_={subscribe(C){return e_().page.subscribe(C)}},lf=Jg(null);var My={},Vf={},Dy={exports:{}};(function(C,w){(function(A,R){C.exports=R()})(rh,function(){var A,R,q;function Y(y,v){if(!A)A=v;else if(!R)R=v;else{var ce="var sharedChunk = {}; ("+A+")(sharedChunk); ("+R+")(sharedChunk);",Te={};A(Te),q=v(Te),typeof window<"u"&&(q.workerUrl=window.URL.createObjectURL(new Blob([ce],{type:"text/javascript"})))}}return Y(["exports"],function(y){function v(t,n){return t(n={exports:{}},n.exports),n.exports}var ce=Te;function Te(t,n,a,d){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=d,this.p2x=a,this.p2y=d}Te.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Te.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Te.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Te.prototype.solveCurveX=function(t,n){var a,d,_,i,e;for(n===void 0&&(n=1e-6),_=t,e=0;e<8;e++){if(i=this.sampleCurveX(_)-t,Math.abs(i)<n)return _;var r=this.sampleCurveDerivativeX(_);if(Math.abs(r)<1e-6)break;_-=i/r}if((_=t)<(a=0))return a;if(_>(d=1))return d;for(;a<d;){if(i=this.sampleCurveX(_),Math.abs(i-t)<n)return _;t>i?a=_:d=_,_=.5*(d-a)+a}return _},Te.prototype.solve=function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))};var Oe=Xe;function Xe(t,n){this.x=t,this.y=n}Xe.prototype={clone:function(){return new Xe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,a=t.y-this.y;return n*n+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),a=Math.sin(t),d=a*this.x+n*this.y;return this.x=n*this.x-a*this.y,this.y=d,this},_rotateAround:function(t,n){var a=Math.cos(t),d=Math.sin(t),_=n.y+d*(this.x-n.x)+a*(this.y-n.y);return this.x=n.x+a*(this.x-n.x)-d*(this.y-n.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Xe.convert=function(t){return t instanceof Xe?t:Array.isArray(t)?new Xe(t[0],t[1]):t};var xe=typeof self<"u"?self:{},dt=Math.pow(2,53)-1;function zt(t,n,a,d){var _=new ce(t,n,a,d);return function(i){return _.solve(i)}}var ci=zt(.25,.1,.25,1);function Ct(t,n,a){return Math.min(a,Math.max(n,t))}function hr(t,n,a){var d=a-n,_=((t-n)%d+d)%d+n;return _===n?a:_}function wt(t){for(var n=[],a=arguments.length-1;a-- >0;)n[a]=arguments[a+1];for(var d=0,_=n;d<_.length;d+=1){var i=_[d];for(var e in i)t[e]=i[e]}return t}var Et=1;function oi(){return Et++}function Jt(){return function t(n){return n?(n^16*Math.random()>>n/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Kt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function pi(t,n){t.forEach(function(a){n[a]&&(n[a]=n[a].bind(n))})}function or(t,n){return t.indexOf(n,t.length-n.length)!==-1}function zi(t,n,a){var d={};for(var _ in t)d[_]=n.call(a||this,t[_],_,t);return d}function sn(t,n,a){var d={};for(var _ in t)n.call(a||this,t[_],_,t)&&(d[_]=t[_]);return d}function Xr(t){return Array.isArray(t)?t.map(Xr):typeof t=="object"&&t?zi(t,Xr):t}var fn={};function lr(t){fn[t]||(typeof console<"u"&&console.warn(t),fn[t]=!0)}function Li(t,n,a){return(a.y-t.y)*(n.x-t.x)>(n.y-t.y)*(a.x-t.x)}function Yr(t){for(var n=0,a=0,d=t.length,_=d-1,i=void 0,e=void 0;a<d;_=a++)n+=((e=t[_]).x-(i=t[a]).x)*(i.y+e.y);return n}function Wt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Qr(t){var n={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,_,i,e){var r=i||e;return n[_]=!r||r.toLowerCase(),""}),n["max-age"]){var a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}var An=null;function Jn(t){if(An==null){var n=t.navigator?t.navigator.userAgent:null;An=!!t.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return An}function kt(t){try{var n=xe[t];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}var ti,si,Fi,Oi,Qi=xe.performance&&xe.performance.now?xe.performance.now.bind(xe.performance):Date.now.bind(Date),Ui=xe.requestAnimationFrame||xe.mozRequestAnimationFrame||xe.webkitRequestAnimationFrame||xe.msRequestAnimationFrame,ji=xe.cancelAnimationFrame||xe.mozCancelAnimationFrame||xe.webkitCancelAnimationFrame||xe.msCancelAnimationFrame,ir={now:Qi,frame:function(t){var n=Ui(t);return{cancel:function(){return ji(n)}}},getImageData:function(t,n){n===void 0&&(n=0);var a=xe.document.createElement("canvas"),d=a.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return a.width=t.width,a.height=t.height,d.drawImage(t,0,0,t.width,t.height),d.getImageData(-n,-n,t.width+2*n,t.height+2*n)},resolveURL:function(t){return ti||(ti=xe.document.createElement("a")),ti.href=t,ti.href},hardwareConcurrency:xe.navigator&&xe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return xe.devicePixelRatio},get prefersReducedMotion(){return!!xe.matchMedia&&(si==null&&(si=xe.matchMedia("(prefers-reduced-motion: reduce)")),si.matches)}},gi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},vr={supported:!1,testSupport:function(t){!Ar&&Oi&&(zr?Ht(t):Fi=t)}},Ar=!1,zr=!1;function Ht(t){var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Oi),t.isContextLost())return;vr.supported=!0}catch{}t.deleteTexture(n),Ar=!0}xe.document&&((Oi=xe.document.createElement("img")).onload=function(){Fi&&Ht(Fi),Fi=null,zr=!0},Oi.onerror=function(){Ar=!0,Fi=null},Oi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var jr="01",Sr=function(t,n){this._transformRequestFn=t,this._customAccessToken=n,this._createSkuToken()};function Wr(t){return t.indexOf("mapbox:")===0}Sr.prototype._createSkuToken=function(){var t=function(){for(var n="",a=0;a<10;a++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",jr,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Sr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Sr.prototype.transformRequest=function(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}},Sr.prototype.normalizeStyleURL=function(t,n){if(!Wr(t))return t;var a=en(t);return a.path="/styles/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||n)},Sr.prototype.normalizeGlyphsURL=function(t,n){if(!Wr(t))return t;var a=en(t);return a.path="/fonts/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||n)},Sr.prototype.normalizeSourceURL=function(t,n){if(!Wr(t))return t;var a=en(t);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||n)},Sr.prototype.normalizeSpriteURL=function(t,n,a,d){var _=en(t);return Wr(t)?(_.path="/styles/v1"+_.path+"/sprite"+n+a,this._makeAPIURL(_,this._customAccessToken||d)):(_.path+=""+n+a,jn(_))},Sr.prototype.normalizeTileURL=function(t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Wr(t))return t;var a=en(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ir.devicePixelRatio>=2||n===512?"@2x":"")+(vr.supported?".webp":"$1")),a.path=a.path.replace(/^.+\/v4\//,"/"),a.path="/v4"+a.path;var d=this._customAccessToken||function(_){for(var i=0,e=_;i<e.length;i+=1){var r=e[i].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(a.params)||gi.ACCESS_TOKEN;return gi.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&a.params.push("sku="+this._skuToken),this._makeAPIURL(a,d)},Sr.prototype.canonicalizeTileURL=function(t,n){var a=en(t);if(!a.path.match(/(^\/v4\/)/)||!a.path.match(/\.[\w]+$/))return t;var d="mapbox://tiles/";d+=a.path.replace("/v4/","");var _=a.params;return n&&(_=_.filter(function(i){return!i.match(/^access_token=/)})),_.length&&(d+="?"+_.join("&")),d},Sr.prototype.canonicalizeTileset=function(t,n){for(var a=!!n&&Wr(n),d=[],_=0,i=t.tiles||[];_<i.length;_+=1){var e=i[_];to(e)?d.push(this.canonicalizeTileURL(e,a)):d.push(e)}return d},Sr.prototype._makeAPIURL=function(t,n){var a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=en(gi.API_URL);if(t.protocol=d.protocol,t.authority=d.authority,t.protocol==="http"){var _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(d.path!=="/"&&(t.path=""+d.path+t.path),!gi.REQUIRE_ACCESS_TOKEN)return jn(t);if(!(n=n||gi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+a);if(n[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+a);return t.params=t.params.filter(function(i){return i.indexOf("access_token")===-1}),t.params.push("access_token="+n),jn(t)},Sr.prototype.setTransformRequest=function(t){this._transformRequestFn=t};var Eo=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function to(t){return Eo.test(t)}var po=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function en(t){var n=t.match(po);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function jn(t){var n=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+n}function Go(t){if(!t)return null;var n=t.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(xe.atob(n[1]).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Si=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Si.prototype.getStorageKey=function(t){var n,a=Go(gi.ACCESS_TOKEN);return n=a&&a.u?xe.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,function(d,_){return String.fromCharCode(Number("0x"+_))})):gi.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+n:"mapbox.eventData:"+n},Si.prototype.fetchEventData=function(){var t=kt("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{var d=xe.localStorage.getItem(n);d&&(this.eventData=JSON.parse(d));var _=xe.localStorage.getItem(a);_&&(this.anonId=_)}catch{lr("Unable to read from LocalStorage")}},Si.prototype.saveEventData=function(){var t=kt("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{xe.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&xe.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{lr("Unable to write to LocalStorage")}},Si.prototype.processRequests=function(t){},Si.prototype.postEvent=function(t,n,a,d){var _=this;if(gi.EVENTS_URL){var i=en(gi.EVENTS_URL);i.params.push("access_token="+(d||gi.ACCESS_TOKEN||""));var e={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.15.3",skuId:jr,userId:this.anonId},r=n?wt(e,n):e,s={url:jn(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([r])};this.pendingRequest=W(s,function(p){_.pendingRequest=null,a(p),_.saveEventData(),_.processRequests(d)})}},Si.prototype.queueRequest=function(t,n){this.queue.push(t),this.processRequests(n)};var wn,io,zn=function(t){function n(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.postMapLoadEvent=function(a,d,_,i){this.skuToken=_,(gi.EVENTS_URL&&i||gi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(e){return Wr(e)||to(e)}))&&this.queueRequest({id:d,timestamp:Date.now()},i)},n.prototype.processRequests=function(a){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),i=_.id,e=_.timestamp;i&&this.success[i]||(this.anonId||this.fetchEventData(),Kt(this.anonId)||(this.anonId=Jt()),this.postEvent(e,{skuToken:this.skuToken},function(r){r||i&&(d.success[i]=!0)},a))}},n}(Si),Sa=new(function(t){function n(a){t.call(this,"appUserTurnstile"),this._customAccessToken=a}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.postTurnstileEvent=function(a,d){gi.EVENTS_URL&&gi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(_){return Wr(_)||to(_)})&&this.queueRequest(Date.now(),d)},n.prototype.processRequests=function(a){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Go(gi.ACCESS_TOKEN),i=_?_.u:gi.ACCESS_TOKEN,e=i!==this.eventData.tokenU;Kt(this.anonId)||(this.anonId=Jt(),e=!0);var r=this.queue.shift();if(this.eventData.lastSuccess){var s=new Date(this.eventData.lastSuccess),p=new Date(r),m=(r-this.eventData.lastSuccess)/864e5;e=e||m>=1||m<-1||s.getDate()!==p.getDate()}else e=!0;if(!e)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},function(g){g||(d.eventData.lastSuccess=r,d.eventData.tokenU=i)},a)}},n}(Si)),ot=Sa.postTurnstileEvent.bind(Sa),Mt=new zn,Bo=Mt.postMapLoadEvent.bind(Mt),ro=500,pr=50;function Cn(){xe.caches&&!wn&&(wn=xe.caches.open("mapbox-tiles"))}function mn(t){var n=t.indexOf("?");return n<0?t:t.slice(0,n)}var fo,xr=1/0;function St(){return fo==null&&(fo=xe.OffscreenCanvas&&new xe.OffscreenCanvas(1,1).getContext("2d")&&typeof xe.createImageBitmap=="function"),fo}var Mi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mi);var Ii=function(t){function n(a,d,_){d===401&&to(_)&&(a+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,a),this.status=d,this.url=_,this.name=this.constructor.name,this.message=a}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},n}(Error),tn=Wt()?function(){return self.worker&&self.worker.referrer}:function(){return(xe.location.protocol==="blob:"?xe.parent:xe).location.href};function Pn(t,n){var a,d=new xe.AbortController,_=new xe.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:tn(),signal:d.signal}),i=!1,e=!1,r=(a=_.url).indexOf("sku=")>0&&to(a);t.type==="json"&&_.headers.set("Accept","application/json");var s=function(m,g,I){if(!e){if(m&&m.message!=="SecurityError"&&lr(m),g&&I)return p(g);var E=Date.now();xe.fetch(_).then(function(M){if(M.ok){var L=r?M.clone():null;return p(M,L,E)}return n(new Ii(M.statusText,M.status,t.url))}).catch(function(M){M.code!==20&&n(new Error(M.message))})}},p=function(m,g,I){(t.type==="arrayBuffer"?m.arrayBuffer():t.type==="json"?m.json():m.text()).then(function(E){e||(g&&I&&function(M,L,F){if(Cn(),wn){var O={status:L.status,statusText:L.statusText,headers:new xe.Headers};L.headers.forEach(function($,te){return O.headers.set(te,$)});var Z=Qr(L.headers.get("Cache-Control")||"");Z["no-store"]||(Z["max-age"]&&O.headers.set("Expires",new Date(F+1e3*Z["max-age"]).toUTCString()),new Date(O.headers.get("Expires")).getTime()-F<42e4||function($,te){if(io===void 0)try{new Response(new ReadableStream),io=!0}catch{io=!1}io?te($.body):$.blob().then(te)}(L,function($){var te=new xe.Response($,O);Cn(),wn&&wn.then(function(ie){return ie.put(mn(M.url),te)}).catch(function(ie){return lr(ie.message)})}))}}(_,g,I),i=!0,n(null,E,m.headers.get("Cache-Control"),m.headers.get("Expires")))}).catch(function(E){e||n(new Error(E.message))})};return r?function(m,g){if(Cn(),!wn)return g(null);var I=mn(m.url);wn.then(function(E){E.match(I).then(function(M){var L=function(F){if(!F)return!1;var O=new Date(F.headers.get("Expires")||0),Z=Qr(F.headers.get("Cache-Control")||"");return O>Date.now()&&!Z["no-cache"]}(M);E.delete(I),L&&E.put(I,M.clone()),g(null,M,L)}).catch(g)}).catch(g)}(_,s):s(null,null),{cancel:function(){e=!0,i||d.abort()}}}var _i,mo,Vn=function(t,n){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(Wt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,n);if(!Wt()){var a=t.url.substring(0,t.url.indexOf("://"));return(gi.REGISTERED_PROTOCOLS[a]||Pn)(t,n)}}if(!(/^file:/.test(d=t.url)||/^file:/.test(tn())&&!/^\w+:/.test(d))){if(xe.fetch&&xe.Request&&xe.AbortController&&xe.Request.prototype.hasOwnProperty("signal"))return Pn(t,n);if(Wt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,n,void 0,!0)}var d;return function(_,i){var e=new xe.XMLHttpRequest;for(var r in e.open(_.method||"GET",_.url,!0),_.type==="arrayBuffer"&&(e.responseType="arraybuffer"),_.headers)e.setRequestHeader(r,_.headers[r]);return _.type==="json"&&(e.responseType="text",e.setRequestHeader("Accept","application/json")),e.withCredentials=_.credentials==="include",e.onerror=function(){i(new Error(e.statusText))},e.onload=function(){if((e.status>=200&&e.status<300||e.status===0)&&e.response!==null){var s=e.response;if(_.type==="json")try{s=JSON.parse(e.response)}catch(p){return i(p)}i(null,s,e.getResponseHeader("Cache-Control"),e.getResponseHeader("Expires"))}else i(new Ii(e.statusText,e.status,_.url))},e.send(_.body),{cancel:function(){return e.abort()}}}(t,n)},ar=function(t,n){return Vn(wt(t,{type:"arrayBuffer"}),n)},W=function(t,n){return Vn(wt(t,{method:"POST"}),n)},Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";_i=[],mo=0;var re=function(t,n){if(vr.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),mo>=gi.MAX_PARALLEL_IMAGE_REQUESTS){var a={requestParameters:t,callback:n,cancelled:!1,cancel:function(){this.cancelled=!0}};return _i.push(a),a}mo++;var d=!1,_=function(){if(!d)for(d=!0,mo--;_i.length&&mo<gi.MAX_PARALLEL_IMAGE_REQUESTS;){var e=_i.shift();e.cancelled||(e.cancel=re(e.requestParameters,e.callback).cancel)}},i=ar(t,function(e,r,s,p){_(),e?n(e):r&&(St()?function(m,g){var I=new xe.Blob([new Uint8Array(m)],{type:"image/png"});xe.createImageBitmap(I).then(function(E){g(null,E)}).catch(function(E){g(new Error("Could not load image because of "+E.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(r,n):function(m,g,I,E){var M=new xe.Image,L=xe.URL;M.onload=function(){g(null,M),L.revokeObjectURL(M.src),M.onload=null,xe.requestAnimationFrame(function(){M.src=Q})},M.onerror=function(){return g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var F=new xe.Blob([new Uint8Array(m)],{type:"image/png"});M.cacheControl=I,M.expires=E,M.src=m.byteLength?L.createObjectURL(F):Q}(r,n,s,p))});return{cancel:function(){i.cancel(),_()}}};function he(t,n,a){a[t]&&a[t].indexOf(n)!==-1||(a[t]=a[t]||[],a[t].push(n))}function be(t,n,a){if(a&&a[t]){var d=a[t].indexOf(n);d!==-1&&a[t].splice(d,1)}}var De=function(t,n){n===void 0&&(n={}),wt(this,n),this.type=t},Fe=function(t){function n(a,d){d===void 0&&(d={}),t.call(this,"error",wt({error:a},d))}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n}(De),Le=function(){};Le.prototype.on=function(t,n){return this._listeners=this._listeners||{},he(t,n,this._listeners),this},Le.prototype.off=function(t,n){return be(t,n,this._listeners),be(t,n,this._oneTimeListeners),this},Le.prototype.once=function(t,n){return this._oneTimeListeners=this._oneTimeListeners||{},he(t,n,this._oneTimeListeners),this},Le.prototype.fire=function(t,n){typeof t=="string"&&(t=new De(t,n||{}));var a=t.type;if(this.listens(a)){t.target=this;for(var d=0,_=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];d<_.length;d+=1)_[d].call(this,t);for(var i=0,e=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];i<e.length;i+=1){var r=e[i];be(a,r,this._oneTimeListeners),r.call(this,t)}var s=this._eventedParent;s&&(wt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),s.fire(t))}else t instanceof Fe&&console.error(t.error);return this},Le.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Le.prototype.setEventedParent=function(t,n){return this._eventedParent=t,this._eventedParentData=n,this};var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(t,n,a,d){this.message=(t?t+": ":"")+a,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)};function ee(t){var n=t.value;return n?[new ke(t.key,n,"constants have been deprecated as of v8")]:[]}function V(t){for(var n=[],a=arguments.length-1;a-- >0;)n[a]=arguments[a+1];for(var d=0,_=n;d<_.length;d+=1){var i=_[d];for(var e in i)t[e]=i[e]}return t}function j(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function J(t){if(Array.isArray(t))return t.map(J);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var n={};for(var a in t)n[a]=J(t[a]);return n}return j(t)}var ne=function(t){function n(a,d){t.call(this,d),this.message=d,this.key=a}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n}(Error),pe=function(t,n){n===void 0&&(n=[]),this.parent=t,this.bindings={};for(var a=0,d=n;a<d.length;a+=1){var _=d[a];this.bindings[_[0]]=_[1]}};pe.prototype.concat=function(t){return new pe(this,t)},pe.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},pe.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ie={kind:"null"},le={kind:"number"},_e={kind:"string"},de={kind:"boolean"},$e={kind:"color"},Ke={kind:"object"},Be={kind:"value"},xt={kind:"collator"},ht={kind:"formatted"},bt={kind:"resolvedImage"};function Rt(t,n){return{kind:"array",itemType:t,N:n}}function Zt(t){if(t.kind==="array"){var n=Zt(t.itemType);return typeof t.N=="number"?"array<"+n+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+n+">"}return t.kind}var Yt=[Ie,le,_e,de,$e,ht,Ke,Rt(Be),bt];function ii(t,n){if(n.kind==="error")return null;if(t.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!ii(t.itemType,n.itemType))&&(typeof t.N!="number"||t.N===n.N))return null}else{if(t.kind===n.kind)return null;if(t.kind==="value"){for(var a=0,d=Yt;a<d.length;a+=1)if(!ii(d[a],n))return null}}return"Expected "+Zt(t)+" but found "+Zt(n)+" instead."}function qt(t,n){return n.some(function(a){return a.kind===t.kind})}function It(t,n){return n.some(function(a){return a==="null"?t===null:a==="array"?Array.isArray(t):a==="object"?t&&!Array.isArray(t)&&typeof t=="object":a===typeof t})}var Rr=v(function(t,n){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(r){return(r=Math.round(r))<0?0:r>255?255:r}function _(r){return d(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function i(r){return(s=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:s>1?1:s;var s}function e(r,s,p){return p<0?p+=1:p>1&&(p-=1),6*p<1?r+(s-r)*p*6:2*p<1?s:3*p<2?r+(s-r)*(2/3-p)*6:r}try{n.parseCSSColor=function(r){var s,p=r.replace(/ /g,"").toLowerCase();if(p in a)return a[p].slice();if(p[0]==="#")return p.length===4?(s=parseInt(p.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:p.length===7&&(s=parseInt(p.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var m=p.indexOf("("),g=p.indexOf(")");if(m!==-1&&g+1===p.length){var I=p.substr(0,m),E=p.substr(m+1,g-(m+1)).split(","),M=1;switch(I){case"rgba":if(E.length!==4)return null;M=i(E.pop());case"rgb":return E.length!==3?null:[_(E[0]),_(E[1]),_(E[2]),M];case"hsla":if(E.length!==4)return null;M=i(E.pop());case"hsl":if(E.length!==3)return null;var L=(parseFloat(E[0])%360+360)%360/360,F=i(E[1]),O=i(E[2]),Z=O<=.5?O*(F+1):O+F-O*F,$=2*O-Z;return[d(255*e($,Z,L+1/3)),d(255*e($,Z,L)),d(255*e($,Z,L-1/3)),M];default:return null}}return null}}catch{}}).parseCSSColor,ri=function(t,n,a,d){d===void 0&&(d=1),this.r=t,this.g=n,this.b=a,this.a=d};ri.parse=function(t){if(t){if(t instanceof ri)return t;if(typeof t=="string"){var n=Rr(t);if(n)return new ri(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3])}}},ri.prototype.toString=function(){var t=this.toArray(),n=t[1],a=t[2],d=t[3];return"rgba("+Math.round(t[0])+","+Math.round(n)+","+Math.round(a)+","+d+")"},ri.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ri.black=new ri(0,0,0,1),ri.white=new ri(1,1,1,1),ri.transparent=new ri(0,0,0,0),ri.red=new ri(1,0,0,1);var Vr=function(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Vr.prototype.compare=function(t,n){return this.collator.compare(t,n)},Vr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ln=function(t,n,a,d,_){this.text=t,this.image=n,this.scale=a,this.fontStack=d,this.textColor=_},rn=function(t){this.sections=t};rn.fromString=function(t){return new rn([new ln(t,null,null,null,null)])},rn.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},rn.factory=function(t){return t instanceof rn?t:rn.fromString(t)},rn.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},rn.prototype.serialize=function(){for(var t=["format"],n=0,a=this.sections;n<a.length;n+=1){var d=a[n];if(d.image)t.push(["image",d.image.name]);else{t.push(d.text);var _={};d.fontStack&&(_["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(_["font-scale"]=d.scale),d.textColor&&(_["text-color"]=["rgba"].concat(d.textColor.toArray())),t.push(_)}}return t};var Mn=function(t){this.name=t.name,this.available=t.available};function br(t,n,a,d){return typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[t,n,a,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[t,n,a,d]:[t,n,a]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ja(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ri||t instanceof Vr||t instanceof rn||t instanceof Mn)return!0;if(Array.isArray(t)){for(var n=0,a=t;n<a.length;n+=1)if(!ja(a[n]))return!1;return!0}if(typeof t=="object"){for(var d in t)if(!ja(t[d]))return!1;return!0}return!1}function Hr(t){if(t===null)return Ie;if(typeof t=="string")return _e;if(typeof t=="boolean")return de;if(typeof t=="number")return le;if(t instanceof ri)return $e;if(t instanceof Vr)return xt;if(t instanceof rn)return ht;if(t instanceof Mn)return bt;if(Array.isArray(t)){for(var n,a=t.length,d=0,_=t;d<_.length;d+=1){var i=Hr(_[d]);if(n){if(n===i)continue;n=Be;break}n=i}return Rt(n||Be,a)}return Ke}function $o(t){var n=typeof t;return t===null?"":n==="string"||n==="number"||n==="boolean"?String(t):t instanceof ri||t instanceof rn||t instanceof Mn?t.toString():JSON.stringify(t)}Mn.prototype.toString=function(){return this.name},Mn.fromString=function(t){return t?new Mn({name:t,available:!1}):null},Mn.prototype.serialize=function(){return["image",this.name]};var no=function(t,n){this.type=t,this.value=n};no.parse=function(t,n){if(t.length!==2)return n.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ja(t[1]))return n.error("invalid value");var a=t[1],d=Hr(a),_=n.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new no(d,a)},no.prototype.evaluate=function(){return this.value},no.prototype.eachChild=function(){},no.prototype.outputDefined=function(){return!0},no.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ri?["rgba"].concat(this.value.toArray()):this.value instanceof rn?this.value.serialize():this.value};var Ir=function(t){this.name="ExpressionEvaluationError",this.message=t};Ir.prototype.toJSON=function(){return this.message};var Dn={string:_e,number:le,boolean:de,object:Ke},yn=function(t,n){this.type=t,this.args=n};yn.parse=function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var a,d=1,_=t[0];if(_==="array"){var i,e;if(t.length>2){var r=t[1];if(typeof r!="string"||!(r in Dn)||r==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);i=Dn[r],d++}else i=Be;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);e=t[2],d++}a=Rt(i,e)}else a=Dn[_];for(var s=[];d<t.length;d++){var p=n.parse(t[d],d,Be);if(!p)return null;s.push(p)}return new yn(a,s)},yn.prototype.evaluate=function(t){for(var n=0;n<this.args.length;n++){var a=this.args[n].evaluate(t);if(!ii(this.type,Hr(a)))return a;if(n===this.args.length-1)throw new Ir("Expected value to be of type "+Zt(this.type)+", but found "+Zt(Hr(a))+" instead.")}return null},yn.prototype.eachChild=function(t){this.args.forEach(t)},yn.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},yn.prototype.serialize=function(){var t=this.type,n=[t.kind];if(t.kind==="array"){var a=t.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);var d=t.N;(typeof d=="number"||this.args.length>1)&&n.push(d)}}return n.concat(this.args.map(function(_){return _.serialize()}))};var Nn=function(t){this.type=ht,this.sections=t};Nn.parse=function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var a=t[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");for(var d=[],_=!1,i=1;i<=t.length-1;++i){var e=t[i];if(_&&typeof e=="object"&&!Array.isArray(e)){_=!1;var r=null;if(e["font-scale"]&&!(r=n.parse(e["font-scale"],1,le)))return null;var s=null;if(e["text-font"]&&!(s=n.parse(e["text-font"],1,Rt(_e))))return null;var p=null;if(e["text-color"]&&!(p=n.parse(e["text-color"],1,$e)))return null;var m=d[d.length-1];m.scale=r,m.font=s,m.textColor=p}else{var g=n.parse(t[i],1,Be);if(!g)return null;var I=g.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:g,scale:null,font:null,textColor:null})}}return new Nn(d)},Nn.prototype.evaluate=function(t){return new rn(this.sections.map(function(n){var a=n.content.evaluate(t);return Hr(a)===bt?new ln("",a,null,null,null):new ln($o(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))},Nn.prototype.eachChild=function(t){for(var n=0,a=this.sections;n<a.length;n+=1){var d=a[n];t(d.content),d.scale&&t(d.scale),d.font&&t(d.font),d.textColor&&t(d.textColor)}},Nn.prototype.outputDefined=function(){return!1},Nn.prototype.serialize=function(){for(var t=["format"],n=0,a=this.sections;n<a.length;n+=1){var d=a[n];t.push(d.content.serialize());var _={};d.scale&&(_["font-scale"]=d.scale.serialize()),d.font&&(_["text-font"]=d.font.serialize()),d.textColor&&(_["text-color"]=d.textColor.serialize()),t.push(_)}return t};var Xo=function(t){this.type=bt,this.input=t};Xo.parse=function(t,n){if(t.length!==2)return n.error("Expected two arguments.");var a=n.parse(t[1],1,_e);return a?new Xo(a):n.error("No image name provided.")},Xo.prototype.evaluate=function(t){var n=this.input.evaluate(t),a=Mn.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a},Xo.prototype.eachChild=function(t){t(this.input)},Xo.prototype.outputDefined=function(){return!1},Xo.prototype.serialize=function(){return["image",this.input.serialize()]};var xu={"to-boolean":de,"to-color":$e,"to-number":le,"to-string":_e},Tn=function(t,n){this.type=t,this.args=n};Tn.parse=function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var a=t[0];if((a==="to-boolean"||a==="to-string")&&t.length!==2)return n.error("Expected one argument.");for(var d=xu[a],_=[],i=1;i<t.length;i++){var e=n.parse(t[i],i,Be);if(!e)return null;_.push(e)}return new Tn(d,_)},Tn.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var n,a,d=0,_=this.args;d<_.length;d+=1){if(a=null,(n=_[d].evaluate(t))instanceof ri)return n;if(typeof n=="string"){var i=t.parseColor(n);if(i)return i}else if(Array.isArray(n)&&!(a=n.length<3||n.length>4?"Invalid rbga value "+JSON.stringify(n)+": expected an array containing either three or four numeric values.":br(n[0],n[1],n[2],n[3])))return new ri(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ir(a||"Could not parse color from value '"+(typeof n=="string"?n:String(JSON.stringify(n)))+"'")}if(this.type.kind==="number"){for(var e=null,r=0,s=this.args;r<s.length;r+=1){if((e=s[r].evaluate(t))===null)return 0;var p=Number(e);if(!isNaN(p))return p}throw new Ir("Could not convert "+JSON.stringify(e)+" to number.")}return this.type.kind==="formatted"?rn.fromString($o(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Mn.fromString($o(this.args[0].evaluate(t))):$o(this.args[0].evaluate(t))},Tn.prototype.eachChild=function(t){this.args.forEach(t)},Tn.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Tn.prototype.serialize=function(){if(this.type.kind==="formatted")return new Nn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(n){t.push(n.serialize())}),t};var Rs=["Unknown","Point","LineString","Polygon"],oo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};oo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},oo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Rs[this.feature.type]:this.feature.type:null},oo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},oo.prototype.canonicalID=function(){return this.canonical},oo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},oo.prototype.parseColor=function(t){var n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=ri.parse(t)),n};var Zr=function(t,n,a,d){this.name=t,this.type=n,this._evaluate=a,this.args=d};Zr.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Zr.prototype.eachChild=function(t){this.args.forEach(t)},Zr.prototype.outputDefined=function(){return!1},Zr.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Zr.parse=function(t,n){var a,d=t[0],_=Zr.definitions[d];if(!_)return n.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var i=Array.isArray(_)?_[0]:_.type,e=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,r=e.filter(function(Ge){var Qe=Ge[0];return!Array.isArray(Qe)||Qe.length===t.length-1}),s=null,p=0,m=r;p<m.length;p+=1){var g=m[p],I=g[0],E=g[1];s=new ko(n.registry,n.path,null,n.scope);for(var M=[],L=!1,F=1;F<t.length;F++){var O=t[F],Z=Array.isArray(I)?I[F-1]:I.type,$=s.parse(O,1+M.length,Z);if(!$){L=!0;break}M.push($)}if(!L)if(Array.isArray(I)&&I.length!==M.length)s.error("Expected "+I.length+" arguments, but found "+M.length+" instead.");else{for(var te=0;te<M.length;te++){var ie=Array.isArray(I)?I[te]:I.type,ve=M[te];s.concat(te+1).checkSubtype(ie,ve.type)}if(s.errors.length===0)return new Zr(d,i,E,M)}}if(r.length===1)(a=n.errors).push.apply(a,s.errors);else{for(var Pe=(r.length?r:e).map(function(Ge){var Qe;return Qe=Ge[0],Array.isArray(Qe)?"("+Qe.map(Zt).join(", ")+")":"("+Zt(Qe.type)+"...)"}).join(" | "),Me=[],Ue=1;Ue<t.length;Ue++){var qe=n.parse(t[Ue],1+Me.length);if(!qe)return null;Me.push(Zt(qe.type))}n.error("Expected arguments of type "+Pe+", but found ("+Me.join(", ")+") instead.")}return null},Zr.register=function(t,n){for(var a in Zr.definitions=n,n)t[a]=Zr};var Nr=function(t,n,a){this.type=xt,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n};function ia(t,n){t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[0]),t[3]=Math.max(t[3],n[1])}function Ia(t,n){return!(t[0]<=n[0]||t[2]>=n[2]||t[1]<=n[1]||t[3]>=n[3])}function vl(t,n){var a=(180+t[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(a*_*8192),Math.round(d*_*8192)]}function Bs(t,n,a){return n[1]>t[1]!=a[1]>t[1]&&t[0]<(a[0]-n[0])*(t[1]-n[1])/(a[1]-n[1])+n[0]}function Kr(t,n){for(var a,d,_,i,e,r,s,p=!1,m=0,g=n.length;m<g;m++)for(var I=n[m],E=0,M=I.length;E<M-1;E++){if((i=(a=t)[0]-(d=I[E])[0])*(s=a[1]-(_=I[E+1])[1])-(r=a[0]-_[0])*(e=a[1]-d[1])==0&&i*r<=0&&e*s<=0)return!1;Bs(t,I[E],I[E+1])&&(p=!p)}return p}function Fs(t,n){for(var a=0;a<n.length;a++)if(Kr(t,n[a]))return!0;return!1}function xl(t,n,a,d){var _=d[0]-a[0],i=d[1]-a[1],e=(t[0]-a[0])*i-_*(t[1]-a[1]),r=(n[0]-a[0])*i-_*(n[1]-a[1]);return e>0&&r<0||e<0&&r>0}function bu(t,n,a){for(var d=0,_=a;d<_.length;d+=1)for(var i=_[d],e=0;e<i.length-1;++e)if((g=[(m=i[e+1])[0]-(p=i[e])[0],m[1]-p[1]])[0]*(I=[(s=n)[0]-(r=t)[0],s[1]-r[1]])[1]-g[1]*I[0]!=0&&xl(r,s,p,m)&&xl(p,m,r,s))return!0;var r,s,p,m,g,I;return!1}function bl(t,n){for(var a=0;a<t.length;++a)if(!Kr(t[a],n))return!1;for(var d=0;d<t.length-1;++d)if(bu(t[d],t[d+1],n))return!1;return!0}function Va(t,n){for(var a=0;a<n.length;a++)if(bl(t,n[a]))return!0;return!1}function hs(t,n,a){for(var d=[],_=0;_<t.length;_++){for(var i=[],e=0;e<t[_].length;e++){var r=vl(t[_][e],a);ia(n,r),i.push(r)}d.push(i)}return d}function Os(t,n,a){for(var d=[],_=0;_<t.length;_++){var i=hs(t[_],n,a);d.push(i)}return d}function wu(t,n,a,d){if(t[0]<a[0]||t[0]>a[2]){var _=.5*d,i=t[0]-a[0]>_?-d:a[0]-t[0]>_?d:0;i===0&&(i=t[0]-a[2]>_?-d:a[2]-t[0]>_?d:0),t[0]+=i}ia(n,t)}function ps(t,n,a,d){for(var _=8192*Math.pow(2,d.z),i=[8192*d.x,8192*d.y],e=[],r=0,s=t;r<s.length;r+=1)for(var p=0,m=s[r];p<m.length;p+=1){var g=m[p],I=[g.x+i[0],g.y+i[1]];wu(I,n,a,_),e.push(I)}return e}function Us(t,n,a,d){for(var _,i=8192*Math.pow(2,d.z),e=[8192*d.x,8192*d.y],r=[],s=0,p=t;s<p.length;s+=1){for(var m=[],g=0,I=p[s];g<I.length;g+=1){var E=I[g],M=[E.x+e[0],E.y+e[1]];ia(n,M),m.push(M)}r.push(m)}if(n[2]-n[0]<=i/2){(_=n)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var L=0,F=r;L<F.length;L+=1)for(var O=0,Z=F[L];O<Z.length;O+=1)wu(Z[O],n,a,i)}return r}Nr.parse=function(t,n){if(t.length!==2)return n.error("Expected one argument.");var a=t[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");var d=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,de);if(!d)return null;var _=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,de);if(!_)return null;var i=null;return a.locale&&!(i=n.parse(a.locale,1,_e))?null:new Nr(d,_,i)},Nr.prototype.evaluate=function(t){return new Vr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Nr.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Nr.prototype.outputDefined=function(){return!1},Nr.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ln=function(t,n){this.type=de,this.geojson=t,this.geometries=n};function ra(t){if(t instanceof Zr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ln)return!1;var n=!0;return t.eachChild(function(a){n&&!ra(a)&&(n=!1)}),n}function na(t){if(t instanceof Zr&&t.name==="feature-state")return!1;var n=!0;return t.eachChild(function(a){n&&!na(a)&&(n=!1)}),n}function Wi(t,n){if(t instanceof Zr&&n.indexOf(t.name)>=0)return!1;var a=!0;return t.eachChild(function(d){a&&!Wi(d,n)&&(a=!1)}),a}Ln.parse=function(t,n){if(t.length!==2)return n.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ja(t[1])){var a=t[1];if(a.type==="FeatureCollection")for(var d=0;d<a.features.length;++d){var _=a.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ln(a,a.features[d].geometry)}else if(a.type==="Feature"){var i=a.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new Ln(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ln(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ln.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){var d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(a.type==="Polygon"){var e=hs(a.coordinates,_,i),r=ps(n.geometry(),d,_,i);if(!Ia(d,_))return!1;for(var s=0,p=r;s<p.length;s+=1)if(!Kr(p[s],e))return!1}if(a.type==="MultiPolygon"){var m=Os(a.coordinates,_,i),g=ps(n.geometry(),d,_,i);if(!Ia(d,_))return!1;for(var I=0,E=g;I<E.length;I+=1)if(!Fs(E[I],m))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){var d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(a.type==="Polygon"){var e=hs(a.coordinates,_,i),r=Us(n.geometry(),d,_,i);if(!Ia(d,_))return!1;for(var s=0,p=r;s<p.length;s+=1)if(!bl(p[s],e))return!1}if(a.type==="MultiPolygon"){var m=Os(a.coordinates,_,i),g=Us(n.geometry(),d,_,i);if(!Ia(d,_))return!1;for(var I=0,E=g;I<E.length;I+=1)if(!Va(E[I],m))return!1}return!0}(t,this.geometries)}return!1},Ln.prototype.eachChild=function(){},Ln.prototype.outputDefined=function(){return!0},Ln.prototype.serialize=function(){return["within",this.geojson]};var Ea=function(t,n){this.type=n.type,this.name=t,this.boundExpression=n};Ea.parse=function(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");var a=t[1];return n.scope.has(a)?new Ea(a,n.scope.get(a)):n.error('Unknown variable "'+a+'". Make sure "'+a+'" has been bound in an enclosing "let" expression before using it.',1)},Ea.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ea.prototype.eachChild=function(){},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return["var",this.name]};var ko=function(t,n,a,d,_){n===void 0&&(n=[]),d===void 0&&(d=new pe),_===void 0&&(_=[]),this.registry=t,this.path=n,this.key=n.map(function(i){return"["+i+"]"}).join(""),this.scope=d,this.errors=_,this.expectedType=a};function yo(t,n){for(var a,d=t.length-1,_=0,i=d,e=0;_<=i;)if((a=t[e=Math.floor((_+i)/2)])<=n){if(e===d||n<t[e+1])return e;_=e+1}else{if(!(a>n))throw new Ir("Input is not a number.");i=e-1}return 0}ko.prototype.parse=function(t,n,a,d,_){return _===void 0&&(_={}),n?this.concat(n,a,d)._parse(t,_):this._parse(t,_)},ko.prototype._parse=function(t,n){function a(p,m,g){return g==="assert"?new yn(m,[p]):g==="coerce"?new Tn(m,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=t[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[d];if(_){var i=_.parse(t,this);if(!i)return null;if(this.expectedType){var e=this.expectedType,r=i.type;if(e.kind!=="string"&&e.kind!=="number"&&e.kind!=="boolean"&&e.kind!=="object"&&e.kind!=="array"||r.kind!=="value")if(e.kind!=="color"&&e.kind!=="formatted"&&e.kind!=="resolvedImage"||r.kind!=="value"&&r.kind!=="string"){if(this.checkSubtype(e,r))return null}else i=a(i,e,n.typeAnnotation||"coerce");else i=a(i,e,n.typeAnnotation||"assert")}if(!(i instanceof no)&&i.type.kind!=="resolvedImage"&&function p(m){if(m instanceof Ea)return p(m.boundExpression);if(m instanceof Zr&&m.name==="error"||m instanceof Nr||m instanceof Ln)return!1;var g=m instanceof Tn||m instanceof yn,I=!0;return m.eachChild(function(E){I=g?I&&p(E):I&&E instanceof no}),!!I&&ra(m)&&Wi(m,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(i)){var s=new oo;try{i=new no(i.type,i.evaluate(s))}catch(p){return this.error(p.message),null}}return i}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},ko.prototype.concat=function(t,n,a){var d=typeof t=="number"?this.path.concat(t):this.path,_=a?this.scope.concat(a):this.scope;return new ko(this.registry,d,n||null,_,this.errors)},ko.prototype.error=function(t){for(var n=[],a=arguments.length-1;a-- >0;)n[a]=arguments[a+1];var d=""+this.key+n.map(function(_){return"["+_+"]"}).join("");this.errors.push(new ne(d,t))},ko.prototype.checkSubtype=function(t,n){var a=ii(t,n);return a&&this.error(a),a};var Ao=function(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(var d=0,_=a;d<_.length;d+=1){var i=_[d],e=i[1];this.labels.push(i[0]),this.outputs.push(e)}};function rr(t,n,a){return t*(1-a)+n*a}Ao.parse=function(t,n){if(t.length-1<4)return n.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");var a=n.parse(t[1],1,le);if(!a)return null;var d=[],_=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(var i=1;i<t.length;i+=2){var e=i===1?-1/0:t[i],r=t[i+1],s=i,p=i+1;if(typeof e!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(d.length&&d[d.length-1][0]>=e)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);var m=n.parse(r,p,_);if(!m)return null;_=_||m.type,d.push([e,m])}return new Ao(_,a,d)},Ao.prototype.evaluate=function(t){var n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);var d=this.input.evaluate(t);if(d<=n[0])return a[0].evaluate(t);var _=n.length;return d>=n[_-1]?a[_-1].evaluate(t):a[yo(n,d)].evaluate(t)},Ao.prototype.eachChild=function(t){t(this.input);for(var n=0,a=this.outputs;n<a.length;n+=1)t(a[n])},Ao.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Ao.prototype.serialize=function(){for(var t=["step",this.input.serialize()],n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t};var ds=Object.freeze({__proto__:null,number:rr,color:function(t,n,a){return new ri(rr(t.r,n.r,a),rr(t.g,n.g,a),rr(t.b,n.b,a),rr(t.a,n.a,a))},array:function(t,n,a){return t.map(function(d,_){return rr(d,n[_],a)})}}),js=6/29*3*(6/29),wl=Math.PI/180,Gl=180/Math.PI;function Vs(t){return t>.008856451679035631?Math.pow(t,1/3):t/js+4/29}function fs(t){return t>6/29?t*t*t:js*(t-4/29)}function Ns(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function qs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Zs(t){var n=qs(t.r),a=qs(t.g),d=qs(t.b),_=Vs((.4124564*n+.3575761*a+.1804375*d)/.95047),i=Vs((.2126729*n+.7151522*a+.072175*d)/1);return{l:116*i-16,a:500*(_-i),b:200*(i-Vs((.0193339*n+.119192*a+.9503041*d)/1.08883)),alpha:t.a}}function $l(t){var n=(t.l+16)/116,a=isNaN(t.a)?n:n+t.a/500,d=isNaN(t.b)?n:n-t.b/200;return n=1*fs(n),a=.95047*fs(a),d=1.08883*fs(d),new ri(Ns(3.2404542*a-1.5371385*n-.4985314*d),Ns(-.969266*a+1.8760108*n+.041556*d),Ns(.0556434*a-.2040259*n+1.0572252*d),t.alpha)}function Tu(t,n,a){var d=n-t;return t+a*(d>180||d<-180?d-360*Math.round(d/360):d)}var Wo={forward:Zs,reverse:$l,interpolate:function(t,n,a){return{l:rr(t.l,n.l,a),a:rr(t.a,n.a,a),b:rr(t.b,n.b,a),alpha:rr(t.alpha,n.alpha,a)}}},Gs={forward:function(t){var n=Zs(t),a=n.l,d=n.a,_=n.b,i=Math.atan2(_,d)*Gl;return{h:i<0?i+360:i,c:Math.sqrt(d*d+_*_),l:a,alpha:t.a}},reverse:function(t){var n=t.h*wl,a=t.c;return $l({l:t.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:t.alpha})},interpolate:function(t,n,a){return{h:Tu(t.h,n.h,a),c:rr(t.c,n.c,a),l:rr(t.l,n.l,a),alpha:rr(t.alpha,n.alpha,a)}}},Su=Object.freeze({__proto__:null,lab:Wo,hcl:Gs}),Sn=function(t,n,a,d,_){this.type=t,this.operator=n,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(var i=0,e=_;i<e.length;i+=1){var r=e[i],s=r[1];this.labels.push(r[0]),this.outputs.push(s)}};function Xl(t,n,a,d){var _=d-a,i=t-a;return _===0?0:n===1?i/_:(Math.pow(n,i)-1)/(Math.pow(n,_)-1)}Sn.interpolationFactor=function(t,n,a,d){var _=0;if(t.name==="exponential")_=Xl(n,t.base,a,d);else if(t.name==="linear")_=Xl(n,1,a,d);else if(t.name==="cubic-bezier"){var i=t.controlPoints;_=new ce(i[0],i[1],i[2],i[3]).solve(Xl(n,1,a,d))}return _},Sn.parse=function(t,n){var a=t[0],d=t[1],_=t[2],i=t.slice(3);if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var e=d[1];if(typeof e!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:e}}else{if(d[0]!=="cubic-bezier")return n.error("Unknown interpolation type "+String(d[0]),1,0);var r=d.slice(1);if(r.length!==4||r.some(function(F){return typeof F!="number"||F<0||F>1}))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:r}}if(t.length-1<4)return n.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(!(_=n.parse(_,2,le)))return null;var s=[],p=null;a==="interpolate-hcl"||a==="interpolate-lab"?p=$e:n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(var m=0;m<i.length;m+=2){var g=i[m],I=i[m+1],E=m+3,M=m+4;if(typeof g!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(s.length&&s[s.length-1][0]>=g)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);var L=n.parse(I,M,p);if(!L)return null;p=p||L.type,s.push([g,L])}return p.kind==="number"||p.kind==="color"||p.kind==="array"&&p.itemType.kind==="number"&&typeof p.N=="number"?new Sn(p,a,d,_,s):n.error("Type "+Zt(p)+" is not interpolatable.")},Sn.prototype.evaluate=function(t){var n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);var d=this.input.evaluate(t);if(d<=n[0])return a[0].evaluate(t);var _=n.length;if(d>=n[_-1])return a[_-1].evaluate(t);var i=yo(n,d),e=Sn.interpolationFactor(this.interpolation,d,n[i],n[i+1]),r=a[i].evaluate(t),s=a[i+1].evaluate(t);return this.operator==="interpolate"?ds[this.type.kind.toLowerCase()](r,s,e):this.operator==="interpolate-hcl"?Gs.reverse(Gs.interpolate(Gs.forward(r),Gs.forward(s),e)):Wo.reverse(Wo.interpolate(Wo.forward(r),Wo.forward(s),e))},Sn.prototype.eachChild=function(t){t(this.input);for(var n=0,a=this.outputs;n<a.length;n+=1)t(a[n])},Sn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Sn.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var n=[this.operator,t,this.input.serialize()],a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n};var ka=function(t,n){this.type=t,this.args=n};ka.parse=function(t,n){if(t.length<2)return n.error("Expectected at least one argument.");var a=null,d=n.expectedType;d&&d.kind!=="value"&&(a=d);for(var _=[],i=0,e=t.slice(1);i<e.length;i+=1){var r=n.parse(e[i],1+_.length,a,void 0,{typeAnnotation:"omit"});if(!r)return null;a=a||r.type,_.push(r)}var s=d&&_.some(function(p){return ii(d,p.type)});return new ka(s?Be:a,_)},ka.prototype.evaluate=function(t){for(var n,a=null,d=0,_=0,i=this.args;_<i.length&&(d++,(a=i[_].evaluate(t))&&a instanceof Mn&&!a.available&&(n||(n=a.name),a=null,d===this.args.length&&(a=n)),a===null);_+=1);return a},ka.prototype.eachChild=function(t){this.args.forEach(t)},ka.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ka.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(n){t.push(n.serialize())}),t};var Aa=function(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n};Aa.prototype.evaluate=function(t){return this.result.evaluate(t)},Aa.prototype.eachChild=function(t){for(var n=0,a=this.bindings;n<a.length;n+=1)t(a[n][1]);t(this.result)},Aa.parse=function(t,n){if(t.length<4)return n.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var a=[],d=1;d<t.length-1;d+=2){var _=t[d];if(typeof _!="string")return n.error("Expected string, but found "+typeof _+" instead.",d);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);var i=n.parse(t[d+1],d+1);if(!i)return null;a.push([_,i])}var e=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return e?new Aa(a,e):null},Aa.prototype.outputDefined=function(){return this.result.outputDefined()},Aa.prototype.serialize=function(){for(var t=["let"],n=0,a=this.bindings;n<a.length;n+=1){var d=a[n];t.push(d[0],d[1].serialize())}return t.push(this.result.serialize()),t};var oa=function(t,n,a){this.type=t,this.index=n,this.input=a};oa.parse=function(t,n){if(t.length!==3)return n.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var a=n.parse(t[1],1,le),d=n.parse(t[2],2,Rt(n.expectedType||Be));return a&&d?new oa(d.type.itemType,a,d):null},oa.prototype.evaluate=function(t){var n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new Ir("Array index out of bounds: "+n+" < 0.");if(n>=a.length)throw new Ir("Array index out of bounds: "+n+" > "+(a.length-1)+".");if(n!==Math.floor(n))throw new Ir("Array index must be an integer, but found "+n+" instead.");return a[n]},oa.prototype.eachChild=function(t){t(this.index),t(this.input)},oa.prototype.outputDefined=function(){return!1},oa.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var aa=function(t,n){this.type=de,this.needle=t,this.haystack=n};aa.parse=function(t,n){if(t.length!==3)return n.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var a=n.parse(t[1],1,Be),d=n.parse(t[2],2,Be);return a&&d?qt(a.type,[de,_e,le,Ie,Be])?new aa(a,d):n.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(a.type)+" instead"):null},aa.prototype.evaluate=function(t){var n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!It(n,["boolean","string","number","null"]))throw new Ir("Expected first argument to be of type boolean, string, number or null, but found "+Zt(Hr(n))+" instead.");if(!It(a,["string","array"]))throw new Ir("Expected second argument to be of type array or string, but found "+Zt(Hr(a))+" instead.");return a.indexOf(n)>=0},aa.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},aa.prototype.outputDefined=function(){return!0},aa.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var go=function(t,n,a){this.type=le,this.needle=t,this.haystack=n,this.fromIndex=a};go.parse=function(t,n){if(t.length<=2||t.length>=5)return n.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var a=n.parse(t[1],1,Be),d=n.parse(t[2],2,Be);if(!a||!d)return null;if(!qt(a.type,[de,_e,le,Ie,Be]))return n.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(a.type)+" instead");if(t.length===4){var _=n.parse(t[3],3,le);return _?new go(a,d,_):null}return new go(a,d)},go.prototype.evaluate=function(t){var n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!It(n,["boolean","string","number","null"]))throw new Ir("Expected first argument to be of type boolean, string, number or null, but found "+Zt(Hr(n))+" instead.");if(!It(a,["string","array"]))throw new Ir("Expected second argument to be of type array or string, but found "+Zt(Hr(a))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(t);return a.indexOf(n,d)}return a.indexOf(n)},go.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},go.prototype.outputDefined=function(){return!1},go.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var za=function(t,n,a,d,_,i){this.inputType=t,this.type=n,this.input=a,this.cases=d,this.outputs=_,this.otherwise=i};za.parse=function(t,n){if(t.length<5)return n.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return n.error("Expected an even number of arguments.");var a,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(var _={},i=[],e=2;e<t.length-1;e+=2){var r=t[e],s=t[e+1];Array.isArray(r)||(r=[r]);var p=n.concat(e);if(r.length===0)return p.error("Expected at least one branch label.");for(var m=0,g=r;m<g.length;m+=1){var I=g[m];if(typeof I!="number"&&typeof I!="string")return p.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return p.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof I=="number"&&Math.floor(I)!==I)return p.error("Numeric branch labels must be integer values.");if(a){if(p.checkSubtype(a,Hr(I)))return null}else a=Hr(I);if(_[String(I)]!==void 0)return p.error("Branch labels must be unique.");_[String(I)]=i.length}var E=n.parse(s,e,d);if(!E)return null;d=d||E.type,i.push(E)}var M=n.parse(t[1],1,Be);if(!M)return null;var L=n.parse(t[t.length-1],t.length-1,d);return L?M.type.kind!=="value"&&n.concat(1).checkSubtype(a,M.type)?null:new za(a,d,M,_,i,L):null},za.prototype.evaluate=function(t){var n=this.input.evaluate(t);return(Hr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)},za.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},za.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},za.prototype.serialize=function(){for(var t=this,n=["match",this.input.serialize()],a=[],d={},_=0,i=Object.keys(this.cases).sort();_<i.length;_+=1){var e=i[_];(g=d[this.cases[e]])===void 0?(d[this.cases[e]]=a.length,a.push([this.cases[e],[e]])):a[g][1].push(e)}for(var r=function(E){return t.inputType.kind==="number"?Number(E):E},s=0,p=a;s<p.length;s+=1){var m=p[s],g=m[0],I=m[1];n.push(I.length===1?r(I[0]):I.map(r)),n.push(this.outputs[outputIndex$1].serialize())}return n.push(this.otherwise.serialize()),n};var Ca=function(t,n,a){this.type=t,this.branches=n,this.otherwise=a};Ca.parse=function(t,n){if(t.length<4)return n.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return n.error("Expected an odd number of arguments.");var a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);for(var d=[],_=1;_<t.length-1;_+=2){var i=n.parse(t[_],_,de);if(!i)return null;var e=n.parse(t[_+1],_+1,a);if(!e)return null;d.push([i,e]),a=a||e.type}var r=n.parse(t[t.length-1],t.length-1,a);return r?new Ca(a,d,r):null},Ca.prototype.evaluate=function(t){for(var n=0,a=this.branches;n<a.length;n+=1){var d=a[n],_=d[1];if(d[0].evaluate(t))return _.evaluate(t)}return this.otherwise.evaluate(t)},Ca.prototype.eachChild=function(t){for(var n=0,a=this.branches;n<a.length;n+=1){var d=a[n],_=d[1];t(d[0]),t(_)}t(this.otherwise)},Ca.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Ca.prototype.serialize=function(){var t=["case"];return this.eachChild(function(n){t.push(n.serialize())}),t};var Ho=function(t,n,a,d){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=d};function Pa(t,n){return t==="=="||t==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Er(t,n,a,d){return d.compare(n,a)===0}function zo(t,n,a){var d=t!=="=="&&t!=="!=";return function(){function _(i,e,r){this.type=de,this.lhs=i,this.rhs=e,this.collator=r,this.hasUntypedArgument=i.type.kind==="value"||e.type.kind==="value"}return _.parse=function(i,e){if(i.length!==3&&i.length!==4)return e.error("Expected two or three arguments.");var r=i[0],s=e.parse(i[1],1,Be);if(!s)return null;if(!Pa(r,s.type))return e.concat(1).error('"'+r+`" comparisons are not supported for type '`+Zt(s.type)+"'.");var p=e.parse(i[2],2,Be);if(!p)return null;if(!Pa(r,p.type))return e.concat(2).error('"'+r+`" comparisons are not supported for type '`+Zt(p.type)+"'.");if(s.type.kind!==p.type.kind&&s.type.kind!=="value"&&p.type.kind!=="value")return e.error("Cannot compare types '"+Zt(s.type)+"' and '"+Zt(p.type)+"'.");d&&(s.type.kind==="value"&&p.type.kind!=="value"?s=new yn(p.type,[s]):s.type.kind!=="value"&&p.type.kind==="value"&&(p=new yn(s.type,[p])));var m=null;if(i.length===4){if(s.type.kind!=="string"&&p.type.kind!=="string"&&s.type.kind!=="value"&&p.type.kind!=="value")return e.error("Cannot use collator to compare non-string types.");if(!(m=e.parse(i[3],3,xt)))return null}return new _(s,p,m)},_.prototype.evaluate=function(i){var e=this.lhs.evaluate(i),r=this.rhs.evaluate(i);if(d&&this.hasUntypedArgument){var s=Hr(e),p=Hr(r);if(s.kind!==p.kind||s.kind!=="string"&&s.kind!=="number")throw new Ir('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+p.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var m=Hr(e),g=Hr(r);if(m.kind!=="string"||g.kind!=="string")return n(i,e,r)}return this.collator?a(i,e,r,this.collator.evaluate(i)):n(i,e,r)},_.prototype.eachChild=function(i){i(this.lhs),i(this.rhs),this.collator&&i(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var i=[t];return this.eachChild(function(e){i.push(e.serialize())}),i},_}()}Ho.parse=function(t,n){if(t.length<=2||t.length>=5)return n.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var a=n.parse(t[1],1,Be),d=n.parse(t[2],2,le);if(!a||!d)return null;if(!qt(a.type,[Rt(Be),_e,Be]))return n.error("Expected first argument to be of type array or string, but found "+Zt(a.type)+" instead");if(t.length===4){var _=n.parse(t[3],3,le);return _?new Ho(a.type,a,d,_):null}return new Ho(a.type,a,d)},Ho.prototype.evaluate=function(t){var n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!It(n,["string","array"]))throw new Ir("Expected first argument to be of type array or string, but found "+Zt(Hr(n))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(t);return n.slice(a,d)}return n.slice(a)},Ho.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var sa=zo("==",function(t,n,a){return n===a},Er),Wl=zo("!=",function(t,n,a){return n!==a},function(t,n,a,d){return!Er(0,n,a,d)}),Tl=zo("<",function(t,n,a){return n<a},function(t,n,a,d){return d.compare(n,a)<0}),Ei=zo(">",function(t,n,a){return n>a},function(t,n,a,d){return d.compare(n,a)>0}),$s=zo("<=",function(t,n,a){return n<=a},function(t,n,a,d){return d.compare(n,a)<=0}),dr=zo(">=",function(t,n,a){return n>=a},function(t,n,a,d){return d.compare(n,a)>=0}),Fo=function(t,n,a,d,_){this.type=_e,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=_};Fo.parse=function(t,n){if(t.length!==3)return n.error("Expected two arguments.");var a=n.parse(t[1],1,le);if(!a)return null;var d=t[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");var _=null;if(d.locale&&!(_=n.parse(d.locale,1,_e)))return null;var i=null;if(d.currency&&!(i=n.parse(d.currency,1,_e)))return null;var e=null;if(d["min-fraction-digits"]&&!(e=n.parse(d["min-fraction-digits"],1,le)))return null;var r=null;return d["max-fraction-digits"]&&!(r=n.parse(d["max-fraction-digits"],1,le))?null:new Fo(a,_,i,e,r)},Fo.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Fo.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var ur=function(t){this.type=le,this.input=t};ur.parse=function(t,n){if(t.length!==2)return n.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var a=n.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error("Expected argument of type string or array, but found "+Zt(a.type)+" instead."):new ur(a):null},ur.prototype.evaluate=function(t){var n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Ir("Expected value to be of type string or array, but found "+Zt(Hr(n))+" instead.")},ur.prototype.eachChild=function(t){t(this.input)},ur.prototype.outputDefined=function(){return!1},ur.prototype.serialize=function(){var t=["length"];return this.eachChild(function(n){t.push(n.serialize())}),t};var Cr={"==":sa,"!=":Wl,">":Ei,"<":Tl,">=":dr,"<=":$s,array:yn,at:oa,boolean:yn,case:Ca,coalesce:ka,collator:Nr,format:Nn,image:Xo,in:aa,"index-of":go,interpolate:Sn,"interpolate-hcl":Sn,"interpolate-lab":Sn,length:ur,let:Aa,literal:no,match:za,number:yn,"number-format":Fo,object:yn,slice:Ho,step:Ao,string:yn,"to-boolean":Tn,"to-color":Tn,"to-number":Tn,"to-string":Tn,var:Ea,within:Ln};function Xs(t,n){var a=n[0],d=n[1],_=n[2],i=n[3];a=a.evaluate(t),d=d.evaluate(t),_=_.evaluate(t);var e=i?i.evaluate(t):1,r=br(a,d,_,e);if(r)throw new Ir(r);return new ri(a/255*e,d/255*e,_/255*e,e)}function Sl(t,n){return t in n}function Hl(t,n){var a=n[t];return a===void 0?null:a}function la(t){return{type:t}}function ms(t){return{result:"success",value:t}}function Ko(t){return{result:"error",value:t}}function ua(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Na(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ws(t){return!!t.expression&&t.expression.interpolated}function nr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function qa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Co(t){return t}function Za(t,n,a){return t!==void 0?t:n!==void 0?n:a!==void 0?a:void 0}function Iu(t,n,a,d,_){return Za(typeof a===_?d[a]:void 0,t.default,n.default)}function Eu(t,n,a){if(nr(a)!=="number")return Za(t.default,n.default);var d=t.stops.length;if(d===1||a<=t.stops[0][0])return t.stops[0][1];if(a>=t.stops[d-1][0])return t.stops[d-1][1];var _=yo(t.stops.map(function(i){return i[0]}),a);return t.stops[_][1]}function Jo(t,n,a){var d=t.base!==void 0?t.base:1;if(nr(a)!=="number")return Za(t.default,n.default);var _=t.stops.length;if(_===1||a<=t.stops[0][0])return t.stops[0][1];if(a>=t.stops[_-1][0])return t.stops[_-1][1];var i=yo(t.stops.map(function(g){return g[0]}),a),e=function(g,I,E,M){var L=M-E,F=g-E;return L===0?0:I===1?F/L:(Math.pow(I,F)-1)/(Math.pow(I,L)-1)}(a,d,t.stops[i][0],t.stops[i+1][0]),r=t.stops[i][1],s=t.stops[i+1][1],p=ds[n.type]||Co;if(t.colorSpace&&t.colorSpace!=="rgb"){var m=Su[t.colorSpace];p=function(g,I){return m.reverse(m.interpolate(m.forward(g),m.forward(I),e))}}return typeof r.evaluate=="function"?{evaluate:function(){for(var g=[],I=arguments.length;I--;)g[I]=arguments[I];var E=r.evaluate.apply(void 0,g),M=s.evaluate.apply(void 0,g);if(E!==void 0&&M!==void 0)return p(E,M,e)}}:p(r,s,e)}function Hs(t,n,a){return n.type==="color"?a=ri.parse(a):n.type==="formatted"?a=rn.fromString(a.toString()):n.type==="resolvedImage"?a=Mn.fromString(a.toString()):nr(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),Za(a,t.default,n.default)}Zr.register(Cr,{error:[{kind:"error"},[_e],function(t,n){throw new Ir(n[0].evaluate(t))}],typeof:[_e,[Be],function(t,n){return Zt(Hr(n[0].evaluate(t)))}],"to-rgba":[Rt(le,4),[$e],function(t,n){return n[0].evaluate(t).toArray()}],rgb:[$e,[le,le,le],Xs],rgba:[$e,[le,le,le,le],Xs],has:{type:de,overloads:[[[_e],function(t,n){return Sl(n[0].evaluate(t),t.properties())}],[[_e,Ke],function(t,n){var a=n[1];return Sl(n[0].evaluate(t),a.evaluate(t))}]]},get:{type:Be,overloads:[[[_e],function(t,n){return Hl(n[0].evaluate(t),t.properties())}],[[_e,Ke],function(t,n){var a=n[1];return Hl(n[0].evaluate(t),a.evaluate(t))}]]},"feature-state":[Be,[_e],function(t,n){return Hl(n[0].evaluate(t),t.featureState||{})}],properties:[Ke,[],function(t){return t.properties()}],"geometry-type":[_e,[],function(t){return t.geometryType()}],id:[Be,[],function(t){return t.id()}],zoom:[le,[],function(t){return t.globals.zoom}],"heatmap-density":[le,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[le,[],function(t){return t.globals.lineProgress||0}],accumulated:[Be,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[le,la(le),function(t,n){for(var a=0,d=0,_=n;d<_.length;d+=1)a+=_[d].evaluate(t);return a}],"*":[le,la(le),function(t,n){for(var a=1,d=0,_=n;d<_.length;d+=1)a*=_[d].evaluate(t);return a}],"-":{type:le,overloads:[[[le,le],function(t,n){var a=n[1];return n[0].evaluate(t)-a.evaluate(t)}],[[le],function(t,n){return-n[0].evaluate(t)}]]},"/":[le,[le,le],function(t,n){var a=n[1];return n[0].evaluate(t)/a.evaluate(t)}],"%":[le,[le,le],function(t,n){var a=n[1];return n[0].evaluate(t)%a.evaluate(t)}],ln2:[le,[],function(){return Math.LN2}],pi:[le,[],function(){return Math.PI}],e:[le,[],function(){return Math.E}],"^":[le,[le,le],function(t,n){var a=n[1];return Math.pow(n[0].evaluate(t),a.evaluate(t))}],sqrt:[le,[le],function(t,n){return Math.sqrt(n[0].evaluate(t))}],log10:[le,[le],function(t,n){return Math.log(n[0].evaluate(t))/Math.LN10}],ln:[le,[le],function(t,n){return Math.log(n[0].evaluate(t))}],log2:[le,[le],function(t,n){return Math.log(n[0].evaluate(t))/Math.LN2}],sin:[le,[le],function(t,n){return Math.sin(n[0].evaluate(t))}],cos:[le,[le],function(t,n){return Math.cos(n[0].evaluate(t))}],tan:[le,[le],function(t,n){return Math.tan(n[0].evaluate(t))}],asin:[le,[le],function(t,n){return Math.asin(n[0].evaluate(t))}],acos:[le,[le],function(t,n){return Math.acos(n[0].evaluate(t))}],atan:[le,[le],function(t,n){return Math.atan(n[0].evaluate(t))}],min:[le,la(le),function(t,n){return Math.min.apply(Math,n.map(function(a){return a.evaluate(t)}))}],max:[le,la(le),function(t,n){return Math.max.apply(Math,n.map(function(a){return a.evaluate(t)}))}],abs:[le,[le],function(t,n){return Math.abs(n[0].evaluate(t))}],round:[le,[le],function(t,n){var a=n[0].evaluate(t);return a<0?-Math.round(-a):Math.round(a)}],floor:[le,[le],function(t,n){return Math.floor(n[0].evaluate(t))}],ceil:[le,[le],function(t,n){return Math.ceil(n[0].evaluate(t))}],"filter-==":[de,[_e,Be],function(t,n){var a=n[0],d=n[1];return t.properties()[a.value]===d.value}],"filter-id-==":[de,[Be],function(t,n){var a=n[0];return t.id()===a.value}],"filter-type-==":[de,[_e],function(t,n){var a=n[0];return t.geometryType()===a.value}],"filter-<":[de,[_e,Be],function(t,n){var a=n[0],d=n[1],_=t.properties()[a.value],i=d.value;return typeof _==typeof i&&_<i}],"filter-id-<":[de,[Be],function(t,n){var a=n[0],d=t.id(),_=a.value;return typeof d==typeof _&&d<_}],"filter->":[de,[_e,Be],function(t,n){var a=n[0],d=n[1],_=t.properties()[a.value],i=d.value;return typeof _==typeof i&&_>i}],"filter-id->":[de,[Be],function(t,n){var a=n[0],d=t.id(),_=a.value;return typeof d==typeof _&&d>_}],"filter-<=":[de,[_e,Be],function(t,n){var a=n[0],d=n[1],_=t.properties()[a.value],i=d.value;return typeof _==typeof i&&_<=i}],"filter-id-<=":[de,[Be],function(t,n){var a=n[0],d=t.id(),_=a.value;return typeof d==typeof _&&d<=_}],"filter->=":[de,[_e,Be],function(t,n){var a=n[0],d=n[1],_=t.properties()[a.value],i=d.value;return typeof _==typeof i&&_>=i}],"filter-id->=":[de,[Be],function(t,n){var a=n[0],d=t.id(),_=a.value;return typeof d==typeof _&&d>=_}],"filter-has":[de,[Be],function(t,n){return n[0].value in t.properties()}],"filter-has-id":[de,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[de,[Rt(_e)],function(t,n){return n[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[de,[Rt(Be)],function(t,n){return n[0].value.indexOf(t.id())>=0}],"filter-in-small":[de,[_e,Rt(Be)],function(t,n){var a=n[0];return n[1].value.indexOf(t.properties()[a.value])>=0}],"filter-in-large":[de,[_e,Rt(Be)],function(t,n){var a=n[0],d=n[1];return function(_,i,e,r){for(;e<=r;){var s=e+r>>1;if(i[s]===_)return!0;i[s]>_?r=s-1:e=s+1}return!1}(t.properties()[a.value],d.value,0,d.value.length-1)}],all:{type:de,overloads:[[[de,de],function(t,n){var a=n[1];return n[0].evaluate(t)&&a.evaluate(t)}],[la(de),function(t,n){for(var a=0,d=n;a<d.length;a+=1)if(!d[a].evaluate(t))return!1;return!0}]]},any:{type:de,overloads:[[[de,de],function(t,n){var a=n[1];return n[0].evaluate(t)||a.evaluate(t)}],[la(de),function(t,n){for(var a=0,d=n;a<d.length;a+=1)if(d[a].evaluate(t))return!0;return!1}]]},"!":[de,[de],function(t,n){return!n[0].evaluate(t)}],"is-supported-script":[de,[_e],function(t,n){var a=t.globals&&t.globals.isSupportedScript;return!a||a(n[0].evaluate(t))}],upcase:[_e,[_e],function(t,n){return n[0].evaluate(t).toUpperCase()}],downcase:[_e,[_e],function(t,n){return n[0].evaluate(t).toLowerCase()}],concat:[_e,la(Be),function(t,n){return n.map(function(a){return $o(a.evaluate(t))}).join("")}],"resolved-locale":[_e,[xt],function(t,n){return n[0].evaluate(t).resolvedLocale()}]});var Ma=function(t,n){this.expression=t,this._warningHistory={},this._evaluator=new oo,this._defaultValue=n?function(a){return a.type==="color"&&qa(a.default)?new ri(0,0,0,0):a.type==="color"?ri.parse(a.default)||null:a.default===void 0?null:a.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null};function Ks(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Cr}function Ga(t,n){var a=new ko(Cr,[],n?function(_){var i={color:$e,string:_e,number:le,enum:_e,boolean:de,formatted:ht,resolvedImage:bt};return _.type==="array"?Rt(i[_.value]||Be,_.length):i[_.type]}(n):void 0),d=a.parse(t,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?ms(new Ma(d,n)):Ko(a.errors)}Ma.prototype.evaluateWithoutErrorHandling=function(t,n,a,d,_,i){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=i,this.expression.evaluate(this._evaluator)},Ma.prototype.evaluate=function(t,n,a,d,_,i){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=i||null;try{var e=this.expression.evaluate(this._evaluator);if(e==null||typeof e=="number"&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Ir("Expected value to be one of "+Object.keys(this._enumValues).map(function(r){return JSON.stringify(r)}).join(", ")+", but found "+JSON.stringify(e)+" instead.");return e}catch(r){return this._warningHistory[r.message]||(this._warningHistory[r.message]=!0,typeof console<"u"&&console.warn(r.message)),this._defaultValue}};var Da=function(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!na(n.expression)};Da.prototype.evaluateWithoutErrorHandling=function(t,n,a,d,_,i){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,d,_,i)},Da.prototype.evaluate=function(t,n,a,d,_,i){return this._styleExpression.evaluate(t,n,a,d,_,i)};var $a=function(t,n,a,d){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!na(n.expression),this.interpolationType=d};function Xa(t,n){if((t=Ga(t,n)).result==="error")return t;var a=t.value.expression,d=ra(a);if(!d&&!ua(n))return Ko([new ne("","data expressions not supported")]);var _=Wi(a,["zoom"]);if(!_&&!Na(n))return Ko([new ne("","zoom expressions not supported")]);var i=function e(r){var s=null;if(r instanceof Aa)s=e(r.result);else if(r instanceof ka)for(var p=0,m=r.args;p<m.length&&!(s=e(m[p]));p+=1);else(r instanceof Ao||r instanceof Sn)&&r.input instanceof Zr&&r.input.name==="zoom"&&(s=r);return s instanceof ne||r.eachChild(function(g){var I=e(g);I instanceof ne?s=I:!s&&I?s=new ne("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&I&&s!==I&&(s=new ne("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}(a);return i||_?i instanceof ne?Ko([i]):i instanceof Sn&&!Ws(n)?Ko([new ne("",'"interpolate" expressions cannot be used with this property')]):ms(i?new $a(d?"camera":"composite",t.value,i.labels,i instanceof Sn?i.interpolation:void 0):new Da(d?"constant":"source",t.value)):Ko([new ne("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}$a.prototype.evaluateWithoutErrorHandling=function(t,n,a,d,_,i){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,d,_,i)},$a.prototype.evaluate=function(t,n,a,d,_,i){return this._styleExpression.evaluate(t,n,a,d,_,i)},$a.prototype.interpolationFactor=function(t,n,a){return this.interpolationType?Sn.interpolationFactor(this.interpolationType,t,n,a):0};var Wa=function(t,n){this._parameters=t,this._specification=n,V(this,function a(d,_){var i,e,r,s=_.type==="color",p=d.stops&&typeof d.stops[0][0]=="object",m=p||!(p||d.property!==void 0),g=d.type||(Ws(_)?"exponential":"interval");if(s&&((d=V({},d)).stops&&(d.stops=d.stops.map(function(qe){return[qe[0],ri.parse(qe[1])]})),d.default=ri.parse(d.default?d.default:_.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!Su[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(g==="exponential")i=Jo;else if(g==="interval")i=Eu;else if(g==="categorical"){i=Iu,e=Object.create(null);for(var I=0,E=d.stops;I<E.length;I+=1){var M=E[I];e[M[0]]=M[1]}r=typeof d.stops[0][0]}else{if(g!=="identity")throw new Error('Unknown function type "'+g+'"');i=Hs}if(p){for(var L={},F=[],O=0;O<d.stops.length;O++){var Z=d.stops[O],$=Z[0].zoom;L[$]===void 0&&(L[$]={zoom:$,type:d.type,property:d.property,default:d.default,stops:[]},F.push($)),L[$].stops.push([Z[0].value,Z[1]])}for(var te=[],ie=0,ve=F;ie<ve.length;ie+=1){var Pe=ve[ie];te.push([L[Pe].zoom,a(L[Pe],_)])}var Me={name:"linear"};return{kind:"composite",interpolationType:Me,interpolationFactor:Sn.interpolationFactor.bind(void 0,Me),zoomStops:te.map(function(qe){return qe[0]}),evaluate:function(qe,Ge){var Qe=qe.zoom;return Jo({stops:te,base:d.base},_,Qe).evaluate(Qe,Ge)}}}if(m){var Ue=g==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:Ue,interpolationFactor:Sn.interpolationFactor.bind(void 0,Ue),zoomStops:d.stops.map(function(qe){return qe[0]}),evaluate:function(qe){return i(d,_,qe.zoom,e,r)}}}return{kind:"source",evaluate:function(qe,Ge){var Qe=Ge&&Ge.properties?Ge.properties[d.property]:void 0;return Qe===void 0?Za(d.default,_.default):i(d,_,Qe,e,r)}}}(this._parameters,this._specification))};function ao(t){var n=t.key,a=t.value,d=t.valueSpec||{},_=t.objectElementValidators||{},i=t.style,e=t.styleSpec,r=[],s=nr(a);if(s!=="object")return[new ke(n,a,"object expected, "+s+" found")];for(var p in a){var m=p.split(".")[0],g=d[m]||d["*"],I=void 0;if(_[m])I=_[m];else if(d[m])I=Ri;else if(_["*"])I=_["*"];else{if(!d["*"]){r.push(new ke(n,a[p],'unknown property "'+p+'"'));continue}I=Ri}r=r.concat(I({key:(n&&n+".")+p,value:a[p],valueSpec:g,style:i,styleSpec:e,object:a,objectKey:p},a))}for(var E in d)_[E]||d[E].required&&d[E].default===void 0&&a[E]===void 0&&r.push(new ke(n,a,'missing required property "'+E+'"'));return r}function Js(t){var n=t.value,a=t.valueSpec,d=t.style,_=t.styleSpec,i=t.key,e=t.arrayElementValidator||Ri;if(nr(n)!=="array")return[new ke(i,n,"array expected, "+nr(n)+" found")];if(a.length&&n.length!==a.length)return[new ke(i,n,"array length "+a.length+" expected, length "+n.length+" found")];if(a["min-length"]&&n.length<a["min-length"])return[new ke(i,n,"array length at least "+a["min-length"]+" expected, length "+n.length+" found")];var r={type:a.value,values:a.values};_.$version<7&&(r.function=a.function),nr(a.value)==="object"&&(r=a.value);for(var s=[],p=0;p<n.length;p++)s=s.concat(e({array:n,arrayIndex:p,value:n[p],valueSpec:r,style:d,styleSpec:_,key:i+"["+p+"]"}));return s}function Ha(t){var n=t.key,a=t.value,d=t.valueSpec,_=nr(a);return _==="number"&&a!=a&&(_="NaN"),_!=="number"?[new ke(n,a,"number expected, "+_+" found")]:"minimum"in d&&a<d.minimum?[new ke(n,a,a+" is less than the minimum value "+d.minimum)]:"maximum"in d&&a>d.maximum?[new ke(n,a,a+" is greater than the maximum value "+d.maximum)]:[]}function Ka(t){var n,a,d,_=t.valueSpec,i=j(t.value.type),e={},r=i!=="categorical"&&t.value.property===void 0,s=!r,p=nr(t.value.stops)==="array"&&nr(t.value.stops[0])==="array"&&nr(t.value.stops[0][0])==="object",m=ao({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(E){if(i==="identity")return[new ke(E.key,E.value,'identity function may not have a "stops" property')];var M=[],L=E.value;return M=M.concat(Js({key:E.key,value:L,valueSpec:E.valueSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:g})),nr(L)==="array"&&L.length===0&&M.push(new ke(E.key,L,"array must have at least one stop")),M},default:function(E){return Ri({key:E.key,value:E.value,valueSpec:_,style:E.style,styleSpec:E.styleSpec})}}});return i==="identity"&&r&&m.push(new ke(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||m.push(new ke(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!Ws(t.valueSpec)&&m.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(s&&!ua(t.valueSpec)?m.push(new ke(t.key,t.value,"property functions not supported")):r&&!Na(t.valueSpec)&&m.push(new ke(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!p||t.value.property!==void 0||m.push(new ke(t.key,t.value,'"property" property is required')),m;function g(E){var M=[],L=E.value,F=E.key;if(nr(L)!=="array")return[new ke(F,L,"array expected, "+nr(L)+" found")];if(L.length!==2)return[new ke(F,L,"array length 2 expected, length "+L.length+" found")];if(p){if(nr(L[0])!=="object")return[new ke(F,L,"object expected, "+nr(L[0])+" found")];if(L[0].zoom===void 0)return[new ke(F,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new ke(F,L,"object stop key must have value")];if(d&&d>j(L[0].zoom))return[new ke(F,L[0].zoom,"stop zoom values must appear in ascending order")];j(L[0].zoom)!==d&&(d=j(L[0].zoom),a=void 0,e={}),M=M.concat(ao({key:F+"[0]",value:L[0],valueSpec:{zoom:{}},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{zoom:Ha,value:I}}))}else M=M.concat(I({key:F+"[0]",value:L[0],valueSpec:{},style:E.style,styleSpec:E.styleSpec},L));return Ks(J(L[1]))?M.concat([new ke(F+"[1]",L[1],"expressions are not allowed in function stops.")]):M.concat(Ri({key:F+"[1]",value:L[1],valueSpec:_,style:E.style,styleSpec:E.styleSpec}))}function I(E,M){var L=nr(E.value),F=j(E.value),O=E.value!==null?E.value:M;if(n){if(L!==n)return[new ke(E.key,O,L+" stop domain type must match previous stop domain type "+n)]}else n=L;if(L!=="number"&&L!=="string"&&L!=="boolean")return[new ke(E.key,O,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&i!=="categorical"){var Z="number expected, "+L+" found";return ua(_)&&i===void 0&&(Z+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(E.key,O,Z)]}return i!=="categorical"||L!=="number"||isFinite(F)&&Math.floor(F)===F?i!=="categorical"&&L==="number"&&a!==void 0&&F<a?[new ke(E.key,O,"stop domain values must appear in ascending order")]:(a=F,i==="categorical"&&F in e?[new ke(E.key,O,"stop domain values must be unique")]:(e[F]=!0,[])):[new ke(E.key,O,"integer expected, found "+F)]}}function La(t){var n=(t.expressionContext==="property"?Xa:Ga)(J(t.value),t.valueSpec);if(n.result==="error")return n.value.map(function(d){return new ke(""+t.key+d.key,t.value,d.message)});var a=n.value.expression||n.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!a.outputDefined())return[new ke(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!na(a))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!na(a))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Wi(a,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!ra(a))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ca(t){var n=t.key,a=t.value,d=t.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(j(a))===-1&&_.push(new ke(n,a,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(a)+" found")):Object.keys(d.values).indexOf(j(a))===-1&&_.push(new ke(n,a,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(a)+" found")),_}function ys(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var n=0,a=t.slice(1);n<a.length;n+=1){var d=a[n];if(!ys(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}Wa.deserialize=function(t){return new Wa(t._parameters,t._specification)},Wa.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ku={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ys(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};ys(t)||(t=Qs(t));var n=Ga(t,ku);if(n.result==="error")throw new Error(n.value.map(function(a){return a.key+": "+a.message}).join(", "));return{filter:function(a,d,_){return n.value.evaluate(a,d,{},_)},needGeometry:function a(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var _=1;_<d.length;_++)if(a(d[_]))return!0;return!1}(t)}}function gs(t,n){return t<n?-1:t>n?1:0}function Qs(t){if(!t)return!0;var n,a=t[0];return t.length<=1?a!=="any":a==="=="?Ja(t[1],t[2],"=="):a==="!="?Rn(Ja(t[1],t[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Ja(t[1],t[2],a):a==="any"?(n=t.slice(1),["any"].concat(n.map(Qs))):a==="all"?["all"].concat(t.slice(1).map(Qs)):a==="none"?["all"].concat(t.slice(1).map(Qs).map(Rn)):a==="in"?_s(t[1],t.slice(2)):a==="!in"?Rn(_s(t[1],t.slice(2))):a==="has"?so(t[1]):a==="!has"?Rn(so(t[1])):a!=="within"||t}function Ja(t,n,a){switch(t){case"$type":return["filter-type-"+a,n];case"$id":return["filter-id-"+a,n];default:return["filter-"+a,t,n]}}function _s(t,n){if(n.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(function(a){return typeof a!=typeof n[0]})?["filter-in-large",t,["literal",n.sort(gs)]]:["filter-in-small",t,["literal",n]]}}function so(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Rn(t){return["!",t]}function Il(t){return ys(J(t.value))?La(V({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function n(a){var d=a.value,_=a.key;if(nr(d)!=="array")return[new ke(_,d,"array expected, "+nr(d)+" found")];var i,e=a.styleSpec,r=[];if(d.length<1)return[new ke(_,d,"filter array must have at least 1 element")];switch(r=r.concat(ca({key:_+"[0]",value:d[0],valueSpec:e.filter_operator,style:a.style,styleSpec:a.styleSpec})),j(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&j(d[1])==="$type"&&r.push(new ke(_,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&r.push(new ke(_,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(i=nr(d[1]))!=="string"&&r.push(new ke(_+"[1]",d[1],"string expected, "+i+" found"));for(var s=2;s<d.length;s++)i=nr(d[s]),j(d[1])==="$type"?r=r.concat(ca({key:_+"["+s+"]",value:d[s],valueSpec:e.geometry_type,style:a.style,styleSpec:a.styleSpec})):i!=="string"&&i!=="number"&&i!=="boolean"&&r.push(new ke(_+"["+s+"]",d[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var p=1;p<d.length;p++)r=r.concat(n({key:_+"["+p+"]",value:d[p],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":i=nr(d[1]),d.length!==2?r.push(new ke(_,d,'filter array for "'+d[0]+'" operator must have 2 elements')):i!=="string"&&r.push(new ke(_+"[1]",d[1],"string expected, "+i+" found"));break;case"within":i=nr(d[1]),d.length!==2?r.push(new ke(_,d,'filter array for "'+d[0]+'" operator must have 2 elements')):i!=="object"&&r.push(new ke(_+"[1]",d[1],"object expected, "+i+" found"))}return r}(t)}function ha(t,n){var a=t.key,d=t.style,_=t.styleSpec,i=t.value,e=t.objectKey,r=_[n+"_"+t.layerType];if(!r)return[];var s=e.match(/^(.*)-transition$/);if(n==="paint"&&s&&r[s[1]]&&r[s[1]].transition)return Ri({key:a,value:i,valueSpec:_.transition,style:d,styleSpec:_});var p,m=t.valueSpec||r[e];if(!m)return[new ke(a,i,'unknown property "'+e+'"')];if(nr(i)==="string"&&ua(m)&&!m.tokens&&(p=/^{([^}]+)}$/.exec(i)))return[new ke(a,i,'"'+e+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(p[1])+" }`.")];var g=[];return t.layerType==="symbol"&&(e==="text-field"&&d&&!d.glyphs&&g.push(new ke(a,i,'use of "text-field" requires a style "glyphs" property')),e==="text-font"&&qa(J(i))&&j(i.type)==="identity"&&g.push(new ke(a,i,'"text-font" does not support identity functions'))),g.concat(Ri({key:t.key,value:i,valueSpec:m,style:d,styleSpec:_,expressionContext:"property",propertyType:n,propertyKey:e}))}function vs(t){return ha(t,"paint")}function Ya(t){return ha(t,"layout")}function pa(t){var n=[],a=t.value,d=t.key,_=t.style,i=t.styleSpec;a.type||a.ref||n.push(new ke(d,a,'either "type" or "ref" is required'));var e,r=j(a.type),s=j(a.ref);if(a.id)for(var p=j(a.id),m=0;m<t.arrayIndex;m++){var g=_.layers[m];j(g.id)===p&&n.push(new ke(d,a.id,'duplicate layer id "'+a.id+'", previously used at line '+g.id.__line__))}if("ref"in a)["type","source","source-layer","filter","layout"].forEach(function(M){M in a&&n.push(new ke(d,a[M],'"'+M+'" is prohibited for ref layers'))}),_.layers.forEach(function(M){j(M.id)===s&&(e=M)}),e?e.ref?n.push(new ke(d,a.ref,"ref cannot reference another ref layer")):r=j(e.type):n.push(new ke(d,a.ref,'ref layer "'+s+'" not found'));else if(r!=="background")if(a.source){var I=_.sources&&_.sources[a.source],E=I&&j(I.type);I?E==="vector"&&r==="raster"?n.push(new ke(d,a.source,'layer "'+a.id+'" requires a raster source')):E==="raster"&&r!=="raster"?n.push(new ke(d,a.source,'layer "'+a.id+'" requires a vector source')):E!=="vector"||a["source-layer"]?E==="raster-dem"&&r!=="hillshade"?n.push(new ke(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):r!=="line"||!a.paint||!a.paint["line-gradient"]||E==="geojson"&&I.lineMetrics||n.push(new ke(d,a,'layer "'+a.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):n.push(new ke(d,a,'layer "'+a.id+'" must specify a "source-layer"')):n.push(new ke(d,a.source,'source "'+a.source+'" not found'))}else n.push(new ke(d,a,'missing required property "source"'));return n=n.concat(ao({key:d,value:a,valueSpec:i.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ri({key:d+".type",value:a.type,valueSpec:i.layer.type,style:t.style,styleSpec:t.styleSpec,object:a,objectKey:"type"})},filter:Il,layout:function(M){return ao({layer:a,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":function(L){return Ya(V({layerType:r},L))}}})},paint:function(M){return ao({layer:a,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":function(L){return vs(V({layerType:r},L))}}})}}}))}function fr(t){var n=t.value,a=t.key,d=nr(n);return d!=="string"?[new ke(a,n,"string expected, "+d+" found")]:[]}var xs={promoteId:function(t){var n=t.key,a=t.value;if(nr(a)==="string")return fr({key:n,value:a});var d=[];for(var _ in a)d.push.apply(d,fr({key:n+"."+_,value:a[_]}));return d}};function Qa(t){var n=t.value,a=t.key,d=t.styleSpec,_=t.style;if(!n.type)return[new ke(a,n,'"type" is required')];var i,e=j(n.type);switch(e){case"vector":case"raster":case"raster-dem":return ao({key:a,value:n,valueSpec:d["source_"+e.replace("-","_")],style:t.style,styleSpec:d,objectElementValidators:xs});case"geojson":if(i=ao({key:a,value:n,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:xs}),n.cluster)for(var r in n.clusterProperties){var s=n.clusterProperties[r],p=s[0],m=typeof p=="string"?[p,["accumulated"],["get",r]]:p;i.push.apply(i,La({key:a+"."+r+".map",value:s[1],expressionContext:"cluster-map"})),i.push.apply(i,La({key:a+"."+r+".reduce",value:m,expressionContext:"cluster-reduce"}))}return i;case"video":return ao({key:a,value:n,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return ao({key:a,value:n,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new ke(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ca({key:a+".type",value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:d})}}function da(t){var n=t.value,a=t.styleSpec,d=a.light,_=t.style,i=[],e=nr(n);if(n===void 0)return i;if(e!=="object")return i.concat([new ke("light",n,"object expected, "+e+" found")]);for(var r in n){var s=r.match(/^(.*)-transition$/);i=i.concat(s&&d[s[1]]&&d[s[1]].transition?Ri({key:r,value:n[r],valueSpec:a.transition,style:_,styleSpec:a}):d[r]?Ri({key:r,value:n[r],valueSpec:d[r],style:_,styleSpec:a}):[new ke(r,n[r],'unknown property "'+r+'"')])}return i}var Gi={"*":function(){return[]},array:Js,boolean:function(t){var n=t.value,a=t.key,d=nr(n);return d!=="boolean"?[new ke(a,n,"boolean expected, "+d+" found")]:[]},number:Ha,color:function(t){var n=t.key,a=t.value,d=nr(a);return d!=="string"?[new ke(n,a,"color expected, "+d+" found")]:Rr(a)===null?[new ke(n,a,'color expected, "'+a+'" found')]:[]},constants:ee,enum:ca,filter:Il,function:Ka,layer:pa,object:ao,source:Qa,light:da,string:fr,formatted:function(t){return fr(t).length===0?[]:La(t)},resolvedImage:function(t){return fr(t).length===0?[]:La(t)}};function Ri(t){var n=t.value,a=t.valueSpec,d=t.styleSpec;return a.expression&&qa(j(n))?Ka(t):a.expression&&Ks(J(n))?La(t):a.type&&Gi[a.type]?Gi[a.type](t):ao(V({},t,{valueSpec:a.type?d[a.type]:a}))}function Ut(t){var n=t.value,a=t.key,d=fr(t);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new ke(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new ke(a,n,'"glyphs" url must include a "{range}" token'))),d}function Po(t,n){n===void 0&&(n=ye);var a=[];return a=a.concat(Ri({key:"",value:t,valueSpec:n.$root,styleSpec:n,style:t,objectElementValidators:{glyphs:Ut,"*":function(){return[]}}})),t.constants&&(a=a.concat(ee({key:"constants",value:t.constants,style:t,styleSpec:n}))),bs(a)}function bs(t){return[].concat(t).sort(function(n,a){return n.line-a.line})}function Mo(t){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];return bs(t.apply(this,n))}}Po.source=Mo(Qa),Po.light=Mo(da),Po.layer=Mo(pa),Po.filter=Mo(Il),Po.paintProperty=Mo(vs),Po.layoutProperty=Mo(Ya);var fa=Po,Ft=fa.light,es=fa.paintProperty,el=fa.layoutProperty;function tl(t,n){var a=!1;if(n&&n.length)for(var d=0,_=n;d<_.length;d+=1)t.fire(new Fe(new Error(_[d].message))),a=!0;return a}var nn=lo;function lo(t,n,a){var d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(a=_[2]);for(var i=0;i<this.d*this.d;i++){var e=_[3+i],r=_[3+i+1];d.push(e===r?null:_.subarray(e,r))}var s=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],s),this.bboxes=_.subarray(s),this.insert=this._insertReadonly}else{this.d=n+2*a;for(var p=0;p<this.d*this.d;p++)d.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=a,this.scale=n/t,this.uid=0;var m=a/n*t;this.min=-m,this.max=t+m}lo.prototype.insert=function(t,n,a,d,_){this._forEachCell(n,a,d,_,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_)},lo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},lo.prototype._insertCell=function(t,n,a,d,_,i){this.cells[_].push(i)},lo.prototype.query=function(t,n,a,d,_){var i=this.min,e=this.max;if(t<=i&&n<=i&&e<=a&&e<=d&&!_)return Array.prototype.slice.call(this.keys);var r=[];return this._forEachCell(t,n,a,d,this._queryCell,r,{},_),r},lo.prototype._queryCell=function(t,n,a,d,_,i,e,r){var s=this.cells[_];if(s!==null)for(var p=this.keys,m=this.bboxes,g=0;g<s.length;g++){var I=s[g];if(e[I]===void 0){var E=4*I;(r?r(m[E+0],m[E+1],m[E+2],m[E+3]):t<=m[E+2]&&n<=m[E+3]&&a>=m[E+0]&&d>=m[E+1])?(e[I]=!0,i.push(p[I])):e[I]=!1}}},lo.prototype._forEachCell=function(t,n,a,d,_,i,e,r){for(var s=this._convertToCellCoord(t),p=this._convertToCellCoord(n),m=this._convertToCellCoord(a),g=this._convertToCellCoord(d),I=s;I<=m;I++)for(var E=p;E<=g;E++){var M=this.d*E+I;if((!r||r(this._convertFromCellCoord(I),this._convertFromCellCoord(E),this._convertFromCellCoord(I+1),this._convertFromCellCoord(E+1)))&&_.call(this,t,n,a,d,M,i,e,r))return}},lo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},lo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},lo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,n=3+this.cells.length+1+1,a=0,d=0;d<this.cells.length;d++)a+=this.cells[d].length;var _=new Int32Array(n+a+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var i=n,e=0;e<t.length;e++){var r=t[e];_[3+e]=i,_.set(r,i),i+=r.length}return _[3+t.length]=i,_.set(this.keys,i),_[3+t.length+1]=i+=this.keys.length,_.set(this.bboxes,i),i+=this.bboxes.length,_.buffer};var Kl=xe.ImageData,gn=xe.ImageBitmap,uo={};function Dt(t,n,a){a===void 0&&(a={}),Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),uo[t]={klass:n,omit:a.omit||[],shallow:a.shallow||[]}}for(var ts in Dt("Object",Object),nn.serialize=function(t,n){var a=t.toArrayBuffer();return n&&n.push(a),{buffer:a}},nn.deserialize=function(t){return new nn(t.buffer)},Dt("Grid",nn),Dt("Color",ri),Dt("Error",Error),Dt("ResolvedImage",Mn),Dt("StylePropertyFunction",Wa),Dt("StyleExpression",Ma,{omit:["_evaluator"]}),Dt("ZoomDependentExpression",$a),Dt("ZoomConstantExpression",Da),Dt("CompoundExpression",Zr,{omit:["_evaluate"]}),Cr)Cr[ts]._classRegistryKey||Dt("Expression_"+ts,Cr[ts]);function Ra(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Yo(t){return gn&&t instanceof gn}function Pr(t,n){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ra(t)||Yo(t))return n&&n.push(t),t;if(ArrayBuffer.isView(t)){var a=t;return n&&n.push(a.buffer),a}if(t instanceof Kl)return n&&n.push(t.data.buffer),t;if(Array.isArray(t)){for(var d=[],_=0,i=t;_<i.length;_+=1)d.push(Pr(i[_],n));return d}if(typeof t=="object"){var e=t.constructor,r=e._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");var s=e.serialize?e.serialize(t,n):{};if(!e.serialize){for(var p in t)if(t.hasOwnProperty(p)&&!(uo[r].omit.indexOf(p)>=0)){var m=t[p];s[p]=uo[r].shallow.indexOf(p)>=0?m:Pr(m,n)}t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(s.$name=r),s}throw new Error("can't serialize object of type "+typeof t)}function Do(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ra(t)||Yo(t)||ArrayBuffer.isView(t)||t instanceof Kl)return t;if(Array.isArray(t))return t.map(Do);if(typeof t=="object"){var n=t.$name||"Object",a=uo[n].klass;if(!a)throw new Error("can't deserialize unregistered class "+n);if(a.deserialize)return a.deserialize(t);for(var d=Object.create(a.prototype),_=0,i=Object.keys(t);_<i.length;_+=1){var e=i[_];if(e!=="$name"){var r=t[e];d[e]=uo[n].shallow.indexOf(e)>=0?r:Do(r)}}return d}throw new Error("can't deserialize object of type "+typeof t)}var qn=function(){this.first=!0};qn.prototype.update=function(t,n){var a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))};var Bt={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ma(t){for(var n=0,a=t;n<a.length;n+=1)if(ws(a[n].charCodeAt(0)))return!0;return!1}function ws(t){return!(t!==746&&t!==747&&(t<4352||!(Bt["Bopomofo Extended"](t)||Bt.Bopomofo(t)||Bt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Bt["CJK Compatibility Ideographs"](t)||Bt["CJK Compatibility"](t)||Bt["CJK Radicals Supplement"](t)||Bt["CJK Strokes"](t)||!(!Bt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Bt["CJK Unified Ideographs Extension A"](t)||Bt["CJK Unified Ideographs"](t)||Bt["Enclosed CJK Letters and Months"](t)||Bt["Hangul Compatibility Jamo"](t)||Bt["Hangul Jamo Extended-A"](t)||Bt["Hangul Jamo Extended-B"](t)||Bt["Hangul Jamo"](t)||Bt["Hangul Syllables"](t)||Bt.Hiragana(t)||Bt["Ideographic Description Characters"](t)||Bt.Kanbun(t)||Bt["Kangxi Radicals"](t)||Bt["Katakana Phonetic Extensions"](t)||Bt.Katakana(t)&&t!==12540||!(!Bt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Bt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Bt["Unified Canadian Aboriginal Syllabics"](t)||Bt["Unified Canadian Aboriginal Syllabics Extended"](t)||Bt["Vertical Forms"](t)||Bt["Yijing Hexagram Symbols"](t)||Bt["Yi Syllables"](t)||Bt["Yi Radicals"](t))))}function Yn(t){return!(ws(t)||function(n){return!!(Bt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Bt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Bt["Letterlike Symbols"](n)||Bt["Number Forms"](n)||Bt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Bt["Control Pictures"](n)&&n!==9251||Bt["Optical Character Recognition"](n)||Bt["Enclosed Alphanumerics"](n)||Bt["Geometric Shapes"](n)||Bt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Bt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Bt["CJK Symbols and Punctuation"](n)||Bt.Katakana(n)||Bt["Private Use Area"](n)||Bt["CJK Compatibility Forms"](n)||Bt["Small Form Variants"](n)||Bt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(t))}function Br(t){return t>=1424&&t<=2303||Bt["Arabic Presentation Forms-A"](t)||Bt["Arabic Presentation Forms-B"](t)}function kr(t,n){return!(!n&&Br(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Bt.Khmer(t))}function il(t){for(var n=0,a=t;n<a.length;n+=1)if(Br(a[n].charCodeAt(0)))return!0;return!1}var Ts=null,Bn="unavailable",ya=null,rl=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Bn="error"),Ts&&Ts(t)};function Jl(){Lo.fire(new De("pluginStateChange",{pluginStatus:Bn,pluginURL:ya}))}var Lo=new Le,co=function(){return Bn},Qt=function(){if(Bn!=="deferred"||!ya)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bn="loading",Jl(),ya&&ar({url:ya},function(t){t?rl(t):(Bn="loaded",Jl())})},Ot={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bn==="loaded"||Ot.applyArabicShaping!=null},isLoading:function(){return Bn==="loading"},setState:function(t){Bn=t.pluginStatus,ya=t.pluginURL},isParsed:function(){return Ot.applyArabicShaping!=null&&Ot.processBidirectionalText!=null&&Ot.processStyledBidirectionalText!=null},getPluginURL:function(){return ya}},$i=function(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qn,this.transition={})};$i.prototype.isSupportedScript=function(t){return function(n,a){for(var d=0,_=n;d<_.length;d+=1)if(!kr(_[d].charCodeAt(0),a))return!1;return!0}(t,Ot.isLoaded())},$i.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},$i.prototype.getCrossfadeParameters=function(){var t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}};var Zn=function(t,n){this.property=t,this.value=n,this.expression=function(a,d){if(qa(a))return new Wa(a,d);if(Ks(a)){var _=Xa(a,d);if(_.result==="error")throw new Error(_.value.map(function(e){return e.key+": "+e.message}).join(", "));return _.value}var i=a;return typeof a=="string"&&d.type==="color"&&(i=ri.parse(a)),{kind:"constant",evaluate:function(){return i}}}(n===void 0?t.specification.default:n,t.specification)};Zn.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Zn.prototype.possiblyEvaluate=function(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)};var Gn=function(t){this.property=t,this.value=new Zn(t,void 0)};Gn.prototype.transitioned=function(t,n){return new _o(this.property,this.value,n,wt({},t.transition,this.transition),t.now)},Gn.prototype.untransitioned=function(){return new _o(this.property,this.value,null,{},0)};var mr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};mr.prototype.getValue=function(t){return Xr(this._values[t].value.value)},mr.prototype.setValue=function(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new Gn(this._values[t].property)),this._values[t].value=new Zn(this._values[t].property,n===null?void 0:Xr(n))},mr.prototype.getTransition=function(t){return Xr(this._values[t].transition)},mr.prototype.setTransition=function(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new Gn(this._values[t].property)),this._values[t].transition=Xr(n)||void 0},mr.prototype.serialize=function(){for(var t={},n=0,a=Object.keys(this._values);n<a.length;n+=1){var d=a[n],_=this.getValue(d);_!==void 0&&(t[d]=_);var i=this.getTransition(d);i!==void 0&&(t[d+"-transition"]=i)}return t},mr.prototype.transitioned=function(t,n){for(var a=new Gr(this._properties),d=0,_=Object.keys(this._values);d<_.length;d+=1){var i=_[d];a._values[i]=this._values[i].transitioned(t,n._values[i])}return a},mr.prototype.untransitioned=function(){for(var t=new Gr(this._properties),n=0,a=Object.keys(this._values);n<a.length;n+=1){var d=a[n];t._values[d]=this._values[d].untransitioned()}return t};var _o=function(t,n,a,d,_){this.property=t,this.value=n,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=a)};_o.prototype.possiblyEvaluate=function(t,n,a){var d=t.now||0,_=this.value.possiblyEvaluate(t,n,a),i=this.prior;if(i){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return i.possiblyEvaluate(t,n,a);var e=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(t,n,a),_,function(r){if(r<=0)return 0;if(r>=1)return 1;var s=r*r,p=s*r;return 4*(r<.5?p:3*(r-s)+p-.75)}(e))}return _};var Gr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Gr.prototype.possiblyEvaluate=function(t,n,a){for(var d=new cr(this._properties),_=0,i=Object.keys(this._values);_<i.length;_+=1){var e=i[_];d._values[e]=this._values[e].possiblyEvaluate(t,n,a)}return d},Gr.prototype.hasTransition=function(){for(var t=0,n=Object.keys(this._values);t<n.length;t+=1)if(this._values[n[t]].prior)return!0;return!1};var Ba=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ba.prototype.getValue=function(t){return Xr(this._values[t].value)},Ba.prototype.setValue=function(t,n){this._values[t]=new Zn(this._values[t].property,n===null?void 0:Xr(n))},Ba.prototype.serialize=function(){for(var t={},n=0,a=Object.keys(this._values);n<a.length;n+=1){var d=a[n],_=this.getValue(d);_!==void 0&&(t[d]=_)}return t},Ba.prototype.possiblyEvaluate=function(t,n,a){for(var d=new cr(this._properties),_=0,i=Object.keys(this._values);_<i.length;_+=1){var e=i[_];d._values[e]=this._values[e].possiblyEvaluate(t,n,a)}return d};var Fn=function(t,n,a){this.property=t,this.value=n,this.parameters=a};Fn.prototype.isConstant=function(){return this.value.kind==="constant"},Fn.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},Fn.prototype.evaluate=function(t,n,a,d){return this.property.evaluate(this.value,this.parameters,t,n,a,d)};var cr=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};cr.prototype.get=function(t){return this._values[t]};var gt=function(t){this.specification=t};gt.prototype.possiblyEvaluate=function(t,n){return t.expression.evaluate(n)},gt.prototype.interpolate=function(t,n,a){var d=ds[this.specification.type];return d?d(t,n,a):t};var ui=function(t,n){this.specification=t,this.overrides=n};ui.prototype.possiblyEvaluate=function(t,n,a,d){return new Fn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},a,d)}:t.expression,n)},ui.prototype.interpolate=function(t,n,a){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Fn(this,{kind:"constant",value:void 0},t.parameters);var d=ds[this.specification.type];return d?new Fn(this,{kind:"constant",value:d(t.value.value,n.value.value,a)},t.parameters):t},ui.prototype.evaluate=function(t,n,a,d,_,i){return t.kind==="constant"?t.value:t.evaluate(n,a,d,_,i)};var _n=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.possiblyEvaluate=function(a,d,_,i){if(a.value===void 0)return new Fn(this,{kind:"constant",value:void 0},d);if(a.expression.kind==="constant"){var e=a.expression.evaluate(d,null,{},_,i),r=a.property.specification.type==="resolvedImage"&&typeof e!="string"?e.name:e,s=this._calculate(r,r,r,d);return new Fn(this,{kind:"constant",value:s},d)}if(a.expression.kind==="camera"){var p=this._calculate(a.expression.evaluate({zoom:d.zoom-1}),a.expression.evaluate({zoom:d.zoom}),a.expression.evaluate({zoom:d.zoom+1}),d);return new Fn(this,{kind:"constant",value:p},d)}return new Fn(this,a.expression,d)},n.prototype.evaluate=function(a,d,_,i,e,r){if(a.kind==="source"){var s=a.evaluate(d,_,i,e,r);return this._calculate(s,s,s,d)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(d.zoom)-1},_,i),a.evaluate({zoom:Math.floor(d.zoom)},_,i),a.evaluate({zoom:Math.floor(d.zoom)+1},_,i),d):a.value},n.prototype._calculate=function(a,d,_,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:a,to:d}:{from:_,to:d}},n.prototype.interpolate=function(a){return a},n}(ui),$n=function(t){this.specification=t};$n.prototype.possiblyEvaluate=function(t,n,a,d){if(t.value!==void 0){if(t.expression.kind==="constant"){var _=t.expression.evaluate(n,null,{},a,d);return this._calculate(_,_,_,n)}return this._calculate(t.expression.evaluate(new $i(Math.floor(n.zoom-1),n)),t.expression.evaluate(new $i(Math.floor(n.zoom),n)),t.expression.evaluate(new $i(Math.floor(n.zoom+1),n)),n)}},$n.prototype._calculate=function(t,n,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}},$n.prototype.interpolate=function(t){return t};var b=function(t){this.specification=t};b.prototype.possiblyEvaluate=function(t,n,a,d){return!!t.expression.evaluate(n,null,{},a,d)},b.prototype.interpolate=function(){return!1};var o=function(t){for(var n in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var a=t[n];a.specification.overridable&&this.overridableProperties.push(n);var d=this.defaultPropertyValues[n]=new Zn(a,void 0),_=this.defaultTransitionablePropertyValues[n]=new Gn(a);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=d.possiblyEvaluate({})}};Dt("DataDrivenProperty",ui),Dt("DataConstantProperty",gt),Dt("CrossFadedDataDrivenProperty",_n),Dt("CrossFadedProperty",$n),Dt("ColorRampProperty",b);var h=function(t){function n(a,d){if(t.call(this),this.id=a.id,this.type=a.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},a.type!=="custom"&&(this.metadata=(a=a).metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),d.layout&&(this._unevaluatedLayout=new Ba(d.layout)),d.paint)){for(var _ in this._transitionablePaint=new mr(d.paint),a.paint)this.setPaintProperty(_,a.paint[_],{validate:!1});for(var i in a.layout)this.setLayoutProperty(i,a.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cr(d.paint)}}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},n.prototype.getLayoutProperty=function(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)},n.prototype.setLayoutProperty=function(a,d,_){_===void 0&&(_={}),d!=null&&this._validate(el,"layers."+this.id+".layout."+a,a,d,_)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,d):this.visibility=d)},n.prototype.getPaintProperty=function(a){return or(a,"-transition")?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)},n.prototype.setPaintProperty=function(a,d,_){if(_===void 0&&(_={}),d!=null&&this._validate(es,"layers."+this.id+".paint."+a,a,d,_))return!1;if(or(a,"-transition"))return this._transitionablePaint.setTransition(a.slice(0,-11),d||void 0),!1;var i=this._transitionablePaint._values[a],e=i.property.specification["property-type"]==="cross-faded-data-driven",r=i.value.isDataDriven(),s=i.value;this._transitionablePaint.setValue(a,d),this._handleSpecialPaintPropertyUpdate(a);var p=this._transitionablePaint._values[a].value;return p.isDataDriven()||r||e||this._handleOverridablePaintPropertyUpdate(a,s,p)},n.prototype._handleSpecialPaintPropertyUpdate=function(a){},n.prototype._handleOverridablePaintPropertyUpdate=function(a,d,_){return!1},n.prototype.isHidden=function(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"},n.prototype.updateTransitions=function(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)},n.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},n.prototype.recalculate=function(a,d){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,d)},n.prototype.serialize=function(){var a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),sn(a,function(d,_){return!(d===void 0||_==="layout"&&!Object.keys(d).length||_==="paint"&&!Object.keys(d).length)})},n.prototype._validate=function(a,d,_,i,e){return e===void 0&&(e={}),(!e||e.validate!==!1)&&tl(this,a.call(fa,{key:d,layerType:this.type,objectKey:_,value:i,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))},n.prototype.is3D=function(){return!1},n.prototype.isTileClipped=function(){return!1},n.prototype.hasOffscreenPass=function(){return!1},n.prototype.resize=function(){},n.prototype.isStateDependent=function(){for(var a in this.paint._values){var d=this.paint.get(a);if(d instanceof Fn&&ua(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},n}(Le),x={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},S=function(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},k=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function D(t,n){n===void 0&&(n=1);var a=0,d=0;return{members:t.map(function(_){var i=x[_.type].BYTES_PER_ELEMENT,e=a=U(a,Math.max(n,i)),r=_.components||1;return d=Math.max(d,i),a+=i*r,{name:_.name,type:_.type,components:r,offset:e}}),size:U(a,Math.max(d,n)),alignment:n}}function U(t,n){return Math.ceil(t/n)*n}k.serialize=function(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},k.deserialize=function(t){var n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n},k.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},k.prototype.clear=function(){this.length=0},k.prototype.resize=function(t){this.reserve(t),this.length=t},k.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}},k.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var N=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d){var _=this.length;return this.resize(_+1),this.emplace(_,a,d)},n.prototype.emplace=function(a,d,_){var i=2*a;return this.int16[i+0]=d,this.int16[i+1]=_,a},n}(k);N.prototype.bytesPerElement=4,Dt("StructArrayLayout2i4",N);var X=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i){var e=this.length;return this.resize(e+1),this.emplace(e,a,d,_,i)},n.prototype.emplace=function(a,d,_,i,e){var r=4*a;return this.int16[r+0]=d,this.int16[r+1]=_,this.int16[r+2]=i,this.int16[r+3]=e,a},n}(k);X.prototype.bytesPerElement=8,Dt("StructArrayLayout4i8",X);var K=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r){var s=this.length;return this.resize(s+1),this.emplace(s,a,d,_,i,e,r)},n.prototype.emplace=function(a,d,_,i,e,r,s){var p=6*a;return this.int16[p+0]=d,this.int16[p+1]=_,this.int16[p+2]=i,this.int16[p+3]=e,this.int16[p+4]=r,this.int16[p+5]=s,a},n}(k);K.prototype.bytesPerElement=12,Dt("StructArrayLayout2i4i12",K);var ae=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r){var s=this.length;return this.resize(s+1),this.emplace(s,a,d,_,i,e,r)},n.prototype.emplace=function(a,d,_,i,e,r,s){var p=4*a,m=8*a;return this.int16[p+0]=d,this.int16[p+1]=_,this.uint8[m+4]=i,this.uint8[m+5]=e,this.uint8[m+6]=r,this.uint8[m+7]=s,a},n}(k);ae.prototype.bytesPerElement=8,Dt("StructArrayLayout2i4ub8",ae);var fe=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d){var _=this.length;return this.resize(_+1),this.emplace(_,a,d)},n.prototype.emplace=function(a,d,_){var i=2*a;return this.float32[i+0]=d,this.float32[i+1]=_,a},n}(k);fe.prototype.bytesPerElement=8,Dt("StructArrayLayout2f8",fe);var ze=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r,s,p,m,g){var I=this.length;return this.resize(I+1),this.emplace(I,a,d,_,i,e,r,s,p,m,g)},n.prototype.emplace=function(a,d,_,i,e,r,s,p,m,g,I){var E=10*a;return this.uint16[E+0]=d,this.uint16[E+1]=_,this.uint16[E+2]=i,this.uint16[E+3]=e,this.uint16[E+4]=r,this.uint16[E+5]=s,this.uint16[E+6]=p,this.uint16[E+7]=m,this.uint16[E+8]=g,this.uint16[E+9]=I,a},n}(k);ze.prototype.bytesPerElement=20,Dt("StructArrayLayout10ui20",ze);var me=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r,s,p,m,g,I,E){var M=this.length;return this.resize(M+1),this.emplace(M,a,d,_,i,e,r,s,p,m,g,I,E)},n.prototype.emplace=function(a,d,_,i,e,r,s,p,m,g,I,E,M){var L=12*a;return this.int16[L+0]=d,this.int16[L+1]=_,this.int16[L+2]=i,this.int16[L+3]=e,this.uint16[L+4]=r,this.uint16[L+5]=s,this.uint16[L+6]=p,this.uint16[L+7]=m,this.int16[L+8]=g,this.int16[L+9]=I,this.int16[L+10]=E,this.int16[L+11]=M,a},n}(k);me.prototype.bytesPerElement=24,Dt("StructArrayLayout4i4ui4i24",me);var Ce=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_)},n.prototype.emplace=function(a,d,_,i){var e=3*a;return this.float32[e+0]=d,this.float32[e+1]=_,this.float32[e+2]=i,a},n}(k);Ce.prototype.bytesPerElement=12,Dt("StructArrayLayout3f12",Ce);var Ne=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},n.prototype.emplace=function(a,d){return this.uint32[1*a+0]=d,a},n}(k);Ne.prototype.bytesPerElement=4,Dt("StructArrayLayout1ul4",Ne);var Ve=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r,s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,a,d,_,i,e,r,s,p,m)},n.prototype.emplace=function(a,d,_,i,e,r,s,p,m,g){var I=10*a,E=5*a;return this.int16[I+0]=d,this.int16[I+1]=_,this.int16[I+2]=i,this.int16[I+3]=e,this.int16[I+4]=r,this.int16[I+5]=s,this.uint32[E+3]=p,this.uint16[I+8]=m,this.uint16[I+9]=g,a},n}(k);Ve.prototype.bytesPerElement=20,Dt("StructArrayLayout6i1ul2ui20",Ve);var We=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r){var s=this.length;return this.resize(s+1),this.emplace(s,a,d,_,i,e,r)},n.prototype.emplace=function(a,d,_,i,e,r,s){var p=6*a;return this.int16[p+0]=d,this.int16[p+1]=_,this.int16[p+2]=i,this.int16[p+3]=e,this.int16[p+4]=r,this.int16[p+5]=s,a},n}(k);We.prototype.bytesPerElement=12,Dt("StructArrayLayout2i2i2i12",We);var Ze=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e){var r=this.length;return this.resize(r+1),this.emplace(r,a,d,_,i,e)},n.prototype.emplace=function(a,d,_,i,e,r){var s=4*a,p=8*a;return this.float32[s+0]=d,this.float32[s+1]=_,this.float32[s+2]=i,this.int16[p+6]=e,this.int16[p+7]=r,a},n}(k);Ze.prototype.bytesPerElement=16,Dt("StructArrayLayout2f1f2i16",Ze);var ut=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i){var e=this.length;return this.resize(e+1),this.emplace(e,a,d,_,i)},n.prototype.emplace=function(a,d,_,i,e){var r=12*a,s=3*a;return this.uint8[r+0]=d,this.uint8[r+1]=_,this.float32[s+1]=i,this.float32[s+2]=e,a},n}(k);ut.prototype.bytesPerElement=12,Dt("StructArrayLayout2ub2f12",ut);var it=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_)},n.prototype.emplace=function(a,d,_,i){var e=3*a;return this.uint16[e+0]=d,this.uint16[e+1]=_,this.uint16[e+2]=i,a},n}(k);it.prototype.bytesPerElement=6,Dt("StructArrayLayout3ui6",it);var rt=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r,s,p,m,g,I,E,M,L,F,O,Z){var $=this.length;return this.resize($+1),this.emplace($,a,d,_,i,e,r,s,p,m,g,I,E,M,L,F,O,Z)},n.prototype.emplace=function(a,d,_,i,e,r,s,p,m,g,I,E,M,L,F,O,Z,$){var te=24*a,ie=12*a,ve=48*a;return this.int16[te+0]=d,this.int16[te+1]=_,this.uint16[te+2]=i,this.uint16[te+3]=e,this.uint32[ie+2]=r,this.uint32[ie+3]=s,this.uint32[ie+4]=p,this.uint16[te+10]=m,this.uint16[te+11]=g,this.uint16[te+12]=I,this.float32[ie+7]=E,this.float32[ie+8]=M,this.uint8[ve+36]=L,this.uint8[ve+37]=F,this.uint8[ve+38]=O,this.uint32[ie+10]=Z,this.int16[te+22]=$,a},n}(k);rt.prototype.bytesPerElement=48,Dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rt);var ft=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i,e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt){var nt=this.length;return this.resize(nt+1),this.emplace(nt,a,d,_,i,e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt)},n.prototype.emplace=function(a,d,_,i,e,r,s,p,m,g,I,E,M,L,F,O,Z,$,te,ie,ve,Pe,Me,Ue,qe,Ge,Qe,yt,nt){var tt=34*a,at=17*a;return this.int16[tt+0]=d,this.int16[tt+1]=_,this.int16[tt+2]=i,this.int16[tt+3]=e,this.int16[tt+4]=r,this.int16[tt+5]=s,this.int16[tt+6]=p,this.int16[tt+7]=m,this.uint16[tt+8]=g,this.uint16[tt+9]=I,this.uint16[tt+10]=E,this.uint16[tt+11]=M,this.uint16[tt+12]=L,this.uint16[tt+13]=F,this.uint16[tt+14]=O,this.uint16[tt+15]=Z,this.uint16[tt+16]=$,this.uint16[tt+17]=te,this.uint16[tt+18]=ie,this.uint16[tt+19]=ve,this.uint16[tt+20]=Pe,this.uint16[tt+21]=Me,this.uint16[tt+22]=Ue,this.uint32[at+12]=qe,this.float32[at+13]=Ge,this.float32[at+14]=Qe,this.float32[at+15]=yt,this.float32[at+16]=nt,a},n}(k);ft.prototype.bytesPerElement=68,Dt("StructArrayLayout8i15ui1ul4f68",ft);var _t=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},n.prototype.emplace=function(a,d){return this.float32[1*a+0]=d,a},n}(k);_t.prototype.bytesPerElement=4,Dt("StructArrayLayout1f4",_t);var lt=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_)},n.prototype.emplace=function(a,d,_,i){var e=3*a;return this.int16[e+0]=d,this.int16[e+1]=_,this.int16[e+2]=i,a},n}(k);lt.prototype.bytesPerElement=6,Dt("StructArrayLayout3i6",lt);var Gt=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_)},n.prototype.emplace=function(a,d,_,i){var e=4*a;return this.uint32[2*a+0]=d,this.uint16[e+2]=_,this.uint16[e+3]=i,a},n}(k);Gt.prototype.bytesPerElement=8,Dt("StructArrayLayout1ul2ui8",Gt);var Lt=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d){var _=this.length;return this.resize(_+1),this.emplace(_,a,d)},n.prototype.emplace=function(a,d,_){var i=2*a;return this.uint16[i+0]=d,this.uint16[i+1]=_,a},n}(k);Lt.prototype.bytesPerElement=4,Dt("StructArrayLayout2ui4",Lt);var yi=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},n.prototype.emplace=function(a,d){return this.uint16[1*a+0]=d,a},n}(k);yi.prototype.bytesPerElement=2,Dt("StructArrayLayout1ui2",yi);var l=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},n.prototype.emplaceBack=function(a,d,_,i){var e=this.length;return this.resize(e+1),this.emplace(e,a,d,_,i)},n.prototype.emplace=function(a,d,_,i,e){var r=4*a;return this.float32[r+0]=d,this.float32[r+1]=_,this.float32[r+2]=i,this.float32[r+3]=e,a},n}(k);l.prototype.bytesPerElement=16,Dt("StructArrayLayout4f16",l);var c=function(t){function n(){t.apply(this,arguments)}t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n;var a={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return a.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},a.x1.get=function(){return this._structArray.int16[this._pos2+2]},a.y1.get=function(){return this._structArray.int16[this._pos2+3]},a.x2.get=function(){return this._structArray.int16[this._pos2+4]},a.y2.get=function(){return this._structArray.int16[this._pos2+5]},a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.anchorPoint.get=function(){return new Oe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(n.prototype,a),n}(S);c.prototype.size=20;var u=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.get=function(a){return new c(this,a)},n}(Ve);Dt("CollisionBoxArray",u);var f=function(t){function n(){t.apply(this,arguments)}t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},a.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},a.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},a.segment.get=function(){return this._structArray.uint16[this._pos2+10]},a.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},a.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},a.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},a.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},a.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},a.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},a.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},a.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},a.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},a.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},a.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(n.prototype,a),n}(S);f.prototype.size=48;var T=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.get=function(a){return new f(this,a)},n}(rt);Dt("PlacedSymbolArray",T);var z=function(t){function n(){t.apply(this,arguments)}t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},a.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},a.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},a.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},a.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},a.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},a.key.get=function(){return this._structArray.uint16[this._pos2+8]},a.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},a.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},a.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},a.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},a.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},a.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},a.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},a.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},a.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},a.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},a.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},a.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},a.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},a.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},a.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},a.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},a.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},a.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(n.prototype,a),n}(S);z.prototype.size=68;var P=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.get=function(a){return new z(this,a)},n}(ft);Dt("SymbolInstanceArray",P);var B=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getoffsetX=function(a){return this.float32[1*a+0]},n}(_t);Dt("GlyphOffsetArray",B);var G=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getx=function(a){return this.int16[3*a+0]},n.prototype.gety=function(a){return this.int16[3*a+1]},n.prototype.gettileUnitDistanceFromAnchor=function(a){return this.int16[3*a+2]},n}(lt);Dt("SymbolLineVertexArray",G);var H=function(t){function n(){t.apply(this,arguments)}t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n;var a={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(n.prototype,a),n}(S);H.prototype.size=8;var oe=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.get=function(a){return new H(this,a)},n}(Gt);Dt("FeatureIndexArray",oe);var ue=D([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(t){t===void 0&&(t=[]),this.segments=t};function Se(t,n){return 256*(t=Ct(Math.floor(t),0,255))+Ct(Math.floor(n),0,255)}se.prototype.prepareSegment=function(t,n,a,d){var _=this.segments[this.segments.length-1];return t>se.MAX_VERTEX_ARRAY_LENGTH&&lr("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!_||_.vertexLength+t>se.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var t=0,n=this.segments;t<n.length;t+=1){var a=n[t];for(var d in a.vaos)a.vaos[d].destroy()}},se.simpleSegment=function(t,n,a,d){return new se([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt("SegmentVector",se);var we=D([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ae=v(function(t){t.exports=function(n,a){var d,_,i,e,r,s,p,m;for(_=n.length-(d=3&n.length),i=a,r=3432918353,s=461845907,m=0;m<_;)p=255&n.charCodeAt(m)|(255&n.charCodeAt(++m))<<8|(255&n.charCodeAt(++m))<<16|(255&n.charCodeAt(++m))<<24,++m,i=27492+(65535&(e=5*(65535&(i=(i^=p=(65535&(p=(p=(65535&p)*r+(((p>>>16)*r&65535)<<16)&4294967295)<<15|p>>>17))*s+(((p>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(e>>>16)&65535)<<16);switch(p=0,d){case 3:p^=(255&n.charCodeAt(m+2))<<16;case 2:p^=(255&n.charCodeAt(m+1))<<8;case 1:i^=p=(65535&(p=(p=(65535&(p^=255&n.charCodeAt(m)))*r+(((p>>>16)*r&65535)<<16)&4294967295)<<15|p>>>17))*s+(((p>>>16)*s&65535)<<16)&4294967295}return i^=n.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}),ge=v(function(t){t.exports=function(n,a){for(var d,_=n.length,i=a^_,e=0;_>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(e)|(255&n.charCodeAt(++e))<<8|(255&n.charCodeAt(++e))<<16|(255&n.charCodeAt(++e))<<24))+((1540483477*(d>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++e;switch(_){case 3:i^=(255&n.charCodeAt(e+2))<<16;case 2:i^=(255&n.charCodeAt(e+1))<<8;case 1:i=1540483477*(65535&(i^=255&n.charCodeAt(e)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}),Ee=Ae,Re=ge;Ee.murmur3=Ae,Ee.murmur2=Re;var je=function(){this.ids=[],this.positions=[],this.indexed=!1};je.prototype.add=function(t,n,a,d){this.ids.push(Ye(t)),this.positions.push(n,a,d)},je.prototype.getPositions=function(t){for(var n=Ye(t),a=0,d=this.ids.length-1;a<d;){var _=a+d>>1;this.ids[_]>=n?d=_:a=_+1}for(var i=[];this.ids[a]===n;)i.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return i},je.serialize=function(t,n){var a=new Float64Array(t.ids),d=new Uint32Array(t.positions);return function _(i,e,r,s){for(;r<s;){for(var p=i[r+s>>1],m=r-1,g=s+1;;){do m++;while(i[m]<p);do g--;while(i[g]>p);if(m>=g)break;et(i,m,g),et(e,3*m,3*g),et(e,3*m+1,3*g+1),et(e,3*m+2,3*g+2)}g-r<s-g?(_(i,e,r,g),r=g+1):(_(i,e,g+1,s),s=g)}}(a,d,0,a.length-1),n&&n.push(a.buffer,d.buffer),{ids:a,positions:d}},je.deserialize=function(t){var n=new je;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n};var He=Math.pow(2,53)-1;function Ye(t){var n=+t;return!isNaN(n)&&n<=He?n:Ee(String(t))}function et(t,n,a){var d=t[n];t[n]=t[a],t[a]=d}Dt("FeaturePositionMap",je);var st=function(t,n){this.gl=t.gl,this.location=n},vt=function(t){function n(a,d){t.call(this,a,d),this.current=0}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))},n}(st),mt=function(t){function n(a,d){t.call(this,a,d),this.current=0}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))},n}(st),Pt=function(t){function n(a,d){t.call(this,a,d),this.current=[0,0]}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))},n}(st),$t=function(t){function n(a,d){t.call(this,a,d),this.current=[0,0,0]}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))},n}(st),ei=function(t){function n(a,d){t.call(this,a,d),this.current=[0,0,0,0]}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))},n}(st),Nt=function(t){function n(a,d){t.call(this,a,d),this.current=ri.transparent}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))},n}(st),Bi=new Float32Array(16),jt=function(t){function n(a,d){t.call(this,a,d),this.current=Bi}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.set=function(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(var d=1;d<16;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}},n}(st);function bi(t){return[Se(255*t.r,255*t.g),Se(255*t.b,255*t.a)]}var Di=function(t,n,a){this.value=t,this.uniformNames=n.map(function(d){return"u_"+d}),this.type=a};Di.prototype.setUniform=function(t,n,a){t.set(a.constantOr(this.value))},Di.prototype.getBinding=function(t,n,a){return this.type==="color"?new Nt(t,n):new mt(t,n)};var vi=function(t,n){this.uniformNames=n.map(function(a){return"u_"+a}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};vi.prototype.setConstantPatternPositions=function(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr},vi.prototype.setUniform=function(t,n,a,d){var _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)},vi.prototype.getBinding=function(t,n,a){return a.substr(0,9)==="u_pattern"?new ei(t,n):new mt(t,n)};var di=function(t,n,a,d){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(function(_){return{name:"a_"+_,type:"Float32",components:a==="color"?2:1,offset:0}}),this.paintVertexArray=new d};di.prototype.populatePaintArray=function(t,n,a,d,_){var i=this.paintVertexArray.length,e=this.expression.evaluate(new $i(0),n,{},d,[],_);this.paintVertexArray.resize(t),this._setPaintValue(i,t,e)},di.prototype.updatePaintArray=function(t,n,a,d){var _=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(t,n,_)},di.prototype._setPaintValue=function(t,n,a){if(this.type==="color")for(var d=bi(a),_=t;_<n;_++)this.paintVertexArray.emplace(_,d[0],d[1]);else{for(var i=t;i<n;i++)this.paintVertexArray.emplace(i,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}},di.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},di.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var hi=function(t,n,a,d,_,i){this.expression=t,this.uniformNames=n.map(function(e){return"u_"+e+"_t"}),this.type=a,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map(function(e){return{name:"a_"+e,type:"Float32",components:a==="color"?4:2,offset:0}}),this.paintVertexArray=new i};hi.prototype.populatePaintArray=function(t,n,a,d,_){var i=this.expression.evaluate(new $i(this.zoom),n,{},d,[],_),e=this.expression.evaluate(new $i(this.zoom+1),n,{},d,[],_),r=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(r,t,i,e)},hi.prototype.updatePaintArray=function(t,n,a,d){var _=this.expression.evaluate({zoom:this.zoom},a,d),i=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(t,n,_,i)},hi.prototype._setPaintValue=function(t,n,a,d){if(this.type==="color")for(var _=bi(a),i=bi(d),e=t;e<n;e++)this.paintVertexArray.emplace(e,_[0],_[1],i[0],i[1]);else{for(var r=t;r<n;r++)this.paintVertexArray.emplace(r,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}},hi.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},hi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},hi.prototype.setUniform=function(t,n){var a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,d=Ct(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(d)},hi.prototype.getBinding=function(t,n,a){return new mt(t,n)};var ni=function(t,n,a,d,_,i){this.expression=t,this.type=n,this.useIntegerZoom=a,this.zoom=d,this.layerId=i,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};ni.prototype.populatePaintArray=function(t,n,a){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,n.patterns&&n.patterns[this.layerId],a)},ni.prototype.updatePaintArray=function(t,n,a,d,_){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],_)},ni.prototype._setPaintValues=function(t,n,a,d){if(d&&a){var _=d[a.min],i=d[a.mid],e=d[a.max];if(_&&i&&e)for(var r=t;r<n;r++)this.zoomInPaintVertexArray.emplace(r,i.tl[0],i.tl[1],i.br[0],i.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],i.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(r,i.tl[0],i.tl[1],i.br[0],i.br[1],e.tl[0],e.tl[1],e.br[0],e.br[1],i.pixelRatio,e.pixelRatio)}},ni.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,we.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,we.members,this.expression.isStateDependent))},ni.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Xt=function(t,n,a){this.binders={},this._buffers=[];var d=[];for(var _ in t.paint._values)if(a(_)){var i=t.paint.get(_);if(i instanceof Fn&&ua(i.property.specification)){var e=Jr(_,t.type),r=i.value,s=i.property.specification.type,p=i.property.useIntegerZoom,m=i.property.specification["property-type"],g=m==="cross-faded"||m==="cross-faded-data-driven";if(r.kind==="constant")this.binders[_]=g?new vi(r.value,e):new Di(r.value,e,s),d.push("/u_"+_);else if(r.kind==="source"||g){var I=un(_,s,"source");this.binders[_]=g?new ni(r,s,p,n,I,t.id):new di(r,e,s,I),d.push("/a_"+_)}else{var E=un(_,s,"composite");this.binders[_]=new hi(r,e,s,p,n,E),d.push("/z_"+_)}}}this.cacheKey=d.sort().join("")};Xt.prototype.getMaxValue=function(t){var n=this.binders[t];return n instanceof di||n instanceof hi?n.maxValue:0},Xt.prototype.populatePaintArrays=function(t,n,a,d,_){for(var i in this.binders){var e=this.binders[i];(e instanceof di||e instanceof hi||e instanceof ni)&&e.populatePaintArray(t,n,a,d,_)}},Xt.prototype.setConstantPatternPositions=function(t,n){for(var a in this.binders){var d=this.binders[a];d instanceof vi&&d.setConstantPatternPositions(t,n)}},Xt.prototype.updatePaintArrays=function(t,n,a,d,_){var i=!1;for(var e in t)for(var r=0,s=n.getPositions(e);r<s.length;r+=1){var p=s[r],m=a.feature(p.index);for(var g in this.binders){var I=this.binders[g];if((I instanceof di||I instanceof hi||I instanceof ni)&&I.expression.isStateDependent===!0){var E=d.paint.get(g);I.expression=E.value,I.updatePaintArray(p.start,p.end,m,t[e],_),i=!0}}}return i},Xt.prototype.defines=function(){var t=[];for(var n in this.binders){var a=this.binders[n];(a instanceof Di||a instanceof vi)&&t.push.apply(t,a.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return t},Xt.prototype.getBinderAttributes=function(){var t=[];for(var n in this.binders){var a=this.binders[n];if(a instanceof di||a instanceof hi)for(var d=0;d<a.paintVertexAttributes.length;d++)t.push(a.paintVertexAttributes[d].name);else if(a instanceof ni)for(var _=0;_<we.members.length;_++)t.push(we.members[_].name)}return t},Xt.prototype.getBinderUniforms=function(){var t=[];for(var n in this.binders){var a=this.binders[n];if(a instanceof Di||a instanceof vi||a instanceof hi)for(var d=0,_=a.uniformNames;d<_.length;d+=1)t.push(_[d])}return t},Xt.prototype.getPaintVertexBuffers=function(){return this._buffers},Xt.prototype.getUniforms=function(t,n){var a=[];for(var d in this.binders){var _=this.binders[d];if(_ instanceof Di||_ instanceof vi||_ instanceof hi)for(var i=0,e=_.uniformNames;i<e.length;i+=1){var r=e[i];if(n[r]){var s=_.getBinding(t,n[r],r);a.push({name:r,property:d,binding:s})}}}return a},Xt.prototype.setUniforms=function(t,n,a,d){for(var _=0,i=n;_<i.length;_+=1){var e=i[_],r=e.name,s=e.property;this.binders[s].setUniform(e.binding,d,a.get(s),r)}},Xt.prototype.updatePaintBuffers=function(t){for(var n in this._buffers=[],this.binders){var a=this.binders[n];if(t&&a instanceof ni){var d=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof di||a instanceof hi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}},Xt.prototype.upload=function(t){for(var n in this.binders){var a=this.binders[n];(a instanceof di||a instanceof hi||a instanceof ni)&&a.upload(t)}this.updatePaintBuffers()},Xt.prototype.destroy=function(){for(var t in this.binders){var n=this.binders[t];(n instanceof di||n instanceof hi||n instanceof ni)&&n.destroy()}};var Hi=function(t,n,a){a===void 0&&(a=function(){return!0}),this.programConfigurations={};for(var d=0,_=t;d<_.length;d+=1){var i=_[d];this.programConfigurations[i.id]=new Xt(i,n,a)}this.needsUpload=!1,this._featureMap=new je,this._bufferOffset=0};function Jr(t,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(n+"-","").replace(/-/g,"_")]}function un(t,n,a){var d={color:{source:fe,composite:l},number:{source:_t,composite:fe}},_=function(i){return{"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze}}[i]}(t);return _&&_[a]||d[n][a]}Hi.prototype.populatePaintArrays=function(t,n,a,d,_,i){for(var e in this.programConfigurations)this.programConfigurations[e].populatePaintArrays(t,n,d,_,i);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Hi.prototype.updatePaintArrays=function(t,n,a,d){for(var _=0,i=a;_<i.length;_+=1){var e=i[_];this.needsUpload=this.programConfigurations[e.id].updatePaintArrays(t,this._featureMap,n,e,d)||this.needsUpload}},Hi.prototype.get=function(t){return this.programConfigurations[t]},Hi.prototype.upload=function(t){if(this.needsUpload){for(var n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}},Hi.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Dt("ConstantBinder",Di),Dt("CrossFadedConstantBinder",vi),Dt("SourceExpressionBinder",di),Dt("CrossFadedCompositeBinder",ni),Dt("CompositeExpressionBinder",hi),Dt("ProgramConfiguration",Xt,{omit:["_buffers"]}),Dt("ProgramConfigurationSet",Hi);var In=Math.pow(2,14)-1,vn=-In-1;function Vi(t){for(var n=8192/t.extent,a=t.loadGeometry(),d=0;d<a.length;d++)for(var _=a[d],i=0;i<_.length;i++){var e=_[i],r=Math.round(e.x*n),s=Math.round(e.y*n);e.x=Ct(r,vn,In),e.y=Ct(s,vn,In),(r<e.x||r>e.x+1||s<e.y||s>e.y+1)&&lr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return a}function On(t,n){return{type:t.type,id:t.id,properties:t.properties,geometry:n?Vi(t):[]}}function ga(t,n,a,d,_){t.emplaceBack(2*n+(d+1)/2,2*a+(_+1)/2)}var cn=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(n){return n.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new N,this.indexArray=new it,this.segments=new se,this.programConfigurations=new Hi(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(n){return n.isStateDependent()}).map(function(n){return n.id})};function hn(t,n){for(var a=0;a<t.length;a++)if(Qo(n,t[a]))return!0;for(var d=0;d<n.length;d++)if(Qo(t,n[d]))return!0;return!!Ss(t,n)}function Oo(t,n,a){return!!Qo(t,n)||!!ol(n,t,a)}function vo(t,n){if(t.length===1)return El(n,t[0]);for(var a=0;a<n.length;a++)for(var d=n[a],_=0;_<d.length;_++)if(Qo(t,d[_]))return!0;for(var i=0;i<t.length;i++)if(El(n,t[i]))return!0;for(var e=0;e<n.length;e++)if(Ss(t,n[e]))return!0;return!1}function Au(t,n,a){if(t.length>1){if(Ss(t,n))return!0;for(var d=0;d<n.length;d++)if(ol(n[d],t,a))return!0}for(var _=0;_<t.length;_++)if(ol(t[_],n,a))return!0;return!1}function Ss(t,n){if(t.length===0||n.length===0)return!1;for(var a=0;a<t.length-1;a++)for(var d=t[a],_=t[a+1],i=0;i<n.length-1;i++)if(nl(d,_,n[i],n[i+1]))return!0;return!1}function nl(t,n,a,d){return Li(t,a,d)!==Li(n,a,d)&&Li(t,n,a)!==Li(t,n,d)}function ol(t,n,a){var d=a*a;if(n.length===1)return t.distSqr(n[0])<d;for(var _=1;_<n.length;_++)if(al(t,n[_-1],n[_])<d)return!0;return!1}function al(t,n,a){var d=n.distSqr(a);if(d===0)return t.distSqr(n);var _=((t.x-n.x)*(a.x-n.x)+(t.y-n.y)*(a.y-n.y))/d;return t.distSqr(_<0?n:_>1?a:a.sub(n)._mult(_)._add(n))}function El(t,n){for(var a,d,_,i=!1,e=0;e<t.length;e++)for(var r=0,s=(a=t[e]).length-1;r<a.length;s=r++)(d=a[r]).y>n.y!=(_=a[s]).y>n.y&&n.x<(_.x-d.x)*(n.y-d.y)/(_.y-d.y)+d.x&&(i=!i);return i}function Qo(t,n){for(var a=!1,d=0,_=t.length-1;d<t.length;_=d++){var i=t[d],e=t[_];i.y>n.y!=e.y>n.y&&n.x<(e.x-i.x)*(n.y-i.y)/(e.y-i.y)+i.x&&(a=!a)}return a}function sl(t,n,a){var d=a[0],_=a[2];if(t.x<d.x&&n.x<d.x||t.x>_.x&&n.x>_.x||t.y<d.y&&n.y<d.y||t.y>_.y&&n.y>_.y)return!1;var i=Li(t,n,a[0]);return i!==Li(t,n,a[1])||i!==Li(t,n,a[2])||i!==Li(t,n,a[3])}function pn(t,n,a){var d=n.paint.get(t).value;return d.kind==="constant"?d.value:a.programConfigurations.get(n.id).getMaxValue(t)}function Ro(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function _a(t,n,a,d,_){if(!n[0]&&!n[1])return t;var i=Oe.convert(n)._mult(_);a==="viewport"&&i._rotate(-d);for(var e=[],r=0;r<t.length;r++)e.push(t[r].sub(i));return e}cn.prototype.populate=function(t,n,a){var d=this.layers[0],_=[],i=null,e=!1;d.type==="circle"&&(e=!(i=d.layout.get("circle-sort-key")).isConstant());for(var r=0,s=t;r<s.length;r+=1){var p=s[r],m=p.feature,g=p.id,I=p.index,E=p.sourceLayerIndex,M=this.layers[0]._featureFilter.needGeometry,L=On(m,M);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),L,a)){var F=e?i.evaluate(L,{},a):void 0,O={id:g,properties:m.properties,type:m.type,sourceLayerIndex:E,index:I,geometry:M?L.geometry:Vi(m),patterns:{},sortKey:F};_.push(O)}}e&&_.sort(function(Ue,qe){return Ue.sortKey-qe.sortKey});for(var Z=0,$=_;Z<$.length;Z+=1){var te=$[Z],ie=te.geometry,ve=te.index,Pe=te.sourceLayerIndex,Me=t[ve].feature;this.addFeature(te,ie,ve,a),n.featureIndex.insert(Me,ie,ve,Pe,this.index)}},cn.prototype.update=function(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)},cn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cn.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ue),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},cn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},cn.prototype.addFeature=function(t,n,a,d){for(var _=0,i=n;_<i.length;_+=1)for(var e=0,r=i[_];e<r.length;e+=1){var s=r[e],p=s.x,m=s.y;if(!(p<0||p>=8192||m<0||m>=8192)){var g=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=g.vertexLength;ga(this.layoutVertexArray,p,m,-1,-1),ga(this.layoutVertexArray,p,m,1,-1),ga(this.layoutVertexArray,p,m,1,1),ga(this.layoutVertexArray,p,m,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),g.vertexLength+=4,g.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},d)},Dt("CircleBucket",cn,{omit:["layers"]});var va=new o({"circle-sort-key":new ui(ye.layout_circle["circle-sort-key"])}),qr={paint:new o({"circle-radius":new ui(ye.paint_circle["circle-radius"]),"circle-color":new ui(ye.paint_circle["circle-color"]),"circle-blur":new ui(ye.paint_circle["circle-blur"]),"circle-opacity":new ui(ye.paint_circle["circle-opacity"]),"circle-translate":new gt(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ui(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ui(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ui(ye.paint_circle["circle-stroke-opacity"])}),layout:va},Or=typeof Float32Array<"u"?Float32Array:Array;function ho(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Yl(t,n,a){var d=n[0],_=n[1],i=n[2],e=n[3],r=n[4],s=n[5],p=n[6],m=n[7],g=n[8],I=n[9],E=n[10],M=n[11],L=n[12],F=n[13],O=n[14],Z=n[15],$=a[0],te=a[1],ie=a[2],ve=a[3];return t[0]=$*d+te*r+ie*g+ve*L,t[1]=$*_+te*s+ie*I+ve*F,t[2]=$*i+te*p+ie*E+ve*O,t[3]=$*e+te*m+ie*M+ve*Z,t[4]=($=a[4])*d+(te=a[5])*r+(ie=a[6])*g+(ve=a[7])*L,t[5]=$*_+te*s+ie*I+ve*F,t[6]=$*i+te*p+ie*E+ve*O,t[7]=$*e+te*m+ie*M+ve*Z,t[8]=($=a[8])*d+(te=a[9])*r+(ie=a[10])*g+(ve=a[11])*L,t[9]=$*_+te*s+ie*I+ve*F,t[10]=$*i+te*p+ie*E+ve*O,t[11]=$*e+te*m+ie*M+ve*Z,t[12]=($=a[12])*d+(te=a[13])*r+(ie=a[14])*g+(ve=a[15])*L,t[13]=$*_+te*s+ie*I+ve*F,t[14]=$*i+te*p+ie*E+ve*O,t[15]=$*e+te*m+ie*M+ve*Z,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,n=0,a=arguments.length;a--;)n+=t[a]*t[a];return Math.sqrt(n)});var is,Gu=Yl;function Ql(t,n,a){var d=n[0],_=n[1],i=n[2],e=n[3];return t[0]=a[0]*d+a[4]*_+a[8]*i+a[12]*e,t[1]=a[1]*d+a[5]*_+a[9]*i+a[13]*e,t[2]=a[2]*d+a[6]*_+a[10]*i+a[14]*e,t[3]=a[3]*d+a[7]*_+a[11]*i+a[15]*e,t}is=new Or(3),Or!=Float32Array&&(is[0]=0,is[1]=0,is[2]=0),function(){var t=new Or(4);Or!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Is=(function(){var t=new Or(2);Or!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function n(a){t.call(this,a,qr)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.createBucket=function(a){return new cn(a)},n.prototype.queryRadius=function(a){var d=a;return pn("circle-radius",this,d)+pn("circle-stroke-width",this,d)+Ro(this.paint.get("circle-translate"))},n.prototype.queryIntersectsFeature=function(a,d,_,i,e,r,s,p){for(var m=_a(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),r.angle,s),g=this.paint.get("circle-radius").evaluate(d,_)+this.paint.get("circle-stroke-width").evaluate(d,_),I=this.paint.get("circle-pitch-alignment")==="map",E=I?m:function(Pe,Me){return Pe.map(function(Ue){return Tc(Ue,Me)})}(m,p),M=I?g*s:g,L=0,F=i;L<F.length;L+=1)for(var O=0,Z=F[L];O<Z.length;O+=1){var $=Z[O],te=I?$:Tc($,p),ie=M,ve=Ql([],[$.x,$.y,0,1],p);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ve[3]/r.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=r.cameraToCenterDistance/ve[3]),Oo(E,te,ie))return!0}return!1},n}(h));function Tc(t,n){var a=Ql([],[t.x,t.y,0,1],n);return new Oe(a[0]/a[3],a[1]/a[3])}var Es=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n}(cn);function kl(t,n,a,d){var _=n.width,i=n.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==_*i*a)throw new RangeError("mismatched image size")}else d=new Uint8Array(_*i*a);return t.width=_,t.height=i,t.data=d,t}function sh(t,n,a){var d=n.width,_=n.height;if(d!==t.width||_!==t.height){var i=kl({},{width:d,height:_},a);lh(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,d),height:Math.min(t.height,_)},a),t.width=d,t.height=_,t.data=i.data}}function lh(t,n,a,d,_,i){if(_.width===0||_.height===0)return n;if(_.width>t.width||_.height>t.height||a.x>t.width-_.width||a.y>t.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||d.x>n.width-_.width||d.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var e=t.data,r=n.data,s=0;s<_.height;s++)for(var p=((a.y+s)*t.width+a.x)*i,m=((d.y+s)*n.width+d.x)*i,g=0;g<_.width*i;g++)r[m+g]=e[p+g];return n}Dt("HeatmapBucket",Es,{omit:["layers"]});var ll=function(t,n){kl(this,t,1,n)};ll.prototype.resize=function(t){sh(this,t,1)},ll.prototype.clone=function(){return new ll({width:this.width,height:this.height},new Uint8Array(this.data))},ll.copy=function(t,n,a,d,_){lh(t,n,a,d,_,1)};var xo=function(t,n){kl(this,t,4,n)};xo.prototype.resize=function(t){sh(this,t,4)},xo.prototype.replace=function(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},xo.prototype.clone=function(){return new xo({width:this.width,height:this.height},new Uint8Array(this.data))},xo.copy=function(t,n,a,d,_){lh(t,n,a,d,_,4)},Dt("AlphaImage",ll),Dt("RGBAImage",xo);var uh={paint:new o({"heatmap-radius":new ui(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ui(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new b(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(ye.paint_heatmap["heatmap-opacity"])})};function zu(t){var n={},a=t.resolution||256,d=t.clips?t.clips.length:1,_=t.image||new xo({width:a,height:d}),i=function(M,L,F){n[t.evaluationKey]=F;var O=t.expression.evaluate(n);_.data[M+L+0]=Math.floor(255*O.r/O.a),_.data[M+L+1]=Math.floor(255*O.g/O.a),_.data[M+L+2]=Math.floor(255*O.b/O.a),_.data[M+L+3]=Math.floor(255*O.a)};if(t.clips)for(var e=0,r=0;e<d;++e,r+=4*a)for(var s=0,p=0;s<a;s++,p+=4){var m=s/(a-1),g=t.clips[e];i(r,p,g.start*(1-m)+g.end*m)}else for(var I=0,E=0;I<a;I++,E+=4)i(0,E,I/(a-1));return _}var xa=function(t){function n(a){t.call(this,a,uh),this._updateColorRamp()}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.createBucket=function(a){return new Es(a)},n.prototype._handleSpecialPaintPropertyUpdate=function(a){a==="heatmap-color"&&this._updateColorRamp()},n.prototype._updateColorRamp=function(){this.colorRamp=zu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},n.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},n.prototype.queryRadius=function(){return 0},n.prototype.queryIntersectsFeature=function(){return!1},n.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},n}(h),tp={paint:new o({"hillshade-illumination-direction":new gt(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(ye.paint_hillshade["hillshade-accent-color"])})},dd=function(t){function n(a){t.call(this,a,tp)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},n}(h),fd=D([{name:"a_pos",components:2,type:"Int16"}],4).members,ch=eu,hh=eu;function eu(t,n,a){a=a||2;var d,_,i,e,r,s,p,m=n&&n.length,g=m?n[0]*a:t.length,I=ph(t,0,g,a,!0),E=[];if(!I||I.next===I.prev)return E;if(m&&(I=function(L,F,O,Z){var $,te,ie,ve=[];for($=0,te=F.length;$<te;$++)(ie=ph(L,F[$]*Z,$<te-1?F[$+1]*Z:L.length,Z,!1))===ie.next&&(ie.steiner=!0),ve.push(wd(ie));for(ve.sort(vd),$=0;$<ve.length;$++)xd(ve[$],O),O=Uo(O,O.next);return O}(t,n,I,a)),t.length>80*a){d=i=t[0],_=e=t[1];for(var M=a;M<g;M+=a)(r=t[M])<d&&(d=r),(s=t[M+1])<_&&(_=s),r>i&&(i=r),s>e&&(e=s);p=(p=Math.max(i-d,e-_))!==0?1/p:0}return ul(I,E,a,d,_,p),E}function ph(t,n,a,d,_){var i,e;if(_===Wu(t,n,a,d)>0)for(i=n;i<a;i+=d)e=mh(i,t[i],t[i+1],e);else for(i=a-d;i>=n;i-=d)e=mh(i,t[i],t[i+1],e);return e&&tu(e,e.next)&&(hl(e),e=e.next),e}function Uo(t,n){if(!t)return t;n||(n=t);var a,d=t;do if(a=!1,d.steiner||!tu(d,d.next)&&Ni(d.prev,d,d.next)!==0)d=d.next;else{if(hl(d),(d=n=d.prev)===d.next)break;a=!0}while(a||d!==n);return n}function ul(t,n,a,d,_,i,e){if(t){!e&&i&&function(m,g,I,E){var M=m;do M.z===null&&(M.z=$u(M.x,M.y,g,I,E)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==m);M.prevZ.nextZ=null,M.prevZ=null,function(L){var F,O,Z,$,te,ie,ve,Pe,Me=1;do{for(O=L,L=null,te=null,ie=0;O;){for(ie++,Z=O,ve=0,F=0;F<Me&&(ve++,Z=Z.nextZ);F++);for(Pe=Me;ve>0||Pe>0&&Z;)ve!==0&&(Pe===0||!Z||O.z<=Z.z)?($=O,O=O.nextZ,ve--):($=Z,Z=Z.nextZ,Pe--),te?te.nextZ=$:L=$,$.prevZ=te,te=$;O=Z}te.nextZ=null,Me*=2}while(ie>1)}(M)}(t,d,_,i);for(var r,s,p=t;t.prev!==t.next;)if(r=t.prev,s=t.next,i?yd(t,d,_,i):md(t))n.push(r.i/a),n.push(t.i/a),n.push(s.i/a),hl(t),t=s.next,p=s.next;else if((t=s)===p){e?e===1?ul(t=gd(Uo(t),n,a),n,a,d,_,i,2):e===2&&_d(t,n,a,d,_,i):ul(Uo(t),n,a,d,_,i,1);break}}}function md(t){var n=t.prev,a=t,d=t.next;if(Ni(n,a,d)>=0)return!1;for(var _=t.next.next;_!==t.prev;){if(rs(n.x,n.y,a.x,a.y,d.x,d.y,_.x,_.y)&&Ni(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function yd(t,n,a,d){var _=t.prev,i=t,e=t.next;if(Ni(_,i,e)>=0)return!1;for(var r=_.x>i.x?_.x>e.x?_.x:e.x:i.x>e.x?i.x:e.x,s=_.y>i.y?_.y>e.y?_.y:e.y:i.y>e.y?i.y:e.y,p=$u(_.x<i.x?_.x<e.x?_.x:e.x:i.x<e.x?i.x:e.x,_.y<i.y?_.y<e.y?_.y:e.y:i.y<e.y?i.y:e.y,n,a,d),m=$u(r,s,n,a,d),g=t.prevZ,I=t.nextZ;g&&g.z>=p&&I&&I.z<=m;){if(g!==t.prev&&g!==t.next&&rs(_.x,_.y,i.x,i.y,e.x,e.y,g.x,g.y)&&Ni(g.prev,g,g.next)>=0||(g=g.prevZ,I!==t.prev&&I!==t.next&&rs(_.x,_.y,i.x,i.y,e.x,e.y,I.x,I.y)&&Ni(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;g&&g.z>=p;){if(g!==t.prev&&g!==t.next&&rs(_.x,_.y,i.x,i.y,e.x,e.y,g.x,g.y)&&Ni(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;I&&I.z<=m;){if(I!==t.prev&&I!==t.next&&rs(_.x,_.y,i.x,i.y,e.x,e.y,I.x,I.y)&&Ni(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function gd(t,n,a){var d=t;do{var _=d.prev,i=d.next.next;!tu(_,i)&&dh(_,d,d.next,i)&&cl(_,i)&&cl(i,_)&&(n.push(_.i/a),n.push(d.i/a),n.push(i.i/a),hl(d),hl(d.next),d=t=i),d=d.next}while(d!==t);return Uo(d)}function _d(t,n,a,d,_,i){var e=t;do{for(var r=e.next.next;r!==e.prev;){if(e.i!==r.i&&Td(e,r)){var s=fh(e,r);return e=Uo(e,e.next),s=Uo(s,s.next),ul(e,n,a,d,_,i),void ul(s,n,a,d,_,i)}r=r.next}e=e.next}while(e!==t)}function vd(t,n){return t.x-n.x}function xd(t,n){if(n=function(d,_){var i,e=_,r=d.x,s=d.y,p=-1/0;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var m=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(m<=r&&m>p){if(p=m,m===r){if(s===e.y)return e;if(s===e.next.y)return e.next}i=e.x<e.next.x?e:e.next}}e=e.next}while(e!==_);if(!i)return null;if(r===p)return i;var g,I=i,E=i.x,M=i.y,L=1/0;e=i;do r>=e.x&&e.x>=E&&r!==e.x&&rs(s<M?r:p,s,E,M,s<M?p:r,s,e.x,e.y)&&(g=Math.abs(s-e.y)/(r-e.x),cl(e,d)&&(g<L||g===L&&(e.x>i.x||e.x===i.x&&bd(i,e)))&&(i=e,L=g)),e=e.next;while(e!==I);return i}(t,n)){var a=fh(n,t);Uo(n,n.next),Uo(a,a.next)}}function bd(t,n){return Ni(t.prev,t,n.prev)<0&&Ni(n.next,t,t.next)<0}function $u(t,n,a,d,_){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-a)*_)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-d)*_)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function wd(t){var n=t,a=t;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==t);return a}function rs(t,n,a,d,_,i,e,r){return(_-e)*(n-r)-(t-e)*(i-r)>=0&&(t-e)*(d-r)-(a-e)*(n-r)>=0&&(a-e)*(i-r)-(_-e)*(d-r)>=0}function Td(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(a,d){var _=a;do{if(_.i!==a.i&&_.next.i!==a.i&&_.i!==d.i&&_.next.i!==d.i&&dh(_,_.next,a,d))return!0;_=_.next}while(_!==a);return!1}(t,n)&&(cl(t,n)&&cl(n,t)&&function(a,d){var _=a,i=!1,e=(a.x+d.x)/2,r=(a.y+d.y)/2;do _.y>r!=_.next.y>r&&_.next.y!==_.y&&e<(_.next.x-_.x)*(r-_.y)/(_.next.y-_.y)+_.x&&(i=!i),_=_.next;while(_!==a);return i}(t,n)&&(Ni(t.prev,t,n.prev)||Ni(t,n.prev,n))||tu(t,n)&&Ni(t.prev,t,t.next)>0&&Ni(n.prev,n,n.next)>0)}function Ni(t,n,a){return(n.y-t.y)*(a.x-n.x)-(n.x-t.x)*(a.y-n.y)}function tu(t,n){return t.x===n.x&&t.y===n.y}function dh(t,n,a,d){var _=ru(Ni(t,n,a)),i=ru(Ni(t,n,d)),e=ru(Ni(a,d,t)),r=ru(Ni(a,d,n));return _!==i&&e!==r||!(_!==0||!iu(t,a,n))||!(i!==0||!iu(t,d,n))||!(e!==0||!iu(a,t,d))||!(r!==0||!iu(a,n,d))}function iu(t,n,a){return n.x<=Math.max(t.x,a.x)&&n.x>=Math.min(t.x,a.x)&&n.y<=Math.max(t.y,a.y)&&n.y>=Math.min(t.y,a.y)}function ru(t){return t>0?1:t<0?-1:0}function cl(t,n){return Ni(t.prev,t,t.next)<0?Ni(t,n,t.next)>=0&&Ni(t,t.prev,n)>=0:Ni(t,n,t.prev)<0||Ni(t,t.next,n)<0}function fh(t,n){var a=new Xu(t.i,t.x,t.y),d=new Xu(n.i,n.x,n.y),_=t.next,i=n.prev;return t.next=n,n.prev=t,a.next=_,_.prev=a,d.next=a,a.prev=d,i.next=d,d.prev=i,d}function mh(t,n,a,d){var _=new Xu(t,n,a);return d?(_.next=d.next,_.prev=d,d.next.prev=_,d.next=_):(_.prev=_,_.next=_),_}function hl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Xu(t,n,a){this.i=t,this.x=n,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wu(t,n,a,d){for(var _=0,i=n,e=a-d;i<a;i+=d)_+=(t[e]-t[i])*(t[i+1]+t[e+1]),e=i;return _}function ip(t,n,a,d,_){(function i(e,r,s,p,m){for(;p>s;){if(p-s>600){var g=p-s+1,I=r-s+1,E=Math.log(g),M=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*M*(g-M)/g)*(I-g/2<0?-1:1);i(e,r,Math.max(s,Math.floor(r-I*M/g+L)),Math.min(p,Math.floor(r+(g-I)*M/g+L)),m)}var F=e[r],O=s,Z=p;for(Hu(e,s,r),m(e[p],F)>0&&Hu(e,s,p);O<Z;){for(Hu(e,O,Z),O++,Z--;m(e[O],F)<0;)O++;for(;m(e[Z],F)>0;)Z--}m(e[s],F)===0?Hu(e,s,Z):Hu(e,++Z,p),Z<=r&&(s=Z+1),r<=Z&&(p=Z-1)}})(t,n,a||0,d||t.length-1,_||rp)}function Hu(t,n,a){var d=t[n];t[n]=t[a],t[a]=d}function rp(t,n){return t<n?-1:t>n?1:0}function nu(t,n){var a=t.length;if(a<=1)return[t];for(var d,_,i=[],e=0;e<a;e++){var r=Yr(t[e]);r!==0&&(t[e].area=Math.abs(r),_===void 0&&(_=r<0),_===r<0?(d&&i.push(d),d=[t[e]]):d.push(t[e]))}if(d&&i.push(d),n>1)for(var s=0;s<i.length;s++)i[s].length<=n||(ip(i[s],n,1,i[s].length-1,Sd),i[s]=i[s].slice(0,n));return i}function Sd(t,n){return n.area-t.area}function Ku(t,n,a){for(var d=a.patternDependencies,_=!1,i=0,e=n;i<e.length;i+=1){var r=e[i].paint.get(t+"-pattern");r.isConstant()||(_=!0);var s=r.constantOr(null);s&&(_=!0,d[s.to]=!0,d[s.from]=!0)}return _}function yh(t,n,a,d,_){for(var i=_.patternDependencies,e=0,r=n;e<r.length;e+=1){var s=r[e],p=s.paint.get(t+"-pattern").value;if(p.kind!=="constant"){var m=p.evaluate({zoom:d-1},a,{},_.availableImages),g=p.evaluate({zoom:d},a,{},_.availableImages),I=p.evaluate({zoom:d+1},a,{},_.availableImages);g=g&&g.name?g.name:g,I=I&&I.name?I.name:I,i[m=m&&m.name?m.name:m]=!0,i[g]=!0,i[I]=!0,a.patterns[s.id]={min:m,mid:g,max:I}}}return a}eu.deviation=function(t,n,a,d){var _=n&&n.length,i=Math.abs(Wu(t,0,_?n[0]*a:t.length,a));if(_)for(var e=0,r=n.length;e<r;e++)i-=Math.abs(Wu(t,n[e]*a,e<r-1?n[e+1]*a:t.length,a));var s=0;for(e=0;e<d.length;e+=3){var p=d[e]*a,m=d[e+1]*a,g=d[e+2]*a;s+=Math.abs((t[p]-t[g])*(t[m+1]-t[p+1])-(t[p]-t[m])*(t[g+1]-t[p+1]))}return i===0&&s===0?0:Math.abs((s-i)/i)},eu.flatten=function(t){for(var n=t[0][0].length,a={vertices:[],holes:[],dimensions:n},d=0,_=0;_<t.length;_++){for(var i=0;i<t[_].length;i++)for(var e=0;e<n;e++)a.vertices.push(t[_][i][e]);_>0&&a.holes.push(d+=t[_-1].length)}return a},ch.default=hh;var ba=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(n){return n.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new N,this.indexArray=new it,this.indexArray2=new Lt,this.programConfigurations=new Hi(t.layers,t.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(n){return n.isStateDependent()}).map(function(n){return n.id})};ba.prototype.populate=function(t,n,a){this.hasPattern=Ku("fill",this.layers,n);for(var d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),i=[],e=0,r=t;e<r.length;e+=1){var s=r[e],p=s.feature,m=s.id,g=s.index,I=s.sourceLayerIndex,E=this.layers[0]._featureFilter.needGeometry,M=On(p,E);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),M,a)){var L=_?d.evaluate(M,{},a,n.availableImages):void 0,F={id:m,properties:p.properties,type:p.type,sourceLayerIndex:I,index:g,geometry:E?M.geometry:Vi(p),patterns:{},sortKey:L};i.push(F)}}_&&i.sort(function(Me,Ue){return Me.sortKey-Ue.sortKey});for(var O=0,Z=i;O<Z.length;O+=1){var $=Z[O],te=$.geometry,ie=$.index,ve=$.sourceLayerIndex;if(this.hasPattern){var Pe=yh("fill",this.layers,$,this.zoom,n);this.patternFeatures.push(Pe)}else this.addFeature($,te,ie,a,{});n.featureIndex.insert(t[ie].feature,te,ie,ve,this.index)}},ba.prototype.update=function(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)},ba.prototype.addFeatures=function(t,n,a){for(var d=0,_=this.patternFeatures;d<_.length;d+=1){var i=_[d];this.addFeature(i,i.geometry,i.index,n,a)}},ba.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ba.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ba.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ba.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ba.prototype.addFeature=function(t,n,a,d,_){for(var i=0,e=nu(n,500);i<e.length;i+=1){for(var r=e[i],s=0,p=0,m=r;p<m.length;p+=1)s+=m[p].length;for(var g=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),I=g.vertexLength,E=[],M=[],L=0,F=r;L<F.length;L+=1){var O=F[L];if(O.length!==0){O!==r[0]&&M.push(E.length/2);var Z=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),$=Z.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack($+O.length-1,$),E.push(O[0].x),E.push(O[0].y);for(var te=1;te<O.length;te++)this.layoutVertexArray.emplaceBack(O[te].x,O[te].y),this.indexArray2.emplaceBack($+te-1,$+te),E.push(O[te].x),E.push(O[te].y);Z.vertexLength+=O.length,Z.primitiveLength+=O.length}}for(var ie=ch(E,M),ve=0;ve<ie.length;ve+=3)this.indexArray.emplaceBack(I+ie[ve],I+ie[ve+1],I+ie[ve+2]);g.vertexLength+=s,g.primitiveLength+=ie.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,_,d)},Dt("FillBucket",ba,{omit:["layers","patternFeatures"]});var gh=new o({"fill-sort-key":new ui(ye.layout_fill["fill-sort-key"])}),_h={paint:new o({"fill-antialias":new gt(ye.paint_fill["fill-antialias"]),"fill-opacity":new ui(ye.paint_fill["fill-opacity"]),"fill-color":new ui(ye.paint_fill["fill-color"]),"fill-outline-color":new ui(ye.paint_fill["fill-outline-color"]),"fill-translate":new gt(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new _n(ye.paint_fill["fill-pattern"])}),layout:gh},Id=function(t){function n(a){t.call(this,a,_h)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.recalculate=function(a,d){t.prototype.recalculate.call(this,a,d);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},n.prototype.createBucket=function(a){return new ba(a)},n.prototype.queryRadius=function(){return Ro(this.paint.get("fill-translate"))},n.prototype.queryIntersectsFeature=function(a,d,_,i,e,r,s){return vo(_a(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),r.angle,s),i)},n.prototype.isTileClipped=function(){return!0},n}(h),Ed=D([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,np=Cu;function Cu(t,n,a,d,_){this.properties={},this.extent=a,this.type=0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=_,t.readFields(Al,this,n)}function Al(t,n,a){t==1?n.id=a.readVarint():t==2?function(d,_){for(var i=d.readVarint()+d.pos;d.pos<i;){var e=_._keys[d.readVarint()],r=_._values[d.readVarint()];_.properties[e]=r}}(a,n):t==3?n.type=a.readVarint():t==4&&(n._geometry=a.pos)}function kd(t){for(var n,a,d=0,_=0,i=t.length,e=i-1;_<i;e=_++)d+=((a=t[e]).x-(n=t[_]).x)*(n.y+a.y);return d}Cu.types=["Unknown","Point","LineString","Polygon"],Cu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var n,a=t.readVarint()+t.pos,d=1,_=0,i=0,e=0,r=[];t.pos<a;){if(_<=0){var s=t.readVarint();d=7&s,_=s>>3}if(_--,d===1||d===2)i+=t.readSVarint(),e+=t.readSVarint(),d===1&&(n&&r.push(n),n=[]),n.push(new Oe(i,e));else{if(d!==7)throw new Error("unknown command "+d);n&&n.push(n[0].clone())}}return n&&r.push(n),r},Cu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var n=t.readVarint()+t.pos,a=1,d=0,_=0,i=0,e=1/0,r=-1/0,s=1/0,p=-1/0;t.pos<n;){if(d<=0){var m=t.readVarint();a=7&m,d=m>>3}if(d--,a===1||a===2)(_+=t.readSVarint())<e&&(e=_),_>r&&(r=_),(i+=t.readSVarint())<s&&(s=i),i>p&&(p=i);else if(a!==7)throw new Error("unknown command "+a)}return[e,s,r,p]},Cu.prototype.toGeoJSON=function(t,n,a){var d,_,i=this.extent*Math.pow(2,a),e=this.extent*t,r=this.extent*n,s=this.loadGeometry(),p=Cu.types[this.type];function m(E){for(var M=0;M<E.length;M++){var L=E[M];E[M]=[360*(L.x+e)/i-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+r)/i)*Math.PI/180))-90]}}switch(this.type){case 1:var g=[];for(d=0;d<s.length;d++)g[d]=s[d][0];m(s=g);break;case 2:for(d=0;d<s.length;d++)m(s[d]);break;case 3:for(s=function(E){var M=E.length;if(M<=1)return[E];for(var L,F,O=[],Z=0;Z<M;Z++){var $=kd(E[Z]);$!==0&&(F===void 0&&(F=$<0),F===$<0?(L&&O.push(L),L=[E[Z]]):L.push(E[Z]))}return L&&O.push(L),O}(s),d=0;d<s.length;d++)for(_=0;_<s[d].length;_++)m(s[d][_])}s.length===1?s=s[0]:p="Multi"+p;var I={type:"Feature",geometry:{type:p,coordinates:s},properties:this.properties};return"id"in this&&(I.id=this.id),I};var vh=ou;function ou(t,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ad,this,n),this.length=this._features.length}function Ad(t,n,a){t===15?n.version=a.readVarint():t===1?n.name=a.readString():t===5?n.extent=a.readVarint():t===2?n._features.push(a.pos):t===3?n._keys.push(a.readString()):t===4&&n._values.push(function(d){for(var _=null,i=d.readVarint()+d.pos;d.pos<i;){var e=d.readVarint()>>3;_=e===1?d.readString():e===2?d.readFloat():e===3?d.readDouble():e===4?d.readVarint64():e===5?d.readVarint():e===6?d.readSVarint():e===7?d.readBoolean():null}return _}(a))}function zd(t,n,a){if(t===3){var d=new vh(a,a.readVarint()+a.pos);d.length&&(n[d.name]=d)}}ou.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var n=this._pbf.readVarint()+this._pbf.pos;return new np(this._pbf,n,this.extent,this._keys,this._values)};var Pu={VectorTile:function(t,n){this.layers=t.readFields(zd,{},n)},VectorTileFeature:np,VectorTileLayer:vh},op=Pu.VectorTileFeature.types,Sc=Math.pow(2,13);function Ju(t,n,a,d,_,i,e,r){t.emplaceBack(n,a,2*Math.floor(d*Sc)+e,_*Sc*2,i*Sc*2,Math.round(r))}var ns=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(n){return n.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new K,this.indexArray=new it,this.programConfigurations=new Hi(t.layers,t.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(n){return n.isStateDependent()}).map(function(n){return n.id})};function Cd(t,n){return t.x===n.x&&(t.x<0||t.x>8192)||t.y===n.y&&(t.y<0||t.y>8192)}ns.prototype.populate=function(t,n,a){this.features=[],this.hasPattern=Ku("fill-extrusion",this.layers,n);for(var d=0,_=t;d<_.length;d+=1){var i=_[d],e=i.feature,r=i.id,s=i.index,p=i.sourceLayerIndex,m=this.layers[0]._featureFilter.needGeometry,g=On(e,m);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),g,a)){var I={id:r,sourceLayerIndex:p,index:s,geometry:m?g.geometry:Vi(e),properties:e.properties,type:e.type,patterns:{}};this.hasPattern?this.features.push(yh("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,s,a,{}),n.featureIndex.insert(e,I.geometry,s,p,this.index,!0)}}},ns.prototype.addFeatures=function(t,n,a){for(var d=0,_=this.features;d<_.length;d+=1){var i=_[d];this.addFeature(i,i.geometry,i.index,n,a)}},ns.prototype.update=function(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)},ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ns.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ed),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ns.prototype.addFeature=function(t,n,a,d,_){for(var i=0,e=nu(n,500);i<e.length;i+=1){for(var r=e[i],s=0,p=0,m=r;p<m.length;p+=1)s+=m[p].length;for(var g=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),I=0,E=r;I<E.length;I+=1){var M=E[I];if(M.length!==0&&!((at=M).every(function(ct){return ct.x<0})||at.every(function(ct){return ct.x>8192})||at.every(function(ct){return ct.y<0})||at.every(function(ct){return ct.y>8192})))for(var L=0,F=0;F<M.length;F++){var O=M[F];if(F>=1){var Z=M[F-1];if(!Cd(O,Z)){g.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(g=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $=O.sub(Z)._perp()._unit(),te=Z.dist(O);L+te>32768&&(L=0),Ju(this.layoutVertexArray,O.x,O.y,$.x,$.y,0,0,L),Ju(this.layoutVertexArray,O.x,O.y,$.x,$.y,0,1,L),Ju(this.layoutVertexArray,Z.x,Z.y,$.x,$.y,0,0,L+=te),Ju(this.layoutVertexArray,Z.x,Z.y,$.x,$.y,0,1,L);var ie=g.vertexLength;this.indexArray.emplaceBack(ie,ie+2,ie+1),this.indexArray.emplaceBack(ie+1,ie+2,ie+3),g.vertexLength+=4,g.primitiveLength+=2}}}}if(g.vertexLength+s>se.MAX_VERTEX_ARRAY_LENGTH&&(g=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),op[t.type]==="Polygon"){for(var ve=[],Pe=[],Me=g.vertexLength,Ue=0,qe=r;Ue<qe.length;Ue+=1){var Ge=qe[Ue];if(Ge.length!==0){Ge!==r[0]&&Pe.push(ve.length/2);for(var Qe=0;Qe<Ge.length;Qe++){var yt=Ge[Qe];Ju(this.layoutVertexArray,yt.x,yt.y,0,0,1,1,0),ve.push(yt.x),ve.push(yt.y)}}}for(var nt=ch(ve,Pe),tt=0;tt<nt.length;tt+=3)this.indexArray.emplaceBack(Me+nt[tt],Me+nt[tt+2],Me+nt[tt+1]);g.primitiveLength+=nt.length/3,g.vertexLength+=s}}var at;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,_,d)},Dt("FillExtrusionBucket",ns,{omit:["layers","features"]});var Pd={paint:new o({"fill-extrusion-opacity":new gt(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ui(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _n(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ui(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ui(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gt(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},xh=function(t){function n(a){t.call(this,a,Pd)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.createBucket=function(a){return new ns(a)},n.prototype.queryRadius=function(){return Ro(this.paint.get("fill-extrusion-translate"))},n.prototype.is3D=function(){return!0},n.prototype.queryIntersectsFeature=function(a,d,_,i,e,r,s,p){var m=_a(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),r.angle,s),g=this.paint.get("fill-extrusion-height").evaluate(d,_),I=this.paint.get("fill-extrusion-base").evaluate(d,_),E=function(L,F,O,Z){for(var $=[],te=0,ie=L;te<ie.length;te+=1){var ve=ie[te],Pe=[ve.x,ve.y,0,1];Ql(Pe,Pe,F),$.push(new Oe(Pe[0]/Pe[3],Pe[1]/Pe[3]))}return $}(m,p),M=function(L,F,O,Z){for(var $=[],te=[],ie=Z[8]*F,ve=Z[9]*F,Pe=Z[10]*F,Me=Z[11]*F,Ue=Z[8]*O,qe=Z[9]*O,Ge=Z[10]*O,Qe=Z[11]*O,yt=0,nt=L;yt<nt.length;yt+=1){for(var tt=[],at=[],ct=0,pt=nt[yt];ct<pt.length;ct+=1){var Je=pt[ct],Tt=Je.x,At=Je.y,li=Z[0]*Tt+Z[4]*At+Z[12],fi=Z[1]*Tt+Z[5]*At+Z[13],wi=Z[2]*Tt+Z[6]*At+Z[14],ki=Z[3]*Tt+Z[7]*At+Z[15],er=wi+Pe,qi=ki+Me,tr=li+Ue,Ki=fi+qe,yr=wi+Ge,Xi=ki+Qe,gr=new Oe((li+ie)/qi,(fi+ve)/qi);gr.z=er/qi,tt.push(gr);var ai=new Oe(tr/Xi,Ki/Xi);ai.z=yr/Xi,at.push(ai)}$.push(tt),te.push(at)}return[$,te]}(i,I,g,p);return function(L,F,O){var Z=1/0;vo(O,F)&&(Z=Ic(O,F[0]));for(var $=0;$<F.length;$++)for(var te=F[$],ie=L[$],ve=0;ve<te.length-1;ve++){var Pe=te[ve],Me=[Pe,te[ve+1],ie[ve+1],ie[ve],Pe];hn(O,Me)&&(Z=Math.min(Z,Ic(O,Me)))}return Z!==1/0&&Z}(M[0],M[1],E)},n}(h);function pl(t,n){return t.x*n.x+t.y*n.y}function Ic(t,n){if(t.length===1){for(var a,d=0,_=n[d++];!a||_.equals(a);)if(!(a=n[d++]))return 1/0;for(;d<n.length;d++){var i=n[d],e=t[0],r=a.sub(_),s=i.sub(_),p=e.sub(_),m=pl(r,r),g=pl(r,s),I=pl(s,s),E=pl(p,r),M=pl(p,s),L=m*I-g*g,F=(I*E-g*M)/L,O=(m*M-g*E)/L,Z=_.z*(1-F-O)+a.z*F+i.z*O;if(isFinite(Z))return Z}return 1/0}for(var $=1/0,te=0,ie=n;te<ie.length;te+=1)$=Math.min($,ie[te].z);return $}var Md=D([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Dd=D([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ld=Pu.VectorTileFeature.types,Yu=Math.cos(Math.PI/180*37.5),bh=Math.pow(2,14)/.5,bo=function(t){var n=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(a){n.gradients[a.id]={}}),this.layoutVertexArray=new ae,this.layoutVertexArray2=new fe,this.indexArray=new it,this.programConfigurations=new Hi(t.layers,t.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};bo.prototype.populate=function(t,n,a){this.hasPattern=Ku("line",this.layers,n);for(var d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),i=[],e=0,r=t;e<r.length;e+=1){var s=r[e],p=s.feature,m=s.id,g=s.index,I=s.sourceLayerIndex,E=this.layers[0]._featureFilter.needGeometry,M=On(p,E);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),M,a)){var L=_?d.evaluate(M,{},a):void 0,F={id:m,properties:p.properties,type:p.type,sourceLayerIndex:I,index:g,geometry:E?M.geometry:Vi(p),patterns:{},sortKey:L};i.push(F)}}_&&i.sort(function(Me,Ue){return Me.sortKey-Ue.sortKey});for(var O=0,Z=i;O<Z.length;O+=1){var $=Z[O],te=$.geometry,ie=$.index,ve=$.sourceLayerIndex;if(this.hasPattern){var Pe=yh("line",this.layers,$,this.zoom,n);this.patternFeatures.push(Pe)}else this.addFeature($,te,ie,a,{});n.featureIndex.insert(t[ie].feature,te,ie,ve,this.index)}},bo.prototype.update=function(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)},bo.prototype.addFeatures=function(t,n,a){for(var d=0,_=this.patternFeatures;d<_.length;d+=1){var i=_[d];this.addFeature(i,i.geometry,i.index,n,a)}},bo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bo.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Dd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Md),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},bo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},bo.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},bo.prototype.addFeature=function(t,n,a,d,_){var i=this.layers[0].layout,e=i.get("line-join").evaluate(t,{}),r=i.get("line-cap"),s=i.get("line-miter-limit"),p=i.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var m=0,g=n;m<g.length;m+=1)this.addLine(g[m],t,e,r,s,p);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,_,d)},bo.prototype.addLine=function(t,n,a,d,_,i){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var r=Ld[n.type]==="Polygon",s=t.length;s>=2&&t[s-1].equals(t[s-2]);)s--;for(var p=0;p<s-1&&t[p].equals(t[p+1]);)p++;if(!(s<(r?3:2))){a==="bevel"&&(_=1.05);var m,g=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray),E=void 0,M=void 0,L=void 0,F=void 0;this.e1=this.e2=-1,r&&(F=t[p].sub(m=t[s-2])._unit()._perp());for(var O=p;O<s;O++)if(!(M=O===s-1?r?t[p+1]:void 0:t[O+1])||!t[O].equals(M)){F&&(L=F),m&&(E=m),m=t[O],F=M?M.sub(m)._unit()._perp():L;var Z=(L=L||F).add(F);Z.x===0&&Z.y===0||Z._unit();var $=L.x*F.x+L.y*F.y,te=Z.x*F.x+Z.y*F.y,ie=te!==0?1/te:1/0,ve=2*Math.sqrt(2-2*te),Pe=te<Yu&&E&&M,Me=L.x*F.y-L.y*F.x>0;if(Pe&&O>p){var Ue=m.dist(E);if(Ue>2*g){var qe=m.sub(m.sub(E)._mult(g/Ue)._round());this.updateDistance(E,qe),this.addCurrentVertex(qe,L,0,0,I),E=qe}}var Ge=E&&M,Qe=Ge?a:r?"butt":d;if(Ge&&Qe==="round"&&(ie<i?Qe="miter":ie<=2&&(Qe="fakeround")),Qe==="miter"&&ie>_&&(Qe="bevel"),Qe==="bevel"&&(ie>2&&(Qe="flipbevel"),ie<_&&(Qe="miter")),E&&this.updateDistance(E,m),Qe==="miter")Z._mult(ie),this.addCurrentVertex(m,Z,0,0,I);else if(Qe==="flipbevel"){if(ie>100)Z=F.mult(-1);else{var yt=ie*L.add(F).mag()/L.sub(F).mag();Z._perp()._mult(yt*(Me?-1:1))}this.addCurrentVertex(m,Z,0,0,I),this.addCurrentVertex(m,Z.mult(-1),0,0,I)}else if(Qe==="bevel"||Qe==="fakeround"){var nt=-Math.sqrt(ie*ie-1),tt=Me?nt:0,at=Me?0:nt;if(E&&this.addCurrentVertex(m,L,tt,at,I),Qe==="fakeround")for(var ct=Math.round(180*ve/Math.PI/20),pt=1;pt<ct;pt++){var Je=pt/ct;if(Je!==.5){var Tt=Je-.5;Je+=Je*Tt*(Je-1)*((1.0904+$*($*(3.55645-1.43519*$)-3.2452))*Tt*Tt+(.848013+$*(.215638*$-1.06021)))}var At=F.sub(L)._mult(Je)._add(L)._unit()._mult(Me?-1:1);this.addHalfVertex(m,At.x,At.y,!1,Me,0,I)}M&&this.addCurrentVertex(m,F,-tt,-at,I)}else if(Qe==="butt")this.addCurrentVertex(m,Z,0,0,I);else if(Qe==="square"){var li=E?1:-1;this.addCurrentVertex(m,Z,li,li,I)}else Qe==="round"&&(E&&(this.addCurrentVertex(m,L,0,0,I),this.addCurrentVertex(m,L,1,1,I,!0)),M&&(this.addCurrentVertex(m,F,-1,-1,I,!0),this.addCurrentVertex(m,F,0,0,I)));if(Pe&&O<s-1){var fi=m.dist(M);if(fi>2*g){var wi=m.add(M.sub(m)._mult(g/fi)._round());this.updateDistance(m,wi),this.addCurrentVertex(wi,F,0,0,I),m=wi}}}}},bo.prototype.addCurrentVertex=function(t,n,a,d,_,i){i===void 0&&(i=!1);var e=n.y*d-n.x,r=-n.y-n.x*d;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,i,!1,a,_),this.addHalfVertex(t,e,r,i,!0,-d,_),this.distance>bh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,n,a,d,_,i))},bo.prototype.addHalfVertex=function(t,n,a,d,_,i,e){var r=.5*(this.lineClips?this.scaledDistance*(bh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(d?1:0),(t.y<<1)+(_?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(i===0?0:i<0?-1:1)|(63&r)<<2,r>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var s=e.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,s),e.primitiveLength++),_?this.e2=s:this.e1=s},bo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},bo.prototype.updateDistance=function(t,n){this.distance+=t.dist(n),this.updateScaledDistance()},Dt("LineBucket",bo,{omit:["layers","patternFeatures"]});var Rd=new o({"line-cap":new gt(ye.layout_line["line-cap"]),"line-join":new ui(ye.layout_line["line-join"]),"line-miter-limit":new gt(ye.layout_line["line-miter-limit"]),"line-round-limit":new gt(ye.layout_line["line-round-limit"]),"line-sort-key":new ui(ye.layout_line["line-sort-key"])}),ap={paint:new o({"line-opacity":new ui(ye.paint_line["line-opacity"]),"line-color":new ui(ye.paint_line["line-color"]),"line-translate":new gt(ye.paint_line["line-translate"]),"line-translate-anchor":new gt(ye.paint_line["line-translate-anchor"]),"line-width":new ui(ye.paint_line["line-width"]),"line-gap-width":new ui(ye.paint_line["line-gap-width"]),"line-offset":new ui(ye.paint_line["line-offset"]),"line-blur":new ui(ye.paint_line["line-blur"]),"line-dasharray":new $n(ye.paint_line["line-dasharray"]),"line-pattern":new _n(ye.paint_line["line-pattern"]),"line-gradient":new b(ye.paint_line["line-gradient"])}),layout:Rd},sp=new(function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.possiblyEvaluate=function(a,d){return d=new $i(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),t.prototype.possiblyEvaluate.call(this,a,d)},n.prototype.evaluate=function(a,d,_,i){return d=wt({},d,{zoom:Math.floor(d.zoom)}),t.prototype.evaluate.call(this,a,d,_,i)},n}(ui))(ap.paint.properties["line-width"].specification);sp.useIntegerZoom=!0;var Bd=function(t){function n(a){t.call(this,a,ap),this.gradientVersion=0}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype._handleSpecialPaintPropertyUpdate=function(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ao,this.gradientVersion=(this.gradientVersion+1)%dt)},n.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},n.prototype.recalculate=function(a,d){t.prototype.recalculate.call(this,a,d),this.paint._values["line-floorwidth"]=sp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)},n.prototype.createBucket=function(a){return new bo(a)},n.prototype.queryRadius=function(a){var d=a,_=lp(pn("line-width",this,d),pn("line-gap-width",this,d)),i=pn("line-offset",this,d);return _/2+Math.abs(i)+Ro(this.paint.get("line-translate"))},n.prototype.queryIntersectsFeature=function(a,d,_,i,e,r,s){var p=_a(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),r.angle,s),m=s/2*lp(this.paint.get("line-width").evaluate(d,_),this.paint.get("line-gap-width").evaluate(d,_)),g=this.paint.get("line-offset").evaluate(d,_);return g&&(i=function(I,E){for(var M=[],L=new Oe(0,0),F=0;F<I.length;F++){for(var O=I[F],Z=[],$=0;$<O.length;$++){var te=O[$],ie=O[$+1],ve=$===0?L:te.sub(O[$-1])._unit()._perp(),Pe=$===O.length-1?L:ie.sub(te)._unit()._perp(),Me=ve._add(Pe)._unit();Me._mult(1/(Me.x*Pe.x+Me.y*Pe.y)),Z.push(Me._mult(E)._add(te))}M.push(Z)}return M}(i,g*s)),function(I,E,M){for(var L=0;L<E.length;L++){var F=E[L];if(I.length>=3){for(var O=0;O<F.length;O++)if(Qo(I,F[O]))return!0}if(Au(I,F,M))return!0}return!1}(p,i,m)},n.prototype.isTileClipped=function(){return!0},n}(h);function lp(t,n){return n>0?n+2*t:t}var up=D([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wh=D([{name:"a_projected_pos",components:3,type:"Float32"}],4),Fd=(D([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),D([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Th=(D([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),D([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),cp=D([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function hp(t,n,a){return t.sections.forEach(function(d){d.text=function(_,i,e){var r=i.layout.get("text-transform").evaluate(e,{});return r==="uppercase"?_=_.toLocaleUpperCase():r==="lowercase"&&(_=_.toLocaleLowerCase()),Ot.applyArabicShaping&&(_=Ot.applyArabicShaping(_)),_}(d.text,n,a)}),t}D([{name:"triangle",components:3,type:"Uint16"}]),D([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),D([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),D([{type:"Float32",name:"offsetX"}]),D([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Qu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},pp=function(t,n,a,d,_){var i,e,r=8*_-d-1,s=(1<<r)-1,p=s>>1,m=-7,g=a?_-1:0,I=a?-1:1,E=t[n+g];for(g+=I,i=E&(1<<-m)-1,E>>=-m,m+=r;m>0;i=256*i+t[n+g],g+=I,m-=8);for(e=i&(1<<-m)-1,i>>=-m,m+=d;m>0;e=256*e+t[n+g],g+=I,m-=8);if(i===0)i=1-p;else{if(i===s)return e?NaN:1/0*(E?-1:1);e+=Math.pow(2,d),i-=p}return(E?-1:1)*e*Math.pow(2,i-d)},dp=function(t,n,a,d,_,i){var e,r,s,p=8*i-_-1,m=(1<<p)-1,g=m>>1,I=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=d?0:i-1,M=d?1:-1,L=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(r=isNaN(n)?1:0,e=m):(e=Math.floor(Math.log(n)/Math.LN2),n*(s=Math.pow(2,-e))<1&&(e--,s*=2),(n+=e+g>=1?I/s:I*Math.pow(2,1-g))*s>=2&&(e++,s/=2),e+g>=m?(r=0,e=m):e+g>=1?(r=(n*s-1)*Math.pow(2,_),e+=g):(r=n*Math.pow(2,g-1)*Math.pow(2,_),e=0));_>=8;t[a+E]=255&r,E+=M,r/=256,_-=8);for(e=e<<_|r,p+=_;p>0;t[a+E]=255&e,E+=M,e/=256,p-=8);t[a+E-M]|=128*L},ec=Mr;function Mr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Mr.Varint=0,Mr.Fixed64=1,Mr.Bytes=2,Mr.Fixed32=5;var fp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function wa(t){return t.type===Mr.Bytes?t.readVarint()+t.pos:t.pos+1}function dn(t,n,a){return a?4294967296*n+(t>>>0):4294967296*(n>>>0)+(t>>>0)}function Ec(t,n,a){var d=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));a.realloc(d);for(var _=a.pos-1;_>=t;_--)a.buf[_+d]=a.buf[_]}function mp(t,n){for(var a=0;a<t.length;a++)n.writeVarint(t[a])}function yp(t,n){for(var a=0;a<t.length;a++)n.writeSVarint(t[a])}function Dr(t,n){for(var a=0;a<t.length;a++)n.writeFloat(t[a])}function zl(t,n){for(var a=0;a<t.length;a++)n.writeDouble(t[a])}function Sh(t,n){for(var a=0;a<t.length;a++)n.writeBoolean(t[a])}function gp(t,n){for(var a=0;a<t.length;a++)n.writeFixed32(t[a])}function _p(t,n){for(var a=0;a<t.length;a++)n.writeSFixed32(t[a])}function dl(t,n){for(var a=0;a<t.length;a++)n.writeFixed64(t[a])}function Mu(t,n){for(var a=0;a<t.length;a++)n.writeSFixed64(t[a])}function tc(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+16777216*t[n+3]}function Du(t,n,a){t[a]=n,t[a+1]=n>>>8,t[a+2]=n>>>16,t[a+3]=n>>>24}function vp(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+(t[n+3]<<24)}function Od(t,n,a){t===1&&a.readMessage(Ud,n)}function Ud(t,n,a){if(t===3){var d=a.readMessage(jd,{}),_=d.width,i=d.height,e=d.left,r=d.top,s=d.advance;n.push({id:d.id,bitmap:new ll({width:_+6,height:i+6},d.bitmap),metrics:{width:_,height:i,left:e,top:r,advance:s}})}}function jd(t,n,a){t===1?n.id=a.readVarint():t===2?n.bitmap=a.readBytes():t===3?n.width=a.readVarint():t===4?n.height=a.readVarint():t===5?n.left=a.readSVarint():t===6?n.top=a.readSVarint():t===7&&(n.advance=a.readVarint())}function xp(t){for(var n=0,a=0,d=0,_=t;d<_.length;d+=1){var i=_[d];n+=i.w*i.h,a=Math.max(a,i.w)}t.sort(function(L,F){return F.h-L.h});for(var e=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}],r=0,s=0,p=0,m=t;p<m.length;p+=1)for(var g=m[p],I=e.length-1;I>=0;I--){var E=e[I];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,s=Math.max(s,g.y+g.h),r=Math.max(r,g.x+g.w),g.w===E.w&&g.h===E.h){var M=e.pop();I<e.length&&(e[I]=M)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(e.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:r,h:s,fill:n/(r*s)||0}}Mr.prototype={destroy:function(){this.buf=null},readFields:function(t,n,a){for(a=a||this.length;this.pos<a;){var d=this.readVarint(),_=d>>3,i=this.pos;this.type=7&d,t(_,n,this),this.pos===i&&this.skip(d)}return n},readMessage:function(t,n){return this.readFields(t,n,this.readVarint()+this.pos)},readFixed32:function(){var t=tc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=vp(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=tc(this.buf,this.pos)+4294967296*tc(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=tc(this.buf,this.pos)+4294967296*vp(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=pp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=pp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var n,a,d=this.buf;return n=127&(a=d[this.pos++]),a<128?n:(n|=(127&(a=d[this.pos++]))<<7,a<128?n:(n|=(127&(a=d[this.pos++]))<<14,a<128?n:(n|=(127&(a=d[this.pos++]))<<21,a<128?n:function(_,i,e){var r,s,p=e.buf;if(r=(112&(s=p[e.pos++]))>>4,s<128||(r|=(127&(s=p[e.pos++]))<<3,s<128)||(r|=(127&(s=p[e.pos++]))<<10,s<128)||(r|=(127&(s=p[e.pos++]))<<17,s<128)||(r|=(127&(s=p[e.pos++]))<<24,s<128)||(r|=(1&(s=p[e.pos++]))<<31,s<128))return dn(_,r,i);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(a=d[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&fp?function(a,d,_){return fp.decode(a.subarray(d,_))}(this.buf,n,t):function(a,d,_){for(var i="",e=d;e<_;){var r,s,p,m=a[e],g=null,I=m>239?4:m>223?3:m>191?2:1;if(e+I>_)break;I===1?m<128&&(g=m):I===2?(192&(r=a[e+1]))==128&&(g=(31&m)<<6|63&r)<=127&&(g=null):I===3?(s=a[e+2],(192&(r=a[e+1]))==128&&(192&s)==128&&((g=(15&m)<<12|(63&r)<<6|63&s)<=2047||g>=55296&&g<=57343)&&(g=null)):I===4&&(s=a[e+2],p=a[e+3],(192&(r=a[e+1]))==128&&(192&s)==128&&(192&p)==128&&((g=(15&m)<<18|(63&r)<<12|(63&s)<<6|63&p)<=65535||g>=1114112)&&(g=null)),g===null?(g=65533,I=1):g>65535&&(g-=65536,i+=String.fromCharCode(g>>>10&1023|55296),g=56320|1023&g),i+=String.fromCharCode(g),e+=I}return i}(this.buf,n,t)},readBytes:function(){var t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n},readPackedVarint:function(t,n){if(this.type!==Mr.Bytes)return t.push(this.readVarint(n));var a=wa(this);for(t=t||[];this.pos<a;)t.push(this.readVarint(n));return t},readPackedSVarint:function(t){if(this.type!==Mr.Bytes)return t.push(this.readSVarint());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Mr.Bytes)return t.push(this.readBoolean());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Mr.Bytes)return t.push(this.readFloat());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Mr.Bytes)return t.push(this.readDouble());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Mr.Bytes)return t.push(this.readFixed32());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Mr.Bytes)return t.push(this.readSFixed32());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Mr.Bytes)return t.push(this.readFixed64());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Mr.Bytes)return t.push(this.readSFixed64());var n=wa(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed64());return t},skip:function(t){var n=7&t;if(n===Mr.Varint)for(;this.buf[this.pos++]>127;);else if(n===Mr.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Mr.Fixed32)this.pos+=4;else{if(n!==Mr.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(t,n){this.writeVarint(t<<3|n)},realloc:function(t){for(var n=this.length||16;n<this.pos+t;)n*=2;if(n!==this.length){var a=new Uint8Array(n);a.set(this.buf),this.buf=a,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Du(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Du(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Du(this.buf,-1&t,this.pos),Du(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Du(this.buf,-1&t,this.pos),Du(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(n,a){var d,_;if(n>=0?(d=n%4294967296|0,_=n/4294967296|0):(_=~(-n/4294967296),4294967295^(d=~(-n%4294967296))?d=d+1|0:(d=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(i,e,r){r.buf[r.pos++]=127&i|128,i>>>=7,r.buf[r.pos++]=127&i|128,i>>>=7,r.buf[r.pos++]=127&i|128,i>>>=7,r.buf[r.pos++]=127&i|128,r.buf[r.pos]=127&(i>>>=7)}(d,0,a),function(i,e){var r=(7&i)<<4;e.buf[e.pos++]|=r|((i>>>=3)?128:0),i&&(e.buf[e.pos++]=127&i|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=127&i|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=127&i|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=127&i|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=127&i)))))}(_,a)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var n=this.pos;this.pos=function(d,_,i){for(var e,r,s=0;s<_.length;s++){if((e=_.charCodeAt(s))>55295&&e<57344){if(!r){e>56319||s+1===_.length?(d[i++]=239,d[i++]=191,d[i++]=189):r=e;continue}if(e<56320){d[i++]=239,d[i++]=191,d[i++]=189,r=e;continue}e=r-55296<<10|e-56320|65536,r=null}else r&&(d[i++]=239,d[i++]=191,d[i++]=189,r=null);e<128?d[i++]=e:(e<2048?d[i++]=e>>6|192:(e<65536?d[i++]=e>>12|224:(d[i++]=e>>18|240,d[i++]=e>>12&63|128),d[i++]=e>>6&63|128),d[i++]=63&e|128)}return i}(this.buf,t,this.pos);var a=this.pos-n;a>=128&&Ec(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeFloat:function(t){this.realloc(4),dp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),dp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var n=t.length;this.writeVarint(n),this.realloc(n);for(var a=0;a<n;a++)this.buf[this.pos++]=t[a]},writeRawMessage:function(t,n){this.pos++;var a=this.pos;t(n,this);var d=this.pos-a;d>=128&&Ec(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d},writeMessage:function(t,n,a){this.writeTag(t,Mr.Bytes),this.writeRawMessage(n,a)},writePackedVarint:function(t,n){n.length&&this.writeMessage(t,mp,n)},writePackedSVarint:function(t,n){n.length&&this.writeMessage(t,yp,n)},writePackedBoolean:function(t,n){n.length&&this.writeMessage(t,Sh,n)},writePackedFloat:function(t,n){n.length&&this.writeMessage(t,Dr,n)},writePackedDouble:function(t,n){n.length&&this.writeMessage(t,zl,n)},writePackedFixed32:function(t,n){n.length&&this.writeMessage(t,gp,n)},writePackedSFixed32:function(t,n){n.length&&this.writeMessage(t,_p,n)},writePackedFixed64:function(t,n){n.length&&this.writeMessage(t,dl,n)},writePackedSFixed64:function(t,n){n.length&&this.writeMessage(t,Mu,n)},writeBytesField:function(t,n){this.writeTag(t,Mr.Bytes),this.writeBytes(n)},writeFixed32Field:function(t,n){this.writeTag(t,Mr.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(t,n){this.writeTag(t,Mr.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(t,n){this.writeTag(t,Mr.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(t,n){this.writeTag(t,Mr.Fixed64),this.writeSFixed64(n)},writeVarintField:function(t,n){this.writeTag(t,Mr.Varint),this.writeVarint(n)},writeSVarintField:function(t,n){this.writeTag(t,Mr.Varint),this.writeSVarint(n)},writeStringField:function(t,n){this.writeTag(t,Mr.Bytes),this.writeString(n)},writeFloatField:function(t,n){this.writeTag(t,Mr.Fixed32),this.writeFloat(n)},writeDoubleField:function(t,n){this.writeTag(t,Mr.Fixed64),this.writeDouble(n)},writeBooleanField:function(t,n){this.writeVarintField(t,Boolean(n))}};var kc=function(t,n){var a=n.pixelRatio,d=n.version,_=n.stretchX,i=n.stretchY,e=n.content;this.paddedRect=t,this.pixelRatio=a,this.stretchX=_,this.stretchY=i,this.content=e,this.version=d},ic={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};ic.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},ic.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},ic.tlbr.get=function(){return this.tl.concat(this.br)},ic.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(kc.prototype,ic);var rc=function(t,n){var a={},d={};this.haveRenderCallbacks=[];var _=[];this.addImages(t,a,_),this.addImages(n,d,_);var i=xp(_),e=new xo({width:i.w||1,height:i.h||1});for(var r in t){var s=t[r],p=a[r].paddedRect;xo.copy(s.data,e,{x:0,y:0},{x:p.x+1,y:p.y+1},s.data)}for(var m in n){var g=n[m],I=d[m].paddedRect,E=I.x+1,M=I.y+1,L=g.data.width,F=g.data.height;xo.copy(g.data,e,{x:0,y:0},{x:E,y:M},g.data),xo.copy(g.data,e,{x:0,y:F-1},{x:E,y:M-1},{width:L,height:1}),xo.copy(g.data,e,{x:0,y:0},{x:E,y:M+F},{width:L,height:1}),xo.copy(g.data,e,{x:L-1,y:0},{x:E-1,y:M},{width:1,height:F}),xo.copy(g.data,e,{x:0,y:0},{x:E+L,y:M},{width:1,height:F})}this.image=e,this.iconPositions=a,this.patternPositions=d};rc.prototype.addImages=function(t,n,a){for(var d in t){var _=t[d],i={x:0,y:0,w:_.data.width+2,h:_.data.height+2};a.push(i),n[d]=new kc(i,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},rc.prototype.patchUpdatedImages=function(t,n){for(var a in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)},rc.prototype.patchUpdatedImage=function(t,n,a){if(t&&n&&t.version!==n.version){t.version=n.version;var d=t.tl;a.update(n.data,void 0,{x:d[0],y:d[1]})}},Dt("ImagePosition",kc),Dt("ImageAtlas",rc);var wo={horizontal:1,vertical:2,horizontalOnly:3},os=function(){this.scale=1,this.fontStack="",this.imageName=null};os.forText=function(t,n){var a=new os;return a.scale=t||1,a.fontStack=n,a},os.forImage=function(t){var n=new os;return n.imageName=t,n};var Qn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Ac(t,n,a,d,_,i,e,r,s,p,m,g,I,E,M,L){var F,O=Qn.fromFeature(t,_);g===wo.vertical&&O.verticalizePunctuation();var Z=Ot.processBidirectionalText,$=Ot.processStyledBidirectionalText;if(Z&&O.sections.length===1){F=[];for(var te=0,ie=Z(O.toString(),au(O,p,i,n,d,E,M));te<ie.length;te+=1){var ve=ie[te],Pe=new Qn;Pe.text=ve,Pe.sections=O.sections;for(var Me=0;Me<ve.length;Me++)Pe.sectionIndex.push(0);F.push(Pe)}}else if($){F=[];for(var Ue=0,qe=$(O.text,O.sectionIndex,au(O,p,i,n,d,E,M));Ue<qe.length;Ue+=1){var Ge=qe[Ue],Qe=new Qn;Qe.text=Ge[0],Qe.sectionIndex=Ge[1],Qe.sections=O.sections,F.push(Qe)}}else F=function(tt,at){for(var ct=[],pt=tt.text,Je=0,Tt=0,At=at;Tt<At.length;Tt+=1){var li=At[Tt];ct.push(tt.substring(Je,li)),Je=li}return Je<pt.length&&ct.push(tt.substring(Je,pt.length)),ct}(O,au(O,p,i,n,d,E,M));var yt=[],nt={positionedLines:yt,text:O.toString(),top:m[1],bottom:m[1],left:m[0],right:m[0],writingMode:g,iconsInText:!1,verticalizable:!1};return function(tt,at,ct,pt,Je,Tt,At,li,fi,wi,ki,er){for(var qi=0,tr=-17,Ki=0,yr=0,Xi=li==="right"?1:li==="left"?0:.5,gr=0,ai=0,Pi=Je;ai<Pi.length;ai+=1){var Ci=Pi[ai];Ci.trim();var xi=Ci.getMaxScale(),Lr=24*(xi-1),Tr={positionedGlyphs:[],lineOffset:0};tt.positionedLines[gr]=Tr;var Ti=Tr.positionedGlyphs,Zi=0;if(Ci.length()){for(var mi=0;mi<Ci.length();mi++){var Ai=Ci.getSection(mi),$r=Ci.getSectionIndex(mi),Fr=Ci.getCharCode(mi),Un=0,_r=null,Xn=null,Wn=null,To=24,eo=!(fi===wo.horizontal||!ki&&!ws(Fr)||ki&&(zc[Fr]||(ss=Fr,Bt.Arabic(ss)||Bt["Arabic Supplement"](ss)||Bt["Arabic Extended-A"](ss)||Bt["Arabic Presentation Forms-A"](ss)||Bt["Arabic Presentation Forms-B"](ss))));if(Ai.imageName){var Hn=pt[Ai.imageName];if(!Hn)continue;Wn=Ai.imageName,tt.iconsInText=tt.iconsInText||!0,Xn=Hn.paddedRect;var So=Hn.displaySize;Ai.scale=24*Ai.scale/er,Un=Lr+(24-So[1]*Ai.scale),To=(_r={width:So[0],height:So[1],left:1,top:-3,advance:eo?So[1]:So[0]}).advance;var Ms=eo?So[0]*Ai.scale-24*xi:So[1]*Ai.scale-24*xi;Ms>0&&Ms>Zi&&(Zi=Ms)}else{var fc=ct[Ai.fontStack],Fl=fc&&fc[Fr];if(Fl&&Fl.rect)Xn=Fl.rect,_r=Fl.metrics;else{var pu=at[Ai.fontStack],Fa=pu&&pu[Fr];if(!Fa)continue;_r=Fa.metrics}Un=24*(xi-Ai.scale)}eo?(tt.verticalizable=!0,Ti.push({glyph:Fr,imageName:Wn,x:qi,y:tr+Un,vertical:eo,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:$r,metrics:_r,rect:Xn}),qi+=To*Ai.scale+wi):(Ti.push({glyph:Fr,imageName:Wn,x:qi,y:tr+Un,vertical:eo,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:$r,metrics:_r,rect:Xn}),qi+=_r.advance*Ai.scale+wi)}Ti.length!==0&&(Ki=Math.max(qi-wi,Ki),Pc(Ti,0,Ti.length-1,Xi,Zi)),qi=0;var mc=Tt*xi+Zi;Tr.lineOffset=Math.max(Zi,Lr),tr+=mc,yr=Math.max(mc,yr),++gr}else tr+=Tt,++gr}var ss,du=tr- -17,fu=Cl(At),Ol=fu.horizontalAlign,ju=fu.verticalAlign;(function(Vc,Nc,yc,gc,qc,_c,Vo,Ul,vc){var Kn,Ta=(Nc-yc)*qc;Kn=_c!==Vo?-Ul*gc- -17:(-gc*vc+.5)*Vo;for(var Ds=0,ml=Vc;Ds<ml.length;Ds+=1)for(var jl=0,ls=ml[Ds].positionedGlyphs;jl<ls.length;jl+=1){var Zc=ls[jl];Zc.x+=Ta,Zc.y+=Kn}})(tt.positionedLines,Xi,Ol,ju,Ki,yr,Tt,du,Je.length),tt.top+=-ju*du,tt.bottom=tt.top+du,tt.left+=-Ol*Ki,tt.right=tt.left+Ki}(nt,n,a,d,F,e,r,s,g,p,I,L),!function(tt){for(var at=0,ct=tt;at<ct.length;at+=1)if(ct[at].positionedGlyphs.length!==0)return!1;return!0}(yt)&&nt}Qn.fromFeature=function(t,n){for(var a=new Qn,d=0;d<t.sections.length;d++){var _=t.sections[d];_.image?a.addImageSection(_):a.addTextSection(_,n)}return a},Qn.prototype.length=function(){return this.text.length},Qn.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Qn.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Qn.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Qn.prototype.verticalizePunctuation=function(){this.text=function(t){for(var n="",a=0;a<t.length;a++){var d=t.charCodeAt(a+1)||null,_=t.charCodeAt(a-1)||null;n+=d&&Yn(d)&&!Qu[t[a+1]]||_&&Yn(_)&&!Qu[t[a-1]]||!Qu[t[a]]?t[a]:Qu[t[a]]}return n}(this.text)},Qn.prototype.trim=function(){for(var t=0,n=0;n<this.text.length&&zc[this.text.charCodeAt(n)];n++)t++;for(var a=this.text.length,d=this.text.length-1;d>=0&&d>=t&&zc[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)},Qn.prototype.substring=function(t,n){var a=new Qn;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a},Qn.prototype.toString=function(){return this.text},Qn.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(n,a){return Math.max(n,t.sections[a].scale)},0)},Qn.prototype.addTextSection=function(t,n){this.text+=t.text,this.sections.push(os.forText(t.scale,t.fontStack||n));for(var a=this.sections.length-1,d=0;d<t.text.length;++d)this.sectionIndex.push(a)},Qn.prototype.addImageSection=function(t){var n=t.image?t.image.name:"";if(n.length!==0){var a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(os.forImage(n)),this.sectionIndex.push(this.sections.length-1)):lr("Reached maximum number of images 6401")}else lr("Can't add FormattedSection with an empty image.")},Qn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var zc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jo={};function Ih(t,n,a,d,_,i){if(n.imageName){var e=d[n.imageName];return e?e.displaySize[0]*n.scale*24/i+_:0}var r=a[n.fontStack],s=r&&r[t];return s?s.metrics.advance*n.scale+_:0}function Cc(t,n,a,d){var _=Math.pow(t-n,2);return d?t<n?_/2:2*_:_+Math.abs(a)*a}function bp(t,n,a){var d=0;return t===10&&(d-=1e4),a&&(d+=150),t!==40&&t!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function nc(t,n,a,d,_,i){for(var e=null,r=Cc(n,a,_,i),s=0,p=d;s<p.length;s+=1){var m=p[s],g=Cc(n-m.x,a,_,i)+m.badness;g<=r&&(e=m,r=g)}return{index:t,x:n,priorBreak:e,badness:r}}function au(t,n,a,d,_,i,e){if(i!=="point")return[];if(!t)return[];for(var r,s=[],p=function(F,O,Z,$,te,ie){for(var ve=0,Pe=0;Pe<F.length();Pe++){var Me=F.getSection(Pe);ve+=Ih(F.getCharCode(Pe),Me,$,te,O,ie)}return ve/Math.max(1,Math.ceil(ve/Z))}(t,n,a,d,_,e),m=t.text.indexOf("\u200B")>=0,g=0,I=0;I<t.length();I++){var E=t.getSection(I),M=t.getCharCode(I);if(zc[M]||(g+=Ih(M,E,d,_,n,e)),I<t.length()-1){var L=!((r=M)<11904||!(Bt["Bopomofo Extended"](r)||Bt.Bopomofo(r)||Bt["CJK Compatibility Forms"](r)||Bt["CJK Compatibility Ideographs"](r)||Bt["CJK Compatibility"](r)||Bt["CJK Radicals Supplement"](r)||Bt["CJK Strokes"](r)||Bt["CJK Symbols and Punctuation"](r)||Bt["CJK Unified Ideographs Extension A"](r)||Bt["CJK Unified Ideographs"](r)||Bt["Enclosed CJK Letters and Months"](r)||Bt["Halfwidth and Fullwidth Forms"](r)||Bt.Hiragana(r)||Bt["Ideographic Description Characters"](r)||Bt["Kangxi Radicals"](r)||Bt["Katakana Phonetic Extensions"](r)||Bt.Katakana(r)||Bt["Vertical Forms"](r)||Bt["Yi Radicals"](r)||Bt["Yi Syllables"](r)));(jo[M]||L||E.imageName)&&s.push(nc(I+1,g,p,s,bp(M,t.getCharCode(I+1),L&&m),!1))}}return function F(O){return O?F(O.priorBreak).concat(O.index):[]}(nc(t.length(),g,p,s,0,!0))}function Cl(t){var n=.5,a=.5;switch(t){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function Pc(t,n,a,d,_){if(d||_)for(var i=t[a],e=(t[a].x+i.metrics.advance*i.scale)*d,r=n;r<=a;r++)t[r].x-=e,t[r].y+=_}function oc(t,n,a,d,_,i){var e,r=t.image;if(r.content){var s=r.content,p=r.pixelRatio||1;e=[s[0]/p,s[1]/p,r.displaySize[0]-s[2]/p,r.displaySize[1]-s[3]/p]}var m,g,I,E,M=n.left*i,L=n.right*i;a==="width"||a==="both"?(E=_[0]+M-d[3],g=_[0]+L+d[1]):g=(E=_[0]+(M+L-r.displaySize[0])/2)+r.displaySize[0];var F=n.top*i,O=n.bottom*i;return a==="height"||a==="both"?(m=_[1]+F-d[0],I=_[1]+O+d[2]):I=(m=_[1]+(F+O-r.displaySize[1])/2)+r.displaySize[1],{image:r,top:m,right:g,bottom:I,left:E,collisionPadding:e}}jo[10]=!0,jo[32]=!0,jo[38]=!0,jo[40]=!0,jo[41]=!0,jo[43]=!0,jo[45]=!0,jo[47]=!0,jo[173]=!0,jo[183]=!0,jo[8203]=!0,jo[8208]=!0,jo[8211]=!0,jo[8231]=!0;var Lu=function(t){function n(a,d,_,i){t.call(this,a,d),this.angle=_,i!==void 0&&(this.segment=i)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.clone=function(){return new n(this.x,this.y,this.angle,this.segment)},n}(Oe);function Mc(t,n){var a=n.expression;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new $i(t+1))};if(a.kind==="source")return{kind:"source"};for(var d=a.zoomStops,_=a.interpolationType,i=0;i<d.length&&d[i]<=t;)i++;for(var e=i=Math.max(0,i-1);e<d.length&&d[e]<t+1;)e++;e=Math.min(d.length-1,e);var r=d[i],s=d[e];return a.kind==="composite"?{kind:"composite",minZoom:r,maxZoom:s,interpolationType:_}:{kind:"camera",minZoom:r,maxZoom:s,minSize:a.evaluate(new $i(r)),maxSize:a.evaluate(new $i(s)),interpolationType:_}}function Eh(t,n,a){var d=n.uSize,_=a.lowerSize;return t.kind==="source"?_/128:t.kind==="composite"?rr(_/128,a.upperSize/128,n.uSizeT):d}function wp(t,n){var a=0,d=0;if(t.kind==="constant")d=t.layoutSize;else if(t.kind!=="source"){var _=t.interpolationType,i=_?Ct(Sn.interpolationFactor(_,n,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?d=rr(t.minSize,t.maxSize,i):a=i}return{uSizeT:a,uSize:d}}Dt("Anchor",Lu);var Tp=Object.freeze({__proto__:null,getSizeData:Mc,evaluateSizeForFeature:Eh,evaluateSizeForZoom:wp,SIZE_PACK_FACTOR:128});function kh(t,n,a,d,_){if(n.segment===void 0)return!0;for(var i=n,e=n.segment+1,r=0;r>-a/2;){if(--e<0)return!1;r-=t[e].dist(i),i=t[e]}r+=t[e].dist(t[e+1]),e++;for(var s=[],p=0;r<a/2;){var m=t[e],g=t[e+1];if(!g)return!1;var I=t[e-1].angleTo(m)-m.angleTo(g);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),s.push({distance:r,angleDelta:I}),p+=I;r-s[0].distance>d;)p-=s.shift().angleDelta;if(p>_)return!1;e++,r+=m.dist(g)}return!0}function Dc(t){for(var n=0,a=0;a<t.length-1;a++)n+=t[a].dist(t[a+1]);return n}function Lc(t,n,a){return t?.6*n*a:0}function Sp(t,n){return Math.max(t?t.right-t.left:0,n?n.right-n.left:0)}function Vd(t,n,a,d,_,i){for(var e=Lc(a,_,i),r=Sp(a,d)*i,s=0,p=Dc(t)/2,m=0;m<t.length-1;m++){var g=t[m],I=t[m+1],E=g.dist(I);if(s+E>p){var M=(p-s)/E,L=rr(g.x,I.x,M),F=rr(g.y,I.y,M),O=new Lu(L,F,I.angleTo(g),m);return O._round(),!e||kh(t,O,r,e,n)?O:void 0}s+=E}}function Ip(t,n,a,d,_,i,e,r,s){var p=Lc(d,i,e),m=Sp(d,_),g=m*e,I=t[0].x===0||t[0].x===s||t[0].y===0||t[0].y===s;return n-g<n/4&&(n=g+n/4),function E(M,L,F,O,Z,$,te,ie,ve){for(var Pe=$/2,Me=Dc(M),Ue=0,qe=L-F,Ge=[],Qe=0;Qe<M.length-1;Qe++){for(var yt=M[Qe],nt=M[Qe+1],tt=yt.dist(nt),at=nt.angleTo(yt);qe+F<Ue+tt;){var ct=((qe+=F)-Ue)/tt,pt=rr(yt.x,nt.x,ct),Je=rr(yt.y,nt.y,ct);if(pt>=0&&pt<ve&&Je>=0&&Je<ve&&qe-Pe>=0&&qe+Pe<=Me){var Tt=new Lu(pt,Je,at,Qe);Tt._round(),O&&!kh(M,Tt,$,O,Z)||Ge.push(Tt)}}Ue+=tt}return ie||Ge.length||te||(Ge=E(M,Ue/2,F,O,Z,$,te,!0,ve)),Ge}(t,I?n/2*r%n:(m/2+2*i)*e*r%n,n,p,a,g,I,!1,s)}function ks(t,n,a,d,_){for(var i=[],e=0;e<t.length;e++)for(var r=t[e],s=void 0,p=0;p<r.length-1;p++){var m=r[p],g=r[p+1];m.x<n&&g.x<n||(m.x<n?m=new Oe(n,m.y+(n-m.x)/(g.x-m.x)*(g.y-m.y))._round():g.x<n&&(g=new Oe(n,m.y+(n-m.x)/(g.x-m.x)*(g.y-m.y))._round()),m.y<a&&g.y<a||(m.y<a?m=new Oe(m.x+(a-m.y)/(g.y-m.y)*(g.x-m.x),a)._round():g.y<a&&(g=new Oe(m.x+(a-m.y)/(g.y-m.y)*(g.x-m.x),a)._round()),m.x>=d&&g.x>=d||(m.x>=d?m=new Oe(d,m.y+(d-m.x)/(g.x-m.x)*(g.y-m.y))._round():g.x>=d&&(g=new Oe(d,m.y+(d-m.x)/(g.x-m.x)*(g.y-m.y))._round()),m.y>=_&&g.y>=_||(m.y>=_?m=new Oe(m.x+(_-m.y)/(g.y-m.y)*(g.x-m.x),_)._round():g.y>=_&&(g=new Oe(m.x+(_-m.y)/(g.y-m.y)*(g.x-m.x),_)._round()),s&&m.equals(s[s.length-1])||i.push(s=[m]),s.push(g)))))}return i}function Ah(t,n,a,d){var _=[],i=t.image,e=i.pixelRatio,r=i.paddedRect.w-2,s=i.paddedRect.h-2,p=t.right-t.left,m=t.bottom-t.top,g=i.stretchX||[[0,r]],I=i.stretchY||[[0,s]],E=function(pt,Je){return pt+Je[1]-Je[0]},M=g.reduce(E,0),L=I.reduce(E,0),F=r-M,O=s-L,Z=0,$=M,te=0,ie=L,ve=0,Pe=F,Me=0,Ue=O;if(i.content&&d){var qe=i.content;Z=as(g,0,qe[0]),te=as(I,0,qe[1]),$=as(g,qe[0],qe[2]),ie=as(I,qe[1],qe[3]),ve=qe[0]-Z,Me=qe[1]-te,Pe=qe[2]-qe[0]-$,Ue=qe[3]-qe[1]-ie}var Ge=function(pt,Je,Tt,At){var li=ac(pt.stretch-Z,$,p,t.left),fi=sc(pt.fixed-ve,Pe,pt.stretch,M),wi=ac(Je.stretch-te,ie,m,t.top),ki=sc(Je.fixed-Me,Ue,Je.stretch,L),er=ac(Tt.stretch-Z,$,p,t.left),qi=sc(Tt.fixed-ve,Pe,Tt.stretch,M),tr=ac(At.stretch-te,ie,m,t.top),Ki=sc(At.fixed-Me,Ue,At.stretch,L),yr=new Oe(li,wi),Xi=new Oe(er,wi),gr=new Oe(er,tr),ai=new Oe(li,tr),Pi=new Oe(fi/e,ki/e),Ci=new Oe(qi/e,Ki/e),xi=n*Math.PI/180;if(xi){var Lr=Math.sin(xi),Tr=Math.cos(xi),Ti=[Tr,-Lr,Lr,Tr];yr._matMult(Ti),Xi._matMult(Ti),ai._matMult(Ti),gr._matMult(Ti)}var Zi=pt.stretch+pt.fixed,mi=Je.stretch+Je.fixed;return{tl:yr,tr:Xi,bl:ai,br:gr,tex:{x:i.paddedRect.x+1+Zi,y:i.paddedRect.y+1+mi,w:Tt.stretch+Tt.fixed-Zi,h:At.stretch+At.fixed-mi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pi,pixelOffsetBR:Ci,minFontScaleX:Pe/e/p,minFontScaleY:Ue/e/m,isSDF:a}};if(d&&(i.stretchX||i.stretchY))for(var Qe=zh(g,F,M),yt=zh(I,O,L),nt=0;nt<Qe.length-1;nt++)for(var tt=Qe[nt],at=Qe[nt+1],ct=0;ct<yt.length-1;ct++)_.push(Ge(tt,yt[ct],at,yt[ct+1]));else _.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:r+1},{fixed:0,stretch:s+1}));return _}function as(t,n,a){for(var d=0,_=0,i=t;_<i.length;_+=1){var e=i[_];d+=Math.max(n,Math.min(a,e[1]))-Math.max(n,Math.min(a,e[0]))}return d}function zh(t,n,a){for(var d=[{fixed:-1,stretch:0}],_=0,i=t;_<i.length;_+=1){var e=i[_],r=e[0],s=e[1],p=d[d.length-1];d.push({fixed:r-p.stretch,stretch:p.stretch}),d.push({fixed:r-p.stretch,stretch:p.stretch+(s-r)})}return d.push({fixed:n+1,stretch:a}),d}function ac(t,n,a,d){return t/n*a+d}function sc(t,n,a,d){return t-n*a/d}var lc=function(t,n,a,d,_,i,e,r,s,p){if(this.boxStartIndex=t.length,s){var m=i.top,g=i.bottom,I=i.collisionPadding;I&&(m-=I[1],g+=I[3]);var E=g-m;E>0&&(E=Math.max(10,E),this.circleDiameter=E)}else{var M=i.top*e-r,L=i.bottom*e+r,F=i.left*e-r,O=i.right*e+r,Z=i.collisionPadding;if(Z&&(F-=Z[0]*e,M-=Z[1]*e,O+=Z[2]*e,L+=Z[3]*e),p){var $=new Oe(F,M),te=new Oe(O,M),ie=new Oe(F,L),ve=new Oe(O,L),Pe=p*Math.PI/180;$._rotate(Pe),te._rotate(Pe),ie._rotate(Pe),ve._rotate(Pe),F=Math.min($.x,te.x,ie.x,ve.x),O=Math.max($.x,te.x,ie.x,ve.x),M=Math.min($.y,te.y,ie.y,ve.y),L=Math.max($.y,te.y,ie.y,ve.y)}t.emplaceBack(n.x,n.y,F,M,O,L,a,d,_)}this.boxEndIndex=t.length},Ru=function(t,n){if(t===void 0&&(t=[]),n===void 0&&(n=Nd),this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function Nd(t,n){return t<n?-1:t>n?1:0}function Ep(t,n,a){n===void 0&&(n=1),a===void 0&&(a=!1);for(var d=1/0,_=1/0,i=-1/0,e=-1/0,r=t[0],s=0;s<r.length;s++){var p=r[s];(!s||p.x<d)&&(d=p.x),(!s||p.y<_)&&(_=p.y),(!s||p.x>i)&&(i=p.x),(!s||p.y>e)&&(e=p.y)}var m=Math.min(i-d,e-_),g=m/2,I=new Ru([],kp);if(m===0)return new Oe(d,_);for(var E=d;E<i;E+=m)for(var M=_;M<e;M+=m)I.push(new su(E+g,M+g,g,t));for(var L=function(Z){for(var $=0,te=0,ie=0,ve=Z[0],Pe=0,Me=ve.length,Ue=Me-1;Pe<Me;Ue=Pe++){var qe=ve[Pe],Ge=ve[Ue],Qe=qe.x*Ge.y-Ge.x*qe.y;te+=(qe.x+Ge.x)*Qe,ie+=(qe.y+Ge.y)*Qe,$+=3*Qe}return new su(te/$,ie/$,0,Z)}(t),F=I.length;I.length;){var O=I.pop();(O.d>L.d||!L.d)&&(L=O,a&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,F)),O.max-L.d<=n||(I.push(new su(O.p.x-(g=O.h/2),O.p.y-g,g,t)),I.push(new su(O.p.x+g,O.p.y-g,g,t)),I.push(new su(O.p.x-g,O.p.y+g,g,t)),I.push(new su(O.p.x+g,O.p.y+g,g,t)),F+=4)}return a&&(console.log("num probes: "+F),console.log("best distance: "+L.d)),L.p}function kp(t,n){return n.max-t.max}function su(t,n,a,d){this.p=new Oe(t,n),this.h=a,this.d=function(_,i){for(var e=!1,r=1/0,s=0;s<i.length;s++)for(var p=i[s],m=0,g=p.length,I=g-1;m<g;I=m++){var E=p[m],M=p[I];E.y>_.y!=M.y>_.y&&_.x<(M.x-E.x)*(_.y-E.y)/(M.y-E.y)+E.x&&(e=!e),r=Math.min(r,al(_,E,M))}return(e?1:-1)*Math.sqrt(r)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}Ru.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Ru.prototype.pop=function(){if(this.length!==0){var t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}},Ru.prototype.peek=function(){return this.data[0]},Ru.prototype._up=function(t){for(var n=this.data,a=this.compare,d=n[t];t>0;){var _=t-1>>1,i=n[_];if(a(d,i)>=0)break;n[t]=i,t=_}n[t]=d},Ru.prototype._down=function(t){for(var n=this.data,a=this.compare,d=this.length>>1,_=n[t];t<d;){var i=1+(t<<1),e=n[i],r=i+1;if(r<this.length&&a(n[r],e)<0&&(i=r,e=n[r]),a(e,_)>=0)break;n[t]=e,t=i}n[t]=_};var Bu=Number.POSITIVE_INFINITY;function Ch(t,n){return n[1]!==Bu?function(a,d,_){var i=0,e=0;switch(d=Math.abs(d),_=Math.abs(_),a){case"top-right":case"top-left":case"top":e=_-7;break;case"bottom-right":case"bottom-left":case"bottom":e=7-_}switch(a){case"top-right":case"bottom-right":case"right":i=-d;break;case"top-left":case"bottom-left":case"left":i=d}return[i,e]}(t,n[0],n[1]):function(a,d){var _=0,i=0;d<0&&(d=0);var e=d/Math.sqrt(2);switch(a){case"top-right":case"top-left":i=e-7;break;case"bottom-right":case"bottom-left":i=7-e;break;case"bottom":i=7-d;break;case"top":i=d-7}switch(a){case"top-right":case"bottom-right":_=-e;break;case"top-left":case"bottom-left":_=e;break;case"left":_=d;break;case"right":_=-d}return[_,i]}(t,n[0])}function Fu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uc(t,n,a,d,_,i,e,r,s,p,m,g,I,E,M){var L=function(te,ie,ve,Pe,Me,Ue,qe,Ge){for(var Qe=Pe.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,yt=[],nt=0,tt=ie.positionedLines;nt<tt.length;nt+=1)for(var at=tt[nt],ct=0,pt=at.positionedGlyphs;ct<pt.length;ct+=1){var Je=pt[ct];if(Je.rect){var Tt=Je.rect||{},At=4,li=!0,fi=1,wi=0,ki=(Me||Ge)&&Je.vertical,er=Je.metrics.advance*Je.scale/2;if(Ge&&ie.verticalizable&&(wi=at.lineOffset/2-(Je.imageName?-(24-Je.metrics.width*Je.scale)/2:24*(Je.scale-1))),Je.imageName){var qi=qe[Je.imageName];li=qi.sdf,At=1/(fi=qi.pixelRatio)}var tr=Me?[Je.x+er,Je.y]:[0,0],Ki=Me?[0,0]:[Je.x+er+ve[0],Je.y+ve[1]-wi],yr=[0,0];ki&&(yr=Ki,Ki=[0,0]);var Xi=(Je.metrics.left-At)*Je.scale-er+Ki[0],gr=(-Je.metrics.top-At)*Je.scale+Ki[1],ai=Xi+Tt.w*Je.scale/fi,Pi=gr+Tt.h*Je.scale/fi,Ci=new Oe(Xi,gr),xi=new Oe(ai,gr),Lr=new Oe(Xi,Pi),Tr=new Oe(ai,Pi);if(ki){var Ti=new Oe(-er,er- -17),Zi=-Math.PI/2,mi=12-er,Ai=new Oe(22-mi,-(Je.imageName?mi:0)),$r=new(Function.prototype.bind.apply(Oe,[null].concat(yr)));Ci._rotateAround(Zi,Ti)._add(Ai)._add($r),xi._rotateAround(Zi,Ti)._add(Ai)._add($r),Lr._rotateAround(Zi,Ti)._add(Ai)._add($r),Tr._rotateAround(Zi,Ti)._add(Ai)._add($r)}if(Qe){var Fr=Math.sin(Qe),Un=Math.cos(Qe),_r=[Un,-Fr,Fr,Un];Ci._matMult(_r),xi._matMult(_r),Lr._matMult(_r),Tr._matMult(_r)}var Xn=new Oe(0,0),Wn=new Oe(0,0);yt.push({tl:Ci,tr:xi,bl:Lr,br:Tr,tex:Tt,writingMode:ie.writingMode,glyphOffset:tr,sectionIndex:Je.sectionIndex,isSDF:li,pixelOffsetTL:Xn,pixelOffsetBR:Wn,minFontScaleX:0,minFontScaleY:0})}}return yt}(0,a,r,_,i,e,d,t.allowVerticalPlacement),F=t.textSizeData,O=null;F.kind==="source"?(O=[128*_.layout.get("text-size").evaluate(e,{})])[0]>32640&&lr(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):F.kind==="composite"&&((O=[128*E.compositeTextSizes[0].evaluate(e,{},M),128*E.compositeTextSizes[1].evaluate(e,{},M)])[0]>32640||O[1]>32640)&&lr(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,L,O,r,i,e,p,n,s.lineStartIndex,s.lineLength,I,M);for(var Z=0,$=m;Z<$.length;Z+=1)g[$[Z]]=t.text.placedSymbolArray.length-1;return 4*L.length}function cc(t){for(var n in t)return t[n];return null}function qd(t,n,a,d){var _=t.compareText;if(n in _){for(var i=_[n],e=i.length-1;e>=0;e--)if(d.dist(i[e])<a)return!0}else _[n]=[];return _[n].push(d),!1}var Zd=Pu.VectorTileFeature.types,Gd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rc(t,n,a,d,_,i,e,r,s,p,m,g,I){var E=r?Math.min(32640,Math.round(r[0])):0,M=r?Math.min(32640,Math.round(r[1])):0;t.emplaceBack(n,a,Math.round(32*d),Math.round(32*_),i,e,(E<<1)+(s?1:0),M,16*p,16*m,256*g,256*I)}function Pl(t,n,a){t.emplaceBack(n.x,n.y,a),t.emplaceBack(n.x,n.y,a),t.emplaceBack(n.x,n.y,a),t.emplaceBack(n.x,n.y,a)}function Ph(t){for(var n=0,a=t.sections;n<a.length;n+=1)if(il(a[n].text))return!0;return!1}var lu=function(t){this.layoutVertexArray=new me,this.indexArray=new it,this.programConfigurations=t,this.segments=new se,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new Ne,this.placedSymbolArray=new T};lu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},lu.prototype.upload=function(t,n,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,up.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,wh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Gd,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(t))},lu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Dt("SymbolBuffers",lu);var uu=function(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new se,this.collisionVertexArray=new ut};uu.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Fd.members,!0)},uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Dt("CollisionBuffers",uu);var wr=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(i){return i.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ho([]),this.placementViewportMatrix=ho([]);var n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Mc(this.zoom,n["text-size"]),this.iconSizeData=Mc(this.zoom,n["icon-size"]);var a=this.layers[0].layout,d=a.get("symbol-sort-key"),_=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(function(i){return wo[i]})),this.stateDependentLayerIds=this.layers.filter(function(i){return i.isStateDependent()}).map(function(i){return i.id}),this.sourceID=t.sourceID};wr.prototype.createArrays=function(){this.text=new lu(new Hi(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new lu(new Hi(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new B,this.lineVertexArray=new G,this.symbolInstances=new P},wr.prototype.calculateGlyphDependencies=function(t,n,a,d,_){for(var i=0;i<t.length;i++)if(n[t.charCodeAt(i)]=!0,(a||d)&&_){var e=Qu[t.charAt(i)];e&&(n[e.charCodeAt(0)]=!0)}},wr.prototype.populate=function(t,n,a){var d=this.layers[0],_=d.layout,i=_.get("text-font"),e=_.get("text-field"),r=_.get("icon-image"),s=(e.value.kind!=="constant"||e.value.value instanceof rn&&!e.value.value.isEmpty()||e.value.value.toString().length>0)&&(i.value.kind!=="constant"||i.value.value.length>0),p=r.value.kind!=="constant"||!!r.value.value||Object.keys(r.parameters).length>0,m=_.get("symbol-sort-key");if(this.features=[],s||p){for(var g=n.iconDependencies,I=n.glyphDependencies,E=n.availableImages,M=new $i(this.zoom),L=0,F=t;L<F.length;L+=1){var O=F[L],Z=O.feature,$=O.id,te=O.index,ie=O.sourceLayerIndex,ve=d._featureFilter.needGeometry,Pe=On(Z,ve);if(d._featureFilter.filter(M,Pe,a)){ve||(Pe.geometry=Vi(Z));var Me=void 0;if(s){var Ue=d.getValueAndResolveTokens("text-field",Pe,a,E),qe=rn.factory(Ue);Ph(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||co()==="unavailable"||this.hasRTLText&&Ot.isParsed())&&(Me=hp(qe,d,Pe))}var Ge=void 0;if(p){var Qe=d.getValueAndResolveTokens("icon-image",Pe,a,E);Ge=Qe instanceof Mn?Qe:Mn.fromString(Qe)}if(Me||Ge){var yt=this.sortFeaturesByKey?m.evaluate(Pe,{},a):void 0;if(this.features.push({id:$,text:Me,icon:Ge,index:te,sourceLayerIndex:ie,geometry:Pe.geometry,properties:Z.properties,type:Zd[Z.type],sortKey:yt}),Ge&&(g[Ge.name]=!0),Me){var nt=i.evaluate(Pe,{},a).join(","),tt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wo.vertical)>=0;for(var at=0,ct=Me.sections;at<ct.length;at+=1){var pt=ct[at];if(pt.image)g[pt.image.name]=!0;else{var Je=ma(Me.toString()),Tt=pt.fontStack||nt,At=I[Tt]=I[Tt]||{};this.calculateGlyphDependencies(pt.text,At,tt,this.allowVerticalPlacement,Je)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(li){var fi={},wi={},ki=[],er=0;function qi(Ti){ki.push(li[Ti]),er++}function tr(Ti,Zi,mi){var Ai=wi[Ti];return delete wi[Ti],wi[Zi]=Ai,ki[Ai].geometry[0].pop(),ki[Ai].geometry[0]=ki[Ai].geometry[0].concat(mi[0]),Ai}function Ki(Ti,Zi,mi){var Ai=fi[Zi];return delete fi[Zi],fi[Ti]=Ai,ki[Ai].geometry[0].shift(),ki[Ai].geometry[0]=mi[0].concat(ki[Ai].geometry[0]),Ai}function yr(Ti,Zi,mi){var Ai=mi?Zi[0][Zi[0].length-1]:Zi[0][0];return Ti+":"+Ai.x+":"+Ai.y}for(var Xi=0;Xi<li.length;Xi++){var gr=li[Xi],ai=gr.geometry,Pi=gr.text?gr.text.toString():null;if(Pi){var Ci=yr(Pi,ai),xi=yr(Pi,ai,!0);if(Ci in wi&&xi in fi&&wi[Ci]!==fi[xi]){var Lr=Ki(Ci,xi,ai),Tr=tr(Ci,xi,ki[Lr].geometry);delete fi[Ci],delete wi[xi],wi[yr(Pi,ki[Tr].geometry,!0)]=Tr,ki[Lr].geometry=null}else Ci in wi?tr(Ci,xi,ai):xi in fi?Ki(Ci,xi,ai):(qi(Xi),fi[Ci]=er-1,wi[xi]=er-1)}else qi(Xi)}return ki.filter(function(Ti){return Ti.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(li,fi){return li.sortKey-fi.sortKey})}},wr.prototype.update=function(t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a))},wr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},wr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},wr.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},wr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},wr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},wr.prototype.addToLineVertexArray=function(t,n){var a=this.lineVertexArray.length;if(t.segment!==void 0){for(var d=t.dist(n[t.segment+1]),_=t.dist(n[t.segment]),i={},e=t.segment+1;e<n.length;e++)i[e]={x:n[e].x,y:n[e].y,tileUnitDistanceFromAnchor:d},e<n.length-1&&(d+=n[e+1].dist(n[e]));for(var r=t.segment||0;r>=0;r--)i[r]={x:n[r].x,y:n[r].y,tileUnitDistanceFromAnchor:_},r>0&&(_+=n[r-1].dist(n[r]));for(var s=0;s<n.length;s++){var p=i[s];this.lineVertexArray.emplaceBack(p.x,p.y,p.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}},wr.prototype.addSymbols=function(t,n,a,d,_,i,e,r,s,p,m,g){for(var I=t.indexArray,E=t.layoutVertexArray,M=t.segments.prepareSegment(4*n.length,E,I,this.canOverlap?i.sortKey:void 0),L=this.glyphOffsetArray.length,F=M.vertexLength,O=this.allowVerticalPlacement&&e===wo.vertical?Math.PI/2:0,Z=i.text&&i.text.sections,$=0;$<n.length;$++){var te=n[$],ie=te.tl,ve=te.tr,Pe=te.bl,Me=te.br,Ue=te.tex,qe=te.pixelOffsetTL,Ge=te.pixelOffsetBR,Qe=te.minFontScaleX,yt=te.minFontScaleY,nt=te.glyphOffset,tt=te.isSDF,at=te.sectionIndex,ct=M.vertexLength,pt=nt[1];Rc(E,r.x,r.y,ie.x,pt+ie.y,Ue.x,Ue.y,a,tt,qe.x,qe.y,Qe,yt),Rc(E,r.x,r.y,ve.x,pt+ve.y,Ue.x+Ue.w,Ue.y,a,tt,Ge.x,qe.y,Qe,yt),Rc(E,r.x,r.y,Pe.x,pt+Pe.y,Ue.x,Ue.y+Ue.h,a,tt,qe.x,Ge.y,Qe,yt),Rc(E,r.x,r.y,Me.x,pt+Me.y,Ue.x+Ue.w,Ue.y+Ue.h,a,tt,Ge.x,Ge.y,Qe,yt),Pl(t.dynamicLayoutVertexArray,r,O),I.emplaceBack(ct,ct+1,ct+2),I.emplaceBack(ct+1,ct+2,ct+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nt[0]),$!==n.length-1&&at===n[$+1].sectionIndex||t.programConfigurations.populatePaintArrays(E.length,i,i.index,{},g,Z&&Z[at])}t.placedSymbolArray.emplaceBack(r.x,r.y,L,this.glyphOffsetArray.length-L,F,s,p,r.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],e,0,!1,0,m)},wr.prototype._addCollisionDebugVertex=function(t,n,a,d,_,i){return n.emplaceBack(0,0),t.emplaceBack(a.x,a.y,d,_,Math.round(i.x),Math.round(i.y))},wr.prototype.addCollisionDebugVertices=function(t,n,a,d,_,i,e){var r=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),s=r.vertexLength,p=_.layoutVertexArray,m=_.collisionVertexArray,g=e.anchorX,I=e.anchorY;this._addCollisionDebugVertex(p,m,i,g,I,new Oe(t,n)),this._addCollisionDebugVertex(p,m,i,g,I,new Oe(a,n)),this._addCollisionDebugVertex(p,m,i,g,I,new Oe(a,d)),this._addCollisionDebugVertex(p,m,i,g,I,new Oe(t,d)),r.vertexLength+=4;var E=_.indexArray;E.emplaceBack(s,s+1),E.emplaceBack(s+1,s+2),E.emplaceBack(s+2,s+3),E.emplaceBack(s+3,s),r.primitiveLength+=4},wr.prototype.addDebugCollisionBoxes=function(t,n,a,d){for(var _=t;_<n;_++){var i=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,d?this.textCollisionBox:this.iconCollisionBox,i.anchorPoint,a)}},wr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new uu(We,Th.members,Lt),this.iconCollisionBox=new uu(We,Th.members,Lt);for(var t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}},wr.prototype._deserializeCollisionBoxesForSymbol=function(t,n,a,d,_,i,e,r,s){for(var p={},m=n;m<a;m++){var g=t.get(m);p.textBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},p.textFeatureIndex=g.featureIndex;break}for(var I=d;I<_;I++){var E=t.get(I);p.verticalTextBox={x1:E.x1,y1:E.y1,x2:E.x2,y2:E.y2,anchorPointX:E.anchorPointX,anchorPointY:E.anchorPointY},p.verticalTextFeatureIndex=E.featureIndex;break}for(var M=i;M<e;M++){var L=t.get(M);p.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},p.iconFeatureIndex=L.featureIndex;break}for(var F=r;F<s;F++){var O=t.get(F);p.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},p.verticalIconFeatureIndex=O.featureIndex;break}return p},wr.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var n=0;n<this.symbolInstances.length;n++){var a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}},wr.prototype.hasTextData=function(){return this.text.segments.get().length>0},wr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},wr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},wr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},wr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},wr.prototype.addIndicesForPlacedSymbol=function(t,n){for(var a=t.placedSymbolArray.get(n),d=a.vertexStartIndex+4*a.numGlyphs,_=a.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)},wr.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var n=Math.sin(t),a=Math.cos(t),d=[],_=[],i=[],e=0;e<this.symbolInstances.length;++e){i.push(e);var r=this.symbolInstances.get(e);d.push(0|Math.round(n*r.anchorX+a*r.anchorY)),_.push(r.featureIndex)}return i.sort(function(s,p){return d[s]-d[p]||_[p]-_[s]}),i},wr.prototype.addToSortKeyRanges=function(t,n){var a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})},wr.prototype.sortFeatures=function(t){var n=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var a=0,d=this.symbolInstanceIndexes;a<d.length;a+=1){var _=this.symbolInstances.get(d[a]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(i,e,r){i>=0&&r.indexOf(i)===e&&n.addIndicesForPlacedSymbol(n.text,i)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Dt("SymbolBucket",wr,{omit:["layers","collisionBoxArray","features","compareText"]}),wr.MAX_GLYPHS=65535,wr.addDynamicAttributes=Pl;var Ml=new o({"symbol-placement":new gt(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ui(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gt(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gt(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ui(ye.layout_symbol["icon-size"]),"icon-text-fit":new gt(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gt(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ui(ye.layout_symbol["icon-image"]),"icon-rotate":new ui(ye.layout_symbol["icon-rotate"]),"icon-padding":new gt(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ui(ye.layout_symbol["icon-offset"]),"icon-anchor":new ui(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(ye.layout_symbol["text-rotation-alignment"]),"text-field":new ui(ye.layout_symbol["text-field"]),"text-font":new ui(ye.layout_symbol["text-font"]),"text-size":new ui(ye.layout_symbol["text-size"]),"text-max-width":new ui(ye.layout_symbol["text-max-width"]),"text-line-height":new gt(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ui(ye.layout_symbol["text-letter-spacing"]),"text-justify":new ui(ye.layout_symbol["text-justify"]),"text-radial-offset":new ui(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new ui(ye.layout_symbol["text-anchor"]),"text-max-angle":new gt(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(ye.layout_symbol["text-writing-mode"]),"text-rotate":new ui(ye.layout_symbol["text-rotate"]),"text-padding":new gt(ye.layout_symbol["text-padding"]),"text-keep-upright":new gt(ye.layout_symbol["text-keep-upright"]),"text-transform":new ui(ye.layout_symbol["text-transform"]),"text-offset":new ui(ye.layout_symbol["text-offset"]),"text-allow-overlap":new gt(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gt(ye.layout_symbol["text-ignore-placement"]),"text-optional":new gt(ye.layout_symbol["text-optional"])}),Bc={paint:new o({"icon-opacity":new ui(ye.paint_symbol["icon-opacity"]),"icon-color":new ui(ye.paint_symbol["icon-color"]),"icon-halo-color":new ui(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ui(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ui(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new ui(ye.paint_symbol["text-opacity"]),"text-color":new ui(ye.paint_symbol["text-color"],{runtimeType:$e,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new ui(ye.paint_symbol["text-halo-color"]),"text-halo-width":new ui(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ui(ye.paint_symbol["text-halo-blur"]),"text-translate":new gt(ye.paint_symbol["text-translate"]),"text-translate-anchor":new gt(ye.paint_symbol["text-translate-anchor"])}),layout:Ml},cu=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ie,this.defaultValue=t};cu.prototype.evaluate=function(t){if(t.formattedSection){var n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},cu.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},cu.prototype.outputDefined=function(){return!1},cu.prototype.serialize=function(){return null},Dt("FormatSectionOverride",cu,{omit:["defaultValue"]});var $d=function(t){function n(a){t.call(this,a,Bc)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.recalculate=function(a,d){if(t.prototype.recalculate.call(this,a,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var i=[],e=0,r=_;e<r.length;e+=1){var s=r[e];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},n.prototype.getValueAndResolveTokens=function(a,d,_,i){var e=this.layout.get(a).evaluate(d,{},_,i),r=this._unevaluatedLayout._values[a];return r.isDataDriven()||Ks(r.value)||!e?e:function(s,p){return p.replace(/{([^{}]+)}/g,function(m,g){return g in s?String(s[g]):""})}(d.properties,e)},n.prototype.createBucket=function(a){return new wr(a)},n.prototype.queryRadius=function(){return 0},n.prototype.queryIntersectsFeature=function(){return!1},n.prototype._setPaintOverrides=function(){for(var a=0,d=Bc.paint.overridableProperties;a<d.length;a+=1){var _=d[a];if(n.hasPaintOverride(this.layout,_)){var i,e=this.paint.get(_),r=new cu(e),s=new Ma(r,e.property.specification);i=e.value.kind==="constant"||e.value.kind==="source"?new Da("source",s):new $a("composite",s,e.value.zoomStops,e.value._interpolationType),this.paint._values[_]=new Fn(e.property,i,e.parameters)}}},n.prototype._handleOverridablePaintPropertyUpdate=function(a,d,_){return!(!this.layout||d.isDataDriven()||_.isDataDriven())&&n.hasPaintOverride(this.layout,a)},n.hasPaintOverride=function(a,d){var _=a.get("text-field"),i=Bc.paint.properties[d],e=!1,r=function(m){for(var g=0,I=m;g<I.length;g+=1)if(i.overrides&&i.overrides.hasOverride(I[g]))return void(e=!0)};if(_.value.kind==="constant"&&_.value.value instanceof rn)r(_.value.value.sections);else if(_.value.kind==="source"){var s=function(m){e||(m instanceof no&&Hr(m.value)===ht?r(m.value.sections):m instanceof Nn?r(m.sections):m.eachChild(s))},p=_.value;p._styleExpression&&s(p._styleExpression.expression)}return e},n}(h),Xd={paint:new o({"background-color":new gt(ye.paint_background["background-color"]),"background-pattern":new $n(ye.paint_background["background-pattern"]),"background-opacity":new gt(ye.paint_background["background-opacity"])})},Wd=function(t){function n(a){t.call(this,a,Xd)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n}(h),Fc={paint:new o({"raster-opacity":new gt(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new gt(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(ye.paint_raster["raster-saturation"]),"raster-contrast":new gt(ye.paint_raster["raster-contrast"]),"raster-resampling":new gt(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(ye.paint_raster["raster-fade-duration"])})},Mh=function(t){function n(a){t.call(this,a,Fc)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n}(h),Hd=function(t){function n(a){t.call(this,a,{}),this.implementation=a}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},n.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},n.prototype.recalculate=function(){},n.prototype.updateTransitions=function(){},n.prototype.hasTransition=function(){},n.prototype.serialize=function(){},n.prototype.onAdd=function(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},n.prototype.onRemove=function(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},n}(h),Dh={circle:Is,heatmap:xa,hillshade:dd,fill:Id,"fill-extrusion":xh,line:Bd,symbol:$d,background:Wd,raster:Mh},Oc=xe.HTMLImageElement,hu=xe.HTMLCanvasElement,Ap=xe.HTMLVideoElement,Uc=xe.ImageData,hc=xe.ImageBitmap,As=function(t,n,a,d){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,d)};As.prototype.update=function(t,n,a){var d=t.width,_=t.height,i=!(this.size&&this.size[0]===d&&this.size[1]===_||a),e=this.context,r=e.gl;if(this.useMipmap=Boolean(n&&n.useMipmap),r.bindTexture(r.TEXTURE_2D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(this.format===r.RGBA&&(!n||n.premultiply!==!1)),i)this.size=[d,_],t instanceof Oc||t instanceof hu||t instanceof Ap||t instanceof Uc||hc&&t instanceof hc?r.texImage2D(r.TEXTURE_2D,0,this.format,this.format,r.UNSIGNED_BYTE,t):r.texImage2D(r.TEXTURE_2D,0,this.format,d,_,0,this.format,r.UNSIGNED_BYTE,t.data);else{var s=a||{x:0,y:0},p=s.x,m=s.y;t instanceof Oc||t instanceof hu||t instanceof Ap||t instanceof Uc||hc&&t instanceof hc?r.texSubImage2D(r.TEXTURE_2D,0,p,m,r.RGBA,r.UNSIGNED_BYTE,t):r.texSubImage2D(r.TEXTURE_2D,0,p,m,d,_,r.RGBA,r.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&r.generateMipmap(r.TEXTURE_2D)},As.prototype.bind=function(t,n,a){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)},As.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},As.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var pc=function(t){var n=this;this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){n._triggered=!1,n._callback()})};pc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},pc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ou=function(t,n,a){this.target=t,this.parent=n,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},pi(["receive","process"],this),this.invoker=new pc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wt()?t:xe};function zp(t,n,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[t*d-2*Math.PI*6378137/2,n*d-2*Math.PI*6378137/2]}Ou.prototype.send=function(t,n,a,d,_){var i=this;_===void 0&&(_=!1);var e=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[e]=a);var r=Jn(this.globalScope)?void 0:[];return this.target.postMessage({id:e,type:t,hasCallback:!!a,targetMapId:d,mustQueue:_,sourceMapId:this.mapId,data:Pr(n,r)},r),{cancel:function(){a&&delete i.callbacks[e],i.target.postMessage({id:e,type:"<cancel>",targetMapId:d,sourceMapId:i.mapId})}}},Ou.prototype.receive=function(t){var n=t.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){delete this.tasks[a];var d=this.cancelCallbacks[a];delete this.cancelCallbacks[a],d&&d()}else Wt()||n.mustQueue?(this.tasks[a]=n,this.taskQueue.push(a),this.invoker.trigger()):this.processTask(a,n)},Ou.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),n=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),n&&this.processTask(t,n)}},Ou.prototype.processTask=function(t,n){var a=this;if(n.type==="<response>"){var d=this.callbacks[t];delete this.callbacks[t],d&&(n.error?d(Do(n.error)):d(null,Do(n.data)))}else{var _=!1,i=Jn(this.globalScope)?void 0:[],e=n.hasCallback?function(m,g){_=!0,delete a.cancelCallbacks[t],a.target.postMessage({id:t,type:"<response>",sourceMapId:a.mapId,error:m?Pr(m):null,data:Pr(g,i)},i)}:function(m){_=!0},r=null,s=Do(n.data);if(this.parent[n.type])r=this.parent[n.type](n.sourceMapId,s,e);else if(this.parent.getWorkerSource){var p=n.type.split(".");r=this.parent.getWorkerSource(n.sourceMapId,p[0],s.source)[p[1]](s,e)}else e(new Error("Could not find function "+n.type));!_&&r&&r.cancel&&(this.cancelCallbacks[t]=r.cancel)}},Ou.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var xn=function(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};xn.prototype.setNorthEast=function(t){return this._ne=t instanceof Ur?new Ur(t.lng,t.lat):Ur.convert(t),this},xn.prototype.setSouthWest=function(t){return this._sw=t instanceof Ur?new Ur(t.lng,t.lat):Ur.convert(t),this},xn.prototype.extend=function(t){var n,a,d=this._sw,_=this._ne;if(t instanceof Ur)n=t,a=t;else{if(!(t instanceof xn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(xn.convert(t)):this.extend(Ur.convert(t)):this;if(a=t._ne,!(n=t._sw)||!a)return this}return d||_?(d.lng=Math.min(n.lng,d.lng),d.lat=Math.min(n.lat,d.lat),_.lng=Math.max(a.lng,_.lng),_.lat=Math.max(a.lat,_.lat)):(this._sw=new Ur(n.lng,n.lat),this._ne=new Ur(a.lng,a.lat)),this},xn.prototype.getCenter=function(){return new Ur((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},xn.prototype.getSouthWest=function(){return this._sw},xn.prototype.getNorthEast=function(){return this._ne},xn.prototype.getNorthWest=function(){return new Ur(this.getWest(),this.getNorth())},xn.prototype.getSouthEast=function(){return new Ur(this.getEast(),this.getSouth())},xn.prototype.getWest=function(){return this._sw.lng},xn.prototype.getSouth=function(){return this._sw.lat},xn.prototype.getEast=function(){return this._ne.lng},xn.prototype.getNorth=function(){return this._ne.lat},xn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},xn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},xn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},xn.prototype.contains=function(t){var n=Ur.convert(t),a=n.lng,d=n.lat,_=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&_},xn.convert=function(t){return!t||t instanceof xn?t:new xn(t)};var Ur=function(t,n){if(isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: ("+t+", "+n+")");if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ur.prototype.wrap=function(){return new Ur(hr(this.lng,-180,180),this.lat)},Ur.prototype.toArray=function(){return[this.lng,this.lat]},Ur.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ur.prototype.distanceTo=function(t){var n=Math.PI/180,a=this.lat*n,d=t.lat*n,_=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((t.lng-this.lng)*n);return 63710088e-1*Math.acos(Math.min(_,1))},Ur.prototype.toBounds=function(t){t===void 0&&(t=0);var n=360*t/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new xn(new Ur(this.lng-a,this.lat-n),new Ur(this.lng+a,this.lat+n))},Ur.convert=function(t){if(t instanceof Ur)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ur(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ur(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Cp=2*Math.PI*63710088e-1;function Lh(t){return Cp*Math.cos(t*Math.PI/180)}function on(t){return(180+t)/360}function Dl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Rh(t,n){return t/Lh(n)}function jc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Ll=function(t,n,a){a===void 0&&(a=0),this.x=+t,this.y=+n,this.z=+a};Ll.fromLngLat=function(t,n){n===void 0&&(n=0);var a=Ur.convert(t);return new Ll(on(a.lng),Dl(a.lat),Rh(n,a.lat))},Ll.prototype.toLngLat=function(){return new Ur(360*this.x-180,jc(this.y))},Ll.prototype.toAltitude=function(){return this.z*Lh(jc(this.y))},Ll.prototype.meterInMercatorCoordinateUnits=function(){return 1/Cp*(t=jc(this.y),1/Math.cos(t*Math.PI/180));var t};var Rl=function(t,n,a){this.z=t,this.x=n,this.y=a,this.key=Bl(0,t,t,n,a)};Rl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Rl.prototype.url=function(t,n){var a,d,_,i,e,r=(d=this.y,_=this.z,i=zp(256*(a=this.x),256*(d=Math.pow(2,_)-d-1),_),e=zp(256*(a+1),256*(d+1),_),i[0]+","+i[1]+","+e[0]+","+e[1]),s=function(p,m,g){for(var I,E="",M=p;M>0;M--)E+=(m&(I=1<<M-1)?1:0)+(g&I?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",r)},Rl.prototype.getTilePoint=function(t){var n=Math.pow(2,this.z);return new Oe(8192*(t.x*n-this.x),8192*(t.y*n-this.y))},Rl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Bh=function(t,n){this.wrap=t,this.canonical=n,this.key=Bl(t,n.z,n.z,n.x,n.y)},an=function(t,n,a,d,_){this.overscaledZ=t,this.wrap=n,this.canonical=new Rl(a,+d,+_),this.key=Bl(n,t,a,d,_)};function Bl(t,n,a,d,_){(t*=2)<0&&(t=-1*t-1);var i=1<<a;return(i*i*t+i*_+d).toString(36)+a.toString(36)+n.toString(36)}an.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},an.prototype.scaledTo=function(t){var n=this.canonical.z-t;return t>this.canonical.z?new an(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new an(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)},an.prototype.calculateScaledKey=function(t,n){var a=this.canonical.z-t;return t>this.canonical.z?Bl(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Bl(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)},an.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n},an.prototype.children=function(t){if(this.overscaledZ>=t)return[new an(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var n=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new an(n,this.wrap,n,a,d),new an(n,this.wrap,n,a+1,d),new an(n,this.wrap,n,a,d+1),new an(n,this.wrap,n,a+1,d+1)]},an.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},an.prototype.wrapped=function(){return new an(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},an.prototype.unwrapTo=function(t){return new an(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},an.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},an.prototype.toUnwrapped=function(){return new Bh(this.wrap,this.canonical)},an.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},an.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Ll(t.x-this.wrap,t.y))},Dt("CanonicalTileID",Rl),Dt("OverscaledTileID",an,{omit:["posMatrix"]});var zs=function(t,n,a){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return lr('"'+a+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=n.height;var d=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=a||"mapbox";for(var _=0;_<d;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(d,_)]=this.data[this._idx(d-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,d)]=this.data[this._idx(_,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};zs.prototype.get=function(t,n){var a=new Uint8Array(this.data.buffer),d=4*this._idx(t,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[d],a[d+1],a[d+2])},zs.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zs.prototype._idx=function(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)},zs.prototype._unpackMapbox=function(t,n,a){return(256*t*256+256*n+a)/10-1e4},zs.prototype._unpackTerrarium=function(t,n,a){return 256*t+n+a/256-32768},zs.prototype.getPixels=function(){return new xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zs.prototype.backfillBorder=function(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var d=n*this.dim,_=n*this.dim+this.dim,i=a*this.dim,e=a*this.dim+this.dim;switch(n){case-1:d=_-1;break;case 1:_=d+1}switch(a){case-1:i=e-1;break;case 1:e=i+1}for(var r=-n*this.dim,s=-a*this.dim,p=i;p<e;p++)for(var m=d;m<_;m++)this.data[this._idx(m,p)]=t.data[this._idx(m+r,p+s)]},Dt("DEMData",zs);var Uu=function(t){this._stringToNumber={},this._numberToString=[];for(var n=0;n<t.length;n++){var a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}};Uu.prototype.encode=function(t){return this._stringToNumber[t]},Uu.prototype.decode=function(t){return this._numberToString[t]};var dc=function(t,n,a,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=d,this.properties=t.properties,this.id=_},ea={geometry:{configurable:!0}};ea.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ea.geometry.set=function(t){this._geometry=t},dc.prototype.toJSON=function(){var t={geometry:this.geometry};for(var n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t},Object.defineProperties(dc.prototype,ea);var Cs=function(){this.state={},this.stateChanges={},this.deletedStates={}};Cs.prototype.updateState=function(t,n,a){var d=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},wt(this.stateChanges[t][d],a),this.deletedStates[t]===null)for(var _ in this.deletedStates[t]={},this.state[t])_!==d&&(this.deletedStates[t][_]=null);else if(this.deletedStates[t]&&this.deletedStates[t][d]===null)for(var i in this.deletedStates[t][d]={},this.state[t][d])a[i]||(this.deletedStates[t][d][i]=null);else for(var e in a)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][e]===null&&delete this.deletedStates[t][d][e]},Cs.prototype.removeFeatureState=function(t,n,a){if(this.deletedStates[t]!==null){var d=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(a in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][a]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}},Cs.prototype.getState=function(t,n){var a=String(n),d=wt({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var _=this.deletedStates[t][n];if(_===null)return{};for(var i in _)delete d[i]}return d},Cs.prototype.initializeTileState=function(t,n){t.setFeatureState(this.state,n)},Cs.prototype.coalesceChanges=function(t,n){var a={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var _={};for(var i in this.stateChanges[d])this.state[d][i]||(this.state[d][i]={}),wt(this.state[d][i],this.stateChanges[d][i]),_[i]=this.state[d][i];a[d]=_}for(var e in this.deletedStates){this.state[e]=this.state[e]||{};var r={};if(this.deletedStates[e]===null)for(var s in this.state[e])r[s]={},this.state[e][s]={};else for(var p in this.deletedStates[e]){if(this.deletedStates[e][p]===null)this.state[e][p]={};else for(var m=0,g=Object.keys(this.deletedStates[e][p]);m<g.length;m+=1)delete this.state[e][p][g[m]];r[p]=this.state[e][p]}a[e]=a[e]||{},wt(a[e],r)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(var I in t)t[I].setFeatureState(a,n)};var Ps=function(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new nn(8192,16,0),this.grid3D=new nn(8192,16,0),this.featureIndexArray=new oe,this.promoteId=n};function Fh(t,n,a,d,_){return zi(t,function(i,e){var r=n instanceof cr?n.get(e):null;return r&&r.evaluate?r.evaluate(a,d,_):r})}function Oh(t){for(var n=1/0,a=1/0,d=-1/0,_=-1/0,i=0,e=t;i<e.length;i+=1){var r=e[i];n=Math.min(n,r.x),a=Math.min(a,r.y),d=Math.max(d,r.x),_=Math.max(_,r.y)}return{minX:n,minY:a,maxX:d,maxY:_}}function Pp(t,n){return n-t}Ps.prototype.insert=function(t,n,a,d,_,i){var e=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,_);for(var r=i?this.grid3D:this.grid,s=0;s<n.length;s++){for(var p=n[s],m=[1/0,1/0,-1/0,-1/0],g=0;g<p.length;g++){var I=p[g];m[0]=Math.min(m[0],I.x),m[1]=Math.min(m[1],I.y),m[2]=Math.max(m[2],I.x),m[3]=Math.max(m[3],I.y)}m[0]<8192&&m[1]<8192&&m[2]>=0&&m[3]>=0&&r.insert(e,m[0],m[1],m[2],m[3])}},Ps.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Pu.VectorTile(new ec(this.rawTileData)).layers,this.sourceLayerCoder=new Uu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ps.prototype.query=function(t,n,a,d){var _=this;this.loadVTLayers();for(var i=t.params||{},e=8192/t.tileSize/t.scale,r=Ys(i.filter),s=t.queryGeometry,p=t.queryPadding*e,m=Oh(s),g=this.grid.query(m.minX-p,m.minY-p,m.maxX+p,m.maxY+p),I=Oh(t.cameraQueryGeometry),E=this.grid3D.query(I.minX-p,I.minY-p,I.maxX+p,I.maxY+p,function(te,ie,ve,Pe){return function(Me,Ue,qe,Ge,Qe){for(var yt=0,nt=Me;yt<nt.length;yt+=1){var tt=nt[yt];if(Ue<=tt.x&&qe<=tt.y&&Ge>=tt.x&&Qe>=tt.y)return!0}var at=[new Oe(Ue,qe),new Oe(Ue,Qe),new Oe(Ge,Qe),new Oe(Ge,qe)];if(Me.length>2){for(var ct=0,pt=at;ct<pt.length;ct+=1)if(Qo(Me,pt[ct]))return!0}for(var Je=0;Je<Me.length-1;Je++)if(sl(Me[Je],Me[Je+1],at))return!0;return!1}(t.cameraQueryGeometry,te-p,ie-p,ve+p,Pe+p)}),M=0,L=E;M<L.length;M+=1)g.push(L[M]);g.sort(Pp);for(var F,O={},Z=function(te){var ie=g[te];if(ie!==F){F=ie;var ve=_.featureIndexArray.get(ie),Pe=null;_.loadMatchingFeature(O,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,r,i.layers,i.availableImages,n,a,d,function(Me,Ue,qe){return Pe||(Pe=Vi(Me)),Ue.queryIntersectsFeature(s,Me,qe,Pe,_.z,t.transform,e,t.pixelPosMatrix)})}},$=0;$<g.length;$++)Z($);return O},Ps.prototype.loadMatchingFeature=function(t,n,a,d,_,i,e,r,s,p,m){var g=this.bucketLayerIDs[n];if(!i||function(Me,Ue){for(var qe=0;qe<Me.length;qe++)if(Ue.indexOf(Me[qe])>=0)return!0;return!1}(i,g)){var I=this.sourceLayerCoder.decode(a),E=this.vtLayers[I].feature(d);if(_.needGeometry){var M=On(E,!0);if(!_.filter(new $i(this.tileID.overscaledZ),M,this.tileID.canonical))return}else if(!_.filter(new $i(this.tileID.overscaledZ),E))return;for(var L=this.getId(E,I),F=0;F<g.length;F++){var O=g[F];if(!(i&&i.indexOf(O)<0)){var Z=r[O];if(Z){var $={};L!==void 0&&p&&($=p.getState(Z.sourceLayer||"_geojsonTileLayer",L));var te=wt({},s[O]);te.paint=Fh(te.paint,Z.paint,E,$,e),te.layout=Fh(te.layout,Z.layout,E,$,e);var ie=!m||m(E,Z,$);if(ie){var ve=new dc(E,this.z,this.x,this.y,L);ve.layer=te;var Pe=t[O];Pe===void 0&&(Pe=t[O]=[]),Pe.push({featureIndex:d,feature:ve,intersectionZ:ie})}}}}}},Ps.prototype.lookupSymbolFeatures=function(t,n,a,d,_,i,e,r){var s={};this.loadVTLayers();for(var p=Ys(_),m=0,g=t;m<g.length;m+=1)this.loadMatchingFeature(s,a,d,g[m],p,i,e,r,n);return s},Ps.prototype.hasLayer=function(t){for(var n=0,a=this.bucketLayerIDs;n<a.length;n+=1)for(var d=0,_=a[n];d<_.length;d+=1)if(t===_[d])return!0;return!1},Ps.prototype.getId=function(t,n){var a=t.id;return this.promoteId&&typeof(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]])=="boolean"&&(a=Number(a)),a},Dt("FeatureIndex",Ps,{omit:["rawTileData","sourceLayerCoder"]});var En=function(t,n){this.tileID=t,this.uid=oi(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};En.prototype.registerFadeDuration=function(t){var n=t+this.timeAdded;n<ir.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)},En.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},En.prototype.loadVectorData=function(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var d in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,m){var g={};if(!m)return g;for(var I=function(){var L=M[E],F=L.layerIds.map(function($){return m.getLayer($)}).filter(Boolean);if(F.length!==0){L.layers=F,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(function($){return F.filter(function(te){return te.id===$})[0]}));for(var O=0,Z=F;O<Z.length;O+=1)g[Z[O].id]=L}},E=0,M=p;E<M.length;E+=1)I();return g}(t.buckets,n.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[d];if(_ instanceof wr){if(this.hasSymbolBuckets=!0,!a)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var i in this.buckets){var e=this.buckets[i];if(e instanceof wr&&e.hasRTLText){this.hasRTLText=!0,Ot.isLoading()||Ot.isLoaded()||co()!=="deferred"||Qt();break}}for(var r in this.queryPadding=0,this.buckets){var s=this.buckets[r];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(r).queryRadius(s))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u},En.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},En.prototype.getBucket=function(t){return this.buckets[t.id]},En.prototype.upload=function(t){for(var n in this.buckets){var a=this.buckets[n];a.uploadPending()&&a.upload(t)}var d=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new As(t,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new As(t,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},En.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},En.prototype.queryRenderedFeatures=function(t,n,a,d,_,i,e,r,s,p){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:i,tileSize:this.tileSize,pixelPosMatrix:p,transform:r,params:e,queryPadding:this.queryPadding*s},t,n,a):{}},En.prototype.querySourceFeatures=function(t,n){var a=this.latestFeatureIndex;if(a&&a.rawTileData){var d=a.loadVTLayers(),_=n?n.sourceLayer:"",i=d._geojsonTileLayer||d[_];if(i)for(var e=Ys(n&&n.filter),r=this.tileID.canonical,s=r.z,p=r.x,m=r.y,g={z:s,x:p,y:m},I=0;I<i.length;I++){var E=i.feature(I);if(e.needGeometry){var M=On(E,!0);if(!e.filter(new $i(this.tileID.overscaledZ),M,this.tileID.canonical))continue}else if(!e.filter(new $i(this.tileID.overscaledZ),E))continue;var L=a.getId(E,_),F=new dc(E,s,p,m,L);F.tile=g,t.push(F)}}},En.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},En.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},En.prototype.setExpiryData=function(t){var n=this.expirationTime;if(t.cacheControl){var a=Qr(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var d=Date.now(),_=!1;if(this.expirationTime>d)_=!1;else if(n)if(this.expirationTime<n)_=!0;else{var i=this.expirationTime-n;i?this.expirationTime=d+Math.max(i,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},En.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},En.prototype.setFeatureState=function(t,n){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var a=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(n.style.hasLayer(d)){var _=this.buckets[d],i=_.layers[0].sourceLayer||"_geojsonTileLayer",e=a[i],r=t[i];if(e&&r&&Object.keys(r).length!==0){_.update(r,e,this.imageAtlas&&this.imageAtlas.patternPositions||{});var s=n&&n.style&&n.style.getLayer(d);s&&(this.queryPadding=Math.max(this.queryPadding,s.queryRadius(_)))}}}},En.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},En.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ir.now()},En.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},En.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=ir.now()+t},En.prototype.setDependencies=function(t,n){for(var a={},d=0,_=n;d<_.length;d+=1)a[_[d]]=!0;this.dependencies[t]=a},En.prototype.hasDependency=function(t,n){for(var a=0,d=t;a<d.length;a+=1){var _=this.dependencies[d[a]];if(_){for(var i=0,e=n;i<e.length;i+=1)if(_[e[i]])return!0}}return!1};var fl=xe.performance,Mp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},fl.mark(this._marks.start)};Mp.prototype.finish=function(){fl.mark(this._marks.end);var t=fl.getEntriesByName(this._marks.measure);return t.length===0&&(fl.measure(this._marks.measure,this._marks.start,this._marks.end),t=fl.getEntriesByName(this._marks.measure),fl.clearMarks(this._marks.start),fl.clearMarks(this._marks.end),fl.clearMeasures(this._marks.measure)),t},y.Actor=Ou,y.AlphaImage=ll,y.CanonicalTileID=Rl,y.CollisionBoxArray=u,y.Color=ri,y.DEMData=zs,y.DataConstantProperty=gt,y.DictionaryCoder=Uu,y.EXTENT=8192,y.ErrorEvent=Fe,y.EvaluationParameters=$i,y.Event=De,y.Evented=Le,y.FeatureIndex=Ps,y.FillBucket=ba,y.FillExtrusionBucket=ns,y.ImageAtlas=rc,y.ImagePosition=kc,y.LineBucket=bo,y.LngLat=Ur,y.LngLatBounds=xn,y.MercatorCoordinate=Ll,y.ONE_EM=24,y.OverscaledTileID=an,y.Point=Oe,y.Point$1=Oe,y.Properties=o,y.Protobuf=ec,y.RGBAImage=xo,y.RequestManager=Sr,y.RequestPerformance=Mp,y.ResourceType=Mi,y.SegmentVector=se,y.SourceFeatureState=Cs,y.StructArrayLayout1ui2=yi,y.StructArrayLayout2f1f2i16=Ze,y.StructArrayLayout2i4=N,y.StructArrayLayout3ui6=it,y.StructArrayLayout4i8=X,y.SymbolBucket=wr,y.Texture=As,y.Tile=En,y.Transitionable=mr,y.Uniform1f=mt,y.Uniform1i=vt,y.Uniform2f=Pt,y.Uniform3f=$t,y.Uniform4f=ei,y.UniformColor=Nt,y.UniformMatrix4f=jt,y.UnwrappedTileID=Bh,y.ValidationError=ke,y.WritingMode=wo,y.ZoomHistory=qn,y.add=function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t},y.addDynamicAttributes=Pl,y.asyncAll=function(t,n,a){if(!t.length)return a(null,[]);var d=t.length,_=new Array(t.length),i=null;t.forEach(function(e,r){n(e,function(s,p){s&&(i=s),_[r]=p,--d==0&&a(i,_)})})},y.bezier=zt,y.bindAll=pi,y.browser=ir,y.cacheEntryPossiblyAdded=function(t){++xr>pr&&(t.getActor().send("enforceCacheSizeLimit",ro),xr=0)},y.clamp=Ct,y.clearTileCache=function(t){var n=xe.caches.delete("mapbox-tiles");t&&n.catch(t).then(function(){return t()})},y.clipLine=ks,y.clone=function(t){var n=new Or(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},y.clone$1=Xr,y.clone$2=function(t){var n=new Or(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},y.collisionCircleLayout=cp,y.config=gi,y.create=function(){var t=new Or(16);return Or!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},y.create$1=function(){var t=new Or(9);return Or!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},y.create$2=function(){var t=new Or(4);return Or!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},y.createCommonjsModule=v,y.createExpression=Ga,y.createLayout=D,y.createStyleLayer=function(t){return t.type==="custom"?new Hd(t):new Dh[t.type](t)},y.cross=function(t,n,a){var d=n[0],_=n[1],i=n[2],e=a[0],r=a[1],s=a[2];return t[0]=_*s-i*r,t[1]=i*e-d*s,t[2]=d*r-_*e,t},y.deepEqual=function t(n,a){if(Array.isArray(n)){if(!Array.isArray(a)||n.length!==a.length)return!1;for(var d=0;d<n.length;d++)if(!t(n[d],a[d]))return!1;return!0}if(typeof n=="object"&&n!==null&&a!==null){if(typeof a!="object"||Object.keys(n).length!==Object.keys(a).length)return!1;for(var _ in n)if(!t(n[_],a[_]))return!1;return!0}return n===a},y.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},y.dot$1=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},y.ease=ci,y.emitValidationErrors=tl,y.endsWith=or,y.enforceCacheSizeLimit=function(t){Cn(),wn&&wn.then(function(n){n.keys().then(function(a){for(var d=0;d<a.length-t;d++)n.delete(a[d])})})},y.evaluateSizeForFeature=Eh,y.evaluateSizeForZoom=wp,y.evaluateVariableOffset=Ch,y.evented=Lo,y.extend=wt,y.featureFilter=Ys,y.filterObject=sn,y.fromRotation=function(t,n){var a=Math.sin(n),d=Math.cos(n);return t[0]=d,t[1]=a,t[2]=0,t[3]=-a,t[4]=d,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},y.getAnchorAlignment=Cl,y.getAnchorJustification=Fu,y.getArrayBuffer=ar,y.getImage=re,y.getJSON=function(t,n){return Vn(wt(t,{type:"json"}),n)},y.getRTLTextPluginStatus=co,y.getReferrer=tn,y.getVideo=function(t,n){var a,d,_=xe.document.createElement("video");_.muted=!0,_.onloadstart=function(){n(null,_)};for(var i=0;i<t.length;i++){var e=xe.document.createElement("source");a=t[i],d=void 0,(d=xe.document.createElement("a")).href=a,(d.protocol!==xe.document.location.protocol||d.host!==xe.document.location.host)&&(_.crossOrigin="Anonymous"),e.src=t[i],_.appendChild(e)}return{cancel:function(){}}},y.identity=ho,y.invert=function(t,n){var a=n[0],d=n[1],_=n[2],i=n[3],e=n[4],r=n[5],s=n[6],p=n[7],m=n[8],g=n[9],I=n[10],E=n[11],M=n[12],L=n[13],F=n[14],O=n[15],Z=a*r-d*e,$=a*s-_*e,te=a*p-i*e,ie=d*s-_*r,ve=d*p-i*r,Pe=_*p-i*s,Me=m*L-g*M,Ue=m*F-I*M,qe=m*O-E*M,Ge=g*F-I*L,Qe=g*O-E*L,yt=I*O-E*F,nt=Z*yt-$*Qe+te*Ge+ie*qe-ve*Ue+Pe*Me;return nt?(t[0]=(r*yt-s*Qe+p*Ge)*(nt=1/nt),t[1]=(_*Qe-d*yt-i*Ge)*nt,t[2]=(L*Pe-F*ve+O*ie)*nt,t[3]=(I*ve-g*Pe-E*ie)*nt,t[4]=(s*qe-e*yt-p*Ue)*nt,t[5]=(a*yt-_*qe+i*Ue)*nt,t[6]=(F*te-M*Pe-O*$)*nt,t[7]=(m*Pe-I*te+E*$)*nt,t[8]=(e*Qe-r*qe+p*Me)*nt,t[9]=(d*qe-a*Qe-i*Me)*nt,t[10]=(M*ve-L*te+O*Z)*nt,t[11]=(g*te-m*ve-E*Z)*nt,t[12]=(r*Ue-e*Ge-s*Me)*nt,t[13]=(a*Ge-d*Ue+_*Me)*nt,t[14]=(L*$-M*ie-F*Z)*nt,t[15]=(m*ie-g*$+I*Z)*nt,t):null},y.isChar=Bt,y.isMapboxURL=Wr,y.keysDifference=function(t,n){var a=[];for(var d in t)d in n||a.push(d);return a},y.makeRequest=Vn,y.mapObject=zi,y.mercatorXfromLng=on,y.mercatorYfromLat=Dl,y.mercatorZfromAltitude=Rh,y.mul=Gu,y.multiply=Yl,y.mvt=Pu,y.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},y.normalize=function(t,n){var a=n[0],d=n[1],_=n[2],i=a*a+d*d+_*_;return i>0&&(i=1/Math.sqrt(i)),t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t},y.number=rr,y.offscreenCanvasSupported=St,y.ortho=function(t,n,a,d,_,i,e){var r=1/(n-a),s=1/(d-_),p=1/(i-e);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(n+a)*r,t[13]=(_+d)*s,t[14]=(e+i)*p,t[15]=1,t},y.parseGlyphPBF=function(t){return new ec(t).readFields(Od,[])},y.pbf=ec,y.performSymbolLayout=function(t,n,a,d,_,i,e){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var r=t.layers[0].layout,s=t.layers[0]._unevaluatedLayout._values,p={};if(t.textSizeData.kind==="composite"){var m=t.textSizeData,g=m.maxZoom;p.compositeTextSizes=[s["text-size"].possiblyEvaluate(new $i(m.minZoom),e),s["text-size"].possiblyEvaluate(new $i(g),e)]}if(t.iconSizeData.kind==="composite"){var I=t.iconSizeData,E=I.maxZoom;p.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new $i(I.minZoom),e),s["icon-size"].possiblyEvaluate(new $i(E),e)]}p.layoutTextSize=s["text-size"].possiblyEvaluate(new $i(t.zoom+1),e),p.layoutIconSize=s["icon-size"].possiblyEvaluate(new $i(t.zoom+1),e),p.textMaxSize=s["text-size"].possiblyEvaluate(new $i(18));for(var M=24*r.get("text-line-height"),L=r.get("text-rotation-alignment")==="map"&&r.get("symbol-placement")!=="point",F=r.get("text-keep-upright"),O=r.get("text-size"),Z=function(){var ie=te[$],ve=r.get("text-font").evaluate(ie,{},e).join(","),Pe=O.evaluate(ie,{},e),Me=p.layoutTextSize.evaluate(ie,{},e),Ue=p.layoutIconSize.evaluate(ie,{},e),qe={horizontal:{},vertical:void 0},Ge=ie.text,Qe=[0,0];if(Ge){var yt=Ge.toString(),nt=24*r.get("text-letter-spacing").evaluate(ie,{},e),tt=function(ai){for(var Pi=0,Ci=ai;Pi<Ci.length;Pi+=1)if(xi=Ci[Pi].charCodeAt(0),Bt.Arabic(xi)||Bt["Arabic Supplement"](xi)||Bt["Arabic Extended-A"](xi)||Bt["Arabic Presentation Forms-A"](xi)||Bt["Arabic Presentation Forms-B"](xi))return!1;var xi;return!0}(yt)?nt:0,at=r.get("text-anchor").evaluate(ie,{},e),ct=r.get("text-variable-anchor");if(!ct){var pt=r.get("text-radial-offset").evaluate(ie,{},e);Qe=pt?Ch(at,[24*pt,Bu]):r.get("text-offset").evaluate(ie,{},e).map(function(ai){return 24*ai})}var Je=L?"center":r.get("text-justify").evaluate(ie,{},e),Tt=r.get("symbol-placement"),At=Tt==="point"?24*r.get("text-max-width").evaluate(ie,{},e):0,li=function(){t.allowVerticalPlacement&&ma(yt)&&(qe.vertical=Ac(Ge,n,a,_,ve,At,M,at,"left",tt,Qe,wo.vertical,!0,Tt,Me,Pe))};if(!L&&ct){for(var fi=Je==="auto"?ct.map(function(ai){return Fu(ai)}):[Je],wi=!1,ki=0;ki<fi.length;ki++){var er=fi[ki];if(!qe.horizontal[er])if(wi)qe.horizontal[er]=qe.horizontal[0];else{var qi=Ac(Ge,n,a,_,ve,At,M,"center",er,tt,Qe,wo.horizontal,!1,Tt,Me,Pe);qi&&(qe.horizontal[er]=qi,wi=qi.positionedLines.length===1)}}li()}else{Je==="auto"&&(Je=Fu(at));var tr=Ac(Ge,n,a,_,ve,At,M,at,Je,tt,Qe,wo.horizontal,!1,Tt,Me,Pe);tr&&(qe.horizontal[Je]=tr),li(),ma(yt)&&L&&F&&(qe.vertical=Ac(Ge,n,a,_,ve,At,M,at,Je,tt,Qe,wo.vertical,!1,Tt,Me,Pe))}}var Ki=void 0,yr=!1;if(ie.icon&&ie.icon.name){var Xi=d[ie.icon.name];Xi&&(Ki=function(ai,Pi,Ci){var xi=Cl(Ci),Lr=Pi[0]-ai.displaySize[0]*xi.horizontalAlign,Tr=Pi[1]-ai.displaySize[1]*xi.verticalAlign;return{image:ai,top:Tr,bottom:Tr+ai.displaySize[1],left:Lr,right:Lr+ai.displaySize[0]}}(_[ie.icon.name],r.get("icon-offset").evaluate(ie,{},e),r.get("icon-anchor").evaluate(ie,{},e)),yr=Xi.sdf,t.sdfIcons===void 0?t.sdfIcons=Xi.sdf:t.sdfIcons!==Xi.sdf&&lr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xi.pixelRatio!==t.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var gr=cc(qe.horizontal)||qe.vertical;t.iconsInText=!!gr&&gr.iconsInText,(gr||Ki)&&function(ai,Pi,Ci,xi,Lr,Tr,Ti,Zi,mi,Ai,$r){var Fr=Tr.textMaxSize.evaluate(Pi,{});Fr===void 0&&(Fr=Ti);var Un,_r=ai.layers[0].layout,Xn=_r.get("icon-offset").evaluate(Pi,{},$r),Wn=cc(Ci.horizontal),To=Ti/24,eo=ai.tilePixelRatio*To,Hn=ai.tilePixelRatio*Fr/24,So=ai.tilePixelRatio*Zi,Ms=ai.tilePixelRatio*_r.get("symbol-spacing"),fc=_r.get("text-padding")*ai.tilePixelRatio,Fl=_r.get("icon-padding")*ai.tilePixelRatio,pu=_r.get("text-max-angle")/180*Math.PI,Fa=_r.get("text-rotation-alignment")==="map"&&_r.get("symbol-placement")!=="point",mc=_r.get("icon-rotation-alignment")==="map"&&_r.get("symbol-placement")!=="point",ss=_r.get("symbol-placement"),du=Ms/2,fu=_r.get("icon-text-fit");xi&&fu!=="none"&&(ai.allowVerticalPlacement&&Ci.vertical&&(Un=oc(xi,Ci.vertical,fu,_r.get("icon-text-fit-padding"),Xn,To)),Wn&&(xi=oc(xi,Wn,fu,_r.get("icon-text-fit-padding"),Xn,To)));var Ol=function(Eg,Uh){Uh.x<0||Uh.x>=8192||Uh.y<0||Uh.y>=8192||function(bn,yl,kg,Vu,Qd,Sm,Dp,Vl,Lp,jh,Rp,Bp,ef,Im,Vh,Em,km,Am,zm,Cm,Oa,Fp,Pm,Nl,Ag){var Mm,xc,Gc,$c,Xc,Wc=bn.addToLineVertexArray(yl,kg),Dm=0,Lm=0,Rm=0,Bm=0,tf=-1,rf=-1,mu={},Fm=Ee(""),nf=0,of=0;if(Vl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(nf=(Mm=Vl.layout.get("text-offset").evaluate(Oa,{},Nl).map(function(qh){return 24*qh}))[0],of=Mm[1]):(nf=24*Vl.layout.get("text-radial-offset").evaluate(Oa,{},Nl),of=Bu),bn.allowVerticalPlacement&&Vu.vertical){var Om=Vl.layout.get("text-rotate").evaluate(Oa,{},Nl)+90;$c=new lc(Lp,yl,jh,Rp,Bp,Vu.vertical,ef,Im,Vh,Om),Dp&&(Xc=new lc(Lp,yl,jh,Rp,Bp,Dp,km,Am,Vh,Om))}if(Qd){var af=Vl.layout.get("icon-rotate").evaluate(Oa,{}),Um=Vl.layout.get("icon-text-fit")!=="none",jm=Ah(Qd,af,Pm,Um),sf=Dp?Ah(Dp,af,Pm,Um):void 0;Gc=new lc(Lp,yl,jh,Rp,Bp,Qd,km,Am,!1,af),Dm=4*jm.length;var Vm=bn.iconSizeData,Nh=null;Vm.kind==="source"?(Nh=[128*Vl.layout.get("icon-size").evaluate(Oa,{})])[0]>32640&&lr(bn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Vm.kind==="composite"&&((Nh=[128*Fp.compositeIconSizes[0].evaluate(Oa,{},Nl),128*Fp.compositeIconSizes[1].evaluate(Oa,{},Nl)])[0]>32640||Nh[1]>32640)&&lr(bn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),bn.addSymbols(bn.icon,jm,Nh,Cm,zm,Oa,!1,yl,Wc.lineStartIndex,Wc.lineLength,-1,Nl),tf=bn.icon.placedSymbolArray.length-1,sf&&(Lm=4*sf.length,bn.addSymbols(bn.icon,sf,Nh,Cm,zm,Oa,wo.vertical,yl,Wc.lineStartIndex,Wc.lineLength,-1,Nl),rf=bn.icon.placedSymbolArray.length-1)}for(var Nm in Vu.horizontal){var Op=Vu.horizontal[Nm];if(!xc){Fm=Ee(Op.text);var zg=Vl.layout.get("text-rotate").evaluate(Oa,{},Nl);xc=new lc(Lp,yl,jh,Rp,Bp,Op,ef,Im,Vh,zg)}var qm=Op.positionedLines.length===1;if(Rm+=uc(bn,yl,Op,Sm,Vl,Vh,Oa,Em,Wc,Vu.vertical?wo.horizontal:wo.horizontalOnly,qm?Object.keys(Vu.horizontal):[Nm],mu,tf,Fp,Nl),qm)break}Vu.vertical&&(Bm+=uc(bn,yl,Vu.vertical,Sm,Vl,Vh,Oa,Em,Wc,wo.vertical,["vertical"],mu,rf,Fp,Nl));var Cg=xc?xc.boxStartIndex:bn.collisionBoxArray.length,Pg=xc?xc.boxEndIndex:bn.collisionBoxArray.length,Mg=$c?$c.boxStartIndex:bn.collisionBoxArray.length,Dg=$c?$c.boxEndIndex:bn.collisionBoxArray.length,Lg=Gc?Gc.boxStartIndex:bn.collisionBoxArray.length,Rg=Gc?Gc.boxEndIndex:bn.collisionBoxArray.length,Bg=Xc?Xc.boxStartIndex:bn.collisionBoxArray.length,Fg=Xc?Xc.boxEndIndex:bn.collisionBoxArray.length,ql=-1,Up=function(qh,Gm){return qh&&qh.circleDiameter?Math.max(qh.circleDiameter,Gm):Gm};ql=Up(xc,ql),ql=Up($c,ql),ql=Up(Gc,ql);var Zm=(ql=Up(Xc,ql))>-1?1:0;Zm&&(ql*=Ag/24),bn.glyphOffsetArray.length>=wr.MAX_GLYPHS&&lr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Oa.sortKey!==void 0&&bn.addToSortKeyRanges(bn.symbolInstances.length,Oa.sortKey),bn.symbolInstances.emplaceBack(yl.x,yl.y,mu.right>=0?mu.right:-1,mu.center>=0?mu.center:-1,mu.left>=0?mu.left:-1,mu.vertical||-1,tf,rf,Fm,Cg,Pg,Mg,Dg,Lg,Rg,Bg,Fg,jh,Rm,Bm,Dm,Lm,Zm,0,ef,nf,of,ql)}(ai,Uh,Eg,Ci,xi,Lr,Un,ai.layers[0],ai.collisionBoxArray,Pi.index,Pi.sourceLayerIndex,ai.index,eo,fc,Fa,mi,So,Fl,mc,Xn,Pi,Tr,Ai,$r,Ti)};if(ss==="line")for(var ju=0,Vc=ks(Pi.geometry,0,0,8192,8192);ju<Vc.length;ju+=1)for(var Nc=Vc[ju],yc=0,gc=Ip(Nc,Ms,pu,Ci.vertical||Wn,xi,24,Hn,ai.overscaling,8192);yc<gc.length;yc+=1){var qc=gc[yc];Wn&&qd(ai,Wn.text,du,qc)||Ol(Nc,qc)}else if(ss==="line-center")for(var _c=0,Vo=Pi.geometry;_c<Vo.length;_c+=1){var Ul=Vo[_c];if(Ul.length>1){var vc=Vd(Ul,pu,Ci.vertical||Wn,xi,24,Hn);vc&&Ol(Ul,vc)}}else if(Pi.type==="Polygon")for(var Kn=0,Ta=nu(Pi.geometry,0);Kn<Ta.length;Kn+=1){var Ds=Ta[Kn],ml=Ep(Ds,16);Ol(Ds[0],new Lu(ml.x,ml.y,0))}else if(Pi.type==="LineString")for(var jl=0,ls=Pi.geometry;jl<ls.length;jl+=1){var Zc=ls[jl];Ol(Zc,new Lu(Zc[0].x,Zc[0].y,0))}else if(Pi.type==="Point")for(var Kd=0,wm=Pi.geometry;Kd<wm.length;Kd+=1)for(var Jd=0,Tm=wm[Kd];Jd<Tm.length;Jd+=1){var Yd=Tm[Jd];Ol([Yd],new Lu(Yd.x,Yd.y,0))}}(t,ie,qe,Ki,d,p,Me,Ue,Qe,yr,e)},$=0,te=t.features;$<te.length;$+=1)Z();i&&t.generateCollisionDebugBuffers()},y.perspective=function(t,n,a,d,_){var i,e=1/Math.tan(n/2);return t[0]=e/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,_!=null&&_!==1/0?(t[10]=(_+d)*(i=1/(d-_)),t[14]=2*_*d*i):(t[10]=-1,t[14]=-2*d),t},y.pick=function(t,n){for(var a={},d=0;d<n.length;d++){var _=n[d];_ in t&&(a[_]=t[_])}return a},y.plugin=Ot,y.polygonIntersectsPolygon=hn,y.postMapLoadEvent=Bo,y.postTurnstileEvent=ot,y.potpack=xp,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Dt,y.registerForPluginStateChange=function(t){return t({pluginStatus:Bn,pluginURL:ya}),Lo.on("pluginStateChange",t),t},y.renderColorRamp=zu,y.rotate=function(t,n,a){var d=n[0],_=n[1],i=n[2],e=n[3],r=Math.sin(a),s=Math.cos(a);return t[0]=d*s+i*r,t[1]=_*s+e*r,t[2]=d*-r+i*s,t[3]=_*-r+e*s,t},y.rotateX=function(t,n,a){var d=Math.sin(a),_=Math.cos(a),i=n[4],e=n[5],r=n[6],s=n[7],p=n[8],m=n[9],g=n[10],I=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=i*_+p*d,t[5]=e*_+m*d,t[6]=r*_+g*d,t[7]=s*_+I*d,t[8]=p*_-i*d,t[9]=m*_-e*d,t[10]=g*_-r*d,t[11]=I*_-s*d,t},y.rotateZ=function(t,n,a){var d=Math.sin(a),_=Math.cos(a),i=n[0],e=n[1],r=n[2],s=n[3],p=n[4],m=n[5],g=n[6],I=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=i*_+p*d,t[1]=e*_+m*d,t[2]=r*_+g*d,t[3]=s*_+I*d,t[4]=p*_-i*d,t[5]=m*_-e*d,t[6]=g*_-r*d,t[7]=I*_-s*d,t},y.scale=function(t,n,a){var d=a[0],_=a[1],i=a[2];return t[0]=n[0]*d,t[1]=n[1]*d,t[2]=n[2]*d,t[3]=n[3]*d,t[4]=n[4]*_,t[5]=n[5]*_,t[6]=n[6]*_,t[7]=n[7]*_,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=n[11]*i,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},y.scale$1=function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t},y.scale$2=function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t},y.setCacheLimits=function(t,n){ro=t,pr=n},y.setRTLTextPlugin=function(t,n,a){if(a===void 0&&(a=!1),Bn==="deferred"||Bn==="loading"||Bn==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ya=ir.resolveURL(t),Bn="deferred",Ts=n,Jl(),a||Qt()},y.sphericalToCartesian=function(t){var n=t[0],a=t[1],d=t[2];return a+=90,a*=Math.PI/180,d*=Math.PI/180,{x:n*Math.cos(a)*Math.sin(d),y:n*Math.sin(a)*Math.sin(d),z:n*Math.cos(d)}},y.sqrLen=function(t){var n=t[0],a=t[1];return n*n+a*a},y.styleSpec=ye,y.sub=function(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t},y.symbolSize=Tp,y.transformMat3=function(t,n,a){var d=n[0],_=n[1],i=n[2];return t[0]=d*a[0]+_*a[3]+i*a[6],t[1]=d*a[1]+_*a[4]+i*a[7],t[2]=d*a[2]+_*a[5]+i*a[8],t},y.transformMat4=Ql,y.translate=function(t,n,a){var d,_,i,e,r,s,p,m,g,I,E,M,L=a[0],F=a[1],O=a[2];return n===t?(t[12]=n[0]*L+n[4]*F+n[8]*O+n[12],t[13]=n[1]*L+n[5]*F+n[9]*O+n[13],t[14]=n[2]*L+n[6]*F+n[10]*O+n[14],t[15]=n[3]*L+n[7]*F+n[11]*O+n[15]):(_=n[1],i=n[2],e=n[3],r=n[4],s=n[5],p=n[6],m=n[7],g=n[8],I=n[9],E=n[10],M=n[11],t[0]=d=n[0],t[1]=_,t[2]=i,t[3]=e,t[4]=r,t[5]=s,t[6]=p,t[7]=m,t[8]=g,t[9]=I,t[10]=E,t[11]=M,t[12]=d*L+r*F+g*O+n[12],t[13]=_*L+s*F+I*O+n[13],t[14]=i*L+p*F+E*O+n[14],t[15]=e*L+m*F+M*O+n[15]),t},y.triggerPluginCompletionEvent=rl,y.uniqueId=oi,y.validateCustomStyleLayer=function(t){var n=[],a=t.id;return a===void 0&&n.push({message:"layers."+a+': missing required property "id"'}),t.render===void 0&&n.push({message:"layers."+a+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&n.push({message:"layers."+a+': property "renderingMode" must be either "2d" or "3d"'}),n},y.validateLight=Ft,y.validateStyle=fa,y.values=function(t){var n=[];for(var a in t)n.push(t[a]);return n},y.vectorTile=Pu,y.version="1.15.3",y.warnOnce=lr,y.webpSupported=vr,y.window=xe,y.wrap=hr}),Y(["./shared"],function(y){function v(W){var Q=typeof W;if(Q==="number"||Q==="boolean"||Q==="string"||W==null)return JSON.stringify(W);if(Array.isArray(W)){for(var re="[",he=0,be=W;he<be.length;he+=1)re+=v(be[he])+",";return re+"]"}for(var De=Object.keys(W).sort(),Fe="{",Le=0;Le<De.length;Le++)Fe+=JSON.stringify(De[Le])+":"+v(W[De[Le]])+",";return Fe+"}"}function ce(W){for(var Q="",re=0,he=y.refProperties;re<he.length;re+=1)Q+="/"+v(W[he[re]]);return Q}var Te=function(W){this.keyCache={},W&&this.replace(W)};Te.prototype.replace=function(W){this._layerConfigs={},this._layers={},this.update(W,[])},Te.prototype.update=function(W,Q){for(var re=this,he=0,be=W;he<be.length;he+=1){var De=be[he];this._layerConfigs[De.id]=De;var Fe=this._layers[De.id]=y.createStyleLayer(De);Fe._featureFilter=y.featureFilter(Fe.filter),this.keyCache[De.id]&&delete this.keyCache[De.id]}for(var Le=0,ye=Q;Le<ye.length;Le+=1){var ke=ye[Le];delete this.keyCache[ke],delete this._layerConfigs[ke],delete this._layers[ke]}this.familiesBySource={};for(var ee=0,V=function(_e,de){for(var $e={},Ke=0;Ke<_e.length;Ke++){var Be=de&&de[_e[Ke].id]||ce(_e[Ke]);de&&(de[_e[Ke].id]=Be);var xt=$e[Be];xt||(xt=$e[Be]=[]),xt.push(_e[Ke])}var ht=[];for(var bt in $e)ht.push($e[bt]);return ht}(y.values(this._layerConfigs),this.keyCache);ee<V.length;ee+=1){var j=V[ee].map(function(_e){return re._layers[_e.id]}),J=j[0];if(J.visibility!=="none"){var ne=J.source||"",pe=this.familiesBySource[ne];pe||(pe=this.familiesBySource[ne]={});var Ie=J.sourceLayer||"_geojsonTileLayer",le=pe[Ie];le||(le=pe[Ie]=[]),le.push(j)}}};var Oe=function(W){var Q={},re=[];for(var he in W){var be=W[he],De=Q[he]={};for(var Fe in be){var Le=be[+Fe];if(Le&&Le.bitmap.width!==0&&Le.bitmap.height!==0){var ye={x:0,y:0,w:Le.bitmap.width+2,h:Le.bitmap.height+2};re.push(ye),De[Fe]={rect:ye,metrics:Le.metrics}}}}var ke=y.potpack(re),ee=new y.AlphaImage({width:ke.w||1,height:ke.h||1});for(var V in W){var j=W[V];for(var J in j){var ne=j[+J];if(ne&&ne.bitmap.width!==0&&ne.bitmap.height!==0){var pe=Q[V][J].rect;y.AlphaImage.copy(ne.bitmap,ee,{x:0,y:0},{x:pe.x+1,y:pe.y+1},ne.bitmap)}}}this.image=ee,this.positions=Q};y.register("GlyphAtlas",Oe);var Xe=function(W){this.tileID=new y.OverscaledTileID(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId};function xe(W,Q,re){for(var he=new y.EvaluationParameters(Q),be=0,De=W;be<De.length;be+=1)De[be].recalculate(he,re)}function dt(W,Q){var re=y.getArrayBuffer(W.request,function(he,be,De,Fe){he?Q(he):be&&Q(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(be)),rawData:be,cacheControl:De,expires:Fe})});return function(){re.cancel(),Q()}}Xe.prototype.parse=function(W,Q,re,he,be){var De=this;this.status="parsing",this.data=W,this.collisionBoxArray=new y.CollisionBoxArray;var Fe=new y.DictionaryCoder(Object.keys(W.layers).sort()),Le=new y.FeatureIndex(this.tileID,this.promoteId);Le.bucketLayerIDs=[];var ye,ke,ee,V,j={},J={featureIndex:Le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},ne=Q.familiesBySource[this.source];for(var pe in ne){var Ie=W.layers[pe];if(Ie){Ie.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+pe+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var le=Fe.encode(pe),_e=[],de=0;de<Ie.length;de++){var $e=Ie.feature(de),Ke=Le.getId($e,pe);_e.push({feature:$e,id:Ke,index:de,sourceLayerIndex:le})}for(var Be=0,xt=ne[pe];Be<xt.length;Be+=1){var ht=xt[Be],bt=ht[0];bt.minzoom&&this.zoom<Math.floor(bt.minzoom)||bt.maxzoom&&this.zoom>=bt.maxzoom||bt.visibility!=="none"&&(xe(ht,this.zoom,re),(j[bt.id]=bt.createBucket({index:Le.bucketLayerIDs.length,layers:ht,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:le,sourceID:this.source})).populate(_e,J,this.tileID.canonical),Le.bucketLayerIDs.push(ht.map(function(qt){return qt.id})))}}}var Rt=y.mapObject(J.glyphDependencies,function(qt){return Object.keys(qt).map(Number)});Object.keys(Rt).length?he.send("getGlyphs",{uid:this.uid,stacks:Rt},function(qt,It){ye||(ye=qt,ke=It,ii.call(De))}):ke={};var Zt=Object.keys(J.iconDependencies);Zt.length?he.send("getImages",{icons:Zt,source:this.source,tileID:this.tileID,type:"icons"},function(qt,It){ye||(ye=qt,ee=It,ii.call(De))}):ee={};var Yt=Object.keys(J.patternDependencies);function ii(){if(ye)return be(ye);if(ke&&ee&&V){var qt=new Oe(ke),It=new y.ImageAtlas(ee,V);for(var Rr in j){var ri=j[Rr];ri instanceof y.SymbolBucket?(xe(ri.layers,this.zoom,re),y.performSymbolLayout(ri,ke,qt.positions,ee,It.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ri.hasPattern&&(ri instanceof y.LineBucket||ri instanceof y.FillBucket||ri instanceof y.FillExtrusionBucket)&&(xe(ri.layers,this.zoom,re),ri.addFeatures(J,this.tileID.canonical,It.patternPositions))}this.status="done",be(null,{buckets:y.values(j).filter(function(Vr){return!Vr.isEmpty()}),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qt.image,imageAtlas:It,glyphMap:this.returnDependencies?ke:null,iconMap:this.returnDependencies?ee:null,glyphPositions:this.returnDependencies?qt.positions:null})}}Yt.length?he.send("getImages",{icons:Yt,source:this.source,tileID:this.tileID,type:"patterns"},function(qt,It){ye||(ye=qt,V=It,ii.call(De))}):V={},ii.call(this)};var zt=function(W,Q,re,he){this.actor=W,this.layerIndex=Q,this.availableImages=re,this.loadVectorData=he||dt,this.loading={},this.loaded={}};zt.prototype.loadTile=function(W,Q){var re=this,he=W.uid;this.loading||(this.loading={});var be=!!(W&&W.request&&W.request.collectResourceTiming)&&new y.RequestPerformance(W.request),De=this.loading[he]=new Xe(W);De.abort=this.loadVectorData(W,function(Fe,Le){if(delete re.loading[he],Fe||!Le)return De.status="done",re.loaded[he]=De,Q(Fe);var ye=Le.rawData,ke={};Le.expires&&(ke.expires=Le.expires),Le.cacheControl&&(ke.cacheControl=Le.cacheControl);var ee={};if(be){var V=be.finish();V&&(ee.resourceTiming=JSON.parse(JSON.stringify(V)))}De.vectorTile=Le.vectorTile,De.parse(Le.vectorTile,re.layerIndex,re.availableImages,re.actor,function(j,J){if(j||!J)return Q(j);Q(null,y.extend({rawTileData:ye.slice(0)},J,ke,ee))}),re.loaded=re.loaded||{},re.loaded[he]=De})},zt.prototype.reloadTile=function(W,Q){var re=this,he=this.loaded,be=W.uid,De=this;if(he&&he[be]){var Fe=he[be];Fe.showCollisionBoxes=W.showCollisionBoxes;var Le=function(ye,ke){var ee=Fe.reloadCallback;ee&&(delete Fe.reloadCallback,Fe.parse(Fe.vectorTile,De.layerIndex,re.availableImages,De.actor,ee)),Q(ye,ke)};Fe.status==="parsing"?Fe.reloadCallback=Le:Fe.status==="done"&&(Fe.vectorTile?Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Le):Le())}},zt.prototype.abortTile=function(W,Q){var re=this.loading,he=W.uid;re&&re[he]&&re[he].abort&&(re[he].abort(),delete re[he]),Q()},zt.prototype.removeTile=function(W,Q){var re=this.loaded,he=W.uid;re&&re[he]&&delete re[he],Q()};var ci=y.window.ImageBitmap,Ct=function(){this.loaded={}};function hr(W,Q){if(W.length!==0){wt(W[0],Q);for(var re=1;re<W.length;re++)wt(W[re],!Q)}}function wt(W,Q){for(var re=0,he=0,be=W.length,De=be-1;he<be;De=he++)re+=(W[he][0]-W[De][0])*(W[De][1]+W[he][1]);re>=0!=!!Q&&W.reverse()}Ct.prototype.loadTile=function(W,Q){var re=W.uid,he=W.encoding,be=W.rawImageData,De=ci&&be instanceof ci?this.getImageData(be):be,Fe=new y.DEMData(re,De,he);this.loaded=this.loaded||{},this.loaded[re]=Fe,Q(null,Fe)},Ct.prototype.getImageData=function(W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);var Q=this.offscreenCanvasContext.getImageData(-1,-1,W.width+2,W.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:Q.width,height:Q.height},Q.data)},Ct.prototype.removeTile=function(W){var Q=this.loaded,re=W.uid;Q&&Q[re]&&delete Q[re]};var Et=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,oi=function(W){this._feature=W,this.extent=y.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))};oi.prototype.loadGeometry=function(){if(this._feature.type===1){for(var W=[],Q=0,re=this._feature.geometry;Q<re.length;Q+=1){var he=re[Q];W.push([new y.Point$1(he[0],he[1])])}return W}for(var be=[],De=0,Fe=this._feature.geometry;De<Fe.length;De+=1){for(var Le=[],ye=0,ke=Fe[De];ye<ke.length;ye+=1){var ee=ke[ye];Le.push(new y.Point$1(ee[0],ee[1]))}be.push(Le)}return be},oi.prototype.toGeoJSON=function(W,Q,re){return Et.call(this,W,Q,re)};var Jt=function(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=W.length,this._features=W};Jt.prototype.feature=function(W){return new oi(this._features[W])};var Kt=y.vectorTile.VectorTileFeature,pi=or;function or(W,Q){this.options=Q||{},this.features=W,this.length=W.length}function zi(W,Q){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=Q||4096}or.prototype.feature=function(W){return new zi(this.features[W],this.options.extent)},zi.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var Q=0;Q<W.length;Q++){for(var re=W[Q],he=[],be=0;be<re.length;be++)he.push(new y.Point$1(re[be][0],re[be][1]));this.geometry.push(he)}return this.geometry},zi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,Q=1/0,re=-1/0,he=1/0,be=-1/0,De=0;De<W.length;De++)for(var Fe=W[De],Le=0;Le<Fe.length;Le++){var ye=Fe[Le];Q=Math.min(Q,ye.x),re=Math.max(re,ye.x),he=Math.min(he,ye.y),be=Math.max(be,ye.y)}return[Q,he,re,be]},zi.prototype.toGeoJSON=Kt.prototype.toGeoJSON;var sn=fn,Xr=pi;function fn(W){var Q=new y.pbf;return function(re,he){for(var be in re.layers)he.writeMessage(3,lr,re.layers[be])}(W,Q),Q.finish()}function lr(W,Q){var re;Q.writeVarintField(15,W.version||1),Q.writeStringField(1,W.name||""),Q.writeVarintField(5,W.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<W.length;re++)he.feature=W.feature(re),Q.writeMessage(2,Li,he);var be=he.keys;for(re=0;re<be.length;re++)Q.writeStringField(3,be[re]);var De=he.values;for(re=0;re<De.length;re++)Q.writeMessage(4,Jn,De[re])}function Li(W,Q){var re=W.feature;re.id!==void 0&&Q.writeVarintField(1,re.id),Q.writeMessage(2,Yr,W),Q.writeVarintField(3,re.type),Q.writeMessage(4,An,re)}function Yr(W,Q){var re=W.feature,he=W.keys,be=W.values,De=W.keycache,Fe=W.valuecache;for(var Le in re.properties){var ye=De[Le];ye===void 0&&(he.push(Le),De[Le]=ye=he.length-1),Q.writeVarint(ye);var ke=re.properties[Le],ee=typeof ke;ee!=="string"&&ee!=="boolean"&&ee!=="number"&&(ke=JSON.stringify(ke));var V=ee+":"+ke,j=Fe[V];j===void 0&&(be.push(ke),Fe[V]=j=be.length-1),Q.writeVarint(j)}}function Wt(W,Q){return(Q<<3)+(7&W)}function Qr(W){return W<<1^W>>31}function An(W,Q){for(var re=W.loadGeometry(),he=W.type,be=0,De=0,Fe=re.length,Le=0;Le<Fe;Le++){var ye=re[Le],ke=1;he===1&&(ke=ye.length),Q.writeVarint(Wt(1,ke));for(var ee=he===3?ye.length-1:ye.length,V=0;V<ee;V++){V===1&&he!==1&&Q.writeVarint(Wt(2,ee-1));var j=ye[V].x-be,J=ye[V].y-De;Q.writeVarint(Qr(j)),Q.writeVarint(Qr(J)),be+=j,De+=J}he===3&&Q.writeVarint(Wt(7,1))}}function Jn(W,Q){var re=typeof W;re==="string"?Q.writeStringField(1,W):re==="boolean"?Q.writeBooleanField(7,W):re==="number"&&(W%1!=0?Q.writeDoubleField(3,W):W<0?Q.writeSVarintField(6,W):Q.writeVarintField(5,W))}function kt(W,Q,re,he){ti(W,re,he),ti(Q,2*re,2*he),ti(Q,2*re+1,2*he+1)}function ti(W,Q,re){var he=W[Q];W[Q]=W[re],W[re]=he}function si(W,Q,re,he){var be=W-re,De=Q-he;return be*be+De*De}sn.fromVectorTileJs=fn,sn.fromGeojsonVt=function(W,Q){Q=Q||{};var re={};for(var he in W)re[he]=new pi(W[he].features,Q),re[he].name=he,re[he].version=Q.version,re[he].extent=Q.extent;return fn({layers:re})},sn.GeoJSONWrapper=Xr;var Fi=function(W){return W[0]},Oi=function(W){return W[1]},Qi=function(W,Q,re,he,be){Q===void 0&&(Q=Fi),re===void 0&&(re=Oi),he===void 0&&(he=64),be===void 0&&(be=Float64Array),this.nodeSize=he,this.points=W;for(var De=W.length<65536?Uint16Array:Uint32Array,Fe=this.ids=new De(W.length),Le=this.coords=new be(2*W.length),ye=0;ye<W.length;ye++)Fe[ye]=ye,Le[2*ye]=Q(W[ye]),Le[2*ye+1]=re(W[ye]);(function ke(ee,V,j,J,ne,pe){if(!(ne-J<=j)){var Ie=J+ne>>1;(function le(_e,de,$e,Ke,Be,xt){for(;Be>Ke;){if(Be-Ke>600){var ht=Be-Ke+1,bt=$e-Ke+1,Rt=Math.log(ht),Zt=.5*Math.exp(2*Rt/3),Yt=.5*Math.sqrt(Rt*Zt*(ht-Zt)/ht)*(bt-ht/2<0?-1:1);le(_e,de,$e,Math.max(Ke,Math.floor($e-bt*Zt/ht+Yt)),Math.min(Be,Math.floor($e+(ht-bt)*Zt/ht+Yt)),xt)}var ii=de[2*$e+xt],qt=Ke,It=Be;for(kt(_e,de,Ke,$e),de[2*Be+xt]>ii&&kt(_e,de,Ke,Be);qt<It;){for(kt(_e,de,qt,It),qt++,It--;de[2*qt+xt]<ii;)qt++;for(;de[2*It+xt]>ii;)It--}de[2*Ke+xt]===ii?kt(_e,de,Ke,It):kt(_e,de,++It,Be),It<=$e&&(Ke=It+1),$e<=It&&(Be=It-1)}})(ee,V,Ie,J,ne,pe%2),ke(ee,V,j,J,Ie-1,pe+1),ke(ee,V,j,Ie+1,ne,pe+1)}})(Fe,Le,he,0,Fe.length-1,0)};Qi.prototype.range=function(W,Q,re,he){return function(be,De,Fe,Le,ye,ke,ee){for(var V,j,J=[0,be.length-1,0],ne=[];J.length;){var pe=J.pop(),Ie=J.pop(),le=J.pop();if(Ie-le<=ee)for(var _e=le;_e<=Ie;_e++)j=De[2*_e+1],(V=De[2*_e])>=Fe&&V<=ye&&j>=Le&&j<=ke&&ne.push(be[_e]);else{var de=Math.floor((le+Ie)/2);j=De[2*de+1],(V=De[2*de])>=Fe&&V<=ye&&j>=Le&&j<=ke&&ne.push(be[de]);var $e=(pe+1)%2;(pe===0?Fe<=V:Le<=j)&&(J.push(le),J.push(de-1),J.push($e)),(pe===0?ye>=V:ke>=j)&&(J.push(de+1),J.push(Ie),J.push($e))}}return ne}(this.ids,this.coords,W,Q,re,he,this.nodeSize)},Qi.prototype.within=function(W,Q,re){return function(he,be,De,Fe,Le,ye){for(var ke=[0,he.length-1,0],ee=[],V=Le*Le;ke.length;){var j=ke.pop(),J=ke.pop(),ne=ke.pop();if(J-ne<=ye)for(var pe=ne;pe<=J;pe++)si(be[2*pe],be[2*pe+1],De,Fe)<=V&&ee.push(he[pe]);else{var Ie=Math.floor((ne+J)/2),le=be[2*Ie],_e=be[2*Ie+1];si(le,_e,De,Fe)<=V&&ee.push(he[Ie]);var de=(j+1)%2;(j===0?De-Le<=le:Fe-Le<=_e)&&(ke.push(ne),ke.push(Ie-1),ke.push(de)),(j===0?De+Le>=le:Fe+Le>=_e)&&(ke.push(Ie+1),ke.push(J),ke.push(de))}}return ee}(this.ids,this.coords,W,Q,re,this.nodeSize)};var Ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(W){return W}},ji=function(W){this.options=jr(Object.create(Ui),W),this.trees=new Array(this.options.maxZoom+1)};function ir(W,Q,re,he,be){return{x:W,y:Q,zoom:1/0,id:re,parentId:-1,numPoints:he,properties:be}}function gi(W,Q){var re=W.geometry.coordinates,he=re[1];return{x:zr(re[0]),y:Ht(he),zoom:1/0,index:Q,parentId:-1}}function vr(W){return{type:"Feature",id:W.id,properties:Ar(W),geometry:{type:"Point",coordinates:[(he=W.x,360*(he-.5)),(Q=W.y,re=(180-360*Q)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var Q,re,he}function Ar(W){var Q=W.numPoints,re=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return jr(jr({},W.properties),{cluster:!0,cluster_id:W.id,point_count:Q,point_count_abbreviated:re})}function zr(W){return W/360+.5}function Ht(W){var Q=Math.sin(W*Math.PI/180),re=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return re<0?0:re>1?1:re}function jr(W,Q){for(var re in Q)W[re]=Q[re];return W}function Sr(W){return W.x}function Wr(W){return W.y}function Eo(W,Q,re,he,be,De){var Fe=be-re,Le=De-he;if(Fe!==0||Le!==0){var ye=((W-re)*Fe+(Q-he)*Le)/(Fe*Fe+Le*Le);ye>1?(re=be,he=De):ye>0&&(re+=Fe*ye,he+=Le*ye)}return(Fe=W-re)*Fe+(Le=Q-he)*Le}function to(W,Q,re,he){var be={id:W===void 0?null:W,type:Q,geometry:re,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Fe=De.geometry,Le=De.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")po(De,Fe);else if(Le==="Polygon"||Le==="MultiLineString")for(var ye=0;ye<Fe.length;ye++)po(De,Fe[ye]);else if(Le==="MultiPolygon")for(ye=0;ye<Fe.length;ye++)for(var ke=0;ke<Fe[ye].length;ke++)po(De,Fe[ye][ke])}(be),be}function po(W,Q){for(var re=0;re<Q.length;re+=3)W.minX=Math.min(W.minX,Q[re]),W.minY=Math.min(W.minY,Q[re+1]),W.maxX=Math.max(W.maxX,Q[re]),W.maxY=Math.max(W.maxY,Q[re+1])}function en(W,Q,re,he){if(Q.geometry){var be=Q.geometry.coordinates,De=Q.geometry.type,Fe=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),Le=[],ye=Q.id;if(re.promoteId?ye=Q.properties[re.promoteId]:re.generateId&&(ye=he||0),De==="Point")jn(be,Le);else if(De==="MultiPoint")for(var ke=0;ke<be.length;ke++)jn(be[ke],Le);else if(De==="LineString")Go(be,Le,Fe,!1);else if(De==="MultiLineString"){if(re.lineMetrics){for(ke=0;ke<be.length;ke++)Go(be[ke],Le=[],Fe,!1),W.push(to(ye,"LineString",Le,Q.properties));return}Si(be,Le,Fe,!1)}else if(De==="Polygon")Si(be,Le,Fe,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(ke=0;ke<Q.geometry.geometries.length;ke++)en(W,{id:ye,geometry:Q.geometry.geometries[ke],properties:Q.properties},re,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<be.length;ke++){var ee=[];Si(be[ke],ee,Fe,!0),Le.push(ee)}}W.push(to(ye,De,Le,Q.properties))}}function jn(W,Q){Q.push(wn(W[0])),Q.push(io(W[1])),Q.push(0)}function Go(W,Q,re,he){for(var be,De,Fe=0,Le=0;Le<W.length;Le++){var ye=wn(W[Le][0]),ke=io(W[Le][1]);Q.push(ye),Q.push(ke),Q.push(0),Le>0&&(Fe+=he?(be*ke-ye*De)/2:Math.sqrt(Math.pow(ye-be,2)+Math.pow(ke-De,2))),be=ye,De=ke}var ee=Q.length-3;Q[2]=1,function V(j,J,ne,pe){for(var Ie,le=pe,_e=ne-J>>1,de=ne-J,$e=j[J],Ke=j[J+1],Be=j[ne],xt=j[ne+1],ht=J+3;ht<ne;ht+=3){var bt=Eo(j[ht],j[ht+1],$e,Ke,Be,xt);if(bt>le)Ie=ht,le=bt;else if(bt===le){var Rt=Math.abs(ht-_e);Rt<de&&(Ie=ht,de=Rt)}}le>pe&&(Ie-J>3&&V(j,J,Ie,pe),j[Ie+2]=le,ne-Ie>3&&V(j,Ie,ne,pe))}(Q,0,ee,re),Q[ee+2]=1,Q.size=Math.abs(Fe),Q.start=0,Q.end=Q.size}function Si(W,Q,re,he){for(var be=0;be<W.length;be++){var De=[];Go(W[be],De,re,he),Q.push(De)}}function wn(W){return W/360+.5}function io(W){var Q=Math.sin(W*Math.PI/180),re=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return re<0?0:re>1?1:re}function zn(W,Q,re,he,be,De,Fe,Le){if(he/=Q,De>=(re/=Q)&&Fe<he)return W;if(Fe<re||De>=he)return null;for(var ye=[],ke=0;ke<W.length;ke++){var ee=W[ke],V=ee.geometry,j=ee.type,J=be===0?ee.minX:ee.minY,ne=be===0?ee.maxX:ee.maxY;if(J>=re&&ne<he)ye.push(ee);else if(!(ne<re||J>=he)){var pe=[];if(j==="Point"||j==="MultiPoint")Sa(V,pe,re,he,be);else if(j==="LineString")ot(V,pe,re,he,be,!1,Le.lineMetrics);else if(j==="MultiLineString")Bo(V,pe,re,he,be,!1);else if(j==="Polygon")Bo(V,pe,re,he,be,!0);else if(j==="MultiPolygon")for(var Ie=0;Ie<V.length;Ie++){var le=[];Bo(V[Ie],le,re,he,be,!0),le.length&&pe.push(le)}if(pe.length){if(Le.lineMetrics&&j==="LineString"){for(Ie=0;Ie<pe.length;Ie++)ye.push(to(ee.id,j,pe[Ie],ee.tags));continue}j!=="LineString"&&j!=="MultiLineString"||(pe.length===1?(j="LineString",pe=pe[0]):j="MultiLineString"),j!=="Point"&&j!=="MultiPoint"||(j=pe.length===3?"Point":"MultiPoint"),ye.push(to(ee.id,j,pe,ee.tags))}}}return ye.length?ye:null}function Sa(W,Q,re,he,be){for(var De=0;De<W.length;De+=3){var Fe=W[De+be];Fe>=re&&Fe<=he&&(Q.push(W[De]),Q.push(W[De+1]),Q.push(W[De+2]))}}function ot(W,Q,re,he,be,De,Fe){for(var Le,ye,ke=Mt(W),ee=be===0?pr:Cn,V=W.start,j=0;j<W.length-3;j+=3){var J=W[j],ne=W[j+1],pe=W[j+2],Ie=W[j+3],le=W[j+4],_e=be===0?J:ne,de=be===0?Ie:le,$e=!1;Fe&&(Le=Math.sqrt(Math.pow(J-Ie,2)+Math.pow(ne-le,2))),_e<re?de>re&&(ye=ee(ke,J,ne,Ie,le,re),Fe&&(ke.start=V+Le*ye)):_e>he?de<he&&(ye=ee(ke,J,ne,Ie,le,he),Fe&&(ke.start=V+Le*ye)):ro(ke,J,ne,pe),de<re&&_e>=re&&(ye=ee(ke,J,ne,Ie,le,re),$e=!0),de>he&&_e<=he&&(ye=ee(ke,J,ne,Ie,le,he),$e=!0),!De&&$e&&(Fe&&(ke.end=V+Le*ye),Q.push(ke),ke=Mt(W)),Fe&&(V+=Le)}var Ke=W.length-3;J=W[Ke],ne=W[Ke+1],pe=W[Ke+2],(_e=be===0?J:ne)>=re&&_e<=he&&ro(ke,J,ne,pe),Ke=ke.length-3,De&&Ke>=3&&(ke[Ke]!==ke[0]||ke[Ke+1]!==ke[1])&&ro(ke,ke[0],ke[1],ke[2]),ke.length&&Q.push(ke)}function Mt(W){var Q=[];return Q.size=W.size,Q.start=W.start,Q.end=W.end,Q}function Bo(W,Q,re,he,be,De){for(var Fe=0;Fe<W.length;Fe++)ot(W[Fe],Q,re,he,be,De,!1)}function ro(W,Q,re,he){W.push(Q),W.push(re),W.push(he)}function pr(W,Q,re,he,be,De){var Fe=(De-Q)/(he-Q);return W.push(De),W.push(re+(be-re)*Fe),W.push(1),Fe}function Cn(W,Q,re,he,be,De){var Fe=(De-re)/(be-re);return W.push(Q+(he-Q)*Fe),W.push(De),W.push(1),Fe}function mn(W,Q){for(var re=[],he=0;he<W.length;he++){var be,De=W[he],Fe=De.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")be=fo(De.geometry,Q);else if(Fe==="MultiLineString"||Fe==="Polygon"){be=[];for(var Le=0;Le<De.geometry.length;Le++)be.push(fo(De.geometry[Le],Q))}else if(Fe==="MultiPolygon")for(be=[],Le=0;Le<De.geometry.length;Le++){for(var ye=[],ke=0;ke<De.geometry[Le].length;ke++)ye.push(fo(De.geometry[Le][ke],Q));be.push(ye)}re.push(to(De.id,Fe,be,De.tags))}return re}function fo(W,Q){var re=[];re.size=W.size,W.start!==void 0&&(re.start=W.start,re.end=W.end);for(var he=0;he<W.length;he+=3)re.push(W[he]+Q,W[he+1],W[he+2]);return re}function xr(W,Q){if(W.transformed)return W;var re,he,be,De=1<<W.z,Fe=W.x,Le=W.y;for(re=0;re<W.features.length;re++){var ye=W.features[re],ke=ye.geometry,ee=ye.type;if(ye.geometry=[],ee===1)for(he=0;he<ke.length;he+=2)ye.geometry.push(St(ke[he],ke[he+1],Q,De,Fe,Le));else for(he=0;he<ke.length;he++){var V=[];for(be=0;be<ke[he].length;be+=2)V.push(St(ke[he][be],ke[he][be+1],Q,De,Fe,Le));ye.geometry.push(V)}}return W.transformed=!0,W}function St(W,Q,re,he,be,De){return[Math.round(re*(W*he-be)),Math.round(re*(Q*he-De))]}function Mi(W,Q,re,he,be){for(var De=Q===be.maxZoom?0:be.tolerance/((1<<Q)*be.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:he,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<W.length;Le++){Fe.numFeatures++,Ii(Fe,W[Le],De,be);var ye=W[Le].minX,ke=W[Le].minY,ee=W[Le].maxX,V=W[Le].maxY;ye<Fe.minX&&(Fe.minX=ye),ke<Fe.minY&&(Fe.minY=ke),ee>Fe.maxX&&(Fe.maxX=ee),V>Fe.maxY&&(Fe.maxY=V)}return Fe}function Ii(W,Q,re,he){var be=Q.geometry,De=Q.type,Fe=[];if(De==="Point"||De==="MultiPoint")for(var Le=0;Le<be.length;Le+=3)Fe.push(be[Le]),Fe.push(be[Le+1]),W.numPoints++,W.numSimplified++;else if(De==="LineString")tn(Fe,be,W,re,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(Le=0;Le<be.length;Le++)tn(Fe,be[Le],W,re,De==="Polygon",Le===0);else if(De==="MultiPolygon")for(var ye=0;ye<be.length;ye++){var ke=be[ye];for(Le=0;Le<ke.length;Le++)tn(Fe,ke[Le],W,re,!0,Le===0)}if(Fe.length){var ee=Q.tags||null;if(De==="LineString"&&he.lineMetrics){for(var V in ee={},Q.tags)ee[V]=Q.tags[V];ee.mapbox_clip_start=be.start/be.size,ee.mapbox_clip_end=be.end/be.size}var j={geometry:Fe,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:ee};Q.id!==null&&(j.id=Q.id),W.features.push(j)}}function tn(W,Q,re,he,be,De){var Fe=he*he;if(he>0&&Q.size<(be?Fe:he))re.numPoints+=Q.length/3;else{for(var Le=[],ye=0;ye<Q.length;ye+=3)(he===0||Q[ye+2]>Fe)&&(re.numSimplified++,Le.push(Q[ye]),Le.push(Q[ye+1])),re.numPoints++;be&&function(ke,ee){for(var V=0,j=0,J=ke.length,ne=J-2;j<J;ne=j,j+=2)V+=(ke[j]-ke[ne])*(ke[j+1]+ke[ne+1]);if(V>0===ee)for(j=0,J=ke.length;j<J/2;j+=2){var pe=ke[j],Ie=ke[j+1];ke[j]=ke[J-2-j],ke[j+1]=ke[J-1-j],ke[J-2-j]=pe,ke[J-1-j]=Ie}}(Le,De),W.push(Le)}}function Pn(W,Q){var re=(Q=this.options=function(be,De){for(var Fe in De)be[Fe]=De[Fe];return be}(Object.create(this.options),Q)).debug;if(re&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(be,De){var Fe=[];if(be.type==="FeatureCollection")for(var Le=0;Le<be.features.length;Le++)en(Fe,be.features[Le],De,Le);else en(Fe,be.type==="Feature"?be:{geometry:be},De);return Fe}(W,Q);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(be,De){var Fe=De.buffer/De.extent,Le=be,ye=zn(be,1,-1-Fe,Fe,0,-1,2,De),ke=zn(be,1,1-Fe,2+Fe,0,-1,2,De);return(ye||ke)&&(Le=zn(be,1,-Fe,1+Fe,0,-1,2,De)||[],ye&&(Le=mn(ye,1).concat(Le)),ke&&(Le=Le.concat(mn(ke,-1)))),Le}(he,Q)).length&&this.splitTile(he,0,0,0),re&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _i(W,Q,re){return 32*((1<<W)*re+Q)+W}function mo(W,Q){var re=W.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);var he=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!he)return Q(null,null);var be=new Jt(he.features),De=sn(be);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),Q(null,{vectorTile:be,rawData:De.buffer})}ji.prototype.load=function(W){var Q=this.options,re=Q.log,he=Q.minZoom,be=Q.maxZoom,De=Q.nodeSize;re&&console.time("total time");var Fe="prepare "+W.length+" points";re&&console.time(Fe),this.points=W;for(var Le=[],ye=0;ye<W.length;ye++)W[ye].geometry&&Le.push(gi(W[ye],ye));this.trees[be+1]=new Qi(Le,Sr,Wr,De,Float32Array),re&&console.timeEnd(Fe);for(var ke=be;ke>=he;ke--){var ee=+Date.now();Le=this._cluster(Le,ke),this.trees[ke]=new Qi(Le,Sr,Wr,De,Float32Array),re&&console.log("z%d: %d clusters in %dms",ke,Le.length,+Date.now()-ee)}return re&&console.timeEnd("total time"),this},ji.prototype.getClusters=function(W,Q){var re=((W[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,W[1])),be=W[2]===180?180:((W[2]+180)%360+360)%360-180,De=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)re=-180,be=180;else if(re>be){var Fe=this.getClusters([re,he,180,De],Q),Le=this.getClusters([-180,he,be,De],Q);return Fe.concat(Le)}for(var ye=this.trees[this._limitZoom(Q)],ke=[],ee=0,V=ye.range(zr(re),Ht(De),zr(be),Ht(he));ee<V.length;ee+=1){var j=ye.points[V[ee]];ke.push(j.numPoints?vr(j):this.points[j.index])}return ke},ji.prototype.getChildren=function(W){var Q=this._getOriginId(W),re=this._getOriginZoom(W),he="No cluster with the specified id.",be=this.trees[re];if(!be)throw new Error(he);var De=be.points[Q];if(!De)throw new Error(he);for(var Fe=this.options.radius/(this.options.extent*Math.pow(2,re-1)),Le=[],ye=0,ke=be.within(De.x,De.y,Fe);ye<ke.length;ye+=1){var ee=be.points[ke[ye]];ee.parentId===W&&Le.push(ee.numPoints?vr(ee):this.points[ee.index])}if(Le.length===0)throw new Error(he);return Le},ji.prototype.getLeaves=function(W,Q,re){var he=[];return this._appendLeaves(he,W,Q=Q||10,re=re||0,0),he},ji.prototype.getTile=function(W,Q,re){var he=this.trees[this._limitZoom(W)],be=Math.pow(2,W),De=this.options,Fe=De.radius/De.extent,Le=(re-Fe)/be,ye=(re+1+Fe)/be,ke={features:[]};return this._addTileFeatures(he.range((Q-Fe)/be,Le,(Q+1+Fe)/be,ye),he.points,Q,re,be,ke),Q===0&&this._addTileFeatures(he.range(1-Fe/be,Le,1,ye),he.points,be,re,be,ke),Q===be-1&&this._addTileFeatures(he.range(0,Le,Fe/be,ye),he.points,-1,re,be,ke),ke.features.length?ke:null},ji.prototype.getClusterExpansionZoom=function(W){for(var Q=this._getOriginZoom(W)-1;Q<=this.options.maxZoom;){var re=this.getChildren(W);if(Q++,re.length!==1)break;W=re[0].properties.cluster_id}return Q},ji.prototype._appendLeaves=function(W,Q,re,he,be){for(var De=0,Fe=this.getChildren(Q);De<Fe.length;De+=1){var Le=Fe[De],ye=Le.properties;if(ye&&ye.cluster?be+ye.point_count<=he?be+=ye.point_count:be=this._appendLeaves(W,ye.cluster_id,re,he,be):be<he?be++:W.push(Le),W.length===re)break}return be},ji.prototype._addTileFeatures=function(W,Q,re,he,be,De){for(var Fe=0,Le=W;Fe<Le.length;Fe+=1){var ye=Q[Le[Fe]],ke=ye.numPoints,ee={type:1,geometry:[[Math.round(this.options.extent*(ye.x*be-re)),Math.round(this.options.extent*(ye.y*be-he))]],tags:ke?Ar(ye):this.points[ye.index].properties},V=void 0;ke?V=ye.id:this.options.generateId?V=ye.index:this.points[ye.index].id&&(V=this.points[ye.index].id),V!==void 0&&(ee.id=V),De.features.push(ee)}},ji.prototype._limitZoom=function(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))},ji.prototype._cluster=function(W,Q){for(var re=[],he=this.options,be=he.reduce,De=he.minPoints,Fe=he.radius/(he.extent*Math.pow(2,Q)),Le=0;Le<W.length;Le++){var ye=W[Le];if(!(ye.zoom<=Q)){ye.zoom=Q;for(var ke=this.trees[Q+1],ee=ke.within(ye.x,ye.y,Fe),V=ye.numPoints||1,j=V,J=0,ne=ee;J<ne.length;J+=1){var pe=ke.points[ne[J]];pe.zoom>Q&&(j+=pe.numPoints||1)}if(j>=De){for(var Ie=ye.x*V,le=ye.y*V,_e=be&&V>1?this._map(ye,!0):null,de=(Le<<5)+(Q+1)+this.points.length,$e=0,Ke=ee;$e<Ke.length;$e+=1){var Be=ke.points[Ke[$e]];if(!(Be.zoom<=Q)){Be.zoom=Q;var xt=Be.numPoints||1;Ie+=Be.x*xt,le+=Be.y*xt,Be.parentId=de,be&&(_e||(_e=this._map(ye,!0)),be(_e,this._map(Be)))}}ye.parentId=de,re.push(ir(Ie/j,le/j,de,j,_e))}else if(re.push(ye),j>1)for(var ht=0,bt=ee;ht<bt.length;ht+=1){var Rt=ke.points[bt[ht]];Rt.zoom<=Q||(Rt.zoom=Q,re.push(Rt))}}}return re},ji.prototype._getOriginId=function(W){return W-this.points.length>>5},ji.prototype._getOriginZoom=function(W){return(W-this.points.length)%32},ji.prototype._map=function(W,Q){if(W.numPoints)return Q?jr({},W.properties):W.properties;var re=this.points[W.index].properties,he=this.options.map(re);return Q&&he===re?jr({},he):he},Pn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pn.prototype.splitTile=function(W,Q,re,he,be,De,Fe){for(var Le=[W,Q,re,he],ye=this.options,ke=ye.debug;Le.length;){he=Le.pop(),re=Le.pop(),Q=Le.pop(),W=Le.pop();var ee=1<<Q,V=_i(Q,re,he),j=this.tiles[V];if(!j&&(ke>1&&console.time("creation"),j=this.tiles[V]=Mi(W,Q,re,he,ye),this.tileCoords.push({z:Q,x:re,y:he}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,re,he,j.numFeatures,j.numPoints,j.numSimplified),console.timeEnd("creation"));var J="z"+Q;this.stats[J]=(this.stats[J]||0)+1,this.total++}if(j.source=W,be){if(Q===ye.maxZoom||Q===be)continue;var ne=1<<be-Q;if(re!==Math.floor(De/ne)||he!==Math.floor(Fe/ne))continue}else if(Q===ye.indexMaxZoom||j.numPoints<=ye.indexMaxPoints)continue;if(j.source=null,W.length!==0){ke>1&&console.time("clipping");var pe,Ie,le,_e,de,$e,Ke=.5*ye.buffer/ye.extent,Be=.5-Ke,xt=.5+Ke,ht=1+Ke;pe=Ie=le=_e=null,de=zn(W,ee,re-Ke,re+xt,0,j.minX,j.maxX,ye),$e=zn(W,ee,re+Be,re+ht,0,j.minX,j.maxX,ye),W=null,de&&(pe=zn(de,ee,he-Ke,he+xt,1,j.minY,j.maxY,ye),Ie=zn(de,ee,he+Be,he+ht,1,j.minY,j.maxY,ye),de=null),$e&&(le=zn($e,ee,he-Ke,he+xt,1,j.minY,j.maxY,ye),_e=zn($e,ee,he+Be,he+ht,1,j.minY,j.maxY,ye),$e=null),ke>1&&console.timeEnd("clipping"),Le.push(pe||[],Q+1,2*re,2*he),Le.push(Ie||[],Q+1,2*re,2*he+1),Le.push(le||[],Q+1,2*re+1,2*he),Le.push(_e||[],Q+1,2*re+1,2*he+1)}}},Pn.prototype.getTile=function(W,Q,re){var he=this.options,be=he.extent,De=he.debug;if(W<0||W>24)return null;var Fe=1<<W,Le=_i(W,Q=(Q%Fe+Fe)%Fe,re);if(this.tiles[Le])return xr(this.tiles[Le],be);De>1&&console.log("drilling down to z%d-%d-%d",W,Q,re);for(var ye,ke=W,ee=Q,V=re;!ye&&ke>0;)ke--,ee=Math.floor(ee/2),V=Math.floor(V/2),ye=this.tiles[_i(ke,ee,V)];return ye&&ye.source?(De>1&&console.log("found parent tile z%d-%d-%d",ke,ee,V),De>1&&console.time("drilling down"),this.splitTile(ye.source,ke,ee,V,W,Q,re),De>1&&console.timeEnd("drilling down"),this.tiles[Le]?xr(this.tiles[Le],be):null):null};var Vn=function(W){function Q(re,he,be,De){W.call(this,re,he,be,mo),De&&(this.loadGeoJSON=De)}return W&&(Q.__proto__=W),(Q.prototype=Object.create(W&&W.prototype)).constructor=Q,Q.prototype.loadData=function(re,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Q.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,be=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var De=!!(be&&be.request&&be.request.collectResourceTiming)&&new y.RequestPerformance(be.request);this.loadGeoJSON(be,function(Fe,Le){if(Fe||!Le)return he(Fe);if(typeof Le!="object")return he(new Error("Input data given to '"+be.source+"' is not a valid GeoJSON object."));(function j(J,ne){var pe,Ie=J&&J.type;if(Ie==="FeatureCollection")for(pe=0;pe<J.features.length;pe++)j(J.features[pe],ne);else if(Ie==="GeometryCollection")for(pe=0;pe<J.geometries.length;pe++)j(J.geometries[pe],ne);else if(Ie==="Feature")j(J.geometry,ne);else if(Ie==="Polygon")hr(J.coordinates,ne);else if(Ie==="MultiPolygon")for(pe=0;pe<J.coordinates.length;pe++)hr(J.coordinates[pe],ne);return J})(Le,!0);try{if(be.filter){var ye=y.createExpression(be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(function(j){return j.key+": "+j.message}).join(", "));var ke=Le.features.filter(function(j){return ye.value.evaluate({zoom:0},j)});Le={type:"FeatureCollection",features:ke}}re._geoJSONIndex=be.cluster?new ji(function(j){var J=j.superclusterOptions,ne=j.clusterProperties;if(!ne||!J)return J;for(var pe={},Ie={},le={accumulated:null,zoom:0},_e={properties:null},de=Object.keys(ne),$e=0,Ke=de;$e<Ke.length;$e+=1){var Be=Ke[$e],xt=ne[Be],ht=xt[0],bt=y.createExpression(xt[1]),Rt=y.createExpression(typeof ht=="string"?[ht,["accumulated"],["get",Be]]:ht);pe[Be]=bt.value,Ie[Be]=Rt.value}return J.map=function(Zt){_e.properties=Zt;for(var Yt={},ii=0,qt=de;ii<qt.length;ii+=1){var It=qt[ii];Yt[It]=pe[It].evaluate(le,_e)}return Yt},J.reduce=function(Zt,Yt){_e.properties=Yt;for(var ii=0,qt=de;ii<qt.length;ii+=1){var It=qt[ii];le.accumulated=Zt[It],Zt[It]=Ie[It].evaluate(le,_e)}},J}(be)).load(Le.features):function(j,J){return new Pn(j,J)}(Le,be.geojsonVtOptions)}catch(j){return he(j)}re.loaded={};var ee={};if(De){var V=De.finish();V&&(ee.resourceTiming={},ee.resourceTiming[be.source]=JSON.parse(JSON.stringify(V)))}he(null,ee)})}},Q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Q.prototype.reloadTile=function(re,he){var be=this.loaded;return be&&be[re.uid]?W.prototype.reloadTile.call(this,re,he):this.loadTile(re,he)},Q.prototype.loadGeoJSON=function(re,he){if(re.request)y.getJSON(re.request,he);else{if(typeof re.data!="string")return he(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(re.data))}catch{return he(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},Q.prototype.removeSource=function(re,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},Q.prototype.getClusterExpansionZoom=function(re,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(be){he(be)}},Q.prototype.getClusterChildren=function(re,he){try{he(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(be){he(be)}},Q.prototype.getClusterLeaves=function(re,he){try{he(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(be){he(be)}},Q}(zt),ar=function(W){var Q=this;this.self=W,this.actor=new y.Actor(W,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:zt,geojson:Vn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,he){if(Q.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');Q.workerSourceTypes[re]=he},this.self.registerRTLTextPlugin=function(re){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=re.applyArabicShaping,y.plugin.processBidirectionalText=re.processBidirectionalText,y.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return ar.prototype.setReferrer=function(W,Q){this.referrer=Q},ar.prototype.setImages=function(W,Q,re){for(var he in this.availableImages[W]=Q,this.workerSources[W]){var be=this.workerSources[W][he];for(var De in be)be[De].availableImages=Q}re()},ar.prototype.setLayers=function(W,Q,re){this.getLayerIndex(W).replace(Q),re()},ar.prototype.updateLayers=function(W,Q,re){this.getLayerIndex(W).update(Q.layers,Q.removedIds),re()},ar.prototype.loadTile=function(W,Q,re){this.getWorkerSource(W,Q.type,Q.source).loadTile(Q,re)},ar.prototype.loadDEMTile=function(W,Q,re){this.getDEMWorkerSource(W,Q.source).loadTile(Q,re)},ar.prototype.reloadTile=function(W,Q,re){this.getWorkerSource(W,Q.type,Q.source).reloadTile(Q,re)},ar.prototype.abortTile=function(W,Q,re){this.getWorkerSource(W,Q.type,Q.source).abortTile(Q,re)},ar.prototype.removeTile=function(W,Q,re){this.getWorkerSource(W,Q.type,Q.source).removeTile(Q,re)},ar.prototype.removeDEMTile=function(W,Q){this.getDEMWorkerSource(W,Q.source).removeTile(Q)},ar.prototype.removeSource=function(W,Q,re){if(this.workerSources[W]&&this.workerSources[W][Q.type]&&this.workerSources[W][Q.type][Q.source]){var he=this.workerSources[W][Q.type][Q.source];delete this.workerSources[W][Q.type][Q.source],he.removeSource!==void 0?he.removeSource(Q,re):re()}},ar.prototype.loadWorkerSource=function(W,Q,re){try{this.self.importScripts(Q.url),re()}catch(he){re(he.toString())}},ar.prototype.syncRTLPluginState=function(W,Q,re){try{y.plugin.setState(Q);var he=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&he!=null){this.self.importScripts(he);var be=y.plugin.isParsed();re(be?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),be)}}catch(De){re(De.toString())}},ar.prototype.getAvailableImages=function(W){var Q=this.availableImages[W];return Q||(Q=[]),Q},ar.prototype.getLayerIndex=function(W){var Q=this.layerIndexes[W];return Q||(Q=this.layerIndexes[W]=new Te),Q},ar.prototype.getWorkerSource=function(W,Q,re){var he=this;return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Q]||(this.workerSources[W][Q]={}),this.workerSources[W][Q][re]||(this.workerSources[W][Q][re]=new this.workerSourceTypes[Q]({send:function(be,De,Fe){he.actor.send(be,De,Fe,W)}},this.getLayerIndex(W),this.getAvailableImages(W))),this.workerSources[W][Q][re]},ar.prototype.getDEMWorkerSource=function(W,Q){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Q]||(this.demWorkerSources[W][Q]=new Ct),this.demWorkerSources[W][Q]},ar.prototype.enforceCacheSizeLimit=function(W,Q){y.enforceCacheSizeLimit(Q)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ar(self)),ar}),Y(["./shared"],function(y){var v=y.createCommonjsModule(function(l){function c(T){return!u(T)}function u(T){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,B,G=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(G);try{B=new Worker(H),P=!0}catch{P=!1}return B&&B.terminate(),URL.revokeObjectURL(H),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var B=P.getContext("2d");if(!B)return!1;var G=B.getImageData(0,0,1,1);return G&&G.width===P.width}()?(f[z=T&&T.failIfMajorPerformanceCaveat]===void 0&&(f[z]=function(P){var B=function(H){var oe=document.createElement("canvas"),ue=Object.create(c.webGLContextAttributes);return ue.failIfMajorPerformanceCaveat=H,oe.probablySupportsContext?oe.probablySupportsContext("webgl",ue)||oe.probablySupportsContext("experimental-webgl",ue):oe.supportsContext?oe.supportsContext("webgl",ue)||oe.supportsContext("experimental-webgl",ue):oe.getContext("webgl",ue)||oe.getContext("experimental-webgl",ue)}(P);if(!B)return!1;var G=B.createShader(B.VERTEX_SHADER);return!(!G||B.isContextLost())&&(B.shaderSource(G,"void main() {}"),B.compileShader(G),B.getShaderParameter(G,B.COMPILE_STATUS)===!0)}(z)),f[z]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var z}l.exports?l.exports=c:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=c,window.mapboxgl.notSupportedReason=u);var f={};c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),ce={create:function(l,c,u){var f=y.window.document.createElement(l);return c!==void 0&&(f.className=c),u&&u.appendChild(f),f},createNS:function(l,c){return y.window.document.createElementNS(l,c)}},Te=y.window.document&&y.window.document.documentElement.style;function Oe(l){if(!Te)return l[0];for(var c=0;c<l.length;c++)if(l[c]in Te)return l[c];return l[0]}var Xe,xe=Oe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);ce.disableDrag=function(){Te&&xe&&(Xe=Te[xe],Te[xe]="none")},ce.enableDrag=function(){Te&&xe&&(Te[xe]=Xe)};var dt=Oe(["transform","WebkitTransform"]);ce.setTransform=function(l,c){l.style[dt]=c};var zt=!1;try{var ci=Object.defineProperty({},"passive",{get:function(){zt=!0}});y.window.addEventListener("test",ci,ci),y.window.removeEventListener("test",ci,ci)}catch{zt=!1}ce.addEventListener=function(l,c,u,f){f===void 0&&(f={}),l.addEventListener(c,u,"passive"in f&&zt?f:f.capture)},ce.removeEventListener=function(l,c,u,f){f===void 0&&(f={}),l.removeEventListener(c,u,"passive"in f&&zt?f:f.capture)};var Ct=function(l){l.preventDefault(),l.stopPropagation(),y.window.removeEventListener("click",Ct,!0)};function hr(l){var c=l.userImage;return!!(c&&c.render&&c.render())&&(l.data.replace(new Uint8Array(c.data.buffer)),!0)}ce.suppressClick=function(){y.window.addEventListener("click",Ct,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Ct,!0)},0)},ce.mousePos=function(l,c){var u=l.getBoundingClientRect();return new y.Point(c.clientX-u.left-l.clientLeft,c.clientY-u.top-l.clientTop)},ce.touchPos=function(l,c){for(var u=l.getBoundingClientRect(),f=[],T=0;T<c.length;T++)f.push(new y.Point(c[T].clientX-u.left-l.clientLeft,c[T].clientY-u.top-l.clientTop));return f},ce.mouseButton=function(l){return y.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},ce.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var wt=function(l){function c(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.isLoaded=function(){return this.loaded},c.prototype.setLoaded=function(u){if(this.loaded!==u&&(this.loaded=u,u)){for(var f=0,T=this.requestors;f<T.length;f+=1){var z=T[f];this._notify(z.ids,z.callback)}this.requestors=[]}},c.prototype.getImage=function(u){return this.images[u]},c.prototype.addImage=function(u,f){this._validate(u,f)&&(this.images[u]=f)},c.prototype._validate=function(u,f){var T=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchX" value'))),T=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchY" value'))),T=!1),this._validateContent(f.content,f)||(this.fire(new y.ErrorEvent(new Error('Image "'+u+'" has invalid "content" value'))),T=!1),T},c.prototype._validateStretch=function(u,f){if(!u)return!0;for(var T=0,z=0,P=u;z<P.length;z+=1){var B=P[z];if(B[0]<T||B[1]<B[0]||f<B[1])return!1;T=B[1]}return!0},c.prototype._validateContent=function(u,f){return!(u&&(u.length!==4||u[0]<0||f.data.width<u[0]||u[1]<0||f.data.height<u[1]||u[2]<0||f.data.width<u[2]||u[3]<0||f.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))},c.prototype.updateImage=function(u,f){f.version=this.images[u].version+1,this.images[u]=f,this.updatedImages[u]=!0},c.prototype.removeImage=function(u){var f=this.images[u];delete this.images[u],delete this.patterns[u],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()},c.prototype.listImages=function(){return Object.keys(this.images)},c.prototype.getImages=function(u,f){var T=!0;if(!this.isLoaded())for(var z=0,P=u;z<P.length;z+=1)this.images[P[z]]||(T=!1);this.isLoaded()||T?this._notify(u,f):this.requestors.push({ids:u,callback:f})},c.prototype._notify=function(u,f){for(var T={},z=0,P=u;z<P.length;z+=1){var B=P[z];this.images[B]||this.fire(new y.Event("styleimagemissing",{id:B}));var G=this.images[B];G?T[B]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:y.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}f(null,T)},c.prototype.getPixelSize=function(){var u=this.atlasImage;return{width:u.width,height:u.height}},c.prototype.getPattern=function(u){var f=this.patterns[u],T=this.getImage(u);if(!T)return null;if(f&&f.position.version===T.version)return f.position;if(f)f.position.version=T.version;else{var z={w:T.data.width+2,h:T.data.height+2,x:0,y:0},P=new y.ImagePosition(z,T);this.patterns[u]={bin:z,position:P}}return this._updatePatternAtlas(),this.patterns[u].position},c.prototype.bind=function(u){var f=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(u,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)},c.prototype._updatePatternAtlas=function(){var u=[];for(var f in this.patterns)u.push(this.patterns[f].bin);var T=y.potpack(u),z=T.w,P=T.h,B=this.atlasImage;for(var G in B.resize({width:z||1,height:P||1}),this.patterns){var H=this.patterns[G].bin,oe=H.x+1,ue=H.y+1,se=this.images[G].data,Se=se.width,we=se.height;y.RGBAImage.copy(se,B,{x:0,y:0},{x:oe,y:ue},{width:Se,height:we}),y.RGBAImage.copy(se,B,{x:0,y:we-1},{x:oe,y:ue-1},{width:Se,height:1}),y.RGBAImage.copy(se,B,{x:0,y:0},{x:oe,y:ue+we},{width:Se,height:1}),y.RGBAImage.copy(se,B,{x:Se-1,y:0},{x:oe-1,y:ue},{width:1,height:we}),y.RGBAImage.copy(se,B,{x:0,y:0},{x:oe+Se,y:ue},{width:1,height:we})}this.dirty=!0},c.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},c.prototype.dispatchRenderCallbacks=function(u){for(var f=0,T=u;f<T.length;f+=1){var z=T[f];if(!this.callbackDispatchedThisFrame[z]){this.callbackDispatchedThisFrame[z]=!0;var P=this.images[z];hr(P)&&this.updateImage(z,P)}}},c}(y.Evented),Et=Kt,oi=Kt,Jt=1e20;function Kt(l,c,u,f,T,z){this.fontSize=l||24,this.buffer=c===void 0?3:c,this.cutoff=f||.25,this.fontFamily=T||"sans-serif",this.fontWeight=z||"normal",this.radius=u||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function pi(l,c,u,f,T,z,P){for(var B=0;B<c;B++){for(var G=0;G<u;G++)f[G]=l[G*c+B];for(or(f,T,z,P,u),G=0;G<u;G++)l[G*c+B]=T[G]}for(G=0;G<u;G++){for(B=0;B<c;B++)f[B]=l[G*c+B];for(or(f,T,z,P,c),B=0;B<c;B++)l[G*c+B]=Math.sqrt(T[B])}}function or(l,c,u,f,T){u[0]=0,f[0]=-Jt,f[1]=+Jt;for(var z=1,P=0;z<T;z++){for(var B=(l[z]+z*z-(l[u[P]]+u[P]*u[P]))/(2*z-2*u[P]);B<=f[P];)P--,B=(l[z]+z*z-(l[u[P]]+u[P]*u[P]))/(2*z-2*u[P]);u[++P]=z,f[P]=B,f[P+1]=+Jt}for(z=0,P=0;z<T;z++){for(;f[P+1]<z;)P++;c[z]=(z-u[P])*(z-u[P])+l[u[P]]}}Kt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var c=this.ctx.getImageData(0,0,this.size,this.size),u=new Uint8ClampedArray(this.size*this.size),f=0;f<this.size*this.size;f++){var T=c.data[4*f+3]/255;this.gridOuter[f]=T===1?0:T===0?Jt:Math.pow(Math.max(0,.5-T),2),this.gridInner[f]=T===1?Jt:T===0?0:Math.pow(Math.max(0,T-.5),2)}for(pi(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),pi(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),f=0;f<this.size*this.size;f++)u[f]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[f]-this.gridInner[f])/this.radius+this.cutoff))));return u},Et.default=oi;var zi=function(l,c){this.requestManager=l,this.localIdeographFontFamily=c,this.entries={}};zi.prototype.setURL=function(l){this.url=l},zi.prototype.getGlyphs=function(l,c){var u=this,f=[];for(var T in l)for(var z=0,P=l[T];z<P.length;z+=1)f.push({stack:T,id:P[z]});y.asyncAll(f,function(B,G){var H=B.stack,oe=B.id,ue=u.entries[H];ue||(ue=u.entries[H]={glyphs:{},requests:{},ranges:{}});var se=ue.glyphs[oe];if(se===void 0){if(se=u._tinySDF(ue,H,oe))return ue.glyphs[oe]=se,void G(null,{stack:H,id:oe,glyph:se});var Se=Math.floor(oe/256);if(256*Se>65535)G(new Error("glyphs > 65535 not supported"));else if(ue.ranges[Se])G(null,{stack:H,id:oe,glyph:se});else{var we=ue.requests[Se];we||(we=ue.requests[Se]=[],zi.loadGlyphRange(H,Se,u.url,u.requestManager,function(Ae,ge){if(ge){for(var Ee in ge)u._doesCharSupportLocalGlyph(+Ee)||(ue.glyphs[+Ee]=ge[+Ee]);ue.ranges[Se]=!0}for(var Re=0,je=we;Re<je.length;Re+=1)(0,je[Re])(Ae,ge);delete ue.requests[Se]})),we.push(function(Ae,ge){Ae?G(Ae):ge&&G(null,{stack:H,id:oe,glyph:ge[oe]||null})})}}else G(null,{stack:H,id:oe,glyph:se})},function(B,G){if(B)c(B);else if(G){for(var H={},oe=0,ue=G;oe<ue.length;oe+=1){var se=ue[oe],Se=se.stack,we=se.id,Ae=se.glyph;(H[Se]||(H[Se]={}))[we]=Ae&&{id:Ae.id,bitmap:Ae.bitmap.clone(),metrics:Ae.metrics}}c(null,H)}})},zi.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](l)||y.isChar["Hangul Syllables"](l)||y.isChar.Hiragana(l)||y.isChar.Katakana(l))},zi.prototype._tinySDF=function(l,c,u){var f=this.localIdeographFontFamily;if(f&&this._doesCharSupportLocalGlyph(u)){var T=l.tinySDF;if(!T){var z="400";/bold/i.test(c)?z="900":/medium/i.test(c)?z="500":/light/i.test(c)&&(z="200"),T=l.tinySDF=new zi.TinySDF(24,3,8,.25,f,z)}return{id:u,bitmap:new y.AlphaImage({width:30,height:30},T.draw(String.fromCharCode(u))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},zi.loadGlyphRange=function(l,c,u,f,T){var z=256*c,P=z+255,B=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",l).replace("{range}",z+"-"+P),y.ResourceType.Glyphs);y.getArrayBuffer(B,function(G,H){if(G)T(G);else if(H){for(var oe={},ue=0,se=y.parseGlyphPBF(H);ue<se.length;ue+=1){var Se=se[ue];oe[Se.id]=Se}T(null,oe)}})},zi.TinySDF=Et;var sn=function(){this.specification=y.styleSpec.light.position};sn.prototype.possiblyEvaluate=function(l,c){return y.sphericalToCartesian(l.expression.evaluate(c))},sn.prototype.interpolate=function(l,c,u){return{x:y.number(l.x,c.x,u),y:y.number(l.y,c.y,u),z:y.number(l.z,c.z,u)}};var Xr=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new sn,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),fn=function(l){function c(u){l.call(this),this._transitionable=new y.Transitionable(Xr),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getLight=function(){return this._transitionable.serialize()},c.prototype.setLight=function(u,f){if(f===void 0&&(f={}),!this._validate(y.validateLight,u,f))for(var T in u){var z=u[T];y.endsWith(T,"-transition")?this._transitionable.setTransition(T.slice(0,-11),z):this._transitionable.setValue(T,z)}},c.prototype.updateTransitions=function(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)},c.prototype.hasTransition=function(){return this._transitioning.hasTransition()},c.prototype.recalculate=function(u){this.properties=this._transitioning.possiblyEvaluate(u)},c.prototype._validate=function(u,f,T){return(!T||T.validate!==!1)&&y.emitValidationErrors(this,u.call(y.validateStyle,y.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},c}(y.Evented),lr=function(l,c){this.width=l,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};lr.prototype.getDash=function(l,c){var u=l.join(",")+String(c);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(l,c)),this.dashEntry[u]},lr.prototype.getDashRanges=function(l,c,u){var f=[],T=l.length%2==1?-l[l.length-1]*u:0,z=l[0]*u,P=!0;f.push({left:T,right:z,isDash:P,zeroLength:l[0]===0});for(var B=l[0],G=1;G<l.length;G++){var H=l[G];f.push({left:T=B*u,right:z=(B+=H)*u,isDash:P=!P,zeroLength:H===0})}return f},lr.prototype.addRoundDash=function(l,c,u){for(var f=c/2,T=-u;T<=u;T++)for(var z=this.width*(this.nextRow+u+T),P=0,B=l[P],G=0;G<this.width;G++){G/B.right>1&&(B=l[++P]);var H=Math.abs(G-B.left),oe=Math.abs(G-B.right),ue=Math.min(H,oe),se=void 0,Se=T/u*(f+1);if(B.isDash){var we=f-Math.abs(Se);se=Math.sqrt(ue*ue+we*we)}else se=f-Math.sqrt(ue*ue+Se*Se);this.data[z+G]=Math.max(0,Math.min(255,se+128))}},lr.prototype.addRegularDash=function(l){for(var c=l.length-1;c>=0;--c){var u=l[c],f=l[c+1];u.zeroLength?l.splice(c,1):f&&f.isDash===u.isDash&&(f.left=u.left,l.splice(c,1))}var T=l[0],z=l[l.length-1];T.isDash===z.isDash&&(T.left=z.left-this.width,z.right=T.right+this.width);for(var P=this.width*this.nextRow,B=0,G=l[B],H=0;H<this.width;H++){H/G.right>1&&(G=l[++B]);var oe=Math.abs(H-G.left),ue=Math.abs(H-G.right),se=Math.min(oe,ue);this.data[P+H]=Math.max(0,Math.min(255,(G.isDash?se:-se)+128))}},lr.prototype.addDash=function(l,c){var u=c?7:0,f=2*u+1;if(this.nextRow+f>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var T=0,z=0;z<l.length;z++)T+=l[z];if(T!==0){var P=this.width/T,B=this.getDashRanges(l,this.width,P);c?this.addRoundDash(B,P,u):this.addRegularDash(B)}var G={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:T};return this.nextRow+=f,this.dirty=!0,G},lr.prototype.bind=function(l){var c=l.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))};var Li=function l(c,u){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var f=this.workerPool.acquire(this.id),T=0;T<f.length;T++){var z=new l.Actor(f[T],u,this.id);z.name="Worker "+T,this.actors.push(z)}};function Yr(l,c,u){var f=function(T,z){if(T)return u(T);if(z){var P=y.pick(y.extend(z,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(P.vectorLayers=z.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(B){return B.id})),P.tiles=c.canonicalizeTileset(P,l.url),u(null,P)}};return l.url?y.getJSON(c.transformRequest(c.normalizeSourceURL(l.url),y.ResourceType.Source),f):y.browser.frame(function(){return f(null,l)})}Li.prototype.broadcast=function(l,c,u){y.asyncAll(this.actors,function(f,T){f.send(l,c,T)},u=u||function(){})},Li.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Li.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Li.Actor=y.Actor;var Wt=function(l,c,u){this.bounds=y.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=c||0,this.maxzoom=u||24};Wt.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Wt.prototype.contains=function(l){var c=Math.pow(2,l.z),u=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*c),f=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*c),T=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*c),z=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*c);return l.x>=u&&l.x<T&&l.y>=f&&l.y<z};var Qr=function(l){function c(u,f,T,z){if(l.call(this),this.id=u,this.dispatcher=T,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(f,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(z)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yr(this._options,this.map._requestManager,function(f,T){u._tileJSONRequest=null,u._loaded=!0,f?u.fire(new y.ErrorEvent(f)):T&&(y.extend(u,T),T.bounds&&(u.tileBounds=new Wt(T.bounds,u.minzoom,u.maxzoom)),y.postTurnstileEvent(T.tiles,u.map._requestManager._customAccessToken),y.postMapLoadEvent(T.tiles,u.map._getMapId(),u.map._requestManager._skuToken,u.map._requestManager._customAccessToken),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setSourceProperty=function(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},c.prototype.setTiles=function(u){var f=this;return this.setSourceProperty(function(){f._options.tiles=u}),this},c.prototype.setUrl=function(u){var f=this;return this.setSourceProperty(function(){f.url=u,f._options.url=u}),this},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return y.extend({},this._options)},c.prototype.loadTile=function(u,f){var T=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),z={request:this.map._requestManager.transformRequest(T,y.ResourceType.Tile),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(B,G){return delete u.request,u.aborted?f(null):B&&B.status!==404?f(B):(G&&G.resourceTiming&&(u.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&u.setExpiryData(G),u.loadVectorData(G,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}z.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired"?u.state==="loading"?u.reloadCallback=f:u.request=u.actor.send("reloadTile",z,P.bind(this)):(u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",z,P.bind(this)))},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.unloadTile=function(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.hasTransition=function(){return!1},c}(y.Evented),An=function(l){function c(u,f,T,z){l.call(this),this.id=u,this.dispatcher=T,this.setEventedParent(z),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},f),y.extend(this,y.pick(f,["url","scheme","tileSize"]))}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yr(this._options,this.map._requestManager,function(f,T){u._tileJSONRequest=null,u._loaded=!0,f?u.fire(new y.ErrorEvent(f)):T&&(y.extend(u,T),T.bounds&&(u.tileBounds=new Wt(T.bounds,u.minzoom,u.maxzoom)),y.postTurnstileEvent(T.tiles),y.postMapLoadEvent(T.tiles,u.map._getMapId(),u.map._requestManager._skuToken),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return y.extend({},this._options)},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.loadTile=function(u,f){var T=this,z=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);u.request=y.getImage(this.map._requestManager.transformRequest(z,y.ResourceType.Tile),function(P,B){if(delete u.request,u.aborted)u.state="unloaded",f(null);else if(P)u.state="errored",f(P);else if(B){T.map._refreshExpiredTiles&&u.setExpiryData(B),delete B.cacheControl,delete B.expires;var G=T.map.painter.context,H=G.gl;u.texture=T.map.painter.getTileTexture(B.width),u.texture?u.texture.update(B,{useMipmap:!0}):(u.texture=new y.Texture(G,B,H.RGBA,{useMipmap:!0}),u.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),u.state="loaded",y.cacheEntryPossiblyAdded(T.dispatcher),f(null)}})},c.prototype.abortTile=function(u,f){u.request&&(u.request.cancel(),delete u.request),f()},c.prototype.unloadTile=function(u,f){u.texture&&this.map.painter.saveTileTexture(u.texture),f()},c.prototype.hasTransition=function(){return!1},c}(y.Evented),Jn=function(l){function c(u,f,T,z){l.call(this,u,f,T,z),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox"}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},c.prototype.loadTile=function(u,f){var T=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function z(P,B){P&&(u.state="errored",f(P)),B&&(u.dem=B,u.needsHillshadePrepare=!0,u.state="loaded",f(null))}u.request=y.getImage(this.map._requestManager.transformRequest(T,y.ResourceType.Tile),function(P,B){if(delete u.request,u.aborted)u.state="unloaded",f(null);else if(P)u.state="errored",f(P);else if(B){this.map._refreshExpiredTiles&&u.setExpiryData(B),delete B.cacheControl,delete B.expires;var G=y.window.ImageBitmap&&B instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?B:y.browser.getImageData(B,1),H={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:G,encoding:this.encoding};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",H,z.bind(this)))}}.bind(this)),u.neighboringTiles=this._getNeighboringTiles(u.tileID)},c.prototype._getNeighboringTiles=function(u){var f=u.canonical,T=Math.pow(2,f.z),z=(f.x-1+T)%T,P=f.x===0?u.wrap-1:u.wrap,B=(f.x+1+T)%T,G=f.x+1===T?u.wrap+1:u.wrap,H={};return H[new y.OverscaledTileID(u.overscaledZ,P,f.z,z,f.y).key]={backfilled:!1},H[new y.OverscaledTileID(u.overscaledZ,G,f.z,B,f.y).key]={backfilled:!1},f.y>0&&(H[new y.OverscaledTileID(u.overscaledZ,P,f.z,z,f.y-1).key]={backfilled:!1},H[new y.OverscaledTileID(u.overscaledZ,u.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},H[new y.OverscaledTileID(u.overscaledZ,G,f.z,B,f.y-1).key]={backfilled:!1}),f.y+1<T&&(H[new y.OverscaledTileID(u.overscaledZ,P,f.z,z,f.y+1).key]={backfilled:!1},H[new y.OverscaledTileID(u.overscaledZ,u.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},H[new y.OverscaledTileID(u.overscaledZ,G,f.z,B,f.y+1).key]={backfilled:!1}),H},c.prototype.unloadTile=function(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&u.actor.send("removeDEMTile",{uid:u.uid,source:this.id})},c}(An),kt=function(l){function c(u,f,T,z){l.call(this),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=T.getActor(),this.setEventedParent(z),this._data=f.data,this._options=y.extend({},f),this._collectResourceTiming=f.collectResourceTiming,this._resourceTiming=[],f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;var P=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*P,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*P,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?Math.min(f.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:y.EXTENT,radius:(f.clusterRadius||50)*P,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(f){if(f)u.fire(new y.ErrorEvent(f));else{var T={dataType:"source",sourceDataType:"metadata"};u._collectResourceTiming&&u._resourceTiming&&u._resourceTiming.length>0&&(T.resourceTiming=u._resourceTiming,u._resourceTiming=[]),u.fire(new y.Event("data",T))}})},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setData=function(u){var f=this;return this._data=u,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(T){if(T)f.fire(new y.ErrorEvent(T));else{var z={dataType:"source",sourceDataType:"content"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(z.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new y.Event("data",z))}}),this},c.prototype.getClusterExpansionZoom=function(u,f){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},f),this},c.prototype.getClusterChildren=function(u,f){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},f),this},c.prototype.getClusterLeaves=function(u,f,T,z){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:f,offset:T},z),this},c.prototype._updateWorkerData=function(u){var f=this;this._loaded=!1;var T=y.extend({},this.workerOptions),z=this._data;typeof z=="string"?(T.request=this.map._requestManager.transformRequest(y.browser.resolveURL(z),y.ResourceType.Source),T.request.collectResourceTiming=this._collectResourceTiming):T.data=JSON.stringify(z),this.actor.send(this.type+".loadData",T,function(P,B){f._removed||B&&B.abandoned||(f._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[f.id]&&(f._resourceTiming=B.resourceTiming[f.id].slice(0)),f.actor.send(f.type+".coalesce",{source:T.source},null),u(P))})},c.prototype.loaded=function(){return this._loaded},c.prototype.loadTile=function(u,f){var T=this,z=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(z,{type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,B){return delete u.request,u.unloadVectorData(),u.aborted?f(null):P?f(P):(u.loadVectorData(B,T.map.painter,z==="reloadTile"),f(null))})},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0},c.prototype.unloadTile=function(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})},c.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},c.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},c.prototype.hasTransition=function(){return!1},c}(y.Evented),ti=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),si=function(l){function c(u,f,T,z){l.call(this),this.id=u,this.dispatcher=T,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(z),this.options=f}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(u,f){var T=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(z,P){T._loaded=!0,z?T.fire(new y.ErrorEvent(z)):P&&(T.image=P,u&&(T.coordinates=u),f&&f(),T._finishLoading())})},c.prototype.loaded=function(){return this._loaded},c.prototype.updateImage=function(u){var f=this;return this.image&&u.url?(this.options.url=u.url,this.load(u.coordinates,function(){f.texture=null}),this):this},c.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setCoordinates=function(u){var f=this;this.coordinates=u;var T=u.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var B=1/0,G=1/0,H=-1/0,oe=-1/0,ue=0,se=P;ue<se.length;ue+=1){var Se=se[ue];B=Math.min(B,Se.x),G=Math.min(G,Se.y),H=Math.max(H,Se.x),oe=Math.max(oe,Se.y)}var we=Math.max(H-B,oe-G),Ae=Math.max(0,Math.floor(-Math.log(we)/Math.LN2)),ge=Math.pow(2,Ae);return new y.CanonicalTileID(Ae,Math.floor((B+H)/2*ge),Math.floor((G+oe)/2*ge))}(T),this.minzoom=this.maxzoom=this.tileID.z;var z=T.map(function(P){return f.tileID.getTilePoint(P)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(z[0].x,z[0].y,0,0),this._boundsArray.emplaceBack(z[1].x,z[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(z[3].x,z[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(z[2].x,z[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},c.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var u=this.map.painter.context,f=u.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,ti.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(u,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var z=this.tiles[T];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}}},c.prototype.loadTile=function(u,f){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},f(null)):(u.state="errored",f(null))},c.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return!1},c}(y.Evented),Fi=function(l){function c(u,f,T,z){l.call(this,u,f,T,z),this.roundZoom=!0,this.type="video",this.options=f}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1;var f=this.options;this.urls=[];for(var T=0,z=f.urls;T<z.length;T+=1)this.urls.push(this.map._requestManager.transformRequest(z[T],y.ResourceType.Source).url);y.getVideo(this.urls,function(P,B){u._loaded=!0,P?u.fire(new y.ErrorEvent(P)):B&&(u.video=B,u.video.loop=!0,u.video.addEventListener("playing",function(){u.map.triggerRepaint()}),u.map&&u.video.play(),u._finishLoading())})},c.prototype.pause=function(){this.video&&this.video.pause()},c.prototype.play=function(){this.video&&this.video.play()},c.prototype.seek=function(u){if(this.video){var f=this.video.seekable;u<f.start(0)||u>f.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+f.start(0)+" and "+f.end(0)+"-second mark."))):this.video.currentTime=u}},c.prototype.getVideo=function(){return this.video},c.prototype.onAdd=function(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},c.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var u=this.map.painter.context,f=u.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,ti.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(u,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var z=this.tiles[T];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this.video&&!this.video.paused},c}(si),Oi=function(l){function c(u,f,T,z){l.call(this,u,f,T,z),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(B){return typeof B!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},c.prototype.getCanvas=function(){return this.canvas},c.prototype.onAdd=function(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()},c.prototype.onRemove=function(){this.pause()},c.prototype.prepare=function(){var u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var f=this.map.painter.context,T=f.gl;for(var z in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ti.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(f,this.canvas,T.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[z];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this._playing},c.prototype._hasInvalidDimensions=function(){for(var u=0,f=[this.canvas.width,this.canvas.height];u<f.length;u+=1){var T=f[u];if(isNaN(T)||T<=0)return!0}return!1},c}(si),Qi={vector:Qr,raster:An,"raster-dem":Jn,geojson:kt,video:Fi,image:si,canvas:Oi};function Ui(l,c){var u=y.identity([]);return y.translate(u,u,[1,1,0]),y.scale(u,u,[.5*l.width,.5*l.height,1]),y.multiply(u,u,l.calculatePosMatrix(c.toUnwrapped()))}function ji(l,c,u,f,T,z){var P=function(Ae,ge,Ee){if(Ae)for(var Re=0,je=Ae;Re<je.length;Re+=1){var He=ge[je[Re]];if(He&&He.source===Ee&&He.type==="fill-extrusion")return!0}else for(var Ye in ge){var et=ge[Ye];if(et.source===Ee&&et.type==="fill-extrusion")return!0}return!1}(T&&T.layers,c,l.id),B=z.maxPitchScaleFactor(),G=l.tilesIn(f,B,P);G.sort(ir);for(var H=[],oe=0,ue=G;oe<ue.length;oe+=1){var se=ue[oe];H.push({wrappedTileID:se.tileID.wrapped().key,queryResults:se.tile.queryRenderedFeatures(c,u,l._state,se.queryGeometry,se.cameraQueryGeometry,se.scale,T,z,B,Ui(l.transform,se.tileID))})}var Se=function(Ae){for(var ge={},Ee={},Re=0,je=Ae;Re<je.length;Re+=1){var He=je[Re],Ye=He.queryResults,et=He.wrappedTileID,st=Ee[et]=Ee[et]||{};for(var vt in Ye)for(var mt=Ye[vt],Pt=st[vt]=st[vt]||{},$t=ge[vt]=ge[vt]||[],ei=0,Nt=mt;ei<Nt.length;ei+=1){var Bi=Nt[ei];Pt[Bi.featureIndex]||(Pt[Bi.featureIndex]=!0,$t.push(Bi))}}return ge}(H);for(var we in Se)Se[we].forEach(function(Ae){var ge=Ae.feature,Ee=l.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Ee});return Se}function ir(l,c){var u=l.tileID,f=c.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}var gi=function(l,c){this.max=l,this.onRemove=c,this.reset()};gi.prototype.reset=function(){for(var l in this.data)for(var c=0,u=this.data[l];c<u.length;c+=1){var f=u[c];f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value)}return this.data={},this.order=[],this},gi.prototype.add=function(l,c,u){var f=this,T=l.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);var z={value:c,timeout:void 0};if(u!==void 0&&(z.timeout=setTimeout(function(){f.remove(l,z)},u)),this.data[T].push(z),this.order.push(T),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},gi.prototype.has=function(l){return l.wrapped().key in this.data},gi.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},gi.prototype._getAndRemoveByKey=function(l){var c=this.data[l].shift();return c.timeout&&clearTimeout(c.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),c.value},gi.prototype.getByKey=function(l){var c=this.data[l];return c?c[0].value:null},gi.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},gi.prototype.remove=function(l,c){if(!this.has(l))return this;var u=l.wrapped().key,f=c===void 0?0:this.data[u].indexOf(c),T=this.data[u][f];return this.data[u].splice(f,1),T.timeout&&clearTimeout(T.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(T.value),this.order.splice(this.order.indexOf(u),1),this},gi.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this},gi.prototype.filter=function(l){var c=[];for(var u in this.data)for(var f=0,T=this.data[u];f<T.length;f+=1){var z=T[f];l(z.value)||c.push(z)}for(var P=0,B=c;P<B.length;P+=1){var G=B[P];this.remove(G.value.tileID,G)}};var vr=function(l,c,u){this.context=l;var f=l.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};vr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},vr.prototype.updateData=function(l){var c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},vr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ar={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},zr=function(l,c,u,f){this.length=c.length,this.attributes=u,this.itemSize=c.bytesPerElement,this.dynamicDraw=f,this.context=l;var T=l.gl;this.buffer=T.createBuffer(),l.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};zr.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},zr.prototype.updateData=function(l){var c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,l.arrayBuffer)},zr.prototype.enableAttributes=function(l,c){for(var u=0;u<this.attributes.length;u++){var f=c.attributes[this.attributes[u].name];f!==void 0&&l.enableVertexAttribArray(f)}},zr.prototype.setVertexAttribPointers=function(l,c,u){for(var f=0;f<this.attributes.length;f++){var T=this.attributes[f],z=c.attributes[T.name];z!==void 0&&l.vertexAttribPointer(z,T.components,l[Ar[T.type]],!1,this.itemSize,T.offset+this.itemSize*(u||0))}},zr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ht=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ht.prototype.get=function(){return this.current},Ht.prototype.set=function(l){},Ht.prototype.getDefault=function(){return this.default},Ht.prototype.setDefault=function(){this.set(this.default)};var jr=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return y.Color.transparent},c.prototype.set=function(u){var f=this.current;(u.r!==f.r||u.g!==f.g||u.b!==f.b||u.a!==f.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(Ht),Sr=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return 1},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)},c}(Ht),Wr=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return 0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)},c}(Ht),Eo=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return[!0,!0,!0,!0]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||u[3]!==f[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(Ht),to=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)},c}(Ht),po=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return 255},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)},c}(Ht),en=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},c.prototype.set=function(u){var f=this.current;(u.func!==f.func||u.ref!==f.ref||u.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)},c}(Ht),jn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)},c}(Ht),Go=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=u,this.dirty=!1}},c}(Ht),Si=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return[0,1]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)},c}(Ht),wn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=u,this.dirty=!1}},c}(Ht),io=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.LESS},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)},c}(Ht),zn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.BLEND):f.disable(f.BLEND),this.current=u,this.dirty=!1}},c}(Ht),Sa=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.ONE,u.ZERO]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)},c}(Ht),ot=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return y.Color.transparent},c.prototype.set=function(u){var f=this.current;(u.r!==f.r||u.g!==f.g||u.b!==f.b||u.a!==f.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(Ht),Mt=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.FUNC_ADD},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)},c}(Ht),Bo=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=u,this.dirty=!1}},c}(Ht),ro=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.BACK},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)},c}(Ht),pr=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.CCW},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)},c}(Ht),Cn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)},c}(Ht),mn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.TEXTURE0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)},c}(Ht),fo=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||u[3]!==f[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(Ht),xr=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,u),this.current=u,this.dirty=!1}},c}(Ht),St=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(Ht),Mi=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindTexture(f.TEXTURE_2D,u),this.current=u,this.dirty=!1}},c}(Ht),Ii=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}},c}(Ht),tn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){var f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1},c}(Ht),Pn=function(l){function c(u){l.call(this,u),this.vao=u.extVertexArrayObject}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)},c}(Ht),_i=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return 4},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}},c}(Ht),mo=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}},c}(Ht),Vn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}},c}(Ht),ar=function(l){function c(u,f){l.call(this,u),this.context=u,this.parent=f}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c}(Ht),W=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.setDirty=function(){this.dirty=!0},c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}},c}(ar),Q=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(ar),re=function(l,c,u,f){this.context=l,this.width=c,this.height=u;var T=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new W(l,T),f&&(this.depthAttachment=new Q(l,T))};re.prototype.destroy=function(){var l=this.context.gl,c=this.colorAttachment.get();if(c&&l.deleteTexture(c),this.depthAttachment){var u=this.depthAttachment.get();u&&l.deleteRenderbuffer(u)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,c,u){this.func=l,this.mask=c,this.range=u};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var be=function(l,c,u,f,T,z){this.test=l,this.ref=c,this.mask=u,this.fail=f,this.depthFail=T,this.pass=z};be.disabled=new be({func:519,mask:0},0,0,7680,7680,7680);var De=function(l,c,u){this.blendFunction=l,this.blendColor=c,this.mask=u};De.disabled=new De(De.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),De.unblended=new De(De.Replace,y.Color.transparent,[!0,!0,!0,!0]),De.alphaBlended=new De([1,771],y.Color.transparent,[!0,!0,!0,!0]);var Fe=function(l,c,u){this.enable=l,this.mode=c,this.frontFace=u};Fe.disabled=new Fe(!1,1029,2305),Fe.backCCW=new Fe(!0,1029,2305);var Le=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new jr(this),this.clearDepth=new Sr(this),this.clearStencil=new Wr(this),this.colorMask=new Eo(this),this.depthMask=new to(this),this.stencilMask=new po(this),this.stencilFunc=new en(this),this.stencilOp=new jn(this),this.stencilTest=new Go(this),this.depthRange=new Si(this),this.depthTest=new wn(this),this.depthFunc=new io(this),this.blend=new zn(this),this.blendFunc=new Sa(this),this.blendColor=new ot(this),this.blendEquation=new Mt(this),this.cullFace=new Bo(this),this.cullFaceSide=new ro(this),this.frontFace=new pr(this),this.program=new Cn(this),this.activeTexture=new mn(this),this.viewport=new fo(this),this.bindFramebuffer=new xr(this),this.bindRenderbuffer=new St(this),this.bindTexture=new Mi(this),this.bindVertexBuffer=new Ii(this),this.bindElementBuffer=new tn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pn(this),this.pixelStoreUnpack=new _i(this),this.pixelStoreUnpackPremultiplyAlpha=new mo(this),this.pixelStoreUnpackFlipY=new Vn(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};Le.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Le.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Le.prototype.createIndexBuffer=function(l,c){return new vr(this,l,c)},Le.prototype.createVertexBuffer=function(l,c,u){return new zr(this,l,c,u)},Le.prototype.createRenderbuffer=function(l,c,u){var f=this.gl,T=f.createRenderbuffer();return this.bindRenderbuffer.set(T),f.renderbufferStorage(f.RENDERBUFFER,l,c,u),this.bindRenderbuffer.set(null),T},Le.prototype.createFramebuffer=function(l,c,u){return new re(this,l,c,u)},Le.prototype.clear=function(l){var c=l.color,u=l.depth,f=this.gl,T=0;c&&(T|=f.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(T|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f.clear(T)},Le.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},Le.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},Le.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},Le.prototype.setColorMode=function(l){y.deepEqual(l.blendFunction,De.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},Le.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ye=function(l){function c(u,f,T){var z=this;l.call(this),this.id=u,this.dispatcher=T,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(z._sourceLoaded=!0),z._sourceLoaded&&!z._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(z.reload(),z.transform&&z.update(z.transform))}),this.on("error",function(){z._sourceErrored=!0}),this._source=function(P,B,G,H){var oe=new Qi[B.type](P,B,G,H);if(oe.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+oe.id);return y.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(u,f,T,this),this._tiles={},this._cache=new gi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.onAdd=function(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(u)},c.prototype.onRemove=function(u){this._source&&this._source.onRemove&&this._source.onRemove(u)},c.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var u in this._tiles){var f=this._tiles[u];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0},c.prototype.getSource=function(){return this._source},c.prototype.pause=function(){this._paused=!0},c.prototype.resume=function(){if(this._paused){var u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}},c.prototype._loadTile=function(u,f){return this._source.loadTile(u,f)},c.prototype._unloadTile=function(u){if(this._source.unloadTile)return this._source.unloadTile(u,function(){})},c.prototype._abortTile=function(u){if(this._source.abortTile)return this._source.abortTile(u,function(){})},c.prototype.serialize=function(){return this._source.serialize()},c.prototype.prepare=function(u){for(var f in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var T=this._tiles[f];T.upload(u),T.prepare(this.map.style.imageManager)}},c.prototype.getIds=function(){return y.values(this._tiles).map(function(u){return u.tileID}).sort(ke).map(function(u){return u.key})},c.prototype.getRenderableIds=function(u){var f=this,T=[];for(var z in this._tiles)this._isIdRenderable(z,u)&&T.push(this._tiles[z]);return u?T.sort(function(P,B){var G=P.tileID,H=B.tileID,oe=new y.Point(G.canonical.x,G.canonical.y)._rotate(f.transform.angle),ue=new y.Point(H.canonical.x,H.canonical.y)._rotate(f.transform.angle);return G.overscaledZ-H.overscaledZ||ue.y-oe.y||ue.x-oe.x}).map(function(P){return P.tileID.key}):T.map(function(P){return P.tileID}).sort(ke).map(function(P){return P.key})},c.prototype.hasRenderableParent=function(u){var f=this.findLoadedParent(u,0);return!!f&&this._isIdRenderable(f.tileID.key)},c.prototype._isIdRenderable=function(u,f){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(f||!this._tiles[u].holdingForFade())},c.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var u in this._cache.reset(),this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")},c.prototype._reloadTile=function(u,f){var T=this._tiles[u];T&&(T.state!=="loading"&&(T.state=f),this._loadTile(T,this._tileLoaded.bind(this,T,u,f)))},c.prototype._tileLoaded=function(u,f,T,z){if(z)return u.state="errored",void(z.status!==404?this._source.fire(new y.ErrorEvent(z,{tile:u})):this.update(this.transform));u.timeAdded=y.browser.now(),T==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(f,u),this.getSource().type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:u,coord:u.tileID}))},c.prototype._backfillDEM=function(u){for(var f=this.getRenderableIds(),T=0;T<f.length;T++){var z=f[T];if(u.neighboringTiles&&u.neighboringTiles[z]){var P=this.getTileByID(z);B(u,P),B(P,u)}}function B(G,H){G.needsHillshadePrepare=!0;var oe=H.tileID.canonical.x-G.tileID.canonical.x,ue=H.tileID.canonical.y-G.tileID.canonical.y,se=Math.pow(2,G.tileID.canonical.z),Se=H.tileID.key;oe===0&&ue===0||Math.abs(ue)>1||(Math.abs(oe)>1&&(Math.abs(oe+se)===1?oe+=se:Math.abs(oe-se)===1&&(oe-=se)),H.dem&&G.dem&&(G.dem.backfillBorder(H.dem,oe,ue),G.neighboringTiles&&G.neighboringTiles[Se]&&(G.neighboringTiles[Se].backfilled=!0)))}},c.prototype.getTile=function(u){return this.getTileByID(u.key)},c.prototype.getTileByID=function(u){return this._tiles[u]},c.prototype._retainLoadedChildren=function(u,f,T,z){for(var P in this._tiles){var B=this._tiles[P];if(!(z[P]||!B.hasData()||B.tileID.overscaledZ<=f||B.tileID.overscaledZ>T)){for(var G=B.tileID;B&&B.tileID.overscaledZ>f+1;){var H=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[H.key])&&B.hasData()&&(G=H)}for(var oe=G;oe.overscaledZ>f;)if(u[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){z[G.key]=G;break}}}},c.prototype.findLoadedParent=function(u,f){if(u.key in this._loadedParentTiles){var T=this._loadedParentTiles[u.key];return T&&T.tileID.overscaledZ>=f?T:null}for(var z=u.overscaledZ-1;z>=f;z--){var P=u.scaledTo(z),B=this._getLoadedTile(P);if(B)return B}},c.prototype._getLoadedTile=function(u){var f=this._tiles[u.key];return f&&f.hasData()?f:this._cache.getByKey(u.wrapped().key)},c.prototype.updateCacheSize=function(u){var f=Math.ceil(u.width/this._source.tileSize)+1,T=Math.ceil(u.height/this._source.tileSize)+1,z=Math.floor(f*T*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,z):z;this._cache.setMaxSize(P)},c.prototype.handleWrapJump=function(u){var f=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,f){var T={};for(var z in this._tiles){var P=this._tiles[z];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),T[P.tileID.key]=P}for(var B in this._tiles=T,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},c.prototype.update=function(u){var f=this;if(this.transform=u,this._sourceLoaded&&!this._paused){var T;this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?T=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(st){return new y.OverscaledTileID(st.canonical.z,st.wrap,st.canonical.z,st.canonical.x,st.canonical.y)}):(T=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(T=T.filter(function(st){return f._source.hasTile(st)}))):T=[];var z=u.coveringZoomLevel(this._source),P=Math.max(z-c.maxOverzooming,this._source.minzoom),B=Math.max(z+c.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(T,z);if(ee(this._source.type)){for(var H={},oe={},ue=0,se=Object.keys(G);ue<se.length;ue+=1){var Se=se[ue],we=G[Se],Ae=this._tiles[Se];if(Ae&&!(Ae.fadeEndTime&&Ae.fadeEndTime<=y.browser.now())){var ge=this.findLoadedParent(we,P);ge&&(this._addTile(ge.tileID),H[ge.tileID.key]=ge.tileID),oe[Se]=we}}for(var Ee in this._retainLoadedChildren(oe,z,B,G),H)G[Ee]||(this._coveredTiles[Ee]=!0,G[Ee]=H[Ee])}for(var Re in G)this._tiles[Re].clearFadeHold();for(var je=0,He=y.keysDifference(this._tiles,G);je<He.length;je+=1){var Ye=He[je],et=this._tiles[Ye];et.hasSymbolBuckets&&!et.holdingForFade()?et.setHoldDuration(this.map._fadeDuration):et.hasSymbolBuckets&&!et.symbolFadeFinished()||this._removeTile(Ye)}this._updateLoadedParentTileCache()}},c.prototype.releaseSymbolFadeTiles=function(){for(var u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)},c.prototype._updateRetainedTiles=function(u,f){for(var T={},z={},P=Math.max(f-c.maxOverzooming,this._source.minzoom),B=Math.max(f+c.maxUnderzooming,this._source.minzoom),G={},H=0,oe=u;H<oe.length;H+=1){var ue=oe[H],se=this._addTile(ue);T[ue.key]=ue,se.hasData()||f<this._source.maxzoom&&(G[ue.key]=ue)}this._retainLoadedChildren(G,f,B,T);for(var Se=0,we=u;Se<we.length;Se+=1){var Ae=we[Se],ge=this._tiles[Ae.key];if(!ge.hasData()){if(f+1>this._source.maxzoom){var Ee=Ae.children(this._source.maxzoom)[0],Re=this.getTile(Ee);if(Re&&Re.hasData()){T[Ee.key]=Ee;continue}}else{var je=Ae.children(this._source.maxzoom);if(T[je[0].key]&&T[je[1].key]&&T[je[2].key]&&T[je[3].key])continue}for(var He=ge.wasRequested(),Ye=Ae.overscaledZ-1;Ye>=P;--Ye){var et=Ae.scaledTo(Ye);if(z[et.key]||(z[et.key]=!0,!(ge=this.getTile(et))&&He&&(ge=this._addTile(et)),ge&&(T[et.key]=et,He=ge.wasRequested(),ge.hasData())))break}}}return T},c.prototype._updateLoadedParentTileCache=function(){for(var u in this._loadedParentTiles={},this._tiles){for(var f=[],T=void 0,z=this._tiles[u].tileID;z.overscaledZ>0;){if(z.key in this._loadedParentTiles){T=this._loadedParentTiles[z.key];break}f.push(z.key);var P=z.scaledTo(z.overscaledZ-1);if(T=this._getLoadedTile(P))break;z=P}for(var B=0,G=f;B<G.length;B+=1)this._loadedParentTiles[G[B]]=T}},c.prototype._addTile=function(u){var f=this._tiles[u.key];if(f)return f;(f=this._cache.getAndRemove(u))&&(this._setTileReloadTimer(u.key,f),f.tileID=u,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,f)));var T=Boolean(f);return T||(f=new y.Tile(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(f,this._tileLoaded.bind(this,f,u.key,f.state))),f?(f.uses++,this._tiles[u.key]=f,T||this._source.fire(new y.Event("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f):null},c.prototype._setTileReloadTimer=function(u,f){var T=this;u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);var z=f.getExpiryTimeout();z&&(this._timers[u]=setTimeout(function(){T._reloadTile(u,"expired"),delete T._timers[u]},z))},c.prototype._removeTile=function(u){var f=this._tiles[u];f&&(f.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))},c.prototype.clearTiles=function(){for(var u in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(u);this._cache.reset()},c.prototype.tilesIn=function(u,f,T){var z=this,P=[],B=this.transform;if(!B)return P;for(var G=T?B.getCameraQueryGeometry(u):u,H=u.map(function(Ye){return B.pointCoordinate(Ye)}),oe=G.map(function(Ye){return B.pointCoordinate(Ye)}),ue=this.getIds(),se=1/0,Se=1/0,we=-1/0,Ae=-1/0,ge=0,Ee=oe;ge<Ee.length;ge+=1){var Re=Ee[ge];se=Math.min(se,Re.x),Se=Math.min(Se,Re.y),we=Math.max(we,Re.x),Ae=Math.max(Ae,Re.y)}for(var je=function(Ye){var et=z._tiles[ue[Ye]];if(!et.holdingForFade()){var st=et.tileID,vt=Math.pow(2,B.zoom-et.tileID.overscaledZ),mt=f*et.queryPadding*y.EXTENT/et.tileSize/vt,Pt=[st.getTilePoint(new y.MercatorCoordinate(se,Se)),st.getTilePoint(new y.MercatorCoordinate(we,Ae))];if(Pt[0].x-mt<y.EXTENT&&Pt[0].y-mt<y.EXTENT&&Pt[1].x+mt>=0&&Pt[1].y+mt>=0){var $t=H.map(function(Nt){return st.getTilePoint(Nt)}),ei=oe.map(function(Nt){return st.getTilePoint(Nt)});P.push({tile:et,tileID:st,queryGeometry:$t,cameraQueryGeometry:ei,scale:vt})}}},He=0;He<ue.length;He++)je(He);return P},c.prototype.getVisibleCoordinates=function(u){for(var f=this,T=this.getRenderableIds(u).map(function(G){return f._tiles[G].tileID}),z=0,P=T;z<P.length;z+=1){var B=P[z];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return T},c.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ee(this._source.type))for(var u in this._tiles){var f=this._tiles[u];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=y.browser.now())return!0}return!1},c.prototype.setFeatureState=function(u,f,T){this._state.updateState(u=u||"_geojsonTileLayer",f,T)},c.prototype.removeFeatureState=function(u,f,T){this._state.removeFeatureState(u=u||"_geojsonTileLayer",f,T)},c.prototype.getFeatureState=function(u,f){return this._state.getState(u=u||"_geojsonTileLayer",f)},c.prototype.setDependencies=function(u,f,T){var z=this._tiles[u];z&&z.setDependencies(f,T)},c.prototype.reloadTilesForDependencies=function(u,f){for(var T in this._tiles)this._tiles[T].hasDependency(u,f)&&this._reloadTile(T,"reloading");this._cache.filter(function(z){return!z.hasDependency(u,f)})},c}(y.Evented);function ke(l,c){var u=Math.abs(2*l.wrap)-+(l.wrap<0),f=Math.abs(2*c.wrap)-+(c.wrap<0);return l.overscaledZ-c.overscaledZ||f-u||c.canonical.y-l.canonical.y||c.canonical.x-l.canonical.x}function ee(l){return l==="raster"||l==="image"||l==="video"}function V(){return new y.window.Worker(yi.workerUrl)}ye.maxOverzooming=10,ye.maxUnderzooming=3;var j="mapboxgl_preloaded_worker_pool",J=function(){this.active={}};J.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<J.workerCount;)this.workers.push(new V);return this.active[l]=!0,this.workers.slice()},J.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(c){c.terminate()}),this.workers=null)},J.prototype.isPreloaded=function(){return!!this.active[j]},J.prototype.numActive=function(){return Object.keys(this.active).length};var ne,pe=Math.floor(y.browser.hardwareConcurrency/2);function Ie(){return ne||(ne=new J),ne}function le(l,c){var u={};for(var f in l)f!=="ref"&&(u[f]=l[f]);return y.refProperties.forEach(function(T){T in c&&(u[T]=c[T])}),u}function _e(l){l=l.slice();for(var c=Object.create(null),u=0;u<l.length;u++)c[l[u].id]=l[u];for(var f=0;f<l.length;f++)"ref"in l[f]&&(l[f]=le(l[f],c[l[f].ref]));return l}J.workerCount=Math.max(Math.min(pe,6),1);var de={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $e(l,c,u){u.push({command:de.addSource,args:[l,c[l]]})}function Ke(l,c,u){c.push({command:de.removeSource,args:[l]}),u[l]=!0}function Be(l,c,u,f){Ke(l,u,f),$e(l,c,u)}function xt(l,c,u){var f;for(f in l[u])if(l[u].hasOwnProperty(f)&&f!=="data"&&!y.deepEqual(l[u][f],c[u][f]))return!1;for(f in c[u])if(c[u].hasOwnProperty(f)&&f!=="data"&&!y.deepEqual(l[u][f],c[u][f]))return!1;return!0}function ht(l,c,u,f,T,z){var P;for(P in c=c||{},l=l||{})l.hasOwnProperty(P)&&(y.deepEqual(l[P],c[P])||u.push({command:z,args:[f,P,c[P],T]}));for(P in c)c.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(y.deepEqual(l[P],c[P])||u.push({command:z,args:[f,P,c[P],T]}))}function bt(l){return l.id}function Rt(l,c){return l[c.id]=c,l}var Zt=function(l,c){this.reset(l,c)};Zt.prototype.reset=function(l,c){this.points=l||[],this._distances=[0];for(var u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Zt.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=y.clamp(l,0,1);for(var c=1,u=this._distances[c],f=l*this.paddedLength+this.padding;u<f&&c<this._distances.length;)u=this._distances[++c];var T=c-1,z=this._distances[T],P=u-z,B=P>0?(f-z)/P:0;return this.points[T].mult(1-B).add(this.points[c].mult(B))};var Yt=function(l,c,u){var f=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(l/u),this.yCellCount=Math.ceil(c/u);for(var z=0;z<this.xCellCount*this.yCellCount;z++)f.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=c,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0};function ii(l,c,u,f,T){var z=y.create();return c?(y.scale(z,z,[1/T,1/T,1]),u||y.rotateZ(z,z,f.angle)):y.multiply(z,f.labelPlaneMatrix,l),z}function qt(l,c,u,f,T){if(c){var z=y.clone(l);return y.scale(z,z,[T,T,1]),u||y.rotateZ(z,z,-f.angle),z}return f.glCoordMatrix}function It(l,c){var u=[l.x,l.y,0,1];no(u,u,c);var f=u[3];return{point:new y.Point(u[0]/f,u[1]/f),signedDistanceFromCamera:f}}function Rr(l,c){return .5+l/c*.5}function ri(l,c){var u=l[0]/l[3],f=l[1]/l[3];return u>=-c[0]&&u<=c[0]&&f>=-c[1]&&f<=c[1]}function Vr(l,c,u,f,T,z,P,B){var G=f?l.textSizeData:l.iconSizeData,H=y.evaluateSizeForZoom(G,u.transform.zoom),oe=[256/u.width*2+1,256/u.height*2+1],ue=f?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ue.clear();for(var se=l.lineVertexArray,Se=f?l.text.placedSymbolArray:l.icon.placedSymbolArray,we=u.transform.width/u.transform.height,Ae=!1,ge=0;ge<Se.length;ge++){var Ee=Se.get(ge);if(Ee.hidden||Ee.writingMode===y.WritingMode.vertical&&!Ae)$o(Ee.numGlyphs,ue);else{Ae=!1;var Re=[Ee.anchorX,Ee.anchorY,0,1];if(y.transformMat4(Re,Re,c),ri(Re,oe)){var je=Rr(u.transform.cameraToCenterDistance,Re[3]),He=y.evaluateSizeForFeature(G,H,Ee),Ye=P?He/je:He*je,et=new y.Point(Ee.anchorX,Ee.anchorY),st=It(et,T).point,vt={},mt=Mn(Ee,Ye,!1,B,c,T,z,l.glyphOffsetArray,se,ue,st,et,vt,we);Ae=mt.useVertical,(mt.notEnoughRoom||Ae||mt.needsFlipping&&Mn(Ee,Ye,!0,B,c,T,z,l.glyphOffsetArray,se,ue,st,et,vt,we).notEnoughRoom)&&$o(Ee.numGlyphs,ue)}else $o(Ee.numGlyphs,ue)}}f?l.text.dynamicLayoutVertexBuffer.updateData(ue):l.icon.dynamicLayoutVertexBuffer.updateData(ue)}function ln(l,c,u,f,T,z,P,B,G,H,oe){var ue=B.glyphStartIndex+B.numGlyphs,se=B.lineStartIndex,Se=B.lineStartIndex+B.lineLength,we=c.getoffsetX(B.glyphStartIndex),Ae=c.getoffsetX(ue-1),ge=ja(l*we,u,f,T,z,P,B.segment,se,Se,G,H,oe);if(!ge)return null;var Ee=ja(l*Ae,u,f,T,z,P,B.segment,se,Se,G,H,oe);return Ee?{first:ge,last:Ee}:null}function rn(l,c,u,f){return l===y.WritingMode.horizontal&&Math.abs(u.y-c.y)>Math.abs(u.x-c.x)*f?{useVertical:!0}:(l===y.WritingMode.vertical?c.y<u.y:c.x>u.x)?{needsFlipping:!0}:null}function Mn(l,c,u,f,T,z,P,B,G,H,oe,ue,se,Se){var we,Ae=c/24,ge=l.lineOffsetX*Ae,Ee=l.lineOffsetY*Ae;if(l.numGlyphs>1){var Re=l.glyphStartIndex+l.numGlyphs,je=l.lineStartIndex,He=l.lineStartIndex+l.lineLength,Ye=ln(Ae,B,ge,Ee,u,oe,ue,l,G,z,se);if(!Ye)return{notEnoughRoom:!0};var et=It(Ye.first.point,P).point,st=It(Ye.last.point,P).point;if(f&&!u){var vt=rn(l.writingMode,et,st,Se);if(vt)return vt}we=[Ye.first];for(var mt=l.glyphStartIndex+1;mt<Re-1;mt++)we.push(ja(Ae*B.getoffsetX(mt),ge,Ee,u,oe,ue,l.segment,je,He,G,z,se));we.push(Ye.last)}else{if(f&&!u){var Pt=It(ue,T).point,$t=l.lineStartIndex+l.segment+1,ei=new y.Point(G.getx($t),G.gety($t)),Nt=It(ei,T),Bi=Nt.signedDistanceFromCamera>0?Nt.point:br(ue,ei,Pt,1,T),jt=rn(l.writingMode,Pt,Bi,Se);if(jt)return jt}var bi=ja(Ae*B.getoffsetX(l.glyphStartIndex),ge,Ee,u,oe,ue,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,G,z,se);if(!bi)return{notEnoughRoom:!0};we=[bi]}for(var Di=0,vi=we;Di<vi.length;Di+=1){var di=vi[Di];y.addDynamicAttributes(H,di.point,di.angle)}return{}}function br(l,c,u,f,T){var z=It(l.add(l.sub(c)._unit()),T).point,P=u.sub(z);return u.add(P._mult(f/P.mag()))}function ja(l,c,u,f,T,z,P,B,G,H,oe,ue){var se=f?l-c:l+c,Se=se>0?1:-1,we=0;f&&(Se*=-1,we=Math.PI),Se<0&&(we+=Math.PI);for(var Ae=Se>0?B+P:B+P+1,ge=T,Ee=T,Re=0,je=0,He=Math.abs(se),Ye=[];Re+je<=He;){if((Ae+=Se)<B||Ae>=G)return null;if(Ee=ge,Ye.push(ge),(ge=ue[Ae])===void 0){var et=new y.Point(H.getx(Ae),H.gety(Ae)),st=It(et,oe);if(st.signedDistanceFromCamera>0)ge=ue[Ae]=st.point;else{var vt=Ae-Se;ge=br(Re===0?z:new y.Point(H.getx(vt),H.gety(vt)),et,Ee,He-Re+1,oe)}}Re+=je,je=Ee.dist(ge)}var mt=(He-Re)/je,Pt=ge.sub(Ee),$t=Pt.mult(mt)._add(Ee);$t._add(Pt._unit()._perp()._mult(u*Se));var ei=we+Math.atan2(ge.y-Ee.y,ge.x-Ee.x);return Ye.push($t),{point:$t,angle:ei,path:Ye}}Yt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Yt.prototype.insert=function(l,c,u,f,T){this._forEachCell(c,u,f,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(T)},Yt.prototype.insertCircle=function(l,c,u,f){this._forEachCell(c-f,u-f,c+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(c),this.circles.push(u),this.circles.push(f)},Yt.prototype._insertBoxCell=function(l,c,u,f,T,z){this.boxCells[T].push(z)},Yt.prototype._insertCircleCell=function(l,c,u,f,T,z){this.circleCells[T].push(z)},Yt.prototype._query=function(l,c,u,f,T,z){if(u<0||l>this.width||f<0||c>this.height)return!T&&[];var P=[];if(l<=0&&c<=0&&this.width<=u&&this.height<=f){if(T)return!0;for(var B=0;B<this.boxKeys.length;B++)P.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var G=0;G<this.circleKeys.length;G++){var H=this.circles[3*G],oe=this.circles[3*G+1],ue=this.circles[3*G+2];P.push({key:this.circleKeys[G],x1:H-ue,y1:oe-ue,x2:H+ue,y2:oe+ue})}return z?P.filter(z):P}return this._forEachCell(l,c,u,f,this._queryCell,P,{hitTest:T,seenUids:{box:{},circle:{}}},z),T?P.length>0:P},Yt.prototype._queryCircle=function(l,c,u,f,T){var z=l-u,P=l+u,B=c-u,G=c+u;if(P<0||z>this.width||G<0||B>this.height)return!f&&[];var H=[];return this._forEachCell(z,B,P,G,this._queryCellCircle,H,{hitTest:f,circle:{x:l,y:c,radius:u},seenUids:{box:{},circle:{}}},T),f?H.length>0:H},Yt.prototype.query=function(l,c,u,f,T){return this._query(l,c,u,f,!1,T)},Yt.prototype.hitTest=function(l,c,u,f,T){return this._query(l,c,u,f,!0,T)},Yt.prototype.hitTestCircle=function(l,c,u,f){return this._queryCircle(l,c,u,!0,f)},Yt.prototype._queryCell=function(l,c,u,f,T,z,P,B){var G=P.seenUids,H=this.boxCells[T];if(H!==null)for(var oe=this.bboxes,ue=0,se=H;ue<se.length;ue+=1){var Se=se[ue];if(!G.box[Se]){G.box[Se]=!0;var we=4*Se;if(l<=oe[we+2]&&c<=oe[we+3]&&u>=oe[we+0]&&f>=oe[we+1]&&(!B||B(this.boxKeys[Se]))){if(P.hitTest)return z.push(!0),!0;z.push({key:this.boxKeys[Se],x1:oe[we],y1:oe[we+1],x2:oe[we+2],y2:oe[we+3]})}}}var Ae=this.circleCells[T];if(Ae!==null)for(var ge=this.circles,Ee=0,Re=Ae;Ee<Re.length;Ee+=1){var je=Re[Ee];if(!G.circle[je]){G.circle[je]=!0;var He=3*je;if(this._circleAndRectCollide(ge[He],ge[He+1],ge[He+2],l,c,u,f)&&(!B||B(this.circleKeys[je]))){if(P.hitTest)return z.push(!0),!0;var Ye=ge[He],et=ge[He+1],st=ge[He+2];z.push({key:this.circleKeys[je],x1:Ye-st,y1:et-st,x2:Ye+st,y2:et+st})}}}},Yt.prototype._queryCellCircle=function(l,c,u,f,T,z,P,B){var G=P.circle,H=P.seenUids,oe=this.boxCells[T];if(oe!==null)for(var ue=this.bboxes,se=0,Se=oe;se<Se.length;se+=1){var we=Se[se];if(!H.box[we]){H.box[we]=!0;var Ae=4*we;if(this._circleAndRectCollide(G.x,G.y,G.radius,ue[Ae+0],ue[Ae+1],ue[Ae+2],ue[Ae+3])&&(!B||B(this.boxKeys[we])))return z.push(!0),!0}}var ge=this.circleCells[T];if(ge!==null)for(var Ee=this.circles,Re=0,je=ge;Re<je.length;Re+=1){var He=je[Re];if(!H.circle[He]){H.circle[He]=!0;var Ye=3*He;if(this._circlesCollide(Ee[Ye],Ee[Ye+1],Ee[Ye+2],G.x,G.y,G.radius)&&(!B||B(this.circleKeys[He])))return z.push(!0),!0}}},Yt.prototype._forEachCell=function(l,c,u,f,T,z,P,B){for(var G=this._convertToXCellCoord(l),H=this._convertToYCellCoord(c),oe=this._convertToXCellCoord(u),ue=this._convertToYCellCoord(f),se=G;se<=oe;se++)for(var Se=H;Se<=ue;Se++)if(T.call(this,l,c,u,f,this.xCellCount*Se+se,z,P,B))return},Yt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Yt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Yt.prototype._circlesCollide=function(l,c,u,f,T,z){var P=f-l,B=T-c,G=u+z;return G*G>P*P+B*B},Yt.prototype._circleAndRectCollide=function(l,c,u,f,T,z,P){var B=(z-f)/2,G=Math.abs(l-(f+B));if(G>B+u)return!1;var H=(P-T)/2,oe=Math.abs(c-(T+H));if(oe>H+u)return!1;if(G<=B||oe<=H)return!0;var ue=G-B,se=oe-H;return ue*ue+se*se<=u*u};var Hr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $o(l,c){for(var u=0;u<l;u++){var f=c.length;c.resize(f+4),c.float32.set(Hr,3*f)}}function no(l,c,u){var f=c[0],T=c[1];return l[0]=u[0]*f+u[4]*T+u[12],l[1]=u[1]*f+u[5]*T+u[13],l[3]=u[3]*f+u[7]*T+u[15],l}var Ir=function(l,c,u){c===void 0&&(c=new Yt(l.width+200,l.height+200,25)),u===void 0&&(u=new Yt(l.width+200,l.height+200,25)),this.transform=l,this.grid=c,this.ignoredGrid=u,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Dn(l,c,u){return c*(y.EXTENT/(l.tileSize*Math.pow(2,u-l.tileID.overscaledZ)))}Ir.prototype.placeCollisionBox=function(l,c,u,f,T){var z=this.projectAndGetPerspectiveRatio(f,l.anchorPointX,l.anchorPointY),P=u*z.perspectiveRatio,B=l.x1*P+z.point.x,G=l.y1*P+z.point.y,H=l.x2*P+z.point.x,oe=l.y2*P+z.point.y;return!this.isInsideGrid(B,G,H,oe)||!c&&this.grid.hitTest(B,G,H,oe,T)?{box:[],offscreen:!1}:{box:[B,G,H,oe],offscreen:this.isOffscreen(B,G,H,oe)}},Ir.prototype.placeCollisionCircles=function(l,c,u,f,T,z,P,B,G,H,oe,ue,se){var Se=[],we=new y.Point(c.anchorX,c.anchorY),Ae=It(we,z),ge=Rr(this.transform.cameraToCenterDistance,Ae.signedDistanceFromCamera),Ee=(H?T/ge:T*ge)/y.ONE_EM,Re=It(we,P).point,je=ln(Ee,f,c.lineOffsetX*Ee,c.lineOffsetY*Ee,!1,Re,we,c,u,P,{}),He=!1,Ye=!1,et=!0;if(je){for(var st=.5*ue*ge+se,vt=new y.Point(-100,-100),mt=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Pt=new Zt,$t=je.first,ei=je.last,Nt=[],Bi=$t.path.length-1;Bi>=1;Bi--)Nt.push($t.path[Bi]);for(var jt=1;jt<ei.path.length;jt++)Nt.push(ei.path[jt]);var bi=2.5*st;if(B){var Di=Nt.map(function(vo){return It(vo,B)});Nt=Di.some(function(vo){return vo.signedDistanceFromCamera<=0})?[]:Di.map(function(vo){return vo.point})}var vi=[];if(Nt.length>0){for(var di=Nt[0].clone(),hi=Nt[0].clone(),ni=1;ni<Nt.length;ni++)di.x=Math.min(di.x,Nt[ni].x),di.y=Math.min(di.y,Nt[ni].y),hi.x=Math.max(hi.x,Nt[ni].x),hi.y=Math.max(hi.y,Nt[ni].y);vi=di.x>=vt.x&&hi.x<=mt.x&&di.y>=vt.y&&hi.y<=mt.y?[Nt]:hi.x<vt.x||di.x>mt.x||hi.y<vt.y||di.y>mt.y?[]:y.clipLine([Nt],vt.x,vt.y,mt.x,mt.y)}for(var Xt=0,Hi=vi;Xt<Hi.length;Xt+=1){var Jr;Pt.reset(Hi[Xt],.25*st),Jr=Pt.length<=.5*st?1:Math.ceil(Pt.paddedLength/bi)+1;for(var un=0;un<Jr;un++){var In=un/Math.max(Jr-1,1),vn=Pt.lerp(In),Vi=vn.x+100,On=vn.y+100;Se.push(Vi,On,st,0);var ga=Vi-st,cn=On-st,hn=Vi+st,Oo=On+st;if(et=et&&this.isOffscreen(ga,cn,hn,Oo),Ye=Ye||this.isInsideGrid(ga,cn,hn,Oo),!l&&this.grid.hitTestCircle(Vi,On,st,oe)&&(He=!0,!G))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!G&&He||!Ye?[]:Se,offscreen:et,collisionDetected:He}},Ir.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var c=[],u=1/0,f=1/0,T=-1/0,z=-1/0,P=0,B=l;P<B.length;P+=1){var G=B[P],H=new y.Point(G.x+100,G.y+100);u=Math.min(u,H.x),f=Math.min(f,H.y),T=Math.max(T,H.x),z=Math.max(z,H.y),c.push(H)}for(var oe={},ue={},se=0,Se=this.grid.query(u,f,T,z).concat(this.ignoredGrid.query(u,f,T,z));se<Se.length;se+=1){var we=Se[se],Ae=we.key;if(oe[Ae.bucketInstanceId]===void 0&&(oe[Ae.bucketInstanceId]={}),!oe[Ae.bucketInstanceId][Ae.featureIndex]){var ge=[new y.Point(we.x1,we.y1),new y.Point(we.x2,we.y1),new y.Point(we.x2,we.y2),new y.Point(we.x1,we.y2)];y.polygonIntersectsPolygon(c,ge)&&(oe[Ae.bucketInstanceId][Ae.featureIndex]=!0,ue[Ae.bucketInstanceId]===void 0&&(ue[Ae.bucketInstanceId]=[]),ue[Ae.bucketInstanceId].push(Ae.featureIndex))}}return ue},Ir.prototype.insertCollisionBox=function(l,c,u,f,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:T},l[0],l[1],l[2],l[3])},Ir.prototype.insertCollisionCircles=function(l,c,u,f,T){for(var z=c?this.ignoredGrid:this.grid,P={bucketInstanceId:u,featureIndex:f,collisionGroupID:T},B=0;B<l.length;B+=4)z.insertCircle(P,l[B],l[B+1],l[B+2])},Ir.prototype.projectAndGetPerspectiveRatio=function(l,c,u){var f=[c,u,0,1];return no(f,f,l),{point:new y.Point((f[0]/f[3]+1)/2*this.transform.width+100,(-f[1]/f[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}},Ir.prototype.isOffscreen=function(l,c,u,f){return u<100||l>=this.screenRightBoundary||f<100||c>this.screenBottomBoundary},Ir.prototype.isInsideGrid=function(l,c,u,f){return u>=0&&l<this.gridRightBoundary&&f>=0&&c<this.gridBottomBoundary},Ir.prototype.getViewportMatrix=function(){var l=y.identity([]);return y.translate(l,l,[-100,-100,0]),l};var yn=function(l,c,u,f){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?c:-c))):f&&u?1:0,this.placed=u};yn.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Nn=function(l,c,u,f,T){this.text=new yn(l?l.text:null,c,u,T),this.icon=new yn(l?l.icon:null,c,f,T)};Nn.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Xo=function(l,c,u){this.text=l,this.icon=c,this.skipFade=u},xu=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Tn=function(l,c,u,f,T){this.bucketInstanceId=l,this.featureIndex=c,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=T},Rs=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function oo(l,c,u,f,T){var z=y.getAnchorAlignment(l),P=-(z.horizontalAlign-.5)*c,B=-(z.verticalAlign-.5)*u,G=y.evaluateVariableOffset(l,f);return new y.Point(P+G[0]*T,B+G[1]*T)}function Zr(l,c,u,f,T,z){var P=l.x1,B=l.x2,G=l.y1,H=l.y2,oe=l.anchorPointX,ue=l.anchorPointY,se=new y.Point(c,u);return f&&se._rotate(T?z:-z),{x1:P+se.x,y1:G+se.y,x2:B+se.x,y2:H+se.y,anchorPointX:oe,anchorPointY:ue}}Rs.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var c=++this.maxGroupID;this.collisionGroups[l]={ID:c,predicate:function(u){return u.collisionGroupID===c}}}return this.collisionGroups[l]};var Nr=function(l,c,u,f){this.transform=l.clone(),this.collisionIndex=new Ir(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Rs(u),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}};function ia(l,c,u,f,T){l.emplaceBack(c?1:0,u?1:0,f||0,T||0),l.emplaceBack(c?1:0,u?1:0,f||0,T||0),l.emplaceBack(c?1:0,u?1:0,f||0,T||0),l.emplaceBack(c?1:0,u?1:0,f||0,T||0)}Nr.prototype.getBucketParts=function(l,c,u,f){var T=u.getBucket(c),z=u.latestFeatureIndex;if(T&&z&&c.id===T.layerIds[0]){var P=u.collisionBoxArray,B=T.layers[0].layout,G=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),H=u.tileSize/y.EXTENT,oe=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),ue=B.get("text-pitch-alignment")==="map",se=B.get("text-rotation-alignment")==="map",Se=Dn(u,1,this.transform.zoom),we=ii(oe,ue,se,this.transform,Se),Ae=null;if(ue){var ge=qt(oe,ue,se,this.transform,Se);Ae=y.multiply([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[T.bucketInstanceId]=new Tn(T.bucketInstanceId,z,T.sourceLayerIndex,T.index,u.tileID);var Ee={bucket:T,layout:B,posMatrix:oe,textLabelPlaneMatrix:we,labelToScreenMatrix:Ae,scale:G,textPixelRatio:H,holdingForFade:u.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(f)for(var Re=0,je=T.sortKeyRanges;Re<je.length;Re+=1){var He=je[Re];l.push({sortKey:He.sortKey,symbolInstanceStart:He.symbolInstanceStart,symbolInstanceEnd:He.symbolInstanceEnd,parameters:Ee})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ee})}},Nr.prototype.attemptAnchorPlacement=function(l,c,u,f,T,z,P,B,G,H,oe,ue,se,Se,we){var Ae,ge=[ue.textOffset0,ue.textOffset1],Ee=oo(l,u,f,ge,T),Re=this.collisionIndex.placeCollisionBox(Zr(c,Ee.x,Ee.y,z,P,this.transform.angle),oe,B,G,H.predicate);if(!we||this.collisionIndex.placeCollisionBox(Zr(we,Ee.x,Ee.y,z,P,this.transform.angle),oe,B,G,H.predicate).box.length!==0)return Re.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),this.variableOffsets[ue.crossTileID]={textOffset:ge,width:u,height:f,anchor:l,textBoxScale:T,prevAnchor:Ae},this.markUsedJustification(se,l,ue,Se),se.allowVerticalPlacement&&(this.markUsedOrientation(se,Se,ue),this.placedOrientations[ue.crossTileID]=Se),{shift:Ee,placedGlyphBoxes:Re}):void 0},Nr.prototype.placeLayerBucketPart=function(l,c,u){var f=this,T=l.parameters,z=T.bucket,P=T.layout,B=T.posMatrix,G=T.textLabelPlaneMatrix,H=T.labelToScreenMatrix,oe=T.textPixelRatio,ue=T.holdingForFade,se=T.collisionBoxArray,Se=T.partiallyEvaluatedTextSize,we=T.collisionGroup,Ae=P.get("text-optional"),ge=P.get("icon-optional"),Ee=P.get("text-allow-overlap"),Re=P.get("icon-allow-overlap"),je=P.get("text-rotation-alignment")==="map",He=P.get("text-pitch-alignment")==="map",Ye=P.get("icon-text-fit")!=="none",et=P.get("symbol-z-order")==="viewport-y",st=Ee&&(Re||!z.hasIconData()||ge),vt=Re&&(Ee||!z.hasTextData()||Ae);!z.collisionArrays&&se&&z.deserializeCollisionBoxes(se);var mt=function(jt,bi){if(!c[jt.crossTileID])if(ue)f.placements[jt.crossTileID]=new Xo(!1,!1,!1);else{var Di,vi=!1,di=!1,hi=!0,ni=null,Xt={box:null,offscreen:null},Hi={box:null,offscreen:null},Jr=null,un=null,In=0,vn=0,Vi=0;bi.textFeatureIndex?In=bi.textFeatureIndex:jt.useRuntimeCollisionCircles&&(In=jt.featureIndex),bi.verticalTextFeatureIndex&&(vn=bi.verticalTextFeatureIndex);var On=bi.textBox;if(On){var ga=function(qr){var Or=y.WritingMode.horizontal;if(z.allowVerticalPlacement&&!qr&&f.prevPlacement){var ho=f.prevPlacement.placedOrientations[jt.crossTileID];ho&&(f.placedOrientations[jt.crossTileID]=ho,f.markUsedOrientation(z,Or=ho,jt))}return Or},cn=function(qr,Or){if(z.allowVerticalPlacement&&jt.numVerticalGlyphVertices>0&&bi.verticalTextBox)for(var ho=0,Yl=z.writingModes;ho<Yl.length&&(Yl[ho]===y.WritingMode.vertical?(Xt=Or(),Hi=Xt):Xt=qr(),!(Xt&&Xt.box&&Xt.box.length));ho+=1);else Xt=qr()};if(P.get("text-variable-anchor")){var hn=P.get("text-variable-anchor");if(f.prevPlacement&&f.prevPlacement.variableOffsets[jt.crossTileID]){var Oo=f.prevPlacement.variableOffsets[jt.crossTileID];hn.indexOf(Oo.anchor)>0&&(hn=hn.filter(function(qr){return qr!==Oo.anchor})).unshift(Oo.anchor)}var vo=function(qr,Or,ho){for(var Yl=qr.x2-qr.x1,is=qr.y2-qr.y1,Gu=jt.textBoxScale,Ql=Ye&&!Re?Or:null,Is={box:[],offscreen:!1},Tc=Ee?2*hn.length:hn.length,Es=0;Es<Tc;++Es){var kl=f.attemptAnchorPlacement(hn[Es%hn.length],qr,Yl,is,Gu,je,He,oe,B,we,Es>=hn.length,jt,z,ho,Ql);if(kl&&(Is=kl.placedGlyphBoxes)&&Is.box&&Is.box.length){vi=!0,ni=kl.shift;break}}return Is};cn(function(){return vo(On,bi.iconBox,y.WritingMode.horizontal)},function(){var qr=bi.verticalTextBox;return z.allowVerticalPlacement&&!(Xt&&Xt.box&&Xt.box.length)&&jt.numVerticalGlyphVertices>0&&qr?vo(qr,bi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Xt&&(vi=Xt.box,hi=Xt.offscreen);var Au=ga(Xt&&Xt.box);if(!vi&&f.prevPlacement){var Ss=f.prevPlacement.variableOffsets[jt.crossTileID];Ss&&(f.variableOffsets[jt.crossTileID]=Ss,f.markUsedJustification(z,Ss.anchor,jt,Au))}}else{var nl=function(qr,Or){var ho=f.collisionIndex.placeCollisionBox(qr,Ee,oe,B,we.predicate);return ho&&ho.box&&ho.box.length&&(f.markUsedOrientation(z,Or,jt),f.placedOrientations[jt.crossTileID]=Or),ho};cn(function(){return nl(On,y.WritingMode.horizontal)},function(){var qr=bi.verticalTextBox;return z.allowVerticalPlacement&&jt.numVerticalGlyphVertices>0&&qr?nl(qr,y.WritingMode.vertical):{box:null,offscreen:null}}),ga(Xt&&Xt.box&&Xt.box.length)}}if(vi=(Di=Xt)&&Di.box&&Di.box.length>0,hi=Di&&Di.offscreen,jt.useRuntimeCollisionCircles){var ol=z.text.placedSymbolArray.get(jt.centerJustifiedTextSymbolIndex),al=y.evaluateSizeForFeature(z.textSizeData,Se,ol),El=P.get("text-padding");Jr=f.collisionIndex.placeCollisionCircles(Ee,ol,z.lineVertexArray,z.glyphOffsetArray,al,B,G,H,u,He,we.predicate,jt.collisionCircleDiameter,El),vi=Ee||Jr.circles.length>0&&!Jr.collisionDetected,hi=hi&&Jr.offscreen}if(bi.iconFeatureIndex&&(Vi=bi.iconFeatureIndex),bi.iconBox){var Qo=function(qr){var Or=Ye&&ni?Zr(qr,ni.x,ni.y,je,He,f.transform.angle):qr;return f.collisionIndex.placeCollisionBox(Or,Re,oe,B,we.predicate)};di=Hi&&Hi.box&&Hi.box.length&&bi.verticalIconBox?(un=Qo(bi.verticalIconBox)).box.length>0:(un=Qo(bi.iconBox)).box.length>0,hi=hi&&un.offscreen}var sl=Ae||jt.numHorizontalGlyphVertices===0&&jt.numVerticalGlyphVertices===0,pn=ge||jt.numIconVertices===0;if(sl||pn?pn?sl||(di=di&&vi):vi=di&&vi:di=vi=di&&vi,vi&&Di&&Di.box&&f.collisionIndex.insertCollisionBox(Di.box,P.get("text-ignore-placement"),z.bucketInstanceId,Hi&&Hi.box&&vn?vn:In,we.ID),di&&un&&f.collisionIndex.insertCollisionBox(un.box,P.get("icon-ignore-placement"),z.bucketInstanceId,Vi,we.ID),Jr&&(vi&&f.collisionIndex.insertCollisionCircles(Jr.circles,P.get("text-ignore-placement"),z.bucketInstanceId,In,we.ID),u)){var Ro=z.bucketInstanceId,_a=f.collisionCircleArrays[Ro];_a===void 0&&(_a=f.collisionCircleArrays[Ro]=new xu);for(var va=0;va<Jr.circles.length;va+=4)_a.circles.push(Jr.circles[va+0]),_a.circles.push(Jr.circles[va+1]),_a.circles.push(Jr.circles[va+2]),_a.circles.push(Jr.collisionDetected?1:0)}f.placements[jt.crossTileID]=new Xo(vi||st,di||vt,hi||z.justReloaded),c[jt.crossTileID]=!0}};if(et)for(var Pt=z.getSortedSymbolIndexes(this.transform.angle),$t=Pt.length-1;$t>=0;--$t){var ei=Pt[$t];mt(z.symbolInstances.get(ei),z.collisionArrays[ei])}else for(var Nt=l.symbolInstanceStart;Nt<l.symbolInstanceEnd;Nt++)mt(z.symbolInstances.get(Nt),z.collisionArrays[Nt]);if(u&&z.bucketInstanceId in this.collisionCircleArrays){var Bi=this.collisionCircleArrays[z.bucketInstanceId];y.invert(Bi.invProjMatrix,B),Bi.viewportMatrix=this.collisionIndex.getViewportMatrix()}z.justReloaded=!1},Nr.prototype.markUsedJustification=function(l,c,u,f){var T;T=f===y.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(c)];for(var z=0,P=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];z<P.length;z+=1){var B=P[z];B>=0&&(l.text.placedSymbolArray.get(B).crossTileID=T>=0&&B!==T?0:u.crossTileID)}},Nr.prototype.markUsedOrientation=function(l,c,u){for(var f=c===y.WritingMode.horizontal||c===y.WritingMode.horizontalOnly?c:0,T=c===y.WritingMode.vertical?c:0,z=0,P=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];z<P.length;z+=1)l.text.placedSymbolArray.get(P[z]).placedOrientation=f;u.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=T)},Nr.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var c=this.prevPlacement,u=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;var f=c?c.symbolFadeChange(l):1,T=c?c.opacities:{},z=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(var B in this.placements){var G=this.placements[B],H=T[B];H?(this.opacities[B]=new Nn(H,f,G.text,G.icon),u=u||G.text!==H.text.placed||G.icon!==H.icon.placed):(this.opacities[B]=new Nn(null,f,G.text,G.icon,G.skipFade),u=u||G.text||G.icon)}for(var oe in T){var ue=T[oe];if(!this.opacities[oe]){var se=new Nn(ue,f,!1,!1);se.isHidden()||(this.opacities[oe]=se,u=u||ue.text.placed||ue.icon.placed)}}for(var Se in z)this.variableOffsets[Se]||!this.opacities[Se]||this.opacities[Se].isHidden()||(this.variableOffsets[Se]=z[Se]);for(var we in P)this.placedOrientations[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.placedOrientations[we]=P[we]);u?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:l)},Nr.prototype.updateLayerOpacities=function(l,c){for(var u={},f=0,T=c;f<T.length;f+=1){var z=T[f],P=z.getBucket(l);P&&z.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,u,z.collisionBoxArray)}},Nr.prototype.updateBucketOpacities=function(l,c,u){var f=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var T=l.layers[0].layout,z=new Nn(null,0,!1,!1,!0),P=T.get("text-allow-overlap"),B=T.get("icon-allow-overlap"),G=T.get("text-variable-anchor"),H=T.get("text-rotation-alignment")==="map",oe=T.get("text-pitch-alignment")==="map",ue=T.get("icon-text-fit")!=="none",se=new Nn(null,0,P&&(B||!l.hasIconData()||T.get("icon-optional")),B&&(P||!l.hasTextData()||T.get("text-optional")),!0);!l.collisionArrays&&u&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(u);for(var Se=function(Ee,Re,je){for(var He=0;He<Re/4;He++)Ee.opacityVertexArray.emplaceBack(je)},we=function(Ee){var Re=l.symbolInstances.get(Ee),je=Re.numHorizontalGlyphVertices,He=Re.numVerticalGlyphVertices,Ye=Re.crossTileID,et=f.opacities[Ye];c[Ye]?et=z:et||(f.opacities[Ye]=et=se),c[Ye]=!0;var st=Re.numIconVertices>0,vt=f.placedOrientations[Re.crossTileID],mt=vt===y.WritingMode.vertical,Pt=vt===y.WritingMode.horizontal||vt===y.WritingMode.horizontalOnly;if(je>0||He>0){var $t=bl(et.text);Se(l.text,je,mt?Va:$t),Se(l.text,He,Pt?Va:$t);var ei=et.text.isHidden();[Re.rightJustifiedTextSymbolIndex,Re.centerJustifiedTextSymbolIndex,Re.leftJustifiedTextSymbolIndex].forEach(function(Xt){Xt>=0&&(l.text.placedSymbolArray.get(Xt).hidden=ei||mt?1:0)}),Re.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Re.verticalPlacedTextSymbolIndex).hidden=ei||Pt?1:0);var Nt=f.variableOffsets[Re.crossTileID];Nt&&f.markUsedJustification(l,Nt.anchor,Re,vt);var Bi=f.placedOrientations[Re.crossTileID];Bi&&(f.markUsedJustification(l,"left",Re,Bi),f.markUsedOrientation(l,Bi,Re))}if(st){var jt=bl(et.icon),bi=!(ue&&Re.verticalPlacedIconSymbolIndex&&mt);Re.placedIconSymbolIndex>=0&&(Se(l.icon,Re.numIconVertices,bi?jt:Va),l.icon.placedSymbolArray.get(Re.placedIconSymbolIndex).hidden=et.icon.isHidden()),Re.verticalPlacedIconSymbolIndex>=0&&(Se(l.icon,Re.numVerticalIconVertices,bi?Va:jt),l.icon.placedSymbolArray.get(Re.verticalPlacedIconSymbolIndex).hidden=et.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var Di=l.collisionArrays[Ee];if(Di){var vi=new y.Point(0,0);if(Di.textBox||Di.verticalTextBox){var di=!0;if(G){var hi=f.variableOffsets[Ye];hi?(vi=oo(hi.anchor,hi.width,hi.height,hi.textOffset,hi.textBoxScale),H&&vi._rotate(oe?f.transform.angle:-f.transform.angle)):di=!1}Di.textBox&&ia(l.textCollisionBox.collisionVertexArray,et.text.placed,!di||mt,vi.x,vi.y),Di.verticalTextBox&&ia(l.textCollisionBox.collisionVertexArray,et.text.placed,!di||Pt,vi.x,vi.y)}var ni=Boolean(!Pt&&Di.verticalIconBox);Di.iconBox&&ia(l.iconCollisionBox.collisionVertexArray,et.icon.placed,ni,ue?vi.x:0,ue?vi.y:0),Di.verticalIconBox&&ia(l.iconCollisionBox.collisionVertexArray,et.icon.placed,!ni,ue?vi.x:0,ue?vi.y:0)}}},Ae=0;Ae<l.symbolInstances.length;Ae++)we(Ae);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var ge=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ge.invProjMatrix,l.placementViewportMatrix=ge.viewportMatrix,l.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Nr.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Nr.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Nr.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Nr.prototype.stillRecent=function(l,c){var u=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*u>l},Nr.prototype.setStale=function(){this.stale=!0};var Ia=Math.pow(2,25),vl=Math.pow(2,24),Bs=Math.pow(2,17),Kr=Math.pow(2,16),Fs=Math.pow(2,9),xl=Math.pow(2,8),bu=Math.pow(2,1);function bl(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var c=l.placed?1:0,u=Math.floor(127*l.opacity);return u*Ia+c*vl+u*Bs+c*Kr+u*Fs+c*xl+u*bu+c}var Va=0,hs=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};hs.prototype.continuePlacement=function(l,c,u,f,T){for(var z=this._bucketParts;this._currentTileIndex<l.length;)if(c.getBucketParts(z,f,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort(function(P,B){return P.sortKey-B.sortKey}));this._currentPartIndex<z.length;)if(c.placeLayerBucketPart(z[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,T())return!0;return!1};var Os=function(l,c,u,f,T,z,P){this.placement=new Nr(l,T,z,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1};Os.prototype.isDone=function(){return this._done},Os.prototype.continuePlacement=function(l,c,u){for(var f=this,T=y.browser.now(),z=function(){var G=y.browser.now()-T;return!f._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var P=c[l[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=B)&&(!P.maxzoom||P.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new hs(P)),this._inProgressLayer.continuePlacement(u[P.source],this.placement,this._showCollisionBoxes,P,z))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Os.prototype.commit=function(l){return this.placement.commit(l),this.placement};var wu=512/y.EXTENT/2,ps=function(l,c,u){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(var f=0;f<c.length;f++){var T=c.get(f),z=T.key;this.indexedSymbolInstances[z]||(this.indexedSymbolInstances[z]=[]),this.indexedSymbolInstances[z].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,l)})}};ps.prototype.getScaledCoordinates=function(l,c){var u=wu/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*y.EXTENT+l.anchorX)*u),y:Math.floor((c.canonical.y*y.EXTENT+l.anchorY)*u)}},ps.prototype.findMatches=function(l,c,u){for(var f=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),T=0;T<l.length;T++){var z=l.get(T);if(!z.crossTileID){var P=this.indexedSymbolInstances[z.key];if(P)for(var B=this.getScaledCoordinates(z,c),G=0,H=P;G<H.length;G+=1){var oe=H[G];if(Math.abs(oe.coord.x-B.x)<=f&&Math.abs(oe.coord.y-B.y)<=f&&!u[oe.crossTileID]){u[oe.crossTileID]=!0,z.crossTileID=oe.crossTileID;break}}}}};var Us=function(){this.maxCrossTileID=0};Us.prototype.generate=function(){return++this.maxCrossTileID};var Ln=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ln.prototype.handleWrapJump=function(l){var c=Math.round((l-this.lng)/360);if(c!==0)for(var u in this.indexes){var f=this.indexes[u],T={};for(var z in f){var P=f[z];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),T[P.tileID.key]=P}this.indexes[u]=T}this.lng=l},Ln.prototype.addBucket=function(l,c,u){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var f=0;f<c.symbolInstances.length;f++)c.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var T=this.usedCrossTileIDs[l.overscaledZ];for(var z in this.indexes){var P=this.indexes[z];if(Number(z)>l.overscaledZ)for(var B in P){var G=P[B];G.tileID.isChildOf(l)&&G.findMatches(c.symbolInstances,l,T)}else{var H=P[l.scaledTo(Number(z)).key];H&&H.findMatches(c.symbolInstances,l,T)}}for(var oe=0;oe<c.symbolInstances.length;oe++){var ue=c.symbolInstances.get(oe);ue.crossTileID||(ue.crossTileID=u.generate(),T[ue.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new ps(l,c.symbolInstances,c.bucketInstanceId),!0},Ln.prototype.removeBucketCrossTileIDs=function(l,c){for(var u in c.indexedSymbolInstances)for(var f=0,T=c.indexedSymbolInstances[u];f<T.length;f+=1)delete this.usedCrossTileIDs[l][T[f].crossTileID]},Ln.prototype.removeStaleBuckets=function(l){var c=!1;for(var u in this.indexes){var f=this.indexes[u];for(var T in f)l[f[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[T]),delete f[T],c=!0)}return c};var ra=function(){this.layerIndexes={},this.crossTileIDs=new Us,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ra.prototype.addLayer=function(l,c,u){var f=this.layerIndexes[l.id];f===void 0&&(f=this.layerIndexes[l.id]=new Ln);var T=!1,z={};f.handleWrapJump(u);for(var P=0,B=c;P<B.length;P+=1){var G=B[P],H=G.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(G.tileID,H,this.crossTileIDs)&&(T=!0),z[H.bucketInstanceId]=!0)}return f.removeStaleBuckets(z)&&(T=!0),T},ra.prototype.pruneUnusedLayers=function(l){var c={};for(var u in l.forEach(function(f){c[f]=!0}),this.layerIndexes)c[u]||delete this.layerIndexes[u]};var na=function(l,c){return y.emitValidationErrors(l,c&&c.filter(function(u){return u.identifier!=="source.canvas"}))},Wi=y.pick(de,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ea=y.pick(de,["setCenter","setZoom","setBearing","setPitch"]),ko=function(){var l={},c=y.styleSpec.$version;for(var u in y.styleSpec.$root){var f,T=y.styleSpec.$root[u];T.required&&(f=u==="version"?c:T.type==="array"?[]:{})!=null&&(l[u]=f)}return l}(),yo=function(l){function c(u,f){var T=this;f===void 0&&(f={}),l.call(this),this.map=u,this.dispatcher=new Li(Ie(),this),this.imageManager=new wt,this.imageManager.setEventedParent(this),this.glyphManager=new zi(u._requestManager,f.localIdeographFontFamily),this.lineAtlas=new lr(256,512),this.crossTileSymbolIndex=new ra,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var z=this;this._rtlTextPluginCallback=c.registerForPluginStateChange(function(P){z.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(B,G){if(y.triggerPluginCompletionEvent(B),G&&G.every(function(oe){return oe}))for(var H in z.sourceCaches)z.sourceCaches[H].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var B=T.sourceCaches[P.sourceId];if(B){var G=B.getSource();if(G&&G.vectorLayerIds)for(var H in T._layers){var oe=T._layers[H];oe.source===G.id&&T._validateLayer(oe)}}}})}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.loadURL=function(u,f){var T=this;f===void 0&&(f={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var z=typeof f.validate=="boolean"?f.validate:!y.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,f.accessToken);var P=this.map._requestManager.transformRequest(u,y.ResourceType.Style);this._request=y.getJSON(P,function(B,G){T._request=null,B?T.fire(new y.ErrorEvent(B)):G&&T._load(G,z)})},c.prototype.loadJSON=function(u,f){var T=this;f===void 0&&(f={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){T._request=null,T._load(u,f.validate!==!1)})},c.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(ko,!1)},c.prototype._load=function(u,f){if(!f||!na(this,y.validateStyle(u))){for(var T in this._loaded=!0,this.stylesheet=u,u.sources)this.addSource(T,u.sources[T],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs);var z=_e(this.stylesheet.layers);this._order=z.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var P=0,B=z;P<B.length;P+=1){var G=B[P];(G=y.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new fn(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},c.prototype._loadSprite=function(u){var f=this;this._spriteRequest=function(T,z,P){var B,G,H,oe=y.browser.devicePixelRatio>1?"@2x":"",ue=y.getJSON(z.transformRequest(z.normalizeSpriteURL(T,oe,".json"),y.ResourceType.SpriteJSON),function(we,Ae){ue=null,H||(H=we,B=Ae,Se())}),se=y.getImage(z.transformRequest(z.normalizeSpriteURL(T,oe,".png"),y.ResourceType.SpriteImage),function(we,Ae){se=null,H||(H=we,G=Ae,Se())});function Se(){if(H)P(H);else if(B&&G){var we=y.browser.getImageData(G),Ae={};for(var ge in B){var Ee=B[ge],Re=Ee.width,je=Ee.height,He=Ee.x,Ye=Ee.y,et=Ee.sdf,st=Ee.pixelRatio,vt=Ee.stretchX,mt=Ee.stretchY,Pt=Ee.content,$t=new y.RGBAImage({width:Re,height:je});y.RGBAImage.copy(we,$t,{x:He,y:Ye},{x:0,y:0},{width:Re,height:je}),Ae[ge]={data:$t,pixelRatio:st,sdf:et,stretchX:vt,stretchY:mt,content:Pt}}P(null,Ae)}}return{cancel:function(){ue&&(ue.cancel(),ue=null),se&&(se.cancel(),se=null)}}}(u,this.map._requestManager,function(T,z){if(f._spriteRequest=null,T)f.fire(new y.ErrorEvent(T));else if(z)for(var P in z)f.imageManager.addImage(P,z[P]);f.imageManager.setLoaded(!0),f._availableImages=f.imageManager.listImages(),f.dispatcher.broadcast("setImages",f._availableImages),f.fire(new y.Event("data",{dataType:"style"}))})},c.prototype._validateLayer=function(u){var f=this.sourceCaches[u.source];if(f){var T=u.sourceLayer;if(T){var z=f.getSource();(z.type==="geojson"||z.vectorLayerIds&&z.vectorLayerIds.indexOf(T)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+T+'" does not exist on source "'+z.id+'" as specified by style layer "'+u.id+'"')))}}},c.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()},c.prototype._serializeLayers=function(u){for(var f=[],T=0,z=u;T<z.length;T+=1){var P=this._layers[z[T]];P.type!=="custom"&&f.push(P.serialize())}return f},c.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(var f in this._layers)if(this._layers[f].hasTransition())return!0;return!1},c.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},c.prototype.update=function(u){if(this._loaded){var f=this._changed;if(this._changed){var T=Object.keys(this._updatedLayers),z=Object.keys(this._removedLayers);for(var P in(T.length||z.length)&&this._updateWorkerLayers(T,z),this._updatedSources){var B=this._updatedSources[P];B==="reload"?this._reloadSource(P):B==="clear"&&this._clearSource(P)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(u);this.light.updateTransitions(u),this._resetUpdates()}var H={};for(var oe in this.sourceCaches){var ue=this.sourceCaches[oe];H[oe]=ue.used,ue.used=!1}for(var se=0,Se=this._order;se<Se.length;se+=1){var we=this._layers[Se[se]];we.recalculate(u,this._availableImages),!we.isHidden(u.zoom)&&we.source&&(this.sourceCaches[we.source].used=!0)}for(var Ae in H){var ge=this.sourceCaches[Ae];H[Ae]!==ge.used&&ge.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ae}))}this.light.recalculate(u),this.z=u.zoom,f&&this.fire(new y.Event("data",{dataType:"style"}))}},c.prototype._updateTilesForChangedImages=function(){var u=Object.keys(this._changedImages);if(u.length){for(var f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}},c.prototype._updateWorkerLayers=function(u,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:f})},c.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},c.prototype.setState=function(u){var f=this;if(this._checkLoaded(),na(this,y.validateStyle(u)))return!1;(u=y.clone$1(u)).layers=_e(u.layers);var T=function(P,B){if(!P)return[{command:de.setStyle,args:[B]}];var G=[];try{if(!y.deepEqual(P.version,B.version))return[{command:de.setStyle,args:[B]}];y.deepEqual(P.center,B.center)||G.push({command:de.setCenter,args:[B.center]}),y.deepEqual(P.zoom,B.zoom)||G.push({command:de.setZoom,args:[B.zoom]}),y.deepEqual(P.bearing,B.bearing)||G.push({command:de.setBearing,args:[B.bearing]}),y.deepEqual(P.pitch,B.pitch)||G.push({command:de.setPitch,args:[B.pitch]}),y.deepEqual(P.sprite,B.sprite)||G.push({command:de.setSprite,args:[B.sprite]}),y.deepEqual(P.glyphs,B.glyphs)||G.push({command:de.setGlyphs,args:[B.glyphs]}),y.deepEqual(P.transition,B.transition)||G.push({command:de.setTransition,args:[B.transition]}),y.deepEqual(P.light,B.light)||G.push({command:de.setLight,args:[B.light]});var H={},oe=[];(function(se,Se,we,Ae){var ge;for(ge in Se=Se||{},se=se||{})se.hasOwnProperty(ge)&&(Se.hasOwnProperty(ge)||Ke(ge,we,Ae));for(ge in Se)Se.hasOwnProperty(ge)&&(se.hasOwnProperty(ge)?y.deepEqual(se[ge],Se[ge])||(se[ge].type==="geojson"&&Se[ge].type==="geojson"&&xt(se,Se,ge)?we.push({command:de.setGeoJSONSourceData,args:[ge,Se[ge].data]}):Be(ge,Se,we,Ae)):$e(ge,Se,we))})(P.sources,B.sources,oe,H);var ue=[];P.layers&&P.layers.forEach(function(se){H[se.source]?G.push({command:de.removeLayer,args:[se.id]}):ue.push(se)}),G=G.concat(oe),function(se,Se,we){Se=Se||[];var Ae,ge,Ee,Re,je,He,Ye,et=(se=se||[]).map(bt),st=Se.map(bt),vt=se.reduce(Rt,{}),mt=Se.reduce(Rt,{}),Pt=et.slice(),$t=Object.create(null);for(Ae=0,ge=0;Ae<et.length;Ae++)mt.hasOwnProperty(Ee=et[Ae])?ge++:(we.push({command:de.removeLayer,args:[Ee]}),Pt.splice(Pt.indexOf(Ee,ge),1));for(Ae=0,ge=0;Ae<st.length;Ae++)Pt[Pt.length-1-Ae]!==(Ee=st[st.length-1-Ae])&&(vt.hasOwnProperty(Ee)?(we.push({command:de.removeLayer,args:[Ee]}),Pt.splice(Pt.lastIndexOf(Ee,Pt.length-ge),1)):ge++,we.push({command:de.addLayer,args:[mt[Ee],He=Pt[Pt.length-Ae]]}),Pt.splice(Pt.length-Ae,0,Ee),$t[Ee]=!0);for(Ae=0;Ae<st.length;Ae++)if(Re=vt[Ee=st[Ae]],je=mt[Ee],!$t[Ee]&&!y.deepEqual(Re,je))if(y.deepEqual(Re.source,je.source)&&y.deepEqual(Re["source-layer"],je["source-layer"])&&y.deepEqual(Re.type,je.type)){for(Ye in ht(Re.layout,je.layout,we,Ee,null,de.setLayoutProperty),ht(Re.paint,je.paint,we,Ee,null,de.setPaintProperty),y.deepEqual(Re.filter,je.filter)||we.push({command:de.setFilter,args:[Ee,je.filter]}),y.deepEqual(Re.minzoom,je.minzoom)&&y.deepEqual(Re.maxzoom,je.maxzoom)||we.push({command:de.setLayerZoomRange,args:[Ee,je.minzoom,je.maxzoom]}),Re)Re.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?ht(Re[Ye],je[Ye],we,Ee,Ye.slice(6),de.setPaintProperty):y.deepEqual(Re[Ye],je[Ye])||we.push({command:de.setLayerProperty,args:[Ee,Ye,je[Ye]]}));for(Ye in je)je.hasOwnProperty(Ye)&&!Re.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?ht(Re[Ye],je[Ye],we,Ee,Ye.slice(6),de.setPaintProperty):y.deepEqual(Re[Ye],je[Ye])||we.push({command:de.setLayerProperty,args:[Ee,Ye,je[Ye]]}))}else we.push({command:de.removeLayer,args:[Ee]}),He=Pt[Pt.lastIndexOf(Ee)+1],we.push({command:de.addLayer,args:[je,He]})}(ue,B.layers,G)}catch(se){console.warn("Unable to compute style diff:",se),G=[{command:de.setStyle,args:[B]}]}return G}(this.serialize(),u).filter(function(P){return!(P.command in Ea)});if(T.length===0)return!1;var z=T.filter(function(P){return!(P.command in Wi)});if(z.length>0)throw new Error("Unimplemented: "+z.map(function(P){return P.command}).join(", ")+".");return T.forEach(function(P){P.command!=="setTransition"&&f[P.command].apply(f,P.args)}),this.stylesheet=u,!0},c.prototype.addImage=function(u,f){if(this.getImage(u))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(u,f),this._afterImageUpdated(u)},c.prototype.updateImage=function(u,f){this.imageManager.updateImage(u,f)},c.prototype.getImage=function(u){return this.imageManager.getImage(u)},c.prototype.removeImage=function(u){if(!this.getImage(u))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(u),this._afterImageUpdated(u)},c.prototype._afterImageUpdated=function(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},c.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},c.prototype.addSource=function(u,f,T){var z=this;if(T===void 0&&(T={}),this._checkLoaded(),this.sourceCaches[u]!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(f).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(y.validateStyle.source,"sources."+u,f,null,T))){this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);var P=this.sourceCaches[u]=new ye(u,f,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:z.loaded(),source:P.serialize(),sourceId:u}}),P.onAdd(this.map),this._changed=!0}},c.prototype.removeSource=function(u){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error("There is no source with this ID");for(var f in this._layers)if(this._layers[f].source===u)return this.fire(new y.ErrorEvent(new Error('Source "'+u+'" cannot be removed while layer "'+f+'" is using it.')));var T=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],T.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),T.setEventedParent(null),T.clearTiles(),T.onRemove&&T.onRemove(this.map),this._changed=!0},c.prototype.setGeoJSONSourceData=function(u,f){this._checkLoaded(),this.sourceCaches[u].getSource().setData(f),this._changed=!0},c.prototype.getSource=function(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()},c.prototype.addLayer=function(u,f,T){T===void 0&&(T={}),this._checkLoaded();var z=u.id;if(this.getLayer(z))this.fire(new y.ErrorEvent(new Error('Layer with id "'+z+'" already exists on this map')));else{var P;if(u.type==="custom"){if(na(this,y.validateCustomStyleLayer(u)))return;P=y.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(z,u.source),u=y.clone$1(u),u=y.extend(u,{source:z})),this._validate(y.validateStyle.layer,"layers."+z,u,{arrayIndex:-1},T))return;P=y.createStyleLayer(u),this._validateLayer(P),P.setEventedParent(this,{layer:{id:z}}),this._serializedLayers[P.id]=P.serialize()}var B=f?this._order.indexOf(f):this._order.length;if(f&&B===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.')));else{if(this._order.splice(B,0,z),this._layerOrderChanged=!0,this._layers[z]=P,this._removedLayers[z]&&P.source&&P.type!=="custom"){var G=this._removedLayers[z];delete this._removedLayers[z],G.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},c.prototype.moveLayer=function(u,f){if(this._checkLoaded(),this._changed=!0,this._layers[u]){if(u!==f){var T=this._order.indexOf(u);this._order.splice(T,1);var z=f?this._order.indexOf(f):this._order.length;f&&z===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.'))):(this._order.splice(z,0,u),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be moved.")))},c.prototype.removeLayer=function(u){this._checkLoaded();var f=this._layers[u];if(f){f.setEventedParent(null);var T=this._order.indexOf(u);this._order.splice(T,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=f,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],f.onRemove&&f.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be removed.")))},c.prototype.getLayer=function(u){return this._layers[u]},c.prototype.hasLayer=function(u){return u in this._layers},c.prototype.setLayerZoomRange=function(u,f,T){this._checkLoaded();var z=this.getLayer(u);z?z.minzoom===f&&z.maxzoom===T||(f!=null&&(z.minzoom=f),T!=null&&(z.maxzoom=T),this._updateLayer(z)):this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot have zoom extent.")))},c.prototype.setFilter=function(u,f,T){T===void 0&&(T={}),this._checkLoaded();var z=this.getLayer(u);if(z){if(!y.deepEqual(z.filter,f))return f==null?(z.filter=void 0,void this._updateLayer(z)):void(this._validate(y.validateStyle.filter,"layers."+z.id+".filter",f,null,T)||(z.filter=y.clone$1(f),this._updateLayer(z)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be filtered.")))},c.prototype.getFilter=function(u){return y.clone$1(this.getLayer(u).filter)},c.prototype.setLayoutProperty=function(u,f,T,z){z===void 0&&(z={}),this._checkLoaded();var P=this.getLayer(u);P?y.deepEqual(P.getLayoutProperty(f),T)||(P.setLayoutProperty(f,T,z),this._updateLayer(P)):this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getLayoutProperty=function(u,f){var T=this.getLayer(u);if(T)return T.getLayoutProperty(f);this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style.")))},c.prototype.setPaintProperty=function(u,f,T,z){z===void 0&&(z={}),this._checkLoaded();var P=this.getLayer(u);P?y.deepEqual(P.getPaintProperty(f),T)||(P.setPaintProperty(f,T,z)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getPaintProperty=function(u,f){return this.getLayer(u).getPaintProperty(f)},c.prototype.setFeatureState=function(u,f){this._checkLoaded();var T=u.source,z=u.sourceLayer,P=this.sourceCaches[T];if(P!==void 0){var B=P.getSource().type;B==="geojson"&&z?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||z?(u.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(z,u.id,f)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},c.prototype.removeFeatureState=function(u,f){this._checkLoaded();var T=u.source,z=this.sourceCaches[T];if(z!==void 0){var P=z.getSource().type,B=P==="vector"?u.sourceLayer:void 0;P!=="vector"||B?f&&typeof u.id!="string"&&typeof u.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):z.removeFeatureState(B,u.id,f):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},c.prototype.getFeatureState=function(u){this._checkLoaded();var f=u.source,T=u.sourceLayer,z=this.sourceCaches[f];if(z!==void 0){if(z.getSource().type!=="vector"||T)return u.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),z.getFeatureState(T,u.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+f+"' does not exist in the map's style.")))},c.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},c.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(u){return u.serialize()}),layers:this._serializeLayers(this._order)},function(u){return u!==void 0})},c.prototype._updateLayer=function(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.sourceCaches[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._changed=!0},c.prototype._flattenAndSortRenderedFeatures=function(u){for(var f=this,T=function(vt){return f._layers[vt].type==="fill-extrusion"},z={},P=[],B=this._order.length-1;B>=0;B--){var G=this._order[B];if(T(G)){z[G]=B;for(var H=0,oe=u;H<oe.length;H+=1){var ue=oe[H][G];if(ue)for(var se=0,Se=ue;se<Se.length;se+=1)P.push(Se[se])}}}P.sort(function(vt,mt){return mt.intersectionZ-vt.intersectionZ});for(var we=[],Ae=this._order.length-1;Ae>=0;Ae--){var ge=this._order[Ae];if(T(ge))for(var Ee=P.length-1;Ee>=0;Ee--){var Re=P[Ee].feature;if(z[Re.layer.id]<Ae)break;we.push(Re),P.pop()}else for(var je=0,He=u;je<He.length;je+=1){var Ye=He[je][ge];if(Ye)for(var et=0,st=Ye;et<st.length;et+=1)we.push(st[et].feature)}}return we},c.prototype.queryRenderedFeatures=function(u,f,T){f&&f.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",f.filter,null,f);var z={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,B=f.layers;P<B.length;P+=1){var G=B[P],H=this._layers[G];if(!H)return this.fire(new y.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];z[H.source]=!0}}var oe=[];for(var ue in f.availableImages=this._availableImages,this.sourceCaches)f.layers&&!z[ue]||oe.push(ji(this.sourceCaches[ue],this._layers,this._serializedLayers,u,f,T));return this.placement&&oe.push(function(se,Se,we,Ae,ge,Ee,Re){for(var je={},He=Ee.queryRenderedSymbols(Ae),Ye=[],et=0,st=Object.keys(He).map(Number);et<st.length;et+=1)Ye.push(Re[st[et]]);Ye.sort(ir);for(var vt=function(){var Nt=Pt[mt],Bi=Nt.featureIndex.lookupSymbolFeatures(He[Nt.bucketInstanceId],Se,Nt.bucketIndex,Nt.sourceLayerIndex,ge.filter,ge.layers,ge.availableImages,se);for(var jt in Bi){var bi=je[jt]=je[jt]||[],Di=Bi[jt];Di.sort(function(hi,ni){var Xt=Nt.featureSortOrder;if(Xt){var Hi=Xt.indexOf(hi.featureIndex);return Xt.indexOf(ni.featureIndex)-Hi}return ni.featureIndex-hi.featureIndex});for(var vi=0,di=Di;vi<di.length;vi+=1)bi.push(di[vi])}},mt=0,Pt=Ye;mt<Pt.length;mt+=1)vt();var $t=function(Nt){je[Nt].forEach(function(Bi){var jt=Bi.feature,bi=we[se[Nt].source].getFeatureState(jt.layer["source-layer"],jt.id);jt.source=jt.layer.source,jt.layer["source-layer"]&&(jt.sourceLayer=jt.layer["source-layer"]),jt.state=bi})};for(var ei in je)$t(ei);return je}(this._layers,this._serializedLayers,this.sourceCaches,u,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},c.prototype.querySourceFeatures=function(u,f){f&&f.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",f.filter,null,f);var T=this.sourceCaches[u];return T?function(z,P){for(var B=z.getRenderableIds().map(function(Se){return z.getTileByID(Se)}),G=[],H={},oe=0;oe<B.length;oe++){var ue=B[oe],se=ue.tileID.canonical.key;H[se]||(H[se]=!0,ue.querySourceFeatures(G,P))}return G}(T,f):[]},c.prototype.addSourceType=function(u,f,T){return c.getSourceType(u)?T(new Error('A source type called "'+u+'" already exists.')):(c.setSourceType(u,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:f.workerSourceURL},T):T(null,null))},c.prototype.getLight=function(){return this.light.getLight()},c.prototype.setLight=function(u,f){f===void 0&&(f={}),this._checkLoaded();var T=this.light.getLight(),z=!1;for(var P in u)if(!y.deepEqual(u[P],T[P])){z=!0;break}if(z){var B={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,f),this.light.updateTransitions(B)}},c.prototype._validate=function(u,f,T,z,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&na(this,u.call(y.validateStyle,y.extend({key:f,style:this.serialize(),value:T,styleSpec:y.styleSpec},z)))},c.prototype._remove=function(){for(var u in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[u].setEventedParent(null);for(var f in this.sourceCaches)this.sourceCaches[f].clearTiles(),this.sourceCaches[f].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},c.prototype._clearSource=function(u){this.sourceCaches[u].clearTiles()},c.prototype._reloadSource=function(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()},c.prototype._updateSources=function(u){for(var f in this.sourceCaches)this.sourceCaches[f].update(u)},c.prototype._generateCollisionBoxes=function(){for(var u in this.sourceCaches)this._reloadSource(u)},c.prototype._updatePlacement=function(u,f,T,z,P){P===void 0&&(P=!1);for(var B=!1,G=!1,H={},oe=0,ue=this._order;oe<ue.length;oe+=1){var se=this._layers[ue[oe]];if(se.type==="symbol"){if(!H[se.source]){var Se=this.sourceCaches[se.source];H[se.source]=Se.getRenderableIds(!0).map(function(Re){return Se.getTileByID(Re)}).sort(function(Re,je){return je.tileID.overscaledZ-Re.tileID.overscaledZ||(Re.tileID.isLessThan(je.tileID)?-1:1)})}var we=this.crossTileSymbolIndex.addLayer(se,H[se.source],u.center.lng);B=B||we}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||T===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),u.zoom))&&(this.pauseablePlacement=new Os(u,this._order,P,f,T,z,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B)for(var Ae=0,ge=this._order;Ae<ge.length;Ae+=1){var Ee=this._layers[ge[Ae]];Ee.type==="symbol"&&this.placement.updateLayerOpacities(Ee,H[Ee.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},c.prototype._releaseSymbolFadeTiles=function(){for(var u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()},c.prototype.getImages=function(u,f,T){this.imageManager.getImages(f.icons,T),this._updateTilesForChangedImages();var z=this.sourceCaches[f.source];z&&z.setDependencies(f.tileID.key,f.type,f.icons)},c.prototype.getGlyphs=function(u,f,T){this.glyphManager.getGlyphs(f.stacks,T)},c.prototype.getResource=function(u,f,T){return y.makeRequest(f,T)},c}(y.Evented);yo.getSourceType=function(l){return Qi[l]},yo.setSourceType=function(l,c){Qi[l]=c},yo.registerForPluginStateChange=y.registerForPluginStateChange;var Ao=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),rr=Er(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ds=Er(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),js=Er(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),wl=Er(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Gl=Er("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Vs=Er(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),fs=Er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ns=Er("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),qs=Er("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Zs=Er("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),$l=Er(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Tu=Er(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Wo=Er(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Gs=Er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Su=Er(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Sn=Er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Xl=Er(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ka=Er(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Aa=Er(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),oa=Er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),aa=Er(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),go=Er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),za=Er(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ca=Er(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ho=Er(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Pa=Er(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Er(l,c){var u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=c.match(/attribute ([\w]+) ([\w]+)/g),T=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=z?z.concat(T):T,B={};return{fragmentSource:l=l.replace(u,function(G,H,oe,ue,se){return B[se]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
varying `+oe+" "+ue+" "+se+`;
#else
uniform `+oe+" "+ue+" u_"+se+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+se+`
    `+oe+" "+ue+" "+se+" = u_"+se+`;
#endif
`}),vertexSource:c=c.replace(u,function(G,H,oe,ue,se){var Se=ue==="float"?"vec2":"vec4",we=se.match(/color/)?"color":Se;return B[se]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
uniform lowp float u_`+se+`_t;
attribute `+oe+" "+Se+" a_"+se+`;
varying `+oe+" "+ue+" "+se+`;
#else
uniform `+oe+" "+ue+" u_"+se+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+se+`
    `+se+" = a_"+se+`;
#else
    `+oe+" "+ue+" "+se+" = u_"+se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+se+`
    `+se+" = unpack_mix_"+we+"(a_"+se+", u_"+se+`_t);
#else
    `+oe+" "+ue+" "+se+" = u_"+se+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
uniform lowp float u_`+se+`_t;
attribute `+oe+" "+Se+" a_"+se+`;
#else
uniform `+oe+" "+ue+" u_"+se+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+se+`
    `+oe+" "+ue+" "+se+" = a_"+se+`;
#else
    `+oe+" "+ue+" "+se+" = u_"+se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+se+`
    `+oe+" "+ue+" "+se+" = unpack_mix_"+we+"(a_"+se+", u_"+se+`_t);
#else
    `+oe+" "+ue+" "+se+" = u_"+se+`;
#endif
`}),staticAttributes:f,staticUniforms:P}}var zo=Object.freeze({__proto__:null,prelude:rr,background:ds,backgroundPattern:js,circle:wl,clippingMask:Gl,heatmap:Vs,heatmapTexture:fs,collisionBox:Ns,collisionCircle:qs,debug:Zs,fill:$l,fillOutline:Tu,fillOutlinePattern:Wo,fillPattern:Gs,fillExtrusion:Su,fillExtrusionPattern:Sn,hillshadePrepare:Xl,hillshade:ka,line:Aa,lineGradient:oa,linePattern:aa,lineSDF:go,raster:za,symbolIcon:Ca,symbolSDF:Ho,symbolTextAndIcon:Pa}),sa=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Wl(l){for(var c=[],u=0;u<l.length;u++)if(l[u]!==null){var f=l[u].split(" ");c.push(f.pop())}return c}sa.prototype.bind=function(l,c,u,f,T,z,P,B){this.context=l;for(var G=this.boundPaintVertexBuffers.length!==f.length,H=0;!G&&H<f.length;H++)this.boundPaintVertexBuffers[H]!==f[H]&&(G=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===u&&!G&&this.boundIndexBuffer===T&&this.boundVertexOffset===z&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===B?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),T&&T.dynamicDraw&&T.bind(),B&&B.bind()):this.freshBind(c,u,f,T,z,P,B)},sa.prototype.freshBind=function(l,c,u,f,T,z,P){var B,G=l.numAttributes,H=this.context,oe=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=l,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=z,this.boundDynamicVertexBuffer2=P;else{B=H.currentNumAttributes||0;for(var ue=G;ue<B;ue++)oe.disableVertexAttribArray(ue)}c.enableAttributes(oe,l);for(var se=0,Se=u;se<Se.length;se+=1)Se[se].enableAttributes(oe,l);z&&z.enableAttributes(oe,l),P&&P.enableAttributes(oe,l),c.bind(),c.setVertexAttribPointers(oe,l,T);for(var we=0,Ae=u;we<Ae.length;we+=1){var ge=Ae[we];ge.bind(),ge.setVertexAttribPointers(oe,l,T)}z&&(z.bind(),z.setVertexAttribPointers(oe,l,T)),f&&f.bind(),P&&(P.bind(),P.setVertexAttribPointers(oe,l,T)),H.currentNumAttributes=G},sa.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Tl=function(l,c,u,f,T,z){var P=l.gl;this.program=P.createProgram();for(var B=Wl(u.staticAttributes),G=f?f.getBinderAttributes():[],H=B.concat(G),oe=u.staticUniforms?Wl(u.staticUniforms):[],ue=f?f.getBinderUniforms():[],se=[],Se=0,we=oe.concat(ue);Se<we.length;Se+=1){var Ae=we[Se];se.indexOf(Ae)<0&&se.push(Ae)}var ge=f?f.defines():[];z&&ge.push("#define OVERDRAW_INSPECTOR;");var Ee=ge.concat(rr.fragmentSource,u.fragmentSource).join(`
`),Re=ge.concat(rr.vertexSource,u.vertexSource).join(`
`),je=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(je,Ee),P.compileShader(je),P.attachShader(this.program,je);var He=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(He,Re),P.compileShader(He),P.attachShader(this.program,He),this.attributes={};var Ye={};this.numAttributes=H.length;for(var et=0;et<this.numAttributes;et++)H[et]&&(P.bindAttribLocation(this.program,et,H[et]),this.attributes[H[et]]=et);P.linkProgram(this.program),P.deleteShader(He),P.deleteShader(je);for(var st=0;st<se.length;st++){var vt=se[st];if(vt&&!Ye[vt]){var mt=P.getUniformLocation(this.program,vt);mt&&(Ye[vt]=mt)}}this.fixedUniforms=T(l,Ye),this.binderUniforms=f?f.getUniforms(l,Ye):[]}}};function Ei(l,c,u){var f=1/Dn(u,1,c.transform.tileZoom),T=Math.pow(2,u.tileID.overscaledZ),z=u.tileSize*Math.pow(2,c.transform.tileZoom)/T,P=z*(u.tileID.canonical.x+u.tileID.wrap*T),B=z*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,B>>16],u_pixel_coord_lower:[65535&P,65535&B]}}Tl.prototype.draw=function(l,c,u,f,T,z,P,B,G,H,oe,ue,se,Se,we,Ae){var ge,Ee=l.gl;if(!this.failedToCreate){for(var Re in l.program.set(this.program),l.setDepthMode(u),l.setStencilMode(f),l.setColorMode(T),l.setCullFace(z),this.fixedUniforms)this.fixedUniforms[Re].set(P[Re]);Se&&Se.setUniforms(l,this.binderUniforms,ue,{zoom:se});for(var je=(ge={},ge[Ee.LINES]=2,ge[Ee.TRIANGLES]=3,ge[Ee.LINE_STRIP]=1,ge)[c],He=0,Ye=oe.get();He<Ye.length;He+=1){var et=Ye[He],st=et.vaos||(et.vaos={});(st[B]||(st[B]=new sa)).bind(l,this,G,Se?Se.getPaintVertexBuffers():[],H,et.vertexOffset,we,Ae),Ee.drawElements(c,et.primitiveLength*je,Ee.UNSIGNED_SHORT,et.primitiveOffset*je*2)}}};var $s=function(l,c,u,f){var T=c.style.light,z=T.properties.get("position"),P=[z.x,z.y,z.z],B=y.create$1();T.properties.get("anchor")==="viewport"&&y.fromRotation(B,-c.transform.angle),y.transformMat3(P,P,B);var G=T.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+u,u_opacity:f}},dr=function(l,c,u,f,T,z,P){return y.extend($s(l,c,u,f),Ei(z,c,P),{u_height_factor:-Math.pow(2,T.overscaledZ)/P.tileSize/8})},Fo=function(l){return{u_matrix:l}},ur=function(l,c,u,f){return y.extend(Fo(l),Ei(u,c,f))},Cr=function(l,c){return{u_matrix:l,u_world:c}},Xs=function(l,c,u,f,T){return y.extend(ur(l,c,u,f),{u_world:T})},Sl=function(l,c,u,f){var T,z,P=l.transform;if(f.paint.get("circle-pitch-alignment")==="map"){var B=Dn(u,1,P.zoom);T=!0,z=[B,B]}else T=!1,z=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(c.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+T,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:z}},Hl=function(l,c,u){var f=Dn(u,1,c.zoom),T=Math.pow(2,c.zoom-u.tileID.overscaledZ),z=u.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[c.pixelsToGLUnits[0]/(f*T),c.pixelsToGLUnits[1]/(f*T)],u_overscale_factor:z}},la=function(l,c,u){return{u_matrix:l,u_inv_matrix:c,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}},ms=function(l,c,u){return u===void 0&&(u=1),{u_matrix:l,u_color:c,u_overlay:0,u_overlay_scale:u}},Ko=function(l){return{u_matrix:l}},ua=function(l,c,u,f){return{u_matrix:l,u_extrude_scale:Dn(c,1,u),u_intensity:f}},Na=function(l,c,u){var f=l.transform;return{u_matrix:Za(l,c,u),u_ratio:1/Dn(c,1,f.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Ws=function(l,c,u,f){return y.extend(Na(l,c,u),{u_image:0,u_image_height:f})},nr=function(l,c,u,f){var T=l.transform,z=Co(c,T);return{u_matrix:Za(l,c,u),u_texsize:c.imageAtlasTexture.size,u_ratio:1/Dn(c,1,T.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[z,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},qa=function(l,c,u,f,T){var z=l.lineAtlas,P=Co(c,l.transform),B=u.layout.get("line-cap")==="round",G=z.getDash(f.from,B),H=z.getDash(f.to,B),oe=G.width*T.fromScale,ue=H.width*T.toScale;return y.extend(Na(l,c,u),{u_patternscale_a:[P/oe,-G.height/2],u_patternscale_b:[P/ue,-H.height/2],u_sdfgamma:z.width/(256*Math.min(oe,ue)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:H.y,u_mix:T.t})};function Co(l,c){return 1/Dn(l,1,c.tileZoom)}function Za(l,c,u){return l.translatePosMatrix(c.tileID.posMatrix,c,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}var Iu=function(l,c,u,f,T){return{u_matrix:l,u_tl_parent:c,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(P=T.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(z=T.paint.get("raster-contrast"),z>0?1/(1-z):1+z),u_spin_weights:Eu(T.paint.get("raster-hue-rotate"))};var z,P};function Eu(l){l*=Math.PI/180;var c=Math.sin(l),u=Math.cos(l);return[(2*u+1)/3,(-Math.sqrt(3)*c-u+1)/3,(Math.sqrt(3)*c-u+1)/3]}var Jo,Hs=function(l,c,u,f,T,z,P,B,G,H){var oe=T.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:oe.width/oe.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:z,u_label_plane_matrix:P,u_coord_matrix:B,u_is_text:+G,u_pitch_with_map:+f,u_texsize:H,u_texture:0}},Ma=function(l,c,u,f,T,z,P,B,G,H,oe){var ue=T.transform;return y.extend(Hs(l,c,u,f,T,z,P,B,G,H),{u_gamma_scale:f?Math.cos(ue._pitch)*ue.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+oe})},Ks=function(l,c,u,f,T,z,P,B,G,H){return y.extend(Ma(l,c,u,f,T,z,P,B,!0,G,!0),{u_texsize_icon:H,u_texture_icon:1})},Ga=function(l,c,u){return{u_matrix:l,u_opacity:c,u_color:u}},Da=function(l,c,u,f,T,z){return y.extend(function(P,B,G,H){var oe=G.imageManager.getPattern(P.from.toString()),ue=G.imageManager.getPattern(P.to.toString()),se=G.imageManager.getPixelSize(),Se=se.width,we=se.height,Ae=Math.pow(2,H.tileID.overscaledZ),ge=H.tileSize*Math.pow(2,G.transform.tileZoom)/Ae,Ee=ge*(H.tileID.canonical.x+H.tileID.wrap*Ae),Re=ge*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:ue.tl,u_pattern_br_b:ue.br,u_texsize:[Se,we],u_mix:B.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:ue.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Dn(H,1,G.transform.tileZoom),u_pixel_coord_upper:[Ee>>16,Re>>16],u_pixel_coord_lower:[65535&Ee,65535&Re]}}(f,z,u,T),{u_matrix:l,u_opacity:c})},$a={fillExtrusion:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_lightpos:new y.Uniform3f(l,c.u_lightpos),u_lightintensity:new y.Uniform1f(l,c.u_lightintensity),u_lightcolor:new y.Uniform3f(l,c.u_lightcolor),u_vertical_gradient:new y.Uniform1f(l,c.u_vertical_gradient),u_opacity:new y.Uniform1f(l,c.u_opacity)}},fillExtrusionPattern:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_lightpos:new y.Uniform3f(l,c.u_lightpos),u_lightintensity:new y.Uniform1f(l,c.u_lightintensity),u_lightcolor:new y.Uniform3f(l,c.u_lightcolor),u_vertical_gradient:new y.Uniform1f(l,c.u_vertical_gradient),u_height_factor:new y.Uniform1f(l,c.u_height_factor),u_image:new y.Uniform1i(l,c.u_image),u_texsize:new y.Uniform2f(l,c.u_texsize),u_pixel_coord_upper:new y.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(l,c.u_pixel_coord_lower),u_scale:new y.Uniform3f(l,c.u_scale),u_fade:new y.Uniform1f(l,c.u_fade),u_opacity:new y.Uniform1f(l,c.u_opacity)}},fill:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix)}},fillPattern:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_image:new y.Uniform1i(l,c.u_image),u_texsize:new y.Uniform2f(l,c.u_texsize),u_pixel_coord_upper:new y.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(l,c.u_pixel_coord_lower),u_scale:new y.Uniform3f(l,c.u_scale),u_fade:new y.Uniform1f(l,c.u_fade)}},fillOutline:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_world:new y.Uniform2f(l,c.u_world)}},fillOutlinePattern:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_world:new y.Uniform2f(l,c.u_world),u_image:new y.Uniform1i(l,c.u_image),u_texsize:new y.Uniform2f(l,c.u_texsize),u_pixel_coord_upper:new y.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(l,c.u_pixel_coord_lower),u_scale:new y.Uniform3f(l,c.u_scale),u_fade:new y.Uniform1f(l,c.u_fade)}},circle:function(l,c){return{u_camera_to_center_distance:new y.Uniform1f(l,c.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(l,c.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(l,c.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(l,c.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(l,c.u_matrix)}},collisionBox:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_camera_to_center_distance:new y.Uniform1f(l,c.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(l,c.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(l,c.u_extrude_scale),u_overscale_factor:new y.Uniform1f(l,c.u_overscale_factor)}},collisionCircle:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_inv_matrix:new y.UniformMatrix4f(l,c.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(l,c.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(l,c.u_viewport_size)}},debug:function(l,c){return{u_color:new y.UniformColor(l,c.u_color),u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_overlay:new y.Uniform1i(l,c.u_overlay),u_overlay_scale:new y.Uniform1f(l,c.u_overlay_scale)}},clippingMask:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix)}},heatmap:function(l,c){return{u_extrude_scale:new y.Uniform1f(l,c.u_extrude_scale),u_intensity:new y.Uniform1f(l,c.u_intensity),u_matrix:new y.UniformMatrix4f(l,c.u_matrix)}},heatmapTexture:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_world:new y.Uniform2f(l,c.u_world),u_image:new y.Uniform1i(l,c.u_image),u_color_ramp:new y.Uniform1i(l,c.u_color_ramp),u_opacity:new y.Uniform1f(l,c.u_opacity)}},hillshade:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_image:new y.Uniform1i(l,c.u_image),u_latrange:new y.Uniform2f(l,c.u_latrange),u_light:new y.Uniform2f(l,c.u_light),u_shadow:new y.UniformColor(l,c.u_shadow),u_highlight:new y.UniformColor(l,c.u_highlight),u_accent:new y.UniformColor(l,c.u_accent)}},hillshadePrepare:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_image:new y.Uniform1i(l,c.u_image),u_dimension:new y.Uniform2f(l,c.u_dimension),u_zoom:new y.Uniform1f(l,c.u_zoom),u_unpack:new y.Uniform4f(l,c.u_unpack)}},line:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_ratio:new y.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(l,c.u_units_to_pixels)}},lineGradient:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_ratio:new y.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(l,c.u_units_to_pixels),u_image:new y.Uniform1i(l,c.u_image),u_image_height:new y.Uniform1f(l,c.u_image_height)}},linePattern:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_texsize:new y.Uniform2f(l,c.u_texsize),u_ratio:new y.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_image:new y.Uniform1i(l,c.u_image),u_units_to_pixels:new y.Uniform2f(l,c.u_units_to_pixels),u_scale:new y.Uniform3f(l,c.u_scale),u_fade:new y.Uniform1f(l,c.u_fade)}},lineSDF:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_ratio:new y.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(l,c.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(l,c.u_patternscale_a),u_patternscale_b:new y.Uniform2f(l,c.u_patternscale_b),u_sdfgamma:new y.Uniform1f(l,c.u_sdfgamma),u_image:new y.Uniform1i(l,c.u_image),u_tex_y_a:new y.Uniform1f(l,c.u_tex_y_a),u_tex_y_b:new y.Uniform1f(l,c.u_tex_y_b),u_mix:new y.Uniform1f(l,c.u_mix)}},raster:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_tl_parent:new y.Uniform2f(l,c.u_tl_parent),u_scale_parent:new y.Uniform1f(l,c.u_scale_parent),u_buffer_scale:new y.Uniform1f(l,c.u_buffer_scale),u_fade_t:new y.Uniform1f(l,c.u_fade_t),u_opacity:new y.Uniform1f(l,c.u_opacity),u_image0:new y.Uniform1i(l,c.u_image0),u_image1:new y.Uniform1i(l,c.u_image1),u_brightness_low:new y.Uniform1f(l,c.u_brightness_low),u_brightness_high:new y.Uniform1f(l,c.u_brightness_high),u_saturation_factor:new y.Uniform1f(l,c.u_saturation_factor),u_contrast_factor:new y.Uniform1f(l,c.u_contrast_factor),u_spin_weights:new y.Uniform3f(l,c.u_spin_weights)}},symbolIcon:function(l,c){return{u_is_size_zoom_constant:new y.Uniform1i(l,c.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(l,c.u_is_size_feature_constant),u_size_t:new y.Uniform1f(l,c.u_size_t),u_size:new y.Uniform1f(l,c.u_size),u_camera_to_center_distance:new y.Uniform1f(l,c.u_camera_to_center_distance),u_pitch:new y.Uniform1f(l,c.u_pitch),u_rotate_symbol:new y.Uniform1i(l,c.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(l,c.u_aspect_ratio),u_fade_change:new y.Uniform1f(l,c.u_fade_change),u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(l,c.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(l,c.u_coord_matrix),u_is_text:new y.Uniform1i(l,c.u_is_text),u_pitch_with_map:new y.Uniform1i(l,c.u_pitch_with_map),u_texsize:new y.Uniform2f(l,c.u_texsize),u_texture:new y.Uniform1i(l,c.u_texture)}},symbolSDF:function(l,c){return{u_is_size_zoom_constant:new y.Uniform1i(l,c.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(l,c.u_is_size_feature_constant),u_size_t:new y.Uniform1f(l,c.u_size_t),u_size:new y.Uniform1f(l,c.u_size),u_camera_to_center_distance:new y.Uniform1f(l,c.u_camera_to_center_distance),u_pitch:new y.Uniform1f(l,c.u_pitch),u_rotate_symbol:new y.Uniform1i(l,c.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(l,c.u_aspect_ratio),u_fade_change:new y.Uniform1f(l,c.u_fade_change),u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(l,c.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(l,c.u_coord_matrix),u_is_text:new y.Uniform1i(l,c.u_is_text),u_pitch_with_map:new y.Uniform1i(l,c.u_pitch_with_map),u_texsize:new y.Uniform2f(l,c.u_texsize),u_texture:new y.Uniform1i(l,c.u_texture),u_gamma_scale:new y.Uniform1f(l,c.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(l,c.u_is_halo)}},symbolTextAndIcon:function(l,c){return{u_is_size_zoom_constant:new y.Uniform1i(l,c.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(l,c.u_is_size_feature_constant),u_size_t:new y.Uniform1f(l,c.u_size_t),u_size:new y.Uniform1f(l,c.u_size),u_camera_to_center_distance:new y.Uniform1f(l,c.u_camera_to_center_distance),u_pitch:new y.Uniform1f(l,c.u_pitch),u_rotate_symbol:new y.Uniform1i(l,c.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(l,c.u_aspect_ratio),u_fade_change:new y.Uniform1f(l,c.u_fade_change),u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(l,c.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(l,c.u_coord_matrix),u_is_text:new y.Uniform1i(l,c.u_is_text),u_pitch_with_map:new y.Uniform1i(l,c.u_pitch_with_map),u_texsize:new y.Uniform2f(l,c.u_texsize),u_texsize_icon:new y.Uniform2f(l,c.u_texsize_icon),u_texture:new y.Uniform1i(l,c.u_texture),u_texture_icon:new y.Uniform1i(l,c.u_texture_icon),u_gamma_scale:new y.Uniform1f(l,c.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(l,c.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(l,c.u_is_halo)}},background:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_opacity:new y.Uniform1f(l,c.u_opacity),u_color:new y.UniformColor(l,c.u_color)}},backgroundPattern:function(l,c){return{u_matrix:new y.UniformMatrix4f(l,c.u_matrix),u_opacity:new y.Uniform1f(l,c.u_opacity),u_image:new y.Uniform1i(l,c.u_image),u_pattern_tl_a:new y.Uniform2f(l,c.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(l,c.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(l,c.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(l,c.u_pattern_br_b),u_texsize:new y.Uniform2f(l,c.u_texsize),u_mix:new y.Uniform1f(l,c.u_mix),u_pattern_size_a:new y.Uniform2f(l,c.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(l,c.u_pattern_size_b),u_scale_a:new y.Uniform1f(l,c.u_scale_a),u_scale_b:new y.Uniform1f(l,c.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(l,c.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(l,c.u_tile_units_to_pixels)}}};function Xa(l,c,u,f,T,z,P){for(var B=l.context,G=B.gl,H=l.useProgram("collisionBox"),oe=[],ue=0,se=0,Se=0;Se<f.length;Se++){var we=f[Se],Ae=c.getTile(we),ge=Ae.getBucket(u);if(ge){var Ee=we.posMatrix;T[0]===0&&T[1]===0||(Ee=l.translatePosMatrix(we.posMatrix,Ae,T,z));var Re=P?ge.textCollisionBox:ge.iconCollisionBox,je=ge.collisionCircleArray;if(je.length>0){var He=y.create(),Ye=Ee;y.mul(He,ge.placementInvProjMatrix,l.transform.glCoordMatrix),y.mul(He,He,ge.placementViewportMatrix),oe.push({circleArray:je,circleOffset:se,transform:Ye,invTransform:He}),se=ue+=je.length/4}Re&&H.draw(B,G.LINES,he.disabled,be.disabled,l.colorModeForRenderPass(),Fe.disabled,Hl(Ee,l.transform,Ae),u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,l.transform.zoom,null,null,Re.collisionVertexBuffer)}}if(P&&oe.length){var et=l.useProgram("collisionCircle"),st=new y.StructArrayLayout2f1f2i16;st.resize(4*ue),st._trim();for(var vt=0,mt=0,Pt=oe;mt<Pt.length;mt+=1)for(var $t=Pt[mt],ei=0;ei<$t.circleArray.length/4;ei++){var Nt=4*ei,Bi=$t.circleArray[Nt+0],jt=$t.circleArray[Nt+1],bi=$t.circleArray[Nt+2],Di=$t.circleArray[Nt+3];st.emplace(vt++,Bi,jt,bi,Di,0),st.emplace(vt++,Bi,jt,bi,Di,1),st.emplace(vt++,Bi,jt,bi,Di,2),st.emplace(vt++,Bi,jt,bi,Di,3)}(!Jo||Jo.length<2*ue)&&(Jo=function(Jr){var un=2*Jr,In=new y.StructArrayLayout3ui6;In.resize(un),In._trim();for(var vn=0;vn<un;vn++){var Vi=6*vn;In.uint16[Vi+0]=4*vn+0,In.uint16[Vi+1]=4*vn+1,In.uint16[Vi+2]=4*vn+2,In.uint16[Vi+3]=4*vn+2,In.uint16[Vi+4]=4*vn+3,In.uint16[Vi+5]=4*vn+0}return In}(ue));for(var vi=B.createIndexBuffer(Jo,!0),di=B.createVertexBuffer(st,y.collisionCircleLayout.members,!0),hi=0,ni=oe;hi<ni.length;hi+=1){var Xt=ni[hi],Hi=la(Xt.transform,Xt.invTransform,l.transform);et.draw(B,G.TRIANGLES,he.disabled,be.disabled,l.colorModeForRenderPass(),Fe.disabled,Hi,u.id,di,vi,y.SegmentVector.simpleSegment(0,2*Xt.circleOffset,Xt.circleArray.length,Xt.circleArray.length/2),null,l.transform.zoom,null,null,null)}di.destroy(),vi.destroy()}}var Wa=y.identity(new Float32Array(16));function ao(l,c,u,f,T,z){var P=y.getAnchorAlignment(l),B=-(P.horizontalAlign-.5)*c,G=-(P.verticalAlign-.5)*u,H=y.evaluateVariableOffset(l,f);return new y.Point((B/T+H[0])*z,(G/T+H[1])*z)}function Js(l,c,u,f,T,z,P,B,G,H,oe){var ue=l.text.placedSymbolArray,se=l.text.dynamicLayoutVertexArray,Se=l.icon.dynamicLayoutVertexArray,we={};se.clear();for(var Ae=0;Ae<ue.length;Ae++){var ge=ue.get(Ae),Ee=ge.hidden||!ge.crossTileID||l.allowVerticalPlacement&&!ge.placedOrientation?null:f[ge.crossTileID];if(Ee){var Re=new y.Point(ge.anchorX,ge.anchorY),je=It(Re,u?B:P),He=Rr(z.cameraToCenterDistance,je.signedDistanceFromCamera),Ye=T.evaluateSizeForFeature(l.textSizeData,H,ge)*He/y.ONE_EM;u&&(Ye*=l.tilePixelRatio/G);for(var et=ao(Ee.anchor,Ee.width,Ee.height,Ee.textOffset,Ee.textBoxScale,Ye),st=u?It(Re.add(et),P).point:je.point.add(c?et.rotate(-z.angle):et),vt=l.allowVerticalPlacement&&ge.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,mt=0;mt<ge.numGlyphs;mt++)y.addDynamicAttributes(se,st,vt);oe&&ge.associatedIconIndex>=0&&(we[ge.associatedIconIndex]={shiftedAnchor:st,angle:vt})}else $o(ge.numGlyphs,se)}if(oe){Se.clear();for(var Pt=l.icon.placedSymbolArray,$t=0;$t<Pt.length;$t++){var ei=Pt.get($t);if(ei.hidden)$o(ei.numGlyphs,Se);else{var Nt=we[$t];if(Nt)for(var Bi=0;Bi<ei.numGlyphs;Bi++)y.addDynamicAttributes(Se,Nt.shiftedAnchor,Nt.angle);else $o(ei.numGlyphs,Se)}}l.icon.dynamicLayoutVertexBuffer.updateData(Se)}l.text.dynamicLayoutVertexBuffer.updateData(se)}function Ha(l,c,u){return u.iconsInText&&c?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Ka(l,c,u,f,T,z,P,B,G,H,oe,ue){for(var se=l.context,Se=se.gl,we=l.transform,Ae=B==="map",ge=G==="map",Ee=Ae&&u.layout.get("symbol-placement")!=="point",Re=Ae&&!ge&&!Ee,je=!u.layout.get("symbol-sort-key").isConstant(),He=!1,Ye=l.depthModeForSublayer(0,he.ReadOnly),et=u.layout.get("text-variable-anchor"),st=[],vt=0,mt=f;vt<mt.length;vt+=1){var Pt=mt[vt],$t=c.getTile(Pt),ei=$t.getBucket(u);if(ei){var Nt=T?ei.text:ei.icon;if(Nt&&Nt.segments.get().length){var Bi=Nt.programConfigurations.get(u.id),jt=T||ei.sdfIcons,bi=T?ei.textSizeData:ei.iconSizeData,Di=ge||we.pitch!==0,vi=l.useProgram(Ha(jt,T,ei),Bi),di=y.evaluateSizeForZoom(bi,we.zoom),hi=void 0,ni=[0,0],Xt=void 0,Hi=void 0,Jr=null,un=void 0;if(T)Xt=$t.glyphAtlasTexture,Hi=Se.LINEAR,hi=$t.glyphAtlasTexture.size,ei.iconsInText&&(ni=$t.imageAtlasTexture.size,Jr=$t.imageAtlasTexture,un=Di||l.options.rotating||l.options.zooming||bi.kind==="composite"||bi.kind==="camera"?Se.LINEAR:Se.NEAREST);else{var In=u.layout.get("icon-size").constantOr(0)!==1||ei.iconsNeedLinear;Xt=$t.imageAtlasTexture,Hi=jt||l.options.rotating||l.options.zooming||In||Di?Se.LINEAR:Se.NEAREST,hi=$t.imageAtlasTexture.size}var vn=Dn($t,1,l.transform.zoom),Vi=ii(Pt.posMatrix,ge,Ae,l.transform,vn),On=qt(Pt.posMatrix,ge,Ae,l.transform,vn),ga=et&&ei.hasTextData(),cn=u.layout.get("icon-text-fit")!=="none"&&ga&&ei.hasIconData();Ee&&Vr(ei,Pt.posMatrix,l,T,Vi,On,ge,H);var hn=l.translatePosMatrix(Pt.posMatrix,$t,z,P),Oo=Ee||T&&et||cn?Wa:Vi,vo=l.translatePosMatrix(On,$t,z,P,!0),Au=jt&&u.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ss={program:vi,buffers:Nt,uniformValues:jt?ei.iconsInText?Ks(bi.kind,di,Re,ge,l,hn,Oo,vo,hi,ni):Ma(bi.kind,di,Re,ge,l,hn,Oo,vo,T,hi,!0):Hs(bi.kind,di,Re,ge,l,hn,Oo,vo,T,hi),atlasTexture:Xt,atlasTextureIcon:Jr,atlasInterpolation:Hi,atlasInterpolationIcon:un,isSDF:jt,hasHalo:Au};if(je&&ei.canOverlap){He=!0;for(var nl=0,ol=Nt.segments.get();nl<ol.length;nl+=1){var al=ol[nl];st.push({segments:new y.SegmentVector([al]),sortKey:al.sortKey,state:Ss})}}else st.push({segments:Nt.segments,sortKey:0,state:Ss})}}}He&&st.sort(function(_a,va){return _a.sortKey-va.sortKey});for(var El=0,Qo=st;El<Qo.length;El+=1){var sl=Qo[El],pn=sl.state;if(se.activeTexture.set(Se.TEXTURE0),pn.atlasTexture.bind(pn.atlasInterpolation,Se.CLAMP_TO_EDGE),pn.atlasTextureIcon&&(se.activeTexture.set(Se.TEXTURE1),pn.atlasTextureIcon&&pn.atlasTextureIcon.bind(pn.atlasInterpolationIcon,Se.CLAMP_TO_EDGE)),pn.isSDF){var Ro=pn.uniformValues;pn.hasHalo&&(Ro.u_is_halo=1,La(pn.buffers,sl.segments,u,l,pn.program,Ye,oe,ue,Ro)),Ro.u_is_halo=0}La(pn.buffers,sl.segments,u,l,pn.program,Ye,oe,ue,pn.uniformValues)}}function La(l,c,u,f,T,z,P,B,G){var H=f.context;T.draw(H,H.gl.TRIANGLES,z,P,B,Fe.disabled,G,u.id,l.layoutVertexBuffer,l.indexBuffer,c,u.paint,f.transform.zoom,l.programConfigurations.get(u.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function ca(l,c,u,f,T,z,P){var B,G,H,oe,ue,se=l.context.gl,Se=u.paint.get("fill-pattern"),we=Se&&Se.constantOr(1),Ae=u.getCrossfadeParameters();P?(G=we&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=se.LINES):(G=we?"fillPattern":"fill",B=se.TRIANGLES);for(var ge=0,Ee=f;ge<Ee.length;ge+=1){var Re=Ee[ge],je=c.getTile(Re);if(!we||je.patternsLoaded()){var He=je.getBucket(u);if(He){var Ye=He.programConfigurations.get(u.id),et=l.useProgram(G,Ye);we&&(l.context.activeTexture.set(se.TEXTURE0),je.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Ye.updatePaintBuffers(Ae));var st=Se.constantOr(null);if(st&&je.imageAtlas){var vt=je.imageAtlas,mt=vt.patternPositions[st.to.toString()],Pt=vt.patternPositions[st.from.toString()];mt&&Pt&&Ye.setConstantPatternPositions(mt,Pt)}var $t=l.translatePosMatrix(Re.posMatrix,je,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(P){oe=He.indexBuffer2,ue=He.segments2;var ei=[se.drawingBufferWidth,se.drawingBufferHeight];H=G==="fillOutlinePattern"&&we?Xs($t,l,Ae,je,ei):Cr($t,ei)}else oe=He.indexBuffer,ue=He.segments,H=we?ur($t,l,Ae,je):Fo($t);et.draw(l.context,B,T,l.stencilModeForClipping(Re),z,Fe.disabled,H,u.id,He.layoutVertexBuffer,oe,ue,u.paint,l.transform.zoom,Ye)}}}}function ys(l,c,u,f,T,z,P){for(var B=l.context,G=B.gl,H=u.paint.get("fill-extrusion-pattern"),oe=H.constantOr(1),ue=u.getCrossfadeParameters(),se=u.paint.get("fill-extrusion-opacity"),Se=0,we=f;Se<we.length;Se+=1){var Ae=we[Se],ge=c.getTile(Ae),Ee=ge.getBucket(u);if(Ee){var Re=Ee.programConfigurations.get(u.id),je=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",Re);oe&&(l.context.activeTexture.set(G.TEXTURE0),ge.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Re.updatePaintBuffers(ue));var He=H.constantOr(null);if(He&&ge.imageAtlas){var Ye=ge.imageAtlas,et=Ye.patternPositions[He.to.toString()],st=Ye.patternPositions[He.from.toString()];et&&st&&Re.setConstantPatternPositions(et,st)}var vt=l.translatePosMatrix(Ae.posMatrix,ge,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),mt=u.paint.get("fill-extrusion-vertical-gradient"),Pt=oe?dr(vt,l,mt,se,Ae,ue,ge):$s(vt,l,mt,se);je.draw(B,B.gl.TRIANGLES,T,z,P,Fe.backCCW,Pt,u.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,u.paint,l.transform.zoom,Re)}}}function ku(l,c,u,f,T,z){var P=l.context,B=P.gl,G=c.fbo;if(G){var H=l.useProgram("hillshade");P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get());var oe=function(ue,se,Se){var we=Se.paint.get("hillshade-shadow-color"),Ae=Se.paint.get("hillshade-highlight-color"),ge=Se.paint.get("hillshade-accent-color"),Ee=Se.paint.get("hillshade-illumination-direction")*(Math.PI/180);Se.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ee-=ue.transform.angle);var Re,je,He,Ye=!ue.options.moving;return{u_matrix:ue.transform.calculatePosMatrix(se.tileID.toUnwrapped(),Ye),u_image:0,u_latrange:(Re=se.tileID,je=Math.pow(2,Re.canonical.z),He=Re.canonical.y,[new y.MercatorCoordinate(0,He/je).toLngLat().lat,new y.MercatorCoordinate(0,(He+1)/je).toLngLat().lat]),u_light:[Se.paint.get("hillshade-exaggeration"),Ee],u_shadow:we,u_highlight:Ae,u_accent:ge}}(l,c,u);H.draw(P,B.TRIANGLES,f,T,z,Fe.disabled,oe,u.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Ys(l,c,u,f,T,z){var P=l.context,B=P.gl,G=c.dem;if(G&&G.data){var H=G.dim,oe=G.stride,ue=G.getPixels();if(P.activeTexture.set(B.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||l.getTileTexture(oe),c.demTexture){var se=c.demTexture;se.update(ue,{premultiply:!1}),se.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else c.demTexture=new y.Texture(P,ue,B.RGBA,{premultiply:!1}),c.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);P.activeTexture.set(B.TEXTURE0);var Se=c.fbo;if(!Se){var we=new y.Texture(P,{width:H,height:H,data:null},B.RGBA);we.bind(B.LINEAR,B.CLAMP_TO_EDGE),(Se=c.fbo=P.createFramebuffer(H,H,!0)).colorAttachment.set(we.texture)}P.bindFramebuffer.set(Se.framebuffer),P.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(P,B.TRIANGLES,f,T,z,Fe.disabled,function(Ae,ge){var Ee=ge.stride,Re=y.create();return y.ortho(Re,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Re,Re,[0,-y.EXTENT,0]),{u_matrix:Re,u_image:1,u_dimension:[Ee,Ee],u_zoom:Ae.overscaledZ,u_unpack:ge.getUnpackVector()}}(c.tileID,G),u.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function gs(l,c,u,f,T){var z=f.paint.get("raster-fade-duration");if(z>0){var P=y.browser.now(),B=(P-l.timeAdded)/z,G=c?(P-c.timeAdded)/z:-1,H=u.getSource(),oe=T.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ue=!c||Math.abs(c.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),se=ue&&l.refreshedUponExpiration?1:y.clamp(ue?B:1-G,0,1);return l.refreshedUponExpiration&&B>=1&&(l.refreshedUponExpiration=!1),c?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}var Qs=new y.Color(1,0,0,1),Ja=new y.Color(0,1,0,1),_s=new y.Color(0,0,1,1),so=new y.Color(1,0,1,1),Rn=new y.Color(0,1,1,1);function Il(l,c,u,f){vs(l,0,c+u/2,l.transform.width,u,f)}function ha(l,c,u,f){vs(l,c-u/2,0,u,l.transform.height,f)}function vs(l,c,u,f,T,z){var P=l.context,B=P.gl;B.enable(B.SCISSOR_TEST),B.scissor(c*y.browser.devicePixelRatio,u*y.browser.devicePixelRatio,f*y.browser.devicePixelRatio,T*y.browser.devicePixelRatio),P.clear({color:z}),B.disable(B.SCISSOR_TEST)}function Ya(l,c,u){var f=l.context,T=f.gl,z=u.posMatrix,P=l.useProgram("debug"),B=he.disabled,G=be.disabled,H=l.colorModeForRenderPass();f.activeTexture.set(T.TEXTURE0),l.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),P.draw(f,T.LINE_STRIP,B,G,H,Fe.disabled,ms(z,y.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=c.getTileByID(u.key).latestRawTileData,ue=Math.floor((oe&&oe.byteLength||0)/1024),se=c.getTile(u).tileSize,Se=512/Math.min(se,512)*(u.overscaledZ/l.transform.zoom)*.5,we=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(we+=" => "+u.overscaledZ),function(Ae,ge){Ae.initDebugOverlayCanvas();var Ee=Ae.debugOverlayCanvas,Re=Ae.context.gl,je=Ae.debugOverlayCanvas.getContext("2d");je.clearRect(0,0,Ee.width,Ee.height),je.shadowColor="white",je.shadowBlur=2,je.lineWidth=1.5,je.strokeStyle="white",je.textBaseline="top",je.font="bold 36px Open Sans, sans-serif",je.fillText(ge,5,5),je.strokeText(ge,5,5),Ae.debugOverlayTexture.update(Ee),Ae.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(l,we+" "+ue+"kb"),P.draw(f,T.TRIANGLES,B,G,De.alphaBlended,Fe.disabled,ms(z,y.Color.transparent,Se),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var pa={symbol:function(l,c,u,f,T){if(l.renderPass==="translucent"){var z=be.disabled,P=l.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(B,G,H,oe,ue,se,Se){for(var we=G.transform,Ae=ue==="map",ge=se==="map",Ee=0,Re=B;Ee<Re.length;Ee+=1){var je=Re[Ee],He=oe.getTile(je),Ye=He.getBucket(H);if(Ye&&Ye.text&&Ye.text.segments.get().length){var et=y.evaluateSizeForZoom(Ye.textSizeData,we.zoom),st=Dn(He,1,G.transform.zoom),vt=ii(je.posMatrix,ge,Ae,G.transform,st),mt=H.layout.get("icon-text-fit")!=="none"&&Ye.hasIconData();if(et){var Pt=Math.pow(2,we.zoom-He.tileID.overscaledZ);Js(Ye,Ae,ge,Se,y.symbolSize,we,vt,je.posMatrix,Pt,et,mt)}}}}(f,l,u,c,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),T),u.paint.get("icon-opacity").constantOr(1)!==0&&Ka(l,c,u,f,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),z,P),u.paint.get("text-opacity").constantOr(1)!==0&&Ka(l,c,u,f,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),z,P),c.map.showCollisionBoxes&&(Xa(l,c,u,f,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Xa(l,c,u,f,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))}},circle:function(l,c,u,f){if(l.renderPass==="translucent"){var T=u.paint.get("circle-opacity"),z=u.paint.get("circle-stroke-width"),P=u.paint.get("circle-stroke-opacity"),B=!u.layout.get("circle-sort-key").isConstant();if(T.constantOr(1)!==0||z.constantOr(1)!==0&&P.constantOr(1)!==0){for(var G=l.context,H=G.gl,oe=l.depthModeForSublayer(0,he.ReadOnly),ue=be.disabled,se=l.colorModeForRenderPass(),Se=[],we=0;we<f.length;we++){var Ae=f[we],ge=c.getTile(Ae),Ee=ge.getBucket(u);if(Ee){var Re=Ee.programConfigurations.get(u.id),je={programConfiguration:Re,program:l.useProgram("circle",Re),layoutVertexBuffer:Ee.layoutVertexBuffer,indexBuffer:Ee.indexBuffer,uniformValues:Sl(l,Ae,ge,u)};if(B)for(var He=0,Ye=Ee.segments.get();He<Ye.length;He+=1){var et=Ye[He];Se.push({segments:new y.SegmentVector([et]),sortKey:et.sortKey,state:je})}else Se.push({segments:Ee.segments,sortKey:0,state:je})}}B&&Se.sort(function($t,ei){return $t.sortKey-ei.sortKey});for(var st=0,vt=Se;st<vt.length;st+=1){var mt=vt[st],Pt=mt.state;Pt.program.draw(G,H.TRIANGLES,oe,ue,se,Fe.disabled,Pt.uniformValues,u.id,Pt.layoutVertexBuffer,Pt.indexBuffer,mt.segments,u.paint,l.transform.zoom,Pt.programConfiguration)}}}},heatmap:function(l,c,u,f){if(u.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var T=l.context,z=T.gl,P=be.disabled,B=new De([z.ONE,z.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Se,we,Ae){var ge=Se.gl;Se.activeTexture.set(ge.TEXTURE1),Se.viewport.set([0,0,we.width/4,we.height/4]);var Ee=Ae.heatmapFbo;if(Ee)ge.bindTexture(ge.TEXTURE_2D,Ee.colorAttachment.get()),Se.bindFramebuffer.set(Ee.framebuffer);else{var Re=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,Re),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Ee=Ae.heatmapFbo=Se.createFramebuffer(we.width/4,we.height/4,!1),function(je,He,Ye,et){var st=je.gl;st.texImage2D(st.TEXTURE_2D,0,st.RGBA,He.width/4,He.height/4,0,st.RGBA,je.extRenderToTextureHalfFloat?je.extTextureHalfFloat.HALF_FLOAT_OES:st.UNSIGNED_BYTE,null),et.colorAttachment.set(Ye)}(Se,we,Re,Ee)}})(T,l,u),T.clear({color:y.Color.transparent});for(var G=0;G<f.length;G++){var H=f[G];if(!c.hasRenderableParent(H)){var oe=c.getTile(H),ue=oe.getBucket(u);if(ue){var se=ue.programConfigurations.get(u.id);l.useProgram("heatmap",se).draw(T,z.TRIANGLES,he.disabled,P,B,Fe.disabled,ua(H.posMatrix,oe,l.transform.zoom,u.paint.get("heatmap-intensity")),u.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,u.paint,l.transform.zoom,se)}}}T.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Se,we){var Ae=Se.context,ge=Ae.gl,Ee=we.heatmapFbo;if(Ee){Ae.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Ee.colorAttachment.get()),Ae.activeTexture.set(ge.TEXTURE1);var Re=we.colorRampTexture;Re||(Re=we.colorRampTexture=new y.Texture(Ae,we.colorRamp,ge.RGBA)),Re.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Se.useProgram("heatmapTexture").draw(Ae,ge.TRIANGLES,he.disabled,be.disabled,Se.colorModeForRenderPass(),Fe.disabled,function(je,He,Ye,et){var st=y.create();y.ortho(st,0,je.width,je.height,0,0,1);var vt=je.context.gl;return{u_matrix:st,u_world:[vt.drawingBufferWidth,vt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:He.paint.get("heatmap-opacity")}}(Se,we),we.id,Se.viewportBuffer,Se.quadTriangleIndexBuffer,Se.viewportSegments,we.paint,Se.transform.zoom)}}(l,u))},line:function(l,c,u,f){if(l.renderPass==="translucent"){var T=u.paint.get("line-opacity"),z=u.paint.get("line-width");if(T.constantOr(1)!==0&&z.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,he.ReadOnly),B=l.colorModeForRenderPass(),G=u.paint.get("line-dasharray"),H=u.paint.get("line-pattern"),oe=H.constantOr(1),ue=u.paint.get("line-gradient"),se=u.getCrossfadeParameters(),Se=oe?"linePattern":G?"lineSDF":ue?"lineGradient":"line",we=l.context,Ae=we.gl,ge=!0,Ee=0,Re=f;Ee<Re.length;Ee+=1){var je=Re[Ee],He=c.getTile(je);if(!oe||He.patternsLoaded()){var Ye=He.getBucket(u);if(Ye){var et=Ye.programConfigurations.get(u.id),st=l.context.program.get(),vt=l.useProgram(Se,et),mt=ge||vt.program!==st,Pt=H.constantOr(null);if(Pt&&He.imageAtlas){var $t=He.imageAtlas,ei=$t.patternPositions[Pt.to.toString()],Nt=$t.patternPositions[Pt.from.toString()];ei&&Nt&&et.setConstantPatternPositions(ei,Nt)}var Bi=oe?nr(l,He,u,se):G?qa(l,He,u,G,se):ue?Ws(l,He,u,Ye.lineClipsArray.length):Na(l,He,u);if(oe)we.activeTexture.set(Ae.TEXTURE0),He.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),et.updatePaintBuffers(se);else if(G&&(mt||l.lineAtlas.dirty))we.activeTexture.set(Ae.TEXTURE0),l.lineAtlas.bind(we);else if(ue){var jt=Ye.gradients[u.id],bi=jt.texture;if(u.gradientVersion!==jt.version){var Di=256;if(u.stepInterpolant){var vi=c.getSource().maxzoom,di=je.canonical.z===vi?Math.ceil(1<<l.transform.maxZoom-je.canonical.z):1;Di=y.clamp(y.nextPowerOfTwo(Ye.maxLineLength/y.EXTENT*1024*di),256,we.maxTextureSize)}jt.gradient=y.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Di,image:jt.gradient||void 0,clips:Ye.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new y.Texture(we,jt.gradient,Ae.RGBA),jt.version=u.gradientVersion,bi=jt.texture}we.activeTexture.set(Ae.TEXTURE0),bi.bind(u.stepInterpolant?Ae.NEAREST:Ae.LINEAR,Ae.CLAMP_TO_EDGE)}vt.draw(we,Ae.TRIANGLES,P,l.stencilModeForClipping(je),B,Fe.disabled,Bi,u.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,u.paint,l.transform.zoom,et,Ye.layoutVertexBuffer2),ge=!1}}}}},fill:function(l,c,u,f){var T=u.paint.get("fill-color"),z=u.paint.get("fill-opacity");if(z.constantOr(1)!==0){var P=l.colorModeForRenderPass(),B=u.paint.get("fill-pattern"),G=l.opaquePassEnabledForLayer()&&!B.constantOr(1)&&T.constantOr(y.Color.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===G){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);ca(l,c,u,f,H,P,!1)}if(l.renderPass==="translucent"&&u.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);ca(l,c,u,f,oe,P,!0)}}},"fill-extrusion":function(l,c,u,f){var T=u.paint.get("fill-extrusion-opacity");if(T!==0&&l.renderPass==="translucent"){var z=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(T!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))ys(l,c,u,f,z,be.disabled,De.disabled),ys(l,c,u,f,z,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();ys(l,c,u,f,z,be.disabled,P)}}},hillshade:function(l,c,u,f){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var T=l.context,z=l.depthModeForSublayer(0,he.ReadOnly),P=l.colorModeForRenderPass(),B=l.renderPass==="translucent"?l.stencilConfigForOverlap(f):[{},f],G=B[0],H=0,oe=B[1];H<oe.length;H+=1){var ue=oe[H],se=c.getTile(ue);se.needsHillshadePrepare&&l.renderPass==="offscreen"?Ys(l,se,u,z,be.disabled,P):l.renderPass==="translucent"&&ku(l,se,u,z,G[ue.overscaledZ],P)}T.viewport.set([0,0,l.width,l.height])}},raster:function(l,c,u,f){if(l.renderPass==="translucent"&&u.paint.get("raster-opacity")!==0&&f.length)for(var T=l.context,z=T.gl,P=c.getSource(),B=l.useProgram("raster"),G=l.colorModeForRenderPass(),H=P instanceof si?[{},f]:l.stencilConfigForOverlap(f),oe=H[0],ue=H[1],se=ue[ue.length-1].overscaledZ,Se=!l.options.moving,we=0,Ae=ue;we<Ae.length;we+=1){var ge=Ae[we],Ee=l.depthModeForSublayer(ge.overscaledZ-se,u.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,z.LESS),Re=c.getTile(ge),je=l.transform.calculatePosMatrix(ge.toUnwrapped(),Se);Re.registerFadeDuration(u.paint.get("raster-fade-duration"));var He=c.findLoadedParent(ge,0),Ye=gs(Re,He,c,u,l.transform),et=void 0,st=void 0,vt=u.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;T.activeTexture.set(z.TEXTURE0),Re.texture.bind(vt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(z.TEXTURE1),He?(He.texture.bind(vt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),et=Math.pow(2,He.tileID.overscaledZ-Re.tileID.overscaledZ),st=[Re.tileID.canonical.x*et%1,Re.tileID.canonical.y*et%1]):Re.texture.bind(vt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);var mt=Iu(je,st||[0,0],et||1,Ye,u);P instanceof si?B.draw(T,z.TRIANGLES,Ee,be.disabled,G,Fe.disabled,mt,u.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):B.draw(T,z.TRIANGLES,Ee,oe[ge.overscaledZ],G,Fe.disabled,mt,u.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,c,u){var f=u.paint.get("background-color"),T=u.paint.get("background-opacity");if(T!==0){var z=l.context,P=z.gl,B=l.transform,G=B.tileSize,H=u.paint.get("background-pattern");if(!l.isPatternMissing(H)){var oe=!H&&f.a===1&&T===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var ue=be.disabled,se=l.depthModeForSublayer(0,oe==="opaque"?he.ReadWrite:he.ReadOnly),Se=l.colorModeForRenderPass(),we=l.useProgram(H?"backgroundPattern":"background"),Ae=B.coveringTiles({tileSize:G});H&&(z.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var ge=u.getCrossfadeParameters(),Ee=0,Re=Ae;Ee<Re.length;Ee+=1){var je=Re[Ee],He=l.transform.calculatePosMatrix(je.toUnwrapped()),Ye=H?Da(He,T,l,H,{tileID:je,tileSize:G},ge):Ga(He,T,f);we.draw(z,P.TRIANGLES,se,ue,Se,Fe.disabled,Ye,u.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,c,u){for(var f=0;f<u.length;f++)Ya(l,c,u[f])},custom:function(l,c,u){var f=l.context,T=u.implementation;if(l.renderPass==="offscreen"){var z=T.prerender;z&&(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),z.call(T,f.gl,l.transform.customLayerMatrix()),f.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(be.disabled);var P=T.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);f.setDepthMode(P),T.render(f.gl,l.transform.customLayerMatrix()),f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}},fr=function(l,c){this.context=new Le(l),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=ye.maxUnderzooming+ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ra,this.gpuTimers={}};fr.prototype.resize=function(l,c){if(this.width=l*y.browser.devicePixelRatio,this.height=c*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var u=0,f=this.style._order;u<f.length;u+=1)this.style._layers[f[u]].resize()},fr.prototype.setup=function(){var l=this.context,c=new y.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(y.EXTENT,0),c.emplaceBack(0,y.EXTENT),c.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(c,Ao.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var u=new y.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(y.EXTENT,0),u.emplaceBack(0,y.EXTENT),u.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=l.createVertexBuffer(u,Ao.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var f=new y.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(y.EXTENT,0,y.EXTENT,0),f.emplaceBack(0,y.EXTENT,0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(f,ti.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var T=new y.StructArrayLayout2i4;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(T,Ao.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var z=new y.StructArrayLayout1ui2;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(z);var P=new y.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new y.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new be({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},fr.prototype.clearStencil=function(){var l=this.context,c=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var u=y.create();y.ortho(u,0,this.width,this.height,0,0,1),y.scale(u,u,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,c.TRIANGLES,he.disabled,this.stencilClearMode,De.disabled,Fe.disabled,Ko(u),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},fr.prototype._renderTileClippingMasks=function(l,c){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&c&&c.length){this.currentStencilSource=l.source;var u=this.context,f=u.gl;this.nextStencilID+c.length>256&&this.clearStencil(),u.setColorMode(De.disabled),u.setDepthMode(he.disabled);var T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var z=0,P=c;z<P.length;z+=1){var B=P[z],G=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;T.draw(u,f.TRIANGLES,he.disabled,new be({func:f.ALWAYS,mask:0},G,255,f.KEEP,f.KEEP,f.REPLACE),De.disabled,Fe.disabled,Ko(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},fr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,c=this.context.gl;return new be({func:c.NOTEQUAL,mask:255},l,255,c.KEEP,c.KEEP,c.REPLACE)},fr.prototype.stencilModeForClipping=function(l){var c=this.context.gl;return new be({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,c.KEEP,c.KEEP,c.REPLACE)},fr.prototype.stencilConfigForOverlap=function(l){var c,u=this.context.gl,f=l.sort(function(G,H){return H.overscaledZ-G.overscaledZ}),T=f[f.length-1].overscaledZ,z=f[0].overscaledZ-T+1;if(z>1){this.currentStencilSource=void 0,this.nextStencilID+z>256&&this.clearStencil();for(var P={},B=0;B<z;B++)P[B+T]=new be({func:u.GEQUAL,mask:255},B+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=z,[P,f]}return[(c={},c[T]=be.disabled,c),f]},fr.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new De([l.CONSTANT_COLOR,l.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?De.unblended:De.alphaBlended},fr.prototype.depthModeForSublayer=function(l,c,u){if(!this.opaquePassEnabledForLayer())return he.disabled;var f=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(u||this.context.gl.LEQUAL,c,[f,f])},fr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},fr.prototype.render=function(l,c){var u=this;this.style=l,this.options=c,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var f=this.style._order,T=this.style.sourceCaches;for(var z in T){var P=T[z];P.used&&P.prepare(this.context)}var B,G,H={},oe={},ue={};for(var se in T){var Se=T[se];H[se]=Se.getVisibleCoordinates(),oe[se]=H[se].slice().reverse(),ue[se]=Se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var we=0;we<f.length;we++)if(this.style._layers[f[we]].is3D()){this.opaquePassCutoff=we;break}this.renderPass="offscreen";for(var Ae=0,ge=f;Ae<ge.length;Ae+=1){var Ee=this.style._layers[ge[Ae]];if(Ee.hasOffscreenPass()&&!Ee.isHidden(this.transform.zoom)){var Re=oe[Ee.source];(Ee.type==="custom"||Re.length)&&this.renderLayer(this,T[Ee.source],Ee,Re)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){var je=this.style._layers[f[this.currentLayer]],He=T[je.source],Ye=H[je.source];this._renderTileClippingMasks(je,Ye),this.renderLayer(this,He,je,Ye)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){var et=this.style._layers[f[this.currentLayer]],st=T[et.source],vt=(et.type==="symbol"?ue:oe)[et.source];this._renderTileClippingMasks(et,H[et.source]),this.renderLayer(this,st,et,vt)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(mt){mt.source&&!mt.isHidden(u.transform.zoom)&&(mt.source!==(G&&G.id)&&(G=u.style.sourceCaches[mt.source]),(!B||B.getSource().maxzoom<G.getSource().maxzoom)&&(B=G))}),B&&pa.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&function(mt){var Pt=mt.transform.padding;Il(mt,mt.transform.height-(Pt.top||0),3,Qs),Il(mt,Pt.bottom||0,3,Ja),ha(mt,Pt.left||0,3,_s),ha(mt,mt.transform.width-(Pt.right||0),3,so);var $t=mt.transform.centerPoint;(function(ei,Nt,Bi,jt){vs(ei,Nt-1,Bi-10,2,20,jt),vs(ei,Nt-10,Bi-1,20,2,jt)})(mt,$t.x,mt.transform.height-$t.y,Rn)}(this),this.context.setDefault()},fr.prototype.renderLayer=function(l,c,u,f){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||f.length)&&(this.id=u.id,this.gpuTimingStart(u),pa[u.type](l,c,u,f,this.style.placement.variableOffsets),this.gpuTimingEnd())},fr.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var c=this.context.extTimerQuery,u=this.gpuTimers[l.id];u||(u=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),u.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,u.query)}},fr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},fr.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},fr.prototype.queryGpuTimers=function(l){var c={};for(var u in l){var f=l[u],T=this.context.extTimerQuery,z=T.getQueryObjectEXT(f.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(f.query),c[u]=z}return c},fr.prototype.translatePosMatrix=function(l,c,u,f,T){if(!u[0]&&!u[1])return l;var z=T?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(z){var P=Math.sin(z),B=Math.cos(z);u=[u[0]*B-u[1]*P,u[0]*P+u[1]*B]}var G=[T?u[0]:Dn(c,u[0],this.transform.zoom),T?u[1]:Dn(c,u[1],this.transform.zoom),0],H=new Float32Array(16);return y.translate(H,l,G),H},fr.prototype.saveTileTexture=function(l){var c=this._tileTextures[l.size[0]];c?c.push(l):this._tileTextures[l.size[0]]=[l]},fr.prototype.getTileTexture=function(l){var c=this._tileTextures[l];return c&&c.length>0?c.pop():null},fr.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var c=this.imageManager.getPattern(l.from.toString()),u=this.imageManager.getPattern(l.to.toString());return!c||!u},fr.prototype.useProgram=function(l,c){this.cache=this.cache||{};var u=""+l+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[u]||(this.cache[u]=new Tl(this.context,l,zo[l],c,$a[l],this._showOverdrawInspector)),this.cache[u]},fr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},fr.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},fr.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},fr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xs=function(l,c){this.points=l,this.planes=c};xs.fromInvProjectionMatrix=function(l,c,u){var f=Math.pow(2,u),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return y.transformMat4([],P,l)}).map(function(P){return y.scale$1([],P,1/P[3]/c*f)}),z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var B=y.sub([],T[P[0]],T[P[1]]),G=y.sub([],T[P[2]],T[P[1]]),H=y.normalize([],y.cross([],B,G)),oe=-y.dot(H,T[P[1]]);return H.concat(oe)});return new xs(T,z)};var Qa=function(l,c){this.min=l,this.max=c,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Qa.prototype.quadrant=function(l){for(var c=[l%2==0,l<2],u=y.clone$2(this.min),f=y.clone$2(this.max),T=0;T<c.length;T++)u[T]=c[T]?this.min[T]:this.center[T],f[T]=c[T]?this.center[T]:this.max[T];return f[2]=this.max[2],new Qa(u,f)},Qa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Qa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Qa.prototype.intersects=function(l){for(var c=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],u=!0,f=0;f<l.planes.length;f++){for(var T=l.planes[f],z=0,P=0;P<c.length;P++)z+=y.dot$1(T,c[P])>=0;if(z===0)return 0;z!==c.length&&(u=!1)}if(u)return 2;for(var B=0;B<3;B++){for(var G=Number.MAX_VALUE,H=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var ue=l.points[oe][B]-this.min[B];G=Math.min(G,ue),H=Math.max(H,ue)}if(H<0||G>this.max[B]-this.min[B])return 0}return 1};var da=function(l,c,u,f){if(l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=0),f===void 0&&(f=0),isNaN(l)||l<0||isNaN(c)||c<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=c,this.left=u,this.right=f};da.prototype.interpolate=function(l,c,u){return c.top!=null&&l.top!=null&&(this.top=y.number(l.top,c.top,u)),c.bottom!=null&&l.bottom!=null&&(this.bottom=y.number(l.bottom,c.bottom,u)),c.left!=null&&l.left!=null&&(this.left=y.number(l.left,c.left,u)),c.right!=null&&l.right!=null&&(this.right=y.number(l.right,c.right,u)),this},da.prototype.getCenter=function(l,c){var u=y.clamp((this.left+l-this.right)/2,0,l),f=y.clamp((this.top+c-this.bottom)/2,0,c);return new y.Point(u,f)},da.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},da.prototype.clone=function(){return new da(this.top,this.bottom,this.left,this.right)},da.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gi=function(l,c,u,f,T){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=T===void 0||T,this._minZoom=l||0,this._maxZoom=c||22,this._minPitch=u==null?0:u,this._maxPitch=f==null?60:f,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new da,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ri={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gi.prototype.clone=function(){var l=new Gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ri.minZoom.get=function(){return this._minZoom},Ri.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ri.maxZoom.get=function(){return this._maxZoom},Ri.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ri.minPitch.get=function(){return this._minPitch},Ri.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ri.maxPitch.get=function(){return this._maxPitch},Ri.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ri.renderWorldCopies.get=function(){return this._renderWorldCopies},Ri.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ri.worldSize.get=function(){return this.tileSize*this.scale},Ri.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ri.size.get=function(){return new y.Point(this.width,this.height)},Ri.bearing.get=function(){return-this.angle/Math.PI*180},Ri.bearing.set=function(l){var c=-y.wrap(l,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ri.pitch.get=function(){return this._pitch/Math.PI*180},Ri.pitch.set=function(l){var c=y.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())},Ri.fov.get=function(){return this._fov/Math.PI*180},Ri.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ri.zoom.get=function(){return this._zoom},Ri.zoom.set=function(l){var c=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())},Ri.center.get=function(){return this._center},Ri.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ri.padding.get=function(){return this._edgeInsets.toJSON()},Ri.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ri.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Gi.prototype.interpolatePadding=function(l,c,u){this._unmodified=!1,this._edgeInsets.interpolate(l,c,u),this._constrain(),this._calcMatrices()},Gi.prototype.coveringZoomLevel=function(l){var c=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,c)},Gi.prototype.getVisibleUnwrappedCoordinates=function(l){var c=[new y.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var u=this.pointCoordinate(new y.Point(0,0)),f=this.pointCoordinate(new y.Point(this.width,0)),T=this.pointCoordinate(new y.Point(this.width,this.height)),z=this.pointCoordinate(new y.Point(0,this.height)),P=Math.floor(Math.min(u.x,f.x,T.x,z.x)),B=Math.floor(Math.max(u.x,f.x,T.x,z.x)),G=P-1;G<=B+1;G++)G!==0&&c.push(new y.UnwrappedTileID(G,l));return c},Gi.prototype.coveringTiles=function(l){var c=this.coveringZoomLevel(l),u=c;if(l.minzoom!==void 0&&c<l.minzoom)return[];l.maxzoom!==void 0&&c>l.maxzoom&&(c=l.maxzoom);var f=y.MercatorCoordinate.fromLngLat(this.center),T=Math.pow(2,c),z=[T*f.x,T*f.y,0],P=xs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),B=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=c);var G=function(mt){return{aabb:new Qa([mt*T,0,0],[(mt+1)*T,T,0]),zoom:0,x:0,y:0,wrap:mt,fullyVisible:!1}},H=[],oe=[],ue=c,se=l.reparseOverscaled?u:c;if(this._renderWorldCopies)for(var Se=1;Se<=3;Se++)H.push(G(-Se)),H.push(G(Se));for(H.push(G(0));H.length>0;){var we=H.pop(),Ae=we.x,ge=we.y,Ee=we.fullyVisible;if(!Ee){var Re=we.aabb.intersects(P);if(Re===0)continue;Ee=Re===2}var je=we.aabb.distanceX(z),He=we.aabb.distanceY(z),Ye=Math.max(Math.abs(je),Math.abs(He));if(we.zoom===ue||Ye>3+(1<<ue-we.zoom)-2&&we.zoom>=B)oe.push({tileID:new y.OverscaledTileID(we.zoom===ue?se:we.zoom,we.wrap,we.zoom,Ae,ge),distanceSq:y.sqrLen([z[0]-.5-Ae,z[1]-.5-ge])});else for(var et=0;et<4;et++){var st=(Ae<<1)+et%2,vt=(ge<<1)+(et>>1);H.push({aabb:we.aabb.quadrant(et),zoom:we.zoom+1,x:st,y:vt,wrap:we.wrap,fullyVisible:Ee})}}return oe.sort(function(mt,Pt){return mt.distanceSq-Pt.distanceSq}).map(function(mt){return mt.tileID})},Gi.prototype.resize=function(l,c){this.width=l,this.height=c,this.pixelsToGLUnits=[2/l,-2/c],this._constrain(),this._calcMatrices()},Ri.unmodified.get=function(){return this._unmodified},Gi.prototype.zoomScale=function(l){return Math.pow(2,l)},Gi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Gi.prototype.project=function(l){var c=y.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(l.lng)*this.worldSize,y.mercatorYfromLat(c)*this.worldSize)},Gi.prototype.unproject=function(l){return new y.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ri.point.get=function(){return this.project(this.center)},Gi.prototype.setLocationAtPoint=function(l,c){var u=this.pointCoordinate(c),f=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(l),z=new y.MercatorCoordinate(T.x-(u.x-f.x),T.y-(u.y-f.y));this.center=this.coordinateLocation(z),this._renderWorldCopies&&(this.center=this.center.wrap())},Gi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Gi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Gi.prototype.locationCoordinate=function(l){return y.MercatorCoordinate.fromLngLat(l)},Gi.prototype.coordinateLocation=function(l){return l.toLngLat()},Gi.prototype.pointCoordinate=function(l){var c=[l.x,l.y,0,1],u=[l.x,l.y,1,1];y.transformMat4(c,c,this.pixelMatrixInverse),y.transformMat4(u,u,this.pixelMatrixInverse);var f=c[3],T=u[3],z=c[1]/f,P=u[1]/T,B=c[2]/f,G=u[2]/T,H=B===G?0:(0-B)/(G-B);return new y.MercatorCoordinate(y.number(c[0]/f,u[0]/T,H)/this.worldSize,y.number(z,P,H)/this.worldSize)},Gi.prototype.coordinatePoint=function(l){var c=[l.x*this.worldSize,l.y*this.worldSize,0,1];return y.transformMat4(c,c,this.pixelMatrix),new y.Point(c[0]/c[3],c[1]/c[3])},Gi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gi.prototype.calculatePosMatrix=function(l,c){c===void 0&&(c=!1);var u=l.key,f=c?this._alignedPosMatrixCache:this._posMatrixCache;if(f[u])return f[u];var T=l.canonical,z=this.worldSize/this.zoomScale(T.z),P=T.x+Math.pow(2,T.z)*l.wrap,B=y.identity(new Float64Array(16));return y.translate(B,B,[P*z,T.y*z,0]),y.scale(B,B,[z/y.EXTENT,z/y.EXTENT,1]),y.multiply(B,c?this.alignedProjMatrix:this.projMatrix,B),f[u]=new Float32Array(B),f[u]},Gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,c,u,f,T=-90,z=90,P=-180,B=180,G=this.size,H=this._unmodified;if(this.latRange){var oe=this.latRange;T=y.mercatorYfromLat(oe[1])*this.worldSize,l=(z=y.mercatorYfromLat(oe[0])*this.worldSize)-T<G.y?G.y/(z-T):0}if(this.lngRange){var ue=this.lngRange;P=y.mercatorXfromLng(ue[0])*this.worldSize,c=(B=y.mercatorXfromLng(ue[1])*this.worldSize)-P<G.x?G.x/(B-P):0}var se=this.point,Se=Math.max(c||0,l||0);if(Se)return this.center=this.unproject(new y.Point(c?(B+P)/2:se.x,l?(z+T)/2:se.y)),this.zoom+=this.scaleZoom(Se),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var we=se.y,Ae=G.y/2;we-Ae<T&&(f=T+Ae),we+Ae>z&&(f=z-Ae)}if(this.lngRange){var ge=se.x,Ee=G.x/2;ge-Ee<P&&(u=P+Ee),ge+Ee>B&&(u=B-Ee)}u===void 0&&f===void 0||(this.center=this.unproject(new y.Point(u!==void 0?u:se.x,f!==void 0?f:se.y))),this._unmodified=H,this._constraining=!1}},Gi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var c=Math.PI/2+this._pitch,u=this._fov*(.5+l.y/this.height),f=Math.sin(u)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-c-u,.01,Math.PI-.01)),T=this.point,z=T.x,P=T.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*f+this.cameraToCenterDistance),G=this.height/50,H=new Float64Array(16);y.perspective(H,this._fov,this.width/this.height,G,B),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,y.scale(H,H,[1,-1,1]),y.translate(H,H,[0,0,-this.cameraToCenterDistance]),y.rotateX(H,H,this._pitch),y.rotateZ(H,H,this.angle),y.translate(H,H,[-z,-P,0]),this.mercatorMatrix=y.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),y.scale(H,H,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=y.invert([],this.projMatrix);var oe=this.width%2/2,ue=this.height%2/2,se=Math.cos(this.angle),Se=Math.sin(this.angle),we=z-Math.round(z)+se*oe+Se*ue,Ae=P-Math.round(P)+se*ue+Se*oe,ge=new Float64Array(H);if(y.translate(ge,ge,[we>.5?we-1:we,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=ge,H=y.create(),y.scale(H,H,[this.width/2,-this.height/2,1]),y.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=y.create(),y.scale(H,H,[1,-1,1]),y.translate(H,H,[-1,-1,0]),y.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new y.Point(0,0)),c=[l.x*this.worldSize,l.y*this.worldSize,0,1];return y.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,l))},Gi.prototype.getCameraQueryGeometry=function(l){var c=this.getCameraPoint();if(l.length===1)return[l[0],c];for(var u=c.x,f=c.y,T=c.x,z=c.y,P=0,B=l;P<B.length;P+=1){var G=B[P];u=Math.min(u,G.x),f=Math.min(f,G.y),T=Math.max(T,G.x),z=Math.max(z,G.y)}return[new y.Point(u,f),new y.Point(T,f),new y.Point(T,z),new y.Point(u,z),new y.Point(u,f)]},Object.defineProperties(Gi.prototype,Ri);var Ut=function(l){var c,u,f,T;this._hashName=l&&encodeURIComponent(l),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(c=this._updateHashUnthrottled.bind(this),u=!1,f=null,T=function(){f=null,u&&(c(),f=setTimeout(T,300),u=!1)},function(){return u=!0,f||T(),f})};Ut.prototype.addTo=function(l){return this._map=l,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ut.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ut.prototype.getHashString=function(l){var c=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,f),z=Math.round(c.lng*T)/T,P=Math.round(c.lat*T)/T,B=this._map.getBearing(),G=this._map.getPitch(),H="";if(H+=l?"/"+z+"/"+P+"/"+u:u+"/"+P+"/"+z,(B||G)&&(H+="/"+Math.round(10*B)/10),G&&(H+="/"+Math.round(G)),this._hashName){var oe=this._hashName,ue=!1,se=y.window.location.hash.slice(1).split("&").map(function(Se){var we=Se.split("=")[0];return we===oe?(ue=!0,we+"="+H):Se}).filter(function(Se){return Se});return ue||se.push(oe+"="+H),"#"+se.join("&")}return"#"+H},Ut.prototype._getCurrentHash=function(){var l,c=this,u=y.window.location.hash.replace("#","");return this._hashName?(u.split("&").map(function(f){return f.split("=")}).forEach(function(f){f[0]===c._hashName&&(l=f)}),(l&&l[1]||"").split("/")):u.split("/")},Ut.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(u){return isNaN(u)})){var c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:c,pitch:+(l[4]||0)}),!0}return!1},Ut.prototype._updateHashUnthrottled=function(){var l=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,l)}catch{}};var Po={linearity:.3,easing:y.bezier(0,0,.3,1)},bs=y.extend({deceleration:2500,maxSpeed:1400},Po),Mo=y.extend({deceleration:20,maxSpeed:1400},Po),fa=y.extend({deceleration:1e3,maxSpeed:360},Po),Ft=y.extend({deceleration:1e3,maxSpeed:90},Po),es=function(l){this._map=l,this.clear()};function el(l,c){(!l.duration||l.duration<c.duration)&&(l.duration=c.duration,l.easing=c.easing)}function tl(l,c,u){var f=u.maxSpeed,T=u.linearity,z=u.deceleration,P=y.clamp(l*T/(c/1e3),-f,f),B=Math.abs(P)/(z*T);return{easing:u.easing,duration:1e3*B,amount:P*(B/2)}}es.prototype.clear=function(){this._inertiaBuffer=[]},es.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:l})},es.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,c=y.browser.now();l.length>0&&c-l[0].time>160;)l.shift()},es.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var c={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},u=0,f=this._inertiaBuffer;u<f.length;u+=1){var T=f[u].settings;c.zoom+=T.zoomDelta||0,c.bearing+=T.bearingDelta||0,c.pitch+=T.pitchDelta||0,T.panDelta&&c.pan._add(T.panDelta),T.around&&(c.around=T.around),T.pinchAround&&(c.pinchAround=T.pinchAround)}var z=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(c.pan.mag()){var B=tl(c.pan.mag(),z,y.extend({},bs,l||{}));P.offset=c.pan.mult(B.amount/c.pan.mag()),P.center=this._map.transform.center,el(P,B)}if(c.zoom){var G=tl(c.zoom,z,Mo);P.zoom=this._map.transform.zoom+G.amount,el(P,G)}if(c.bearing){var H=tl(c.bearing,z,fa);P.bearing=this._map.transform.bearing+y.clamp(H.amount,-179,179),el(P,H)}if(c.pitch){var oe=tl(c.pitch,z,Ft);P.pitch=this._map.transform.pitch+oe.amount,el(P,oe)}if(P.zoom||P.bearing){var ue=c.pinchAround===void 0?c.around:c.pinchAround;P.around=ue?this._map.unproject(ue):this._map.getCenter()}return this.clear(),y.extend(P,{noMoveStart:!0})}};var nn=function(l){function c(f,T,z,P){P===void 0&&(P={});var B=ce.mousePos(T.getCanvasContainer(),z),G=T.unproject(B);l.call(this,f,y.extend({point:B,lngLat:G,originalEvent:z},P)),this._defaultPrevented=!1,this.target=T}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(y.Event),lo=function(l){function c(f,T,z){var P=f==="touchend"?z.changedTouches:z.touches,B=ce.touchPos(T.getCanvasContainer(),P),G=B.map(function(ue){return T.unproject(ue)}),H=B.reduce(function(ue,se,Se,we){return ue.add(se.div(we.length))},new y.Point(0,0)),oe=T.unproject(H);l.call(this,f,{points:B,point:H,lngLats:G,lngLat:oe,originalEvent:z}),this._defaultPrevented=!1}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(y.Event),Kl=function(l){function c(f,T,z){l.call(this,f,{originalEvent:z}),this._defaultPrevented=!1}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(y.Event),gn=function(l,c){this._map=l,this._clickTolerance=c.clickTolerance};gn.prototype.reset=function(){delete this._mousedownPos},gn.prototype.wheel=function(l){return this._firePreventable(new Kl(l.type,this._map,l))},gn.prototype.mousedown=function(l,c){return this._mousedownPos=c,this._firePreventable(new nn(l.type,this._map,l))},gn.prototype.mouseup=function(l){this._map.fire(new nn(l.type,this._map,l))},gn.prototype.click=function(l,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new nn(l.type,this._map,l))},gn.prototype.dblclick=function(l){return this._firePreventable(new nn(l.type,this._map,l))},gn.prototype.mouseover=function(l){this._map.fire(new nn(l.type,this._map,l))},gn.prototype.mouseout=function(l){this._map.fire(new nn(l.type,this._map,l))},gn.prototype.touchstart=function(l){return this._firePreventable(new lo(l.type,this._map,l))},gn.prototype.touchmove=function(l){this._map.fire(new lo(l.type,this._map,l))},gn.prototype.touchend=function(l){this._map.fire(new lo(l.type,this._map,l))},gn.prototype.touchcancel=function(l){this._map.fire(new lo(l.type,this._map,l))},gn.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},gn.prototype.isEnabled=function(){return!0},gn.prototype.isActive=function(){return!1},gn.prototype.enable=function(){},gn.prototype.disable=function(){};var uo=function(l){this._map=l};uo.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},uo.prototype.mousemove=function(l){this._map.fire(new nn(l.type,this._map,l))},uo.prototype.mousedown=function(){this._delayContextMenu=!0},uo.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},uo.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new nn(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},uo.prototype.isEnabled=function(){return!0},uo.prototype.isActive=function(){return!1},uo.prototype.enable=function(){},uo.prototype.disable=function(){};var Dt=function(l,c){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=c.clickTolerance||1};function ts(l,c){for(var u={},f=0;f<l.length;f++)u[l[f].identifier]=c[f];return u}Dt.prototype.isEnabled=function(){return!!this._enabled},Dt.prototype.isActive=function(){return!!this._active},Dt.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Dt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Dt.prototype.mousedown=function(l,c){this.isEnabled()&&l.shiftKey&&l.button===0&&(ce.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)},Dt.prototype.mousemoveWindow=function(l,c){if(this._active){var u=c;if(!(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)){var f=this._startPos;this._lastPos=u,this._box||(this._box=ce.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var T=Math.min(f.x,u.x),z=Math.max(f.x,u.x),P=Math.min(f.y,u.y),B=Math.max(f.y,u.y);ce.setTransform(this._box,"translate("+T+"px,"+P+"px)"),this._box.style.width=z-T+"px",this._box.style.height=B-P+"px"}}},Dt.prototype.mouseupWindow=function(l,c){var u=this;if(this._active&&l.button===0){var f=this._startPos,T=c;if(this.reset(),ce.suppressClick(),f.x!==T.x||f.y!==T.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(z){return z.fitScreenCoordinates(f,T,u._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},Dt.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Dt.prototype.reset=function(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(ce.remove(this._box),this._box=null),ce.enableDrag(),delete this._startPos,delete this._lastPos},Dt.prototype._fireEvent=function(l,c){return this._map.fire(new y.Event(l,{originalEvent:c}))};var Ra=function(l){this.reset(),this.numTouches=l.numTouches};Ra.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ra.prototype.touchstart=function(l,c,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),u.length===this.numTouches&&(this.centroid=function(f){for(var T=new y.Point(0,0),z=0,P=f;z<P.length;z+=1)T._add(P[z]);return T.div(f.length)}(c),this.touches=ts(u,c)))},Ra.prototype.touchmove=function(l,c,u){if(!this.aborted&&this.centroid){var f=ts(u,c);for(var T in this.touches){var z=f[T];(!z||z.dist(this.touches[T])>30)&&(this.aborted=!0)}}},Ra.prototype.touchend=function(l,c,u){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){var f=!this.aborted&&this.centroid;if(this.reset(),f)return f}};var Yo=function(l){this.singleTap=new Ra(l),this.numTaps=l.numTaps,this.reset()};Yo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Yo.prototype.touchstart=function(l,c,u){this.singleTap.touchstart(l,c,u)},Yo.prototype.touchmove=function(l,c,u){this.singleTap.touchmove(l,c,u)},Yo.prototype.touchend=function(l,c,u){var f=this.singleTap.touchend(l,c,u);if(f){var T=l.timeStamp-this.lastTime<500,z=!this.lastTap||this.lastTap.dist(f)<30;if(T&&z||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}};var Pr=function(){this._zoomIn=new Yo({numTouches:1,numTaps:2}),this._zoomOut=new Yo({numTouches:2,numTaps:1}),this.reset()};Pr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Pr.prototype.touchstart=function(l,c,u){this._zoomIn.touchstart(l,c,u),this._zoomOut.touchstart(l,c,u)},Pr.prototype.touchmove=function(l,c,u){this._zoomIn.touchmove(l,c,u),this._zoomOut.touchmove(l,c,u)},Pr.prototype.touchend=function(l,c,u){var f=this,T=this._zoomIn.touchend(l,c,u),z=this._zoomOut.touchend(l,c,u);return T?(this._active=!0,l.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(T)},{originalEvent:l})}}):z?(this._active=!0,l.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(z)},{originalEvent:l})}}):void 0},Pr.prototype.touchcancel=function(){this.reset()},Pr.prototype.enable=function(){this._enabled=!0},Pr.prototype.disable=function(){this._enabled=!1,this.reset()},Pr.prototype.isEnabled=function(){return this._enabled},Pr.prototype.isActive=function(){return this._active};var Do={0:1,2:2},qn=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};qn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qn.prototype._correctButton=function(l,c){return!1},qn.prototype._move=function(l,c){return{}},qn.prototype.mousedown=function(l,c){if(!this._lastPoint){var u=ce.mouseButton(l);this._correctButton(l,u)&&(this._lastPoint=c,this._eventButton=u)}},qn.prototype.mousemoveWindow=function(l,c){var u=this._lastPoint;if(u){if(l.preventDefault(),function(f,T){var z=Do[T];return f.buttons===void 0||(f.buttons&z)!==z}(l,this._eventButton))this.reset();else if(this._moved||!(c.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(u,c)}},qn.prototype.mouseupWindow=function(l){this._lastPoint&&ce.mouseButton(l)===this._eventButton&&(this._moved&&ce.suppressClick(),this.reset())},qn.prototype.enable=function(){this._enabled=!0},qn.prototype.disable=function(){this._enabled=!1,this.reset()},qn.prototype.isEnabled=function(){return this._enabled},qn.prototype.isActive=function(){return this._active};var Bt=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.mousedown=function(u,f){l.prototype.mousedown.call(this,u,f),this._lastPoint&&(this._active=!0)},c.prototype._correctButton=function(u,f){return f===0&&!u.ctrlKey},c.prototype._move=function(u,f){return{around:f,panDelta:f.sub(u)}},c}(qn),ma=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype._correctButton=function(u,f){return f===0&&u.ctrlKey||f===2},c.prototype._move=function(u,f){var T=.8*(f.x-u.x);if(T)return this._active=!0,{bearingDelta:T}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(qn),ws=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype._correctButton=function(u,f){return f===0&&u.ctrlKey||f===2},c.prototype._move=function(u,f){var T=-.5*(f.y-u.y);if(T)return this._active=!0,{pitchDelta:T}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(qn),Yn=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Yn.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},Yn.prototype.touchstart=function(l,c,u){return this._calculateTransform(l,c,u)},Yn.prototype.touchmove=function(l,c,u){if(this._active&&!(u.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,c,u)},Yn.prototype.touchend=function(l,c,u){this._calculateTransform(l,c,u),this._active&&u.length<this._minTouches&&this.reset()},Yn.prototype.touchcancel=function(){this.reset()},Yn.prototype._calculateTransform=function(l,c,u){u.length>0&&(this._active=!0);var f=ts(u,c),T=new y.Point(0,0),z=new y.Point(0,0),P=0;for(var B in f){var G=f[B],H=this._touches[B];H&&(T._add(G),z._add(G.sub(H)),P++,f[B]=G)}if(this._touches=f,!(P<this._minTouches)&&z.mag()){var oe=z.div(P);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:T.div(P),panDelta:oe}}},Yn.prototype.enable=function(){this._enabled=!0},Yn.prototype.disable=function(){this._enabled=!1,this.reset()},Yn.prototype.isEnabled=function(){return this._enabled},Yn.prototype.isActive=function(){return this._active};var Br=function(){this.reset()};function kr(l,c,u){for(var f=0;f<l.length;f++)if(l[f].identifier===u)return c[f]}function il(l,c){return Math.log(l/c)/Math.LN2}Br.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Br.prototype._start=function(l){},Br.prototype._move=function(l,c,u){return{}},Br.prototype.touchstart=function(l,c,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([c[0],c[1]]))},Br.prototype.touchmove=function(l,c,u){if(this._firstTwoTouches){l.preventDefault();var f=this._firstTwoTouches,T=f[1],z=kr(u,c,f[0]),P=kr(u,c,T);if(z&&P){var B=this._aroundCenter?null:z.add(P).div(2);return this._move([z,P],B,l)}}},Br.prototype.touchend=function(l,c,u){if(this._firstTwoTouches){var f=this._firstTwoTouches,T=f[1],z=kr(u,c,f[0]),P=kr(u,c,T);z&&P||(this._active&&ce.suppressClick(),this.reset())}},Br.prototype.touchcancel=function(){this.reset()},Br.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Br.prototype.disable=function(){this._enabled=!1,this.reset()},Br.prototype.isEnabled=function(){return this._enabled},Br.prototype.isActive=function(){return this._active};var Ts=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},c.prototype._start=function(u){this._startDistance=this._distance=u[0].dist(u[1])},c.prototype._move=function(u,f){var T=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(il(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:il(this._distance,T),pinchAround:f}},c}(Br);function Bn(l,c){return 180*l.angleWith(c)/Math.PI}var ya=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},c.prototype._start=function(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])},c.prototype._move=function(u,f){var T=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bn(this._vector,T),pinchAround:f}},c.prototype._isBelowThreshold=function(u){this._minDiameter=Math.min(this._minDiameter,u.mag());var f=25/(Math.PI*this._minDiameter)*360,T=Bn(u,this._startVector);return Math.abs(T)<f},c}(Br);function rl(l){return Math.abs(l.y)>Math.abs(l.x)}var Jl=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},c.prototype._start=function(u){this._lastPoints=u,rl(u[0].sub(u[1]))&&(this._valid=!1)},c.prototype._move=function(u,f,T){var z=u[0].sub(this._lastPoints[0]),P=u[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(z,P,T.timeStamp),this._valid)return this._lastPoints=u,this._active=!0,{pitchDelta:(z.y+P.y)/2*-.5}},c.prototype.gestureBeginsVertically=function(u,f,T){if(this._valid!==void 0)return this._valid;var z=u.mag()>=2,P=f.mag()>=2;if(z||P){if(!z||!P)return this._firstMove===void 0&&(this._firstMove=T),T-this._firstMove<100&&void 0;var B=u.y>0==f.y>0;return rl(u)&&rl(f)&&B}},c}(Br),Lo={panStep:100,bearingStep:15,pitchStep:10},co=function(){var l=Lo;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Qt(l){return l*(2-l)}co.prototype.reset=function(){this._active=!1},co.prototype.keydown=function(l){var c=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var u=0,f=0,T=0,z=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:l.shiftKey?f=-1:(l.preventDefault(),z=-1);break;case 39:l.shiftKey?f=1:(l.preventDefault(),z=1);break;case 38:l.shiftKey?T=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?T=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(f=0,T=0),{cameraAnimation:function(B){var G=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:Qt,zoom:u?Math.round(G)+u*(l.shiftKey?2:1):G,bearing:B.getBearing()+f*c._bearingStep,pitch:B.getPitch()+T*c._pitchStep,offset:[-z*c._panStep,-P*c._panStep],center:B.getCenter()},{originalEvent:l})}}}},co.prototype.enable=function(){this._enabled=!0},co.prototype.disable=function(){this._enabled=!1,this.reset()},co.prototype.isEnabled=function(){return this._enabled},co.prototype.isActive=function(){return this._active},co.prototype.disableRotation=function(){this._rotationDisabled=!0},co.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ot=function(l,c){this._map=l,this._el=l.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Ot.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ot.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ot.prototype.isEnabled=function(){return!!this._enabled},Ot.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ot.prototype.isZooming=function(){return!!this._zooming},Ot.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ot.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ot.prototype.wheel=function(l){if(this.isEnabled()){var c=l.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,u=y.browser.now(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,c!==0&&c%4.000244140625==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(f*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),l.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=l,this._delta-=c,this._active||this._start(l)),l.preventDefault()}},Ot.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ot.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var c=ce.mousePos(this._el,l);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ot.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var c=this._map.transform;if(this._delta!==0){var u=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,f=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&f!==0&&(f=1/f);var T=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(T*f))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var z,P=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,B=this._startZoom,G=this._easing,H=!1;if(this._type==="wheel"&&B&&G){var oe=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),ue=G(oe);z=y.number(B,P,ue),oe<1?this._frameId||(this._frameId=!0):H=!0}else z=P,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:z-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ot.prototype._smoothOutEasing=function(l){var c=y.ease;if(this._prevEase){var u=this._prevEase,f=(y.browser.now()-u.start)/u.duration,T=u.easing(f+.01)-u.easing(f),z=.27/Math.sqrt(T*T+1e-4)*.01,P=Math.sqrt(.0729-z*z);c=y.bezier(z,P,.25,1)}return this._prevEase={start:y.browser.now(),duration:l,easing:c},c},Ot.prototype.reset=function(){this._active=!1};var $i=function(l,c){this._clickZoom=l,this._tapZoom=c};$i.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},$i.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},$i.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},$i.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Zn=function(){this.reset()};Zn.prototype.reset=function(){this._active=!1},Zn.prototype.dblclick=function(l,c){return l.preventDefault(),{cameraAnimation:function(u){u.easeTo({duration:300,zoom:u.getZoom()+(l.shiftKey?-1:1),around:u.unproject(c)},{originalEvent:l})}}},Zn.prototype.enable=function(){this._enabled=!0},Zn.prototype.disable=function(){this._enabled=!1,this.reset()},Zn.prototype.isEnabled=function(){return this._enabled},Zn.prototype.isActive=function(){return this._active};var Gn=function(){this._tap=new Yo({numTouches:1,numTaps:1}),this.reset()};Gn.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Gn.prototype.touchstart=function(l,c,u){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=c[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(l,c,u))},Gn.prototype.touchmove=function(l,c,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;var f=c[0],T=f.y-this._swipePoint.y;return this._swipePoint=f,l.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(l,c,u)},Gn.prototype.touchend=function(l,c,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(l,c,u)&&(this._tapTime=l.timeStamp)},Gn.prototype.touchcancel=function(){this.reset()},Gn.prototype.enable=function(){this._enabled=!0},Gn.prototype.disable=function(){this._enabled=!1,this.reset()},Gn.prototype.isEnabled=function(){return this._enabled},Gn.prototype.isActive=function(){return this._active};var mr=function(l,c,u){this._el=l,this._mousePan=c,this._touchPan=u};mr.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},mr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},mr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},mr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var _o=function(l,c,u){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=c,this._mousePitch=u};_o.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},_o.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},_o.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},_o.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Gr=function(l,c,u,f){this._el=l,this._touchZoom=c,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0};Gr.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},Gr.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},Gr.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Gr.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Gr.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Gr.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ba=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Fn=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c}(y.Event);function cr(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var gt=function(l,c){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new es(l),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),y.bindAll(["handleEvent","handleWindowEvent"],this);var u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[y.window,"blur",void 0]];for(var f=0,T=this._listeners;f<T.length;f+=1){var z=T[f],P=z[0];ce.addEventListener(P,z[1],P===y.window.document?this.handleWindowEvent:this.handleEvent,z[2])}};gt.prototype.destroy=function(){for(var l=0,c=this._listeners;l<c.length;l+=1){var u=c[l],f=u[0];ce.removeEventListener(f,u[1],f===y.window.document?this.handleWindowEvent:this.handleEvent,u[2])}},gt.prototype._addDefaultHandlers=function(l){var c=this._map,u=c.getCanvasContainer();this._add("mapEvent",new gn(c,l));var f=c.boxZoom=new Dt(c,l);this._add("boxZoom",f);var T=new Pr,z=new Zn;c.doubleClickZoom=new $i(z,T),this._add("tapZoom",T),this._add("clickZoom",z);var P=new Gn;this._add("tapDragZoom",P);var B=c.touchPitch=new Jl;this._add("touchPitch",B);var G=new ma(l),H=new ws(l);c.dragRotate=new _o(l,G,H),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var oe=new Bt(l),ue=new Yn(l);c.dragPan=new mr(u,oe,ue),this._add("mousePan",oe),this._add("touchPan",ue,["touchZoom","touchRotate"]);var se=new ya,Se=new Ts;c.touchZoomRotate=new Gr(u,Se,se,P),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",Se,["touchPan","touchRotate"]);var we=c.scrollZoom=new Ot(c,this);this._add("scrollZoom",we,["mousePan"]);var Ae=c.keyboard=new co;this._add("keyboard",Ae),this._add("blockableMapEvent",new uo(c));for(var ge=0,Ee=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ge<Ee.length;ge+=1){var Re=Ee[ge];l.interactive&&l[Re]&&c[Re].enable(l[Re])}},gt.prototype._add=function(l,c,u){this._handlers.push({handlerName:l,handler:c,allowed:u}),this._handlersById[l]=c},gt.prototype.stop=function(l){if(!this._updatingCamera){for(var c=0,u=this._handlers;c<u.length;c+=1)u[c].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},gt.prototype.isActive=function(){for(var l=0,c=this._handlers;l<c.length;l+=1)if(c[l].handler.isActive())return!0;return!1},gt.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gt.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gt.prototype.isMoving=function(){return Boolean(Ba(this._eventsInProgress))||this.isZooming()},gt.prototype._blockedByActive=function(l,c,u){for(var f in l)if(f!==u&&(!c||c.indexOf(f)<0))return!0;return!1},gt.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},gt.prototype._getMapTouches=function(l){for(var c=[],u=0,f=l;u<f.length;u+=1){var T=f[u];this._el.contains(T.target)&&c.push(T)}return c},gt.prototype.handleEvent=function(l,c){if(l.type!=="blur"){this._updatingCamera=!0;for(var u=l.type==="renderFrame"?void 0:l,f={needsRenderFrame:!1},T={},z={},P=l.touches?this._getMapTouches(l.touches):void 0,B=P?ce.touchPos(this._el,P):ce.mousePos(this._el,l),G=0,H=this._handlers;G<H.length;G+=1){var oe=H[G],ue=oe.handlerName,se=oe.handler,Se=oe.allowed;if(se.isEnabled()){var we=void 0;this._blockedByActive(z,Se,ue)?se.reset():se[c||l.type]&&(we=se[c||l.type](l,B,P),this.mergeHandlerResult(f,T,we,ue,u),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||se.isActive())&&(z[ue]=se)}}var Ae={};for(var ge in this._previousActiveHandlers)z[ge]||(Ae[ge]=u);this._previousActiveHandlers=z,(Object.keys(Ae).length||cr(f))&&(this._changes.push([f,T,Ae]),this._triggerRenderFrame()),(Object.keys(z).length||cr(f))&&this._map._stop(!0),this._updatingCamera=!1;var Ee=f.cameraAnimation;Ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ee(this._map))}else this.stop(!0)},gt.prototype.mergeHandlerResult=function(l,c,u,f,T){if(u){y.extend(l,u);var z={handlerName:f,originalEvent:u.originalEvent||T};u.zoomDelta!==void 0&&(c.zoom=z),u.panDelta!==void 0&&(c.drag=z),u.pitchDelta!==void 0&&(c.pitch=z),u.bearingDelta!==void 0&&(c.rotate=z)}},gt.prototype._applyChanges=function(){for(var l={},c={},u={},f=0,T=this._changes;f<T.length;f+=1){var z=T[f],P=z[0],B=z[1],G=z[2];P.panDelta&&(l.panDelta=(l.panDelta||new y.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),y.extend(c,B),y.extend(u,G)}this._updateMapTransform(l,c,u),this._changes=[]},gt.prototype._updateMapTransform=function(l,c,u){var f=this._map,T=f.transform;if(!cr(l))return this._fireEvents(c,u,!0);var z=l.panDelta,P=l.zoomDelta,B=l.bearingDelta,G=l.pitchDelta,H=l.around,oe=l.pinchAround;oe!==void 0&&(H=oe),f._stop(!0),H=H||f.transform.centerPoint;var ue=T.pointLocation(z?H.sub(z):H);B&&(T.bearing+=B),G&&(T.pitch+=G),P&&(T.zoom+=P),T.setLocationAtPoint(ue,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(c,u,!0)},gt.prototype._fireEvents=function(l,c,u){var f=this,T=Ba(this._eventsInProgress),z=Ba(l),P={};for(var B in l)this._eventsInProgress[B]||(P[B+"start"]=l[B].originalEvent),this._eventsInProgress[B]=l[B];for(var G in!T&&z&&this._fireEvent("movestart",z.originalEvent),P)this._fireEvent(G,P[G]);for(var H in z&&this._fireEvent("move",z.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var oe,ue={};for(var se in this._eventsInProgress){var Se=this._eventsInProgress[se],we=Se.handlerName,Ae=Se.originalEvent;this._handlersById[we].isActive()||(delete this._eventsInProgress[se],ue[se+"end"]=oe=c[we]||Ae)}for(var ge in ue)this._fireEvent(ge,ue[ge]);var Ee=Ba(this._eventsInProgress);if(u&&(T||z)&&!Ee){this._updatingCamera=!0;var Re=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),je=function(He){return He!==0&&-f._bearingSnap<He&&He<f._bearingSnap};Re?(je(Re.bearing||this._map.getBearing())&&(Re.bearing=0),this._map.easeTo(Re,{originalEvent:oe})):(this._map.fire(new y.Event("moveend",{originalEvent:oe})),je(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gt.prototype._fireEvent=function(l,c){this._map.fire(new y.Event(l,c?{originalEvent:c}:{}))},gt.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(c){delete l._frameId,l.handleEvent(new Fn("renderFrame",{timeStamp:c})),l._applyChanges()})},gt.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var ui=function(l){function c(u,f){l.call(this),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=f.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},c.prototype.setCenter=function(u,f){return this.jumpTo({center:u},f)},c.prototype.panBy=function(u,f,T){return u=y.Point.convert(u).mult(-1),this.panTo(this.transform.center,y.extend({offset:u},f),T)},c.prototype.panTo=function(u,f,T){return this.easeTo(y.extend({center:u},f),T)},c.prototype.getZoom=function(){return this.transform.zoom},c.prototype.setZoom=function(u,f){return this.jumpTo({zoom:u},f),this},c.prototype.zoomTo=function(u,f,T){return this.easeTo(y.extend({zoom:u},f),T)},c.prototype.zoomIn=function(u,f){return this.zoomTo(this.getZoom()+1,u,f),this},c.prototype.zoomOut=function(u,f){return this.zoomTo(this.getZoom()-1,u,f),this},c.prototype.getBearing=function(){return this.transform.bearing},c.prototype.setBearing=function(u,f){return this.jumpTo({bearing:u},f),this},c.prototype.getPadding=function(){return this.transform.padding},c.prototype.setPadding=function(u,f){return this.jumpTo({padding:u},f),this},c.prototype.rotateTo=function(u,f,T){return this.easeTo(y.extend({bearing:u},f),T)},c.prototype.resetNorth=function(u,f){return this.rotateTo(0,y.extend({duration:1e3},u),f),this},c.prototype.resetNorthPitch=function(u,f){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},u),f),this},c.prototype.snapToNorth=function(u,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,f):this},c.prototype.getPitch=function(){return this.transform.pitch},c.prototype.setPitch=function(u,f){return this.jumpTo({pitch:u},f),this},c.prototype.cameraForBounds=function(u,f){u=y.LngLatBounds.convert(u);var T=f&&f.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),T,f)},c.prototype._cameraForBoxAndBearing=function(u,f,T,z){var P={top:0,bottom:0,right:0,left:0};if(typeof(z=y.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},z)).padding=="number"){var B=z.padding;z.padding={top:B,bottom:B,right:B,left:B}}z.padding=y.extend(P,z.padding);var G=this.transform,H=G.padding,oe=G.project(y.LngLat.convert(u)),ue=G.project(y.LngLat.convert(f)),se=oe.rotate(-T*Math.PI/180),Se=ue.rotate(-T*Math.PI/180),we=new y.Point(Math.max(se.x,Se.x),Math.max(se.y,Se.y)),Ae=new y.Point(Math.min(se.x,Se.x),Math.min(se.y,Se.y)),ge=we.sub(Ae),Ee=(G.width-(H.left+H.right+z.padding.left+z.padding.right))/ge.x,Re=(G.height-(H.top+H.bottom+z.padding.top+z.padding.bottom))/ge.y;if(!(Re<0||Ee<0)){var je=Math.min(G.scaleZoom(G.scale*Math.min(Ee,Re)),z.maxZoom),He=typeof z.offset.x=="number"?new y.Point(z.offset.x,z.offset.y):y.Point.convert(z.offset),Ye=new y.Point((z.padding.left-z.padding.right)/2,(z.padding.top-z.padding.bottom)/2).rotate(T*Math.PI/180),et=He.add(Ye).mult(G.scale/G.zoomScale(je));return{center:G.unproject(oe.add(ue).div(2).sub(et)),zoom:je,bearing:T}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},c.prototype.fitBounds=function(u,f,T){return this._fitInternal(this.cameraForBounds(u,f),f,T)},c.prototype.fitScreenCoordinates=function(u,f,T,z,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(u)),this.transform.pointLocation(y.Point.convert(f)),T,z),z,P)},c.prototype._fitInternal=function(u,f,T){return u?(delete(f=y.extend(u,f)).padding,f.linear?this.easeTo(f,T):this.flyTo(f,T)):this},c.prototype.jumpTo=function(u,f){this.stop();var T=this.transform,z=!1,P=!1,B=!1;return"zoom"in u&&T.zoom!==+u.zoom&&(z=!0,T.zoom=+u.zoom),u.center!==void 0&&(T.center=y.LngLat.convert(u.center)),"bearing"in u&&T.bearing!==+u.bearing&&(P=!0,T.bearing=+u.bearing),"pitch"in u&&T.pitch!==+u.pitch&&(B=!0,T.pitch=+u.pitch),u.padding==null||T.isPaddingEqual(u.padding)||(T.padding=u.padding),this.fire(new y.Event("movestart",f)).fire(new y.Event("move",f)),z&&this.fire(new y.Event("zoomstart",f)).fire(new y.Event("zoom",f)).fire(new y.Event("zoomend",f)),P&&this.fire(new y.Event("rotatestart",f)).fire(new y.Event("rotate",f)).fire(new y.Event("rotateend",f)),B&&this.fire(new y.Event("pitchstart",f)).fire(new y.Event("pitch",f)).fire(new y.Event("pitchend",f)),this.fire(new y.Event("moveend",f))},c.prototype.easeTo=function(u,f){var T=this;this._stop(!1,u.easeId),((u=y.extend({offset:[0,0],duration:500,easing:y.ease},u)).animate===!1||!u.essential&&y.browser.prefersReducedMotion)&&(u.duration=0);var z=this.transform,P=this.getZoom(),B=this.getBearing(),G=this.getPitch(),H=this.getPadding(),oe="zoom"in u?+u.zoom:P,ue="bearing"in u?this._normalizeBearing(u.bearing,B):B,se="pitch"in u?+u.pitch:G,Se="padding"in u?u.padding:z.padding,we=y.Point.convert(u.offset),Ae=z.centerPoint.add(we),ge=z.pointLocation(Ae),Ee=y.LngLat.convert(u.center||ge);this._normalizeCenter(Ee);var Re,je,He=z.project(ge),Ye=z.project(Ee).sub(He),et=z.zoomScale(oe-P);u.around&&(Re=y.LngLat.convert(u.around),je=z.locationPoint(Re));var st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==P,this._rotating=this._rotating||B!==ue,this._pitching=this._pitching||se!==G,this._padding=!z.isPaddingEqual(Se),this._easeId=u.easeId,this._prepareEase(f,u.noMoveStart,st),this._ease(function(vt){if(T._zooming&&(z.zoom=y.number(P,oe,vt)),T._rotating&&(z.bearing=y.number(B,ue,vt)),T._pitching&&(z.pitch=y.number(G,se,vt)),T._padding&&(z.interpolatePadding(H,Se,vt),Ae=z.centerPoint.add(we)),Re)z.setLocationAtPoint(Re,je);else{var mt=z.zoomScale(z.zoom-P),Pt=oe>P?Math.min(2,et):Math.max(.5,et),$t=Math.pow(Pt,1-vt),ei=z.unproject(He.add(Ye.mult(vt*$t)).mult(mt));z.setLocationAtPoint(z.renderWorldCopies?ei.wrap():ei,Ae)}T._fireMoveEvents(f)},function(vt){T._afterEase(f,vt)},u),this},c.prototype._prepareEase=function(u,f,T){T===void 0&&(T={}),this._moving=!0,f||T.moving||this.fire(new y.Event("movestart",u)),this._zooming&&!T.zooming&&this.fire(new y.Event("zoomstart",u)),this._rotating&&!T.rotating&&this.fire(new y.Event("rotatestart",u)),this._pitching&&!T.pitching&&this.fire(new y.Event("pitchstart",u))},c.prototype._fireMoveEvents=function(u){this.fire(new y.Event("move",u)),this._zooming&&this.fire(new y.Event("zoom",u)),this._rotating&&this.fire(new y.Event("rotate",u)),this._pitching&&this.fire(new y.Event("pitch",u))},c.prototype._afterEase=function(u,f){if(!this._easeId||!f||this._easeId!==f){delete this._easeId;var T=this._zooming,z=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,T&&this.fire(new y.Event("zoomend",u)),z&&this.fire(new y.Event("rotateend",u)),P&&this.fire(new y.Event("pitchend",u)),this.fire(new y.Event("moveend",u))}},c.prototype.flyTo=function(u,f){var T=this;if(!u.essential&&y.browser.prefersReducedMotion){var z=y.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(z,f)}this.stop(),u=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},u);var P=this.transform,B=this.getZoom(),G=this.getBearing(),H=this.getPitch(),oe=this.getPadding(),ue="zoom"in u?y.clamp(+u.zoom,P.minZoom,P.maxZoom):B,se="bearing"in u?this._normalizeBearing(u.bearing,G):G,Se="pitch"in u?+u.pitch:H,we="padding"in u?u.padding:P.padding,Ae=P.zoomScale(ue-B),ge=y.Point.convert(u.offset),Ee=P.centerPoint.add(ge),Re=P.pointLocation(Ee),je=y.LngLat.convert(u.center||Re);this._normalizeCenter(je);var He=P.project(Re),Ye=P.project(je).sub(He),et=u.curve,st=Math.max(P.width,P.height),vt=st/Ae,mt=Ye.mag();if("minZoom"in u){var Pt=y.clamp(Math.min(u.minZoom,B,ue),P.minZoom,P.maxZoom),$t=st/P.zoomScale(Pt-B);et=Math.sqrt($t/mt*2)}var ei=et*et;function Nt(ni){var Xt=(vt*vt-st*st+(ni?-1:1)*ei*ei*mt*mt)/(2*(ni?vt:st)*ei*mt);return Math.log(Math.sqrt(Xt*Xt+1)-Xt)}function Bi(ni){return(Math.exp(ni)-Math.exp(-ni))/2}function jt(ni){return(Math.exp(ni)+Math.exp(-ni))/2}var bi=Nt(0),Di=function(ni){return jt(bi)/jt(bi+et*ni)},vi=function(ni){return st*((jt(bi)*(Bi(Xt=bi+et*ni)/jt(Xt))-Bi(bi))/ei)/mt;var Xt},di=(Nt(1)-bi)/et;if(Math.abs(mt)<1e-6||!isFinite(di)){if(Math.abs(st-vt)<1e-6)return this.easeTo(u,f);var hi=vt<st?-1:1;di=Math.abs(Math.log(vt/st))/et,vi=function(){return 0},Di=function(ni){return Math.exp(hi*et*ni)}}return u.duration="duration"in u?+u.duration:1e3*di/("screenSpeed"in u?+u.screenSpeed/et:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=G!==se,this._pitching=Se!==H,this._padding=!P.isPaddingEqual(we),this._prepareEase(f,!1),this._ease(function(ni){var Xt=ni*di,Hi=1/Di(Xt);P.zoom=ni===1?ue:B+P.scaleZoom(Hi),T._rotating&&(P.bearing=y.number(G,se,ni)),T._pitching&&(P.pitch=y.number(H,Se,ni)),T._padding&&(P.interpolatePadding(oe,we,ni),Ee=P.centerPoint.add(ge));var Jr=ni===1?je:P.unproject(He.add(Ye.mult(vi(Xt))).mult(Hi));P.setLocationAtPoint(P.renderWorldCopies?Jr.wrap():Jr,Ee),T._fireMoveEvents(f)},function(){return T._afterEase(f)},u),this},c.prototype.isEasing=function(){return!!this._easeFrameId},c.prototype.stop=function(){return this._stop()},c.prototype._stop=function(u,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var T=this._onEaseEnd;delete this._onEaseEnd,T.call(this,f)}if(!u){var z=this.handlers;z&&z.stop(!1)}return this},c.prototype._ease=function(u,f,T){T.animate===!1||T.duration===0?(u(1),f()):(this._easeStart=y.browser.now(),this._easeOptions=T,this._onEaseFrame=u,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},c.prototype._renderFrameCallback=function(){var u=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},c.prototype._normalizeBearing=function(u,f){u=y.wrap(u,-180,180);var T=Math.abs(u-f);return Math.abs(u-360-f)<T&&(u-=360),Math.abs(u+360-f)<T&&(u+=360),u},c.prototype._normalizeCenter=function(u){var f=this.transform;if(f.renderWorldCopies&&!f.lngRange){var T=u.lng-f.center.lng;u.lng+=T>180?-360:T<-180?360:0}},c}(y.Evented),_n=function(l){l===void 0&&(l={}),this.options=l,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};_n.prototype.getDefaultPosition=function(){return"bottom-right"},_n.prototype.onAdd=function(l){var c=this.options&&this.options.compact;return this._map=l,this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ce.create("button","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.type="button",this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ce.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("maplibregl-compact","mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_n.prototype.onRemove=function(){ce.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_n.prototype._setElementTitle=function(l,c){var u=this._map._getUIString("AttributionControl."+c);l.title=u,l.setAttribute("aria-label",u)},_n.prototype._toggleAttribution=function(){this._container.classList.contains("maplibregl-compact-show")||this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},_n.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(l){var u=c.reduce(function(f,T,z){return T.value&&(f+=T.key+"="+T.value+(z<c.length-1?"&":"")),f},"?");l.href=y.config.FEEDBACK_URL+"/"+u+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},_n.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},_n.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(B){return typeof B!="string"?"":B})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}var u=this._map.style.sourceCaches;for(var f in u){var T=u[f];if(T.used){var z=T.getSource();z.attribution&&l.indexOf(z.attribution)<0&&l.push(z.attribution)}}l.sort(function(B,G){return B.length-G.length});var P=(l=l.filter(function(B,G){for(var H=G+1;H<l.length;H++)if(l[H].indexOf(B)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._editLink=null)}},_n.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("maplibregl-compact","mapboxgl-compact"):this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show")};var $n=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};$n.prototype.onAdd=function(l){this._map=l,this._container=ce.create("div","maplibregl-ctrl mapboxgl-ctrl");var c=ce.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},$n.prototype.onRemove=function(){ce.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},$n.prototype.getDefaultPosition=function(){return"bottom-left"},$n.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},$n.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var c in l)if(l[c].getSource().mapbox_logo)return!0;return!1}},$n.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var c=l[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("maplibregl-compact","mapboxgl-compact"):c.classList.remove("maplibregl-compact","mapboxgl-compact")}};var b=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};b.prototype.add=function(l){var c=++this._id;return this._queue.push({callback:l,id:c,cancelled:!1}),c},b.prototype.remove=function(l){for(var c=this._currentlyRunning,u=0,f=c?this._queue.concat(c):this._queue;u<f.length;u+=1){var T=f[u];if(T.id===l)return void(T.cancelled=!0)}},b.prototype.run=function(l){l===void 0&&(l=0);var c=this._currentlyRunning=this._queue;this._queue=[];for(var u=0,f=c;u<f.length;u+=1){var T=f[u];if(!T.cancelled&&(T.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},b.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var o={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},h=y.window.HTMLImageElement,x=y.window.HTMLElement,S=y.window.ImageBitmap,k={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},D=function(l){function c(f){var T=this;if((f=y.extend({},k,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var z=new Gi(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies);if(l.call(this,z,f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new b,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},o,f.locale),this._clickTolerance=f.clickTolerance,this._requestManager=new y.RequestManager(f.transformRequest,f.accessToken),typeof f.container=="string"){if(this._container=y.window.document.getElementById(f.container),!this._container)throw new Error("Container '"+f.container+"' not found.")}else{if(!(f.container instanceof x))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return T._update(!1)}),this.on("moveend",function(){return T._update(!1)}),this.on("zoom",function(){return T._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gt(this,f),this._hash=f.hash&&new Ut(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,y.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new _n({customAttribution:f.customAttribution})),this.addControl(new $n,f.logoPosition),this.on("style.load",function(){T.transform.unmodified&&T.jumpTo(T.style.stylesheet)}),this.on("data",function(P){T._update(P.dataType==="style"),T.fire(new y.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){T.fire(new y.Event(P.dataType+"dataloading",P))})}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return c.prototype._getMapId=function(){return this._mapId},c.prototype.addControl=function(f,T){if(T===void 0&&(T=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var z=f.onAdd(this);this._controls.push(f);var P=this._controlPositions[T];return T.indexOf("bottom")!==-1?P.insertBefore(z,P.firstChild):P.appendChild(z),this},c.prototype.removeControl=function(f){if(!f||!f.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var T=this._controls.indexOf(f);return T>-1&&this._controls.splice(T,1),f.onRemove(this),this},c.prototype.hasControl=function(f){return this._controls.indexOf(f)>-1},c.prototype.resize=function(f){var T=this._containerDimensions(),z=T[0],P=T[1];this._resizeCanvas(z,P),this.transform.resize(z,P),this.painter.resize(z,P);var B=!this._moving;return B&&(this.stop(),this.fire(new y.Event("movestart",f)).fire(new y.Event("move",f))),this.fire(new y.Event("resize",f)),B&&this.fire(new y.Event("moveend",f)),this},c.prototype.getBounds=function(){return this.transform.getBounds()},c.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},c.prototype.setMaxBounds=function(f){return this.transform.setMaxBounds(y.LngLatBounds.convert(f)),this._update()},c.prototype.setMinZoom=function(f){if((f=f==null?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},c.prototype.getMinZoom=function(){return this.transform.minZoom},c.prototype.setMaxZoom=function(f){if((f=f==null?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")},c.prototype.getMaxZoom=function(){return this.transform.maxZoom},c.prototype.setMinPitch=function(f){if((f=f==null?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},c.prototype.getMinPitch=function(){return this.transform.minPitch},c.prototype.setMaxPitch=function(f){if((f=f==null?60:f)>60)throw new Error("maxPitch must be less than or equal to 60");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")},c.prototype.getMaxPitch=function(){return this.transform.maxPitch},c.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},c.prototype.setRenderWorldCopies=function(f){return this.transform.renderWorldCopies=f,this._update()},c.prototype.project=function(f){return this.transform.locationPoint(y.LngLat.convert(f))},c.prototype.unproject=function(f){return this.transform.pointLocation(y.Point.convert(f))},c.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},c.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},c.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},c.prototype._createDelegatedListener=function(f,T,z){var P,B=this;if(f==="mouseenter"||f==="mouseover"){var G=!1;return{layer:T,listener:z,delegates:{mousemove:function(oe){var ue=B.getLayer(T)?B.queryRenderedFeatures(oe.point,{layers:[T]}):[];ue.length?G||(G=!0,z.call(B,new nn(f,B,oe.originalEvent,{features:ue}))):G=!1},mouseout:function(){G=!1}}}}if(f==="mouseleave"||f==="mouseout"){var H=!1;return{layer:T,listener:z,delegates:{mousemove:function(oe){(B.getLayer(T)?B.queryRenderedFeatures(oe.point,{layers:[T]}):[]).length?H=!0:H&&(H=!1,z.call(B,new nn(f,B,oe.originalEvent)))},mouseout:function(oe){H&&(H=!1,z.call(B,new nn(f,B,oe.originalEvent)))}}}}return{layer:T,listener:z,delegates:(P={},P[f]=function(oe){var ue=B.getLayer(T)?B.queryRenderedFeatures(oe.point,{layers:[T]}):[];ue.length&&(oe.features=ue,z.call(B,oe),delete oe.features)},P)}},c.prototype.on=function(f,T,z){if(z===void 0)return l.prototype.on.call(this,f,T);var P=this._createDelegatedListener(f,T,z);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(P),P.delegates)this.on(B,P.delegates[B]);return this},c.prototype.once=function(f,T,z){if(z===void 0)return l.prototype.once.call(this,f,T);var P=this._createDelegatedListener(f,T,z);for(var B in P.delegates)this.once(B,P.delegates[B]);return this},c.prototype.off=function(f,T,z){var P=this;return z===void 0?l.prototype.off.call(this,f,T):(this._delegatedListeners&&this._delegatedListeners[f]&&function(B){for(var G=B[f],H=0;H<G.length;H++){var oe=G[H];if(oe.layer===T&&oe.listener===z){for(var ue in oe.delegates)P.off(ue,oe.delegates[ue]);return G.splice(H,1),P}}}(this._delegatedListeners),this)},c.prototype.queryRenderedFeatures=function(f,T){if(!this.style)return[];var z;if(T!==void 0||f===void 0||f instanceof y.Point||Array.isArray(f)||(T=f,f=void 0),T=T||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof f[0]=="number")z=[y.Point.convert(f)];else{var P=y.Point.convert(f[0]),B=y.Point.convert(f[1]);z=[P,new y.Point(B.x,P.y),B,new y.Point(P.x,B.y),P]}return this.style.queryRenderedFeatures(z,T,this.transform)},c.prototype.querySourceFeatures=function(f,T){return this.style.querySourceFeatures(f,T)},c.prototype.setStyle=function(f,T){return(T=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},T)).diff!==!1&&T.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,T),this):(this._localIdeographFontFamily=T.localIdeographFontFamily,this._updateStyle(f,T))},c.prototype.setTransformRequest=function(f){return this._requestManager.setTransformRequest(f),this},c.prototype._getUIString=function(f){var T=this._locale[f];if(T==null)throw new Error("Missing UI string '"+f+"'");return T},c.prototype._updateStyle=function(f,T){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new yo(this,T||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)},c.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new yo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},c.prototype._diffStyle=function(f,T){var z=this;if(typeof f=="string"){var P=this._requestManager.normalizeStyleURL(f),B=this._requestManager.transformRequest(P,y.ResourceType.Style);y.getJSON(B,function(G,H){G?z.fire(new y.ErrorEvent(G)):H&&z._updateDiff(H,T)})}else typeof f=="object"&&this._updateDiff(f,T)},c.prototype._updateDiff=function(f,T){try{this.style.setState(f)&&this._update(!0)}catch(z){y.warnOnce("Unable to perform style diff: "+(z.message||z.error||z)+".  Rebuilding the style from scratch."),this._updateStyle(f,T)}},c.prototype.getStyle=function(){if(this.style)return this.style.serialize()},c.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},c.prototype.addSource=function(f,T){return this._lazyInitEmptyStyle(),this.style.addSource(f,T),this._update(!0)},c.prototype.isSourceLoaded=function(f){var T=this.style&&this.style.sourceCaches[f];if(T!==void 0)return T.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+f+"'")))},c.prototype.areTilesLoaded=function(){var f=this.style&&this.style.sourceCaches;for(var T in f){var z=f[T]._tiles;for(var P in z){var B=z[P];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},c.prototype.addSourceType=function(f,T,z){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,T,z)},c.prototype.removeSource=function(f){return this.style.removeSource(f),this._update(!0)},c.prototype.getSource=function(f){return this.style.getSource(f)},c.prototype.addImage=function(f,T,z){z===void 0&&(z={});var P=z.pixelRatio;P===void 0&&(P=1);var B=z.sdf;B===void 0&&(B=!1);var G=z.stretchX,H=z.stretchY,oe=z.content;if(this._lazyInitEmptyStyle(),T instanceof h||S&&T instanceof S){var ue=y.browser.getImageData(T);this.style.addImage(f,{data:new y.RGBAImage({width:ue.width,height:ue.height},ue.data),pixelRatio:P,stretchX:G,stretchY:H,content:oe,sdf:B,version:0})}else{if(T.width===void 0||T.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var se=T;this.style.addImage(f,{data:new y.RGBAImage({width:T.width,height:T.height},new Uint8Array(T.data)),pixelRatio:P,stretchX:G,stretchY:H,content:oe,sdf:B,version:0,userImage:se}),se.onAdd&&se.onAdd(this,f)}},c.prototype.updateImage=function(f,T){var z=this.style.getImage(f);if(!z)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=T instanceof h||S&&T instanceof S?y.browser.getImageData(T):T,B=P.width,G=P.height,H=P.data;return B===void 0||G===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==z.data.width||G!==z.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(z.data.replace(H,!(T instanceof h||S&&T instanceof S)),void this.style.updateImage(f,z))},c.prototype.hasImage=function(f){return f?!!this.style.getImage(f):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},c.prototype.removeImage=function(f){this.style.removeImage(f)},c.prototype.loadImage=function(f,T){y.getImage(this._requestManager.transformRequest(f,y.ResourceType.Image),T)},c.prototype.listImages=function(){return this.style.listImages()},c.prototype.addLayer=function(f,T){return this._lazyInitEmptyStyle(),this.style.addLayer(f,T),this._update(!0)},c.prototype.moveLayer=function(f,T){return this.style.moveLayer(f,T),this._update(!0)},c.prototype.removeLayer=function(f){return this.style.removeLayer(f),this._update(!0)},c.prototype.getLayer=function(f){return this.style.getLayer(f)},c.prototype.setLayerZoomRange=function(f,T,z){return this.style.setLayerZoomRange(f,T,z),this._update(!0)},c.prototype.setFilter=function(f,T,z){return z===void 0&&(z={}),this.style.setFilter(f,T,z),this._update(!0)},c.prototype.getFilter=function(f){return this.style.getFilter(f)},c.prototype.setPaintProperty=function(f,T,z,P){return P===void 0&&(P={}),this.style.setPaintProperty(f,T,z,P),this._update(!0)},c.prototype.getPaintProperty=function(f,T){return this.style.getPaintProperty(f,T)},c.prototype.setLayoutProperty=function(f,T,z,P){return P===void 0&&(P={}),this.style.setLayoutProperty(f,T,z,P),this._update(!0)},c.prototype.getLayoutProperty=function(f,T){return this.style.getLayoutProperty(f,T)},c.prototype.setLight=function(f,T){return T===void 0&&(T={}),this._lazyInitEmptyStyle(),this.style.setLight(f,T),this._update(!0)},c.prototype.getLight=function(){return this.style.getLight()},c.prototype.setFeatureState=function(f,T){return this.style.setFeatureState(f,T),this._update()},c.prototype.removeFeatureState=function(f,T){return this.style.removeFeatureState(f,T),this._update()},c.prototype.getFeatureState=function(f){return this.style.getFeatureState(f)},c.prototype.getContainer=function(){return this._container},c.prototype.getCanvasContainer=function(){return this._canvasContainer},c.prototype.getCanvas=function(){return this._canvas},c.prototype._containerDimensions=function(){var f=0,T=0;return this._container&&(f=this._container.clientWidth||400,T=this._container.clientHeight||300),[f,T]},c.prototype._setupContainer=function(){var f=this._container;f.classList.add("maplibregl-map","mapboxgl-map");var T=this._canvasContainer=ce.create("div","maplibregl-canvas-container mapboxgl-canvas-container",f);this._interactive&&T.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=ce.create("canvas","maplibregl-canvas mapboxgl-canvas",T),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var z=this._containerDimensions();this._resizeCanvas(z[0],z[1]);var P=this._controlContainer=ce.create("div","maplibregl-control-container mapboxgl-control-container",f),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){B[G]=ce.create("div","maplibregl-ctrl-"+G+" mapboxgl-ctrl-"+G,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},c.prototype._resizeCanvas=function(f,T){var z=y.browser.devicePixelRatio||1;this._canvas.width=z*f,this._canvas.height=z*T,this._canvas.style.width=f+"px",this._canvas.style.height=T+"px"},c.prototype._setupPainter=function(){var f=y.extend({},v.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),T=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);T?(this.painter=new fr(T,this.transform),y.webpSupported.testSupport(T)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},c.prototype._contextLost=function(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:f}))},c.prototype._contextRestored=function(f){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:f}))},c.prototype._onMapScroll=function(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},c.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},c.prototype._update=function(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this},c.prototype._requestRenderFrame=function(f){return this._update(),this._renderTaskQueue.add(f)},c.prototype._cancelRenderFrame=function(f){this._renderTaskQueue.remove(f)},c.prototype._render=function(f){var T,z=this,P=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(T=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,T),P=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,oe=y.browser.now();this.style.zoomHistory.update(H,oe);var ue=new y.EvaluationParameters(H,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=ue.crossFadingFactor();se===1&&se===this._crossFadingFactor||(G=!0,this._crossFadingFactor=se),this.style.update(ue)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Se=y.browser.now()-P;B.endQueryEXT(B.TIME_ELAPSED_EXT,T),setTimeout(function(){var ge=B.getQueryObjectEXT(T,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(T),z.fire(new y.Event("gpu-timing-frame",{cpuTime:Se,gpuTime:ge}))},50)}if(this.listens("gpu-timing-layer")){var we=this.painter.collectGpuTimers();setTimeout(function(){var ge=z.painter.queryGpuTimers(we);z.fire(new y.Event("gpu-timing-layer",{layerTimes:ge}))},50)}var Ae=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ae||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||Ae||(this._fullyLoaded=!0),this}},c.prototype.remove=function(){this._hash&&this._hash.remove();for(var f=0,T=this._controls;f<T.length;f+=1)T[f].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var z=this.painter.context.gl.getExtension("WEBGL_lose_context");z&&z.loseContext(),U(this._canvasContainer),U(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},c.prototype.triggerRepaint=function(){var f=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(T){f._frame=null,f._render(T)}))},c.prototype._onWindowOnline=function(){this._update()},c.prototype._onWindowResize=function(f){this._trackResize&&this.resize({originalEvent:f})._update()},u.showTileBoundaries.get=function(){return!!this._showTileBoundaries},u.showTileBoundaries.set=function(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())},u.showPadding.get=function(){return!!this._showPadding},u.showPadding.set=function(f){this._showPadding!==f&&(this._showPadding=f,this._update())},u.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},u.showCollisionBoxes.set=function(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())},u.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},u.showOverdrawInspector.set=function(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())},u.repaint.get=function(){return!!this._repaint},u.repaint.set=function(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())},u.vertices.get=function(){return!!this._vertices},u.vertices.set=function(f){this._vertices=f,this._update()},c.prototype._setCacheLimits=function(f,T){y.setCacheLimits(f,T)},u.version.get=function(){return y.version},Object.defineProperties(c.prototype,u),c}(ui);function U(l){l.parentNode&&l.parentNode.removeChild(l)}var N={showCompass:!0,showZoom:!0,visualizePitch:!1},X=function(l){var c=this;this.options=y.extend({},N,l),this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(u){return u.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",function(u){return c._map.zoomIn({},{originalEvent:u})}),ce.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",function(u){return c._map.zoomOut({},{originalEvent:u})}),ce.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",function(u){c.options.visualizePitch?c._map.resetNorthPitch({},{originalEvent:u}):c._map.resetNorth({},{originalEvent:u})}),this._compassIcon=ce.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};X.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),c=l===this._map.getMaxZoom(),u=l===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},X.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},X.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new K(this._map,this._compass,this.options.visualizePitch)),this._container},X.prototype.onRemove=function(){ce.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},X.prototype._createButton=function(l,c){var u=ce.create("button",l,this._container);return u.type="button",u.addEventListener("click",c),u},X.prototype._setButtonTitle=function(l,c){var u=this._map._getUIString("NavigationControl."+c);l.title=u,l.setAttribute("aria-label",u)};var K=function(l,c,u){u===void 0&&(u=!1),this._clickTolerance=10,this.element=c,this.mouseRotate=new ma({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,u&&(this.mousePitch=new ws({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ce.addEventListener(c,"mousedown",this.mousedown),ce.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),ce.addEventListener(c,"touchmove",this.touchmove),ce.addEventListener(c,"touchend",this.touchend),ce.addEventListener(c,"touchcancel",this.reset)};function ae(l,c,u){if(l=new y.LngLat(l.lng,l.lat),c){var f=new y.LngLat(l.lng-360,l.lat),T=new y.LngLat(l.lng+360,l.lat),z=u.locationPoint(l).distSqr(c);u.locationPoint(f).distSqr(c)<z?l=f:u.locationPoint(T).distSqr(c)<z&&(l=T)}for(;Math.abs(l.lng-u.center.lng)>180;){var P=u.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=u.width&&P.y<=u.height)break;l.lng>u.center.lng?l.lng-=360:l.lng+=360}return l}K.prototype.down=function(l,c){this.mouseRotate.mousedown(l,c),this.mousePitch&&this.mousePitch.mousedown(l,c),ce.disableDrag()},K.prototype.move=function(l,c){var u=this.map,f=this.mouseRotate.mousemoveWindow(l,c);if(f&&f.bearingDelta&&u.setBearing(u.getBearing()+f.bearingDelta),this.mousePitch){var T=this.mousePitch.mousemoveWindow(l,c);T&&T.pitchDelta&&u.setPitch(u.getPitch()+T.pitchDelta)}},K.prototype.off=function(){var l=this.element;ce.removeEventListener(l,"mousedown",this.mousedown),ce.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),ce.removeEventListener(l,"touchmove",this.touchmove),ce.removeEventListener(l,"touchend",this.touchend),ce.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},K.prototype.offTemp=function(){ce.enableDrag(),ce.removeEventListener(y.window,"mousemove",this.mousemove),ce.removeEventListener(y.window,"mouseup",this.mouseup)},K.prototype.mousedown=function(l){this.down(y.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),ce.mousePos(this.element,l)),ce.addEventListener(y.window,"mousemove",this.mousemove),ce.addEventListener(y.window,"mouseup",this.mouseup)},K.prototype.mousemove=function(l){this.move(l,ce.mousePos(this.element,l))},K.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},K.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ce.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},K.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=ce.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},K.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},K.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var fe={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ze(l,c,u){var f=l.classList;for(var T in fe)f.remove("maplibregl-"+u+"-anchor-"+T,"mapboxgl-"+u+"-anchor-"+T);f.add("maplibregl-"+u+"-anchor-"+c,"mapboxgl-"+u+"-anchor-"+c)}var me,Ce=function(l){function c(u,f){if(l.call(this),(u instanceof y.window.HTMLElement||f)&&(u=y.extend({element:u},f)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment!=="auto"?u.pitchAlignment:this._rotationAlignment,u&&u.element)this._element=u.element,this._offset=y.Point.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=ce.create("div"),this._element.setAttribute("aria-label","Map marker");var T=ce.createNS("http://www.w3.org/2000/svg","svg");T.setAttributeNS(null,"display","block"),T.setAttributeNS(null,"height","41px"),T.setAttributeNS(null,"width","27px"),T.setAttributeNS(null,"viewBox","0 0 27 41");var z=ce.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"stroke","none"),z.setAttributeNS(null,"stroke-width","1"),z.setAttributeNS(null,"fill","none"),z.setAttributeNS(null,"fill-rule","evenodd");var P=ce.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var B=ce.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var G=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<H.length;G+=1){var oe=H[G],ue=ce.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",oe.rx),ue.setAttributeNS(null,"ry",oe.ry),B.appendChild(ue)}var se=ce.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"fill",this._color);var Se=ce.createNS("http://www.w3.org/2000/svg","path");Se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),se.appendChild(Se);var we=ce.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");var Ae=ce.createNS("http://www.w3.org/2000/svg","path");Ae.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(Ae);var ge=ce.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");var Ee=ce.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Re=ce.createNS("http://www.w3.org/2000/svg","circle");Re.setAttributeNS(null,"fill","#000000"),Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"cx","5.5"),Re.setAttributeNS(null,"cy","5.5"),Re.setAttributeNS(null,"r","5.4999962");var je=ce.createNS("http://www.w3.org/2000/svg","circle");je.setAttributeNS(null,"fill","#FFFFFF"),je.setAttributeNS(null,"cx","5.5"),je.setAttributeNS(null,"cy","5.5"),je.setAttributeNS(null,"r","5.4999962"),Ee.appendChild(Re),Ee.appendChild(je),P.appendChild(B),P.appendChild(se),P.appendChild(we),P.appendChild(ge),P.appendChild(Ee),T.appendChild(P),T.setAttributeNS(null,"height",41*this._scale+"px"),T.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(T),this._offset=y.Point.convert(u&&u.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",function(He){He.preventDefault()}),this._element.addEventListener("mousedown",function(He){He.preventDefault()}),ze(this._element,this._anchor,"marker"),this._popup=null}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.addTo=function(u){return this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},c.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ce.remove(this._element),this._popup&&this._popup.remove(),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=y.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},c.prototype.getElement=function(){return this._element},c.prototype.setPopup=function(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){var f=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=u,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},c.prototype._onKeyPress=function(u){var f=u.code,T=u.charCode||u.keyCode;f!=="Space"&&f!=="Enter"&&T!==32&&T!==13||this.togglePopup()},c.prototype._onMapClick=function(u){var f=u.originalEvent.target,T=this._element;this._popup&&(f===T||T.contains(f))&&this.togglePopup()},c.prototype.getPopup=function(){return this._popup},c.prototype.togglePopup=function(){var u=this._popup;return u?(u.isOpen()?u.remove():u.addTo(this._map),this):this},c.prototype._update=function(u){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ae(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(f="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T="rotateX("+this._map.getPitch()+"deg)"),u&&u.type!=="moveend"||(this._pos=this._pos.round()),ce.setTransform(this._element,fe[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+T+" "+f)}},c.prototype.getOffset=function(){return this._offset},c.prototype.setOffset=function(u){return this._offset=y.Point.convert(u),this._update(),this},c.prototype._onMove=function(u){if(!this._isDragging){var f=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},c.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},c.prototype._addDragHandler=function(u){this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},c.prototype.setDraggable=function(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},c.prototype.isDraggable=function(){return this._draggable},c.prototype.setRotation=function(u){return this._rotation=u||0,this._update(),this},c.prototype.getRotation=function(){return this._rotation},c.prototype.setRotationAlignment=function(u){return this._rotationAlignment=u||"auto",this._update(),this},c.prototype.getRotationAlignment=function(){return this._rotationAlignment},c.prototype.setPitchAlignment=function(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this},c.prototype.getPitchAlignment=function(){return this._pitchAlignment},c}(y.Evented),Ne={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ve=0,We=!1,Ze=function(l){function c(u){l.call(this),this.options=y.extend({},Ne,u),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.onAdd=function(u){var f;return this._map=u,this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),f=this._setupUI,me!==void 0?f(me):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(T){f(me=T.state!=="denied")}):f(me=!!y.window.navigator.geolocation),this._container},c.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ce.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ve=0,We=!1},c.prototype._isOutOfMapMaxBounds=function(u){var f=this._map.getMaxBounds(),T=u.coords;return f&&(T.longitude<f.getWest()||T.longitude>f.getEast()||T.latitude<f.getSouth()||T.latitude>f.getNorth())},c.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}},c.prototype._onSuccess=function(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",u)),this._finish()}},c.prototype._updateCamera=function(u){var f=new y.LngLat(u.coords.longitude,u.coords.latitude),T=u.coords.accuracy,z=this._map.getBearing(),P=y.extend({bearing:z},this.options.fitBoundsOptions);this._map.fitBounds(f.toBounds(T),P,{geolocateSource:!0})},c.prototype._updateMarker=function(u){if(u){var f=new y.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},c.prototype._updateCircleRadius=function(){var u=this._map._container.clientHeight/2,f=this._map.unproject([0,u]),T=this._map.unproject([1,u]),z=f.distanceTo(T),P=Math.ceil(2*this._accuracy/z);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},c.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},c.prototype._onError=function(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&We)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",u)),this._finish()}},c.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},c.prototype._setupUI=function(u){var f=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=ce.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),ce.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var T=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}else{var z=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=z,this._geolocateButton.setAttribute("aria-label",z)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ce.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ce(this._dotElement),this._circleElement=ce.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ce({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||f._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(f._watchState="BACKGROUND",f._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),f._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),f.fire(new y.Event("trackuserlocationend")))})},c.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ve--,We=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ve>1?(u={maximumAge:6e5,timeout:0},We=!0):(u=this.options.positionOptions,We=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},c.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},c}(y.Evented),ut={maxWidth:100,unit:"metric"},it=function(l){this.options=y.extend({},ut,l),y.bindAll(["_onMove","setUnit"],this)};function rt(l,c,u){var f=u&&u.maxWidth||100,T=l._container.clientHeight/2,z=l.unproject([0,T]),P=l.unproject([f,T]),B=z.distanceTo(P);if(u&&u.unit==="imperial"){var G=3.2808*B;G>5280?ft(c,f,G/5280,l._getUIString("ScaleControl.Miles")):ft(c,f,G,l._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?ft(c,f,B/1852,l._getUIString("ScaleControl.NauticalMiles")):B>=1e3?ft(c,f,B/1e3,l._getUIString("ScaleControl.Kilometers")):ft(c,f,B,l._getUIString("ScaleControl.Meters"))}function ft(l,c,u,f){var T,z,P,B=(T=u,(z=Math.pow(10,(""+Math.floor(T)).length-1))*(P=(P=T/z)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(G){var H=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*H)/H}(P)));l.style.width=c*(B/u)+"px",l.innerHTML=B+"&nbsp;"+f}it.prototype.getDefaultPosition=function(){return"bottom-left"},it.prototype._onMove=function(){rt(this._map,this._container,this.options)},it.prototype.onAdd=function(l){return this._map=l,this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},it.prototype.onRemove=function(){ce.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},it.prototype.setUnit=function(l){this.options.unit=l,rt(this._map,this._container,this.options)};var _t=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof y.window.HTMLElement?this._container=l.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};_t.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},_t.prototype.onRemove=function(){ce.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},_t.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},_t.prototype._setupUI=function(){var l=this._fullscreenButton=ce.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);ce.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},_t.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},_t.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},_t.prototype._isFullscreen=function(){return this._fullscreen},_t.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},_t.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var lt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gt=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Lt=function(l){function c(u){l.call(this),this.options=y.extend(Object.create(lt),u),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.addTo=function(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},c.prototype.isOpen=function(){return!!this._map},c.prototype.remove=function(){return this._content&&ce.remove(this._content),this._container&&(ce.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=y.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this},c.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this},c.prototype.getElement=function(){return this._container},c.prototype.setText=function(u){return this.setDOMContent(y.window.document.createTextNode(u))},c.prototype.setHTML=function(u){var f,T=y.window.document.createDocumentFragment(),z=y.window.document.createElement("body");for(z.innerHTML=u;f=z.firstChild;)T.appendChild(f);return this.setDOMContent(T)},c.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},c.prototype.setMaxWidth=function(u){return this.options.maxWidth=u,this._update(),this},c.prototype.setDOMContent=function(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ce.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this},c.prototype.addClassName=function(u){this._container&&this._container.classList.add(u)},c.prototype.removeClassName=function(u){this._container&&this._container.classList.remove(u)},c.prototype.setOffset=function(u){return this.options.offset=u,this._update(),this},c.prototype.toggleClassName=function(u){if(this._container)return this._container.classList.toggle(u)},c.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=ce.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},c.prototype._onMouseUp=function(u){this._update(u.point)},c.prototype._onMouseMove=function(u){this._update(u.point)},c.prototype._onDrag=function(u){this._update(u.point)},c.prototype._update=function(u){var f=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=ce.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=ce.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ue){return f._container.classList.add(ue)}),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ae(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||u)){var T=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),z=this.options.anchor,P=function ue(se){if(se){if(typeof se=="number"){var Se=Math.round(Math.sqrt(.5*Math.pow(se,2)));return{center:new y.Point(0,0),top:new y.Point(0,se),"top-left":new y.Point(Se,Se),"top-right":new y.Point(-Se,Se),bottom:new y.Point(0,-se),"bottom-left":new y.Point(Se,-Se),"bottom-right":new y.Point(-Se,-Se),left:new y.Point(se,0),right:new y.Point(-se,0)}}if(se instanceof y.Point||Array.isArray(se)){var we=y.Point.convert(se);return{center:we,top:we,"top-left":we,"top-right":we,bottom:we,"bottom-left":we,"bottom-right":we,left:we,right:we}}return{center:y.Point.convert(se.center||[0,0]),top:y.Point.convert(se.top||[0,0]),"top-left":y.Point.convert(se["top-left"]||[0,0]),"top-right":y.Point.convert(se["top-right"]||[0,0]),bottom:y.Point.convert(se.bottom||[0,0]),"bottom-left":y.Point.convert(se["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(se["bottom-right"]||[0,0]),left:y.Point.convert(se.left||[0,0]),right:y.Point.convert(se.right||[0,0])}}return ue(new y.Point(0,0))}(this.options.offset);if(!z){var B,G=this._container.offsetWidth,H=this._container.offsetHeight;B=T.y+P.bottom.y<H?["top"]:T.y>this._map.transform.height-H?["bottom"]:[],T.x<G/2?B.push("left"):T.x>this._map.transform.width-G/2&&B.push("right"),z=B.length===0?"bottom":B.join("-")}var oe=T.add(P[z]).round();ce.setTransform(this._container,fe[z]+" translate("+oe.x+"px,"+oe.y+"px)"),ze(this._container,z,"popup")}},c.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var u=this._container.querySelector(Gt);u&&u.focus()}},c.prototype._onClose=function(){this.remove()},c}(y.Evented),yi={version:y.version,supported:v,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:D,NavigationControl:X,GeolocateControl:Ze,AttributionControl:_n,ScaleControl:it,FullscreenControl:_t,Popup:Lt,Marker:Ce,Style:yo,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Ie().acquire(j)},clearPrewarmedResources:function(){var l=ne;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(j),ne=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(l){y.config.ACCESS_TOKEN=l},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(l){y.config.API_URL=l},get workerCount(){return J.workerCount},set workerCount(l){J.workerCount=l},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){y.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){y.clearTileCache(l)},workerUrl:"",addProtocol:function(l,c){y.config.REGISTERED_PROTOCOLS[l]=c},removeProtocol:function(l){delete y.config.REGISTERED_PROTOCOLS[l]}};return yi}),q})})(Dy);var i_=8,r_={version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90\xB0 orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features. Note: fog is renamed to atmosphere in the Android and iOS SDKs and planned to be changed in GL-JS v.3.0.0."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Mercator, Globe, Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Natural Earth, and Winkel Tripel. Terrain, sky and fog are supported by only Mercator and globe. CustomLayerInterface is not supported outside of Mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},n_={"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},o_=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],a_={type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},s_={type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},l_={type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},u_={type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) \u2014 it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},c_={type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},h_={type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},p_={id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},d_=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],f_={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},m_={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},y_={"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},g_={"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},__={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},v_={"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},x_={"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn\u2019t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},b_={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},w_={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},T_={type:"array",value:"*",doc:"A filter selects specific features from a layer."},S_={type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},I_={type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},E_={type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},k_={type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},A_={type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},z_={type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] \u2260 value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] \u2265 value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] \u2264 value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] \u2208 {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] \u2209 {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 \u2227 ... \u2227 fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 \u2228 ... \u2228 fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `\xACf0 \u2227 ... \u2227 \xACfn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},C_={type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},P_={type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},M_={type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},D_={doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},L_={range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region immediately below the horizon and within the `range` and above the horizon and within `horizon-blend`. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region above the horizon, `high-color` extends further above the horizon than the `color` property and its spread can be controlled with `horizon-blend`. The opacity can be set to `0` to remove the high atmosphere color contribution.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the region above the horizon and after the end of the `horizon-blend` contribution. The opacity can be set to `0` to have a transparent background.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the atmosphere to the color of space. A value of zero leaves a sharp transition from atmosphere to space. Increasing the value blends the color of atmosphere into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"A value controlling the star intensity where `0` will show no stars and `1` will show stars at their maximum intensity.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}}},R_={anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0\xB0 (0\xB0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0\xB0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0\xB0, directly above, to 180\xB0, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},B_={name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carr\xE9e projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},F_={source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.",requires:["source"],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},O_=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],U_={"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},j_={"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",doc:"The line part between [trim-start, trim-end] will be marked as transparent to make a route vanishing effect. The line trim-off offset is based on the whole line range [0.0, 1.0].",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"2.9.0",android:"10.5.0",ios:"10.5.0",macos:"10.5.0"}},"property-type":"constant"}},V_={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},N_={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},q_={"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},Z_={"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},G_={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},$_={"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},X_={"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0\xB0 north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0\xB0 is directly above, at zenith, and 90\xB0 at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0\xB0 north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0\xB0 is directly above, at zenith, and 90\xB0 at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},W_={duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},H_={"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}},K_={$version:i_,$root:r_,sources:n_,source:o_,source_vector:a_,source_raster:s_,source_raster_dem:l_,source_geojson:u_,source_video:c_,source_image:h_,layer:p_,layout:d_,layout_background:f_,layout_sky:m_,layout_fill:y_,layout_circle:g_,layout_heatmap:__,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:v_,layout_symbol:x_,layout_raster:b_,layout_hillshade:w_,filter:T_,filter_symbol:S_,filter_fill:I_,filter_line:E_,filter_circle:k_,"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:A_,filter_operator:z_,geometry_type:C_,function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:`A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:
* In categorical functions, when the feature value does not match any of the stop domain values.
* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.
* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a \`circle-color\` property but the feature property value is not a string or not a valid color).
* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.
If no default is provided, the style property's default is used in these circumstances.`}},function_stop:P_,expression:M_,expression_name:D_,fog:L_,light:R_,projection:B_,terrain:F_,paint:O_,paint_fill:U_,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:j_,paint_circle:V_,paint_heatmap:N_,paint_symbol:q_,paint_raster:Z_,paint_hillshade:G_,paint_background:$_,paint_sky:X_,transition:W_,"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:H_},uf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function td(C){var w={exports:{}};return C(w,w.exports),w.exports}function J_(C){throw new Error('Could not dynamically require "'+C+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}/*! https://mths.be/punycode v1.3.2 by @mathias */td(function(C,w){(function(A){var R=w&&!w.nodeType&&w,q=C&&!C.nodeType&&C,Y=typeof uf=="object"&&uf;(Y.global===Y||Y.window===Y||Y.self===Y)&&(A=Y);var y,v=2147483647,ce=36,Te=1,Oe=26,Xe=38,xe=700,dt=72,zt=128,ci="-",Ct=/^xn--/,hr=/[^\x20-\x7E]/,wt=/[\x2E\u3002\uFF0E\uFF61]/g,Et={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},oi=ce-Te,Jt=Math.floor,Kt=String.fromCharCode,pi;function or(kt){throw RangeError(Et[kt])}function zi(kt,ti){for(var si=kt.length,Fi=[];si--;)Fi[si]=ti(kt[si]);return Fi}function sn(kt,ti){var si=kt.split("@"),Fi="";si.length>1&&(Fi=si[0]+"@",kt=si[1]),kt=kt.replace(wt,".");var Oi=kt.split("."),Qi=zi(Oi,ti).join(".");return Fi+Qi}function Xr(kt){for(var ti=[],si=0,Fi=kt.length,Oi,Qi;si<Fi;)Oi=kt.charCodeAt(si++),Oi>=55296&&Oi<=56319&&si<Fi?(Qi=kt.charCodeAt(si++),(Qi&64512)==56320?ti.push(((Oi&1023)<<10)+(Qi&1023)+65536):(ti.push(Oi),si--)):ti.push(Oi);return ti}function fn(kt){return zi(kt,function(ti){var si="";return ti>65535&&(ti-=65536,si+=Kt(ti>>>10&1023|55296),ti=56320|ti&1023),si+=Kt(ti),si}).join("")}function lr(kt){return kt-48<10?kt-22:kt-65<26?kt-65:kt-97<26?kt-97:ce}function Li(kt,ti){return kt+22+75*(kt<26)-((ti!=0)<<5)}function Yr(kt,ti,si){var Fi=0;for(kt=si?Jt(kt/xe):kt>>1,kt+=Jt(kt/ti);kt>oi*Oe>>1;Fi+=ce)kt=Jt(kt/oi);return Jt(Fi+(oi+1)*kt/(kt+Xe))}function Wt(kt){var ti=[],si=kt.length,Fi,Oi=0,Qi=zt,Ui=dt,ji,ir,gi,vr,Ar,zr,Ht,jr,Sr;for(ji=kt.lastIndexOf(ci),ji<0&&(ji=0),ir=0;ir<ji;++ir)kt.charCodeAt(ir)>=128&&or("not-basic"),ti.push(kt.charCodeAt(ir));for(gi=ji>0?ji+1:0;gi<si;){for(vr=Oi,Ar=1,zr=ce;gi>=si&&or("invalid-input"),Ht=lr(kt.charCodeAt(gi++)),(Ht>=ce||Ht>Jt((v-Oi)/Ar))&&or("overflow"),Oi+=Ht*Ar,jr=zr<=Ui?Te:zr>=Ui+Oe?Oe:zr-Ui,!(Ht<jr);zr+=ce)Sr=ce-jr,Ar>Jt(v/Sr)&&or("overflow"),Ar*=Sr;Fi=ti.length+1,Ui=Yr(Oi-vr,Fi,vr==0),Jt(Oi/Fi)>v-Qi&&or("overflow"),Qi+=Jt(Oi/Fi),Oi%=Fi,ti.splice(Oi++,0,Qi)}return fn(ti)}function Qr(kt){var ti,si,Fi,Oi,Qi,Ui,ji,ir,gi,vr,Ar,zr=[],Ht,jr,Sr,Wr;for(kt=Xr(kt),Ht=kt.length,ti=zt,si=0,Qi=dt,Ui=0;Ui<Ht;++Ui)Ar=kt[Ui],Ar<128&&zr.push(Kt(Ar));for(Fi=Oi=zr.length,Oi&&zr.push(ci);Fi<Ht;){for(ji=v,Ui=0;Ui<Ht;++Ui)Ar=kt[Ui],Ar>=ti&&Ar<ji&&(ji=Ar);for(jr=Fi+1,ji-ti>Jt((v-si)/jr)&&or("overflow"),si+=(ji-ti)*jr,ti=ji,Ui=0;Ui<Ht;++Ui)if(Ar=kt[Ui],Ar<ti&&++si>v&&or("overflow"),Ar==ti){for(ir=si,gi=ce;vr=gi<=Qi?Te:gi>=Qi+Oe?Oe:gi-Qi,!(ir<vr);gi+=ce)Wr=ir-vr,Sr=ce-vr,zr.push(Kt(Li(vr+Wr%Sr,0))),ir=Jt(Wr/Sr);zr.push(Kt(Li(ir,0))),Qi=Yr(si,jr,Fi==Oi),si=0,++Fi}++si,++ti}return zr.join("")}function An(kt){return sn(kt,function(ti){return Ct.test(ti)?Wt(ti.slice(4).toLowerCase()):ti})}function Jn(kt){return sn(kt,function(ti){return hr.test(ti)?"xn--"+Qr(ti):ti})}if(y={version:"1.3.2",ucs2:{decode:Xr,encode:fn},decode:Wt,encode:Qr,toASCII:Jn,toUnicode:An},R&&q)if(C.exports==R)q.exports=y;else for(pi in y)y.hasOwnProperty(pi)&&(R[pi]=y[pi]);else A.punycode=y})(uf)});function Y_(C,w){return Object.prototype.hasOwnProperty.call(C,w)}var Q_=function(C,w,A,R){w=w||"&",A=A||"=";var q={};if(typeof C!="string"||C.length===0)return q;var Y=/\+/g;C=C.split(w);var y=1e3;R&&typeof R.maxKeys=="number"&&(y=R.maxKeys);var v=C.length;y>0&&v>y&&(v=y);for(var ce=0;ce<v;++ce){var Te=C[ce].replace(Y,"%20"),Oe=Te.indexOf(A),Xe,xe,dt,zt;Oe>=0?(Xe=Te.substr(0,Oe),xe=Te.substr(Oe+1)):(Xe=Te,xe=""),dt=decodeURIComponent(Xe),zt=decodeURIComponent(xe),Y_(q,dt)?Array.isArray(q[dt])?q[dt].push(zt):q[dt]=[q[dt],zt]:q[dt]=zt}return q},Zh=function(C){switch(typeof C){case"string":return C;case"boolean":return C?"true":"false";case"number":return isFinite(C)?C:"";default:return""}},ev=function(C,w,A,R){return w=w||"&",A=A||"=",C===null&&(C=void 0),typeof C=="object"?Object.keys(C).map(function(q){var Y=encodeURIComponent(Zh(q))+A;return Array.isArray(C[q])?C[q].map(function(y){return Y+encodeURIComponent(Zh(y))}).join(w):Y+encodeURIComponent(Zh(C[q]))}).join(w):R?encodeURIComponent(Zh(R))+A+encodeURIComponent(Zh(C)):""};td(function(C,w){w.decode=w.parse=Q_,w.encode=w.stringify=ev});function Ly(C,...w){for(const A of w)for(const R in A)C[R]=A[R];return C}class tv extends Error{constructor(w,A){super(A),this.message=A,this.key=w}}var Zl=tv;class Nf{constructor(w,A=[]){this.parent=w,this.bindings={};for(const[R,q]of A)this.bindings[R]=q}concat(w){return new Nf(this,w)}get(w){if(this.bindings[w])return this.bindings[w];if(this.parent)return this.parent.get(w);throw new Error(`${w} not found in scope.`)}has(w){return this.bindings[w]?!0:this.parent?this.parent.has(w):!1}}var iv=Nf;const id={kind:"null"},Vt={kind:"number"},sr={kind:"string"},Ji={kind:"boolean"},gu={kind:"color"},eh={kind:"object"},Yi={kind:"value"},rv={kind:"error"},rd={kind:"collator"},nd={kind:"formatted"},Yh={kind:"resolvedImage"};function Ls(C,w){return{kind:"array",itemType:C,N:w}}function kn(C){if(C.kind==="array"){const w=kn(C.itemType);return typeof C.N=="number"?`array<${w}, ${C.N}>`:C.itemType.kind==="value"?"array":`array<${w}>`}else return C.kind}const nv=[id,Vt,sr,Ji,gu,nd,eh,Ls(Yi),Yh];function Hh(C,w){if(w.kind==="error")return null;if(C.kind==="array"){if(w.kind==="array"&&(w.N===0&&w.itemType.kind==="value"||!Hh(C.itemType,w.itemType))&&(typeof C.N!="number"||C.N===w.N))return null}else{if(C.kind===w.kind)return null;if(C.kind==="value"){for(const A of nv)if(!Hh(A,w))return null}}return`Expected ${kn(C)} but found ${kn(w)} instead.`}function qf(C,w){return w.some(A=>A.kind===C.kind)}function Kh(C,w){return w.some(A=>A==="null"?C===null:A==="array"?Array.isArray(C):A==="object"?C&&!Array.isArray(C)&&typeof C=="object":A===typeof C)}var ov=td(function(C,w){var A={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function R(Te){return Te=Math.round(Te),Te<0?0:Te>255?255:Te}function q(Te){return Te<0?0:Te>1?1:Te}function Y(Te){return Te[Te.length-1]==="%"?R(parseFloat(Te)/100*255):R(parseInt(Te))}function y(Te){return Te[Te.length-1]==="%"?q(parseFloat(Te)/100):q(parseFloat(Te))}function v(Te,Oe,Xe){return Xe<0?Xe+=1:Xe>1&&(Xe-=1),Xe*6<1?Te+(Oe-Te)*Xe*6:Xe*2<1?Oe:Xe*3<2?Te+(Oe-Te)*(2/3-Xe)*6:Te}function ce(Te){var Oe=Te.replace(/ /g,"").toLowerCase();if(Oe in A)return A[Oe].slice();if(Oe[0]==="#"){if(Oe.length===4){var Xe=parseInt(Oe.substr(1),16);return Xe>=0&&Xe<=4095?[(Xe&3840)>>4|(Xe&3840)>>8,Xe&240|(Xe&240)>>4,Xe&15|(Xe&15)<<4,1]:null}else if(Oe.length===7){var Xe=parseInt(Oe.substr(1),16);return Xe>=0&&Xe<=16777215?[(Xe&16711680)>>16,(Xe&65280)>>8,Xe&255,1]:null}return null}var xe=Oe.indexOf("("),dt=Oe.indexOf(")");if(xe!==-1&&dt+1===Oe.length){var zt=Oe.substr(0,xe),ci=Oe.substr(xe+1,dt-(xe+1)).split(","),Ct=1;switch(zt){case"rgba":if(ci.length!==4)return null;Ct=y(ci.pop());case"rgb":return ci.length!==3?null:[Y(ci[0]),Y(ci[1]),Y(ci[2]),Ct];case"hsla":if(ci.length!==4)return null;Ct=y(ci.pop());case"hsl":if(ci.length!==3)return null;var hr=(parseFloat(ci[0])%360+360)%360/360,wt=y(ci[1]),Et=y(ci[2]),oi=Et<=.5?Et*(wt+1):Et+wt-Et*wt,Jt=Et*2-oi;return[R(v(Jt,oi,hr+1/3)*255),R(v(Jt,oi,hr)*255),R(v(Jt,oi,hr-1/3)*255),Ct];default:return null}}return null}try{w.parseCSSColor=ce}catch{}});class Ua{constructor(w,A,R,q=1){this.r=w,this.g=A,this.b=R,this.a=q}static parse(w){if(!w)return;if(w instanceof Ua)return w;if(typeof w!="string")return;const A=ov.parseCSSColor(w);if(!!A)return new Ua(A[0]/255*A[3],A[1]/255*A[3],A[2]/255*A[3],A[3])}toString(){const[w,A,R,q]=this.toArray();return`rgba(${Math.round(w)},${Math.round(A)},${Math.round(R)},${q})`}toArray(){const{r:w,g:A,b:R,a:q}=this;return q===0?[0,0,0,0]:[w*255/q,A*255/q,R*255/q,q]}toArray01(){const{r:w,g:A,b:R,a:q}=this;return q===0?[0,0,0,0]:[w/q,A/q,R/q,q]}toArray01PremultipliedAlpha(){const{r:w,g:A,b:R,a:q}=this;return[w,A,R,q]}}Ua.black=new Ua(0,0,0,1);Ua.white=new Ua(1,1,1,1);Ua.transparent=new Ua(0,0,0,0);Ua.red=new Ua(1,0,0,1);Ua.blue=new Ua(0,0,1,1);var qo=Ua;class Zf{constructor(w,A,R){w?this.sensitivity=A?"variant":"case":this.sensitivity=A?"accent":"base",this.locale=R,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(w,A){return this.collator.compare(w,A)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Df{constructor(w,A,R,q,Y){this.text=w.normalize?w.normalize():w,this.image=A,this.scale=R,this.fontStack=q,this.textColor=Y}}class gl{constructor(w){this.sections=w}static fromString(w){return new gl([new Df(w,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(w=>w.text.length!==0||w.image&&w.image.name.length!==0)}static factory(w){return w instanceof gl?w:gl.fromString(w)}toString(){return this.sections.length===0?"":this.sections.map(w=>w.text).join("")}serialize(){const w=["format"];for(const A of this.sections){if(A.image){w.push(["image",A.image.name]);continue}w.push(A.text);const R={};A.fontStack&&(R["text-font"]=["literal",A.fontStack.split(",")]),A.scale&&(R["font-scale"]=A.scale),A.textColor&&(R["text-color"]=["rgba"].concat(A.textColor.toArray())),w.push(R)}return w}}class vu{constructor(w){this.name=w.name,this.available=w.available}toString(){return this.name}static fromString(w){return w?new vu({name:w,available:!1}):null}serialize(){return["image",this.name]}}function Ry(C,w,A,R){return typeof C=="number"&&C>=0&&C<=255&&typeof w=="number"&&w>=0&&w<=255&&typeof A=="number"&&A>=0&&A<=255?typeof R>"u"||typeof R=="number"&&R>=0&&R<=1?null:`Invalid rgba value [${[C,w,A,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof R=="number"?[C,w,A,R]:[C,w,A]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wp(C){if(C===null)return!0;if(typeof C=="string")return!0;if(typeof C=="boolean")return!0;if(typeof C=="number")return!0;if(C instanceof qo)return!0;if(C instanceof Zf)return!0;if(C instanceof gl)return!0;if(C instanceof vu)return!0;if(Array.isArray(C)){for(const w of C)if(!Wp(w))return!1;return!0}else if(typeof C=="object"){for(const w in C)if(!Wp(C[w]))return!1;return!0}else return!1}function Io(C){if(C===null)return id;if(typeof C=="string")return sr;if(typeof C=="boolean")return Ji;if(typeof C=="number")return Vt;if(C instanceof qo)return gu;if(C instanceof Zf)return rd;if(C instanceof gl)return nd;if(C instanceof vu)return Yh;if(Array.isArray(C)){const w=C.length;let A;for(const R of C){const q=Io(R);if(!A)A=q;else{if(A===q)continue;A=Yi;break}}return Ls(A||Yi,w)}else return eh}function Xh(C){const w=typeof C;return C===null?"":w==="string"||w==="number"||w==="boolean"?String(C):C instanceof qo||C instanceof gl||C instanceof vu?C.toString():JSON.stringify(C)}class Gf{constructor(w,A){this.type=w,this.value=A}static parse(w,A){if(w.length!==2)return A.error(`'literal' expression requires exactly one argument, but found ${w.length-1} instead.`);if(!Wp(w[1]))return A.error("invalid value");const R=w[1];let q=Io(R);const Y=A.expectedType;return q.kind==="array"&&q.N===0&&Y&&Y.kind==="array"&&(typeof Y.N!="number"||Y.N===0)&&(q=Y),new Gf(q,R)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof qo?["rgba"].concat(this.value.toArray()):this.value instanceof gl?this.value.serialize():this.value}}var Hp=Gf;class av{constructor(w){this.name="ExpressionEvaluationError",this.message=w}toJSON(){return this.message}}var Zo=av;const cf={string:sr,number:Vt,boolean:Ji,object:eh};class $f{constructor(w,A){this.type=w,this.args=A}static parse(w,A){if(w.length<2)return A.error("Expected at least one argument.");let R=1,q;const Y=w[0];if(Y==="array"){let v;if(w.length>2){const Te=w[1];if(typeof Te!="string"||!(Te in cf)||Te==="object")return A.error('The item type argument of "array" must be one of string, number, boolean',1);v=cf[Te],R++}else v=Yi;let ce;if(w.length>3){if(w[2]!==null&&(typeof w[2]!="number"||w[2]<0||w[2]!==Math.floor(w[2])))return A.error('The length argument to "array" must be a positive integer literal',2);ce=w[2],R++}q=Ls(v,ce)}else q=cf[Y];const y=[];for(;R<w.length;R++){const v=A.parse(w[R],R,Yi);if(!v)return null;y.push(v)}return new $f(q,y)}evaluate(w){for(let A=0;A<this.args.length;A++){const R=this.args[A].evaluate(w);if(Hh(this.type,Io(R))){if(A===this.args.length-1)throw new Zo(`Expected value to be of type ${kn(this.type)}, but found ${kn(Io(R))} instead.`)}else return R}return null}eachChild(w){this.args.forEach(w)}outputDefined(){return this.args.every(w=>w.outputDefined())}serialize(){const w=this.type,A=[w.kind];if(w.kind==="array"){const R=w.itemType;if(R.kind==="string"||R.kind==="number"||R.kind==="boolean"){A.push(R.kind);const q=w.N;(typeof q=="number"||this.args.length>1)&&A.push(q)}}return A.concat(this.args.map(R=>R.serialize()))}}var yu=$f;class od{constructor(w){this.type=nd,this.sections=w}static parse(w,A){if(w.length<2)return A.error("Expected at least one argument.");const R=w[1];if(!Array.isArray(R)&&typeof R=="object")return A.error("First argument must be an image or text section.");const q=[];let Y=!1;for(let y=1;y<=w.length-1;++y){const v=w[y];if(Y&&typeof v=="object"&&!Array.isArray(v)){Y=!1;let ce=null;if(v["font-scale"]&&(ce=A.parse(v["font-scale"],1,Vt),!ce))return null;let Te=null;if(v["text-font"]&&(Te=A.parse(v["text-font"],1,Ls(sr)),!Te))return null;let Oe=null;if(v["text-color"]&&(Oe=A.parse(v["text-color"],1,gu),!Oe))return null;const Xe=q[q.length-1];Xe.scale=ce,Xe.font=Te,Xe.textColor=Oe}else{const ce=A.parse(w[y],1,Yi);if(!ce)return null;const Te=ce.type.kind;if(Te!=="string"&&Te!=="value"&&Te!=="null"&&Te!=="resolvedImage")return A.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Y=!0,q.push({content:ce,scale:null,font:null,textColor:null})}}return new od(q)}evaluate(w){const A=R=>{const q=R.content.evaluate(w);return Io(q)===Yh?new Df("",q,null,null,null):new Df(Xh(q),null,R.scale?R.scale.evaluate(w):null,R.font?R.font.evaluate(w).join(","):null,R.textColor?R.textColor.evaluate(w):null)};return new gl(this.sections.map(A))}eachChild(w){for(const A of this.sections)w(A.content),A.scale&&w(A.scale),A.font&&w(A.font),A.textColor&&w(A.textColor)}outputDefined(){return!1}serialize(){const w=["format"];for(const A of this.sections){w.push(A.content.serialize());const R={};A.scale&&(R["font-scale"]=A.scale.serialize()),A.font&&(R["text-font"]=A.font.serialize()),A.textColor&&(R["text-color"]=A.textColor.serialize()),w.push(R)}return w}}class ad{constructor(w){this.type=Yh,this.input=w}static parse(w,A){if(w.length!==2)return A.error("Expected two arguments.");const R=A.parse(w[1],1,sr);return R?new ad(R):A.error("No image name provided.")}evaluate(w){const A=this.input.evaluate(w),R=vu.fromString(A);return R&&w.availableImages&&(R.available=w.availableImages.indexOf(A)>-1),R}eachChild(w){w(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const sv={"to-boolean":Ji,"to-color":gu,"to-number":Vt,"to-string":sr};class Xf{constructor(w,A){this.type=w,this.args=A}static parse(w,A){if(w.length<2)return A.error("Expected at least one argument.");const R=w[0];if((R==="to-boolean"||R==="to-string")&&w.length!==2)return A.error("Expected one argument.");const q=sv[R],Y=[];for(let y=1;y<w.length;y++){const v=A.parse(w[y],y,Yi);if(!v)return null;Y.push(v)}return new Xf(q,Y)}evaluate(w){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(w));if(this.type.kind==="color"){let A,R;for(const q of this.args){if(A=q.evaluate(w),R=null,A instanceof qo)return A;if(typeof A=="string"){const Y=w.parseColor(A);if(Y)return Y}else if(Array.isArray(A)&&(A.length<3||A.length>4?R=`Invalid rbga value ${JSON.stringify(A)}: expected an array containing either three or four numeric values.`:R=Ry(A[0],A[1],A[2],A[3]),!R))return new qo(A[0]/255,A[1]/255,A[2]/255,A[3])}throw new Zo(R||`Could not parse color from value '${typeof A=="string"?A:String(JSON.stringify(A))}'`)}else if(this.type.kind==="number"){let A=null;for(const R of this.args){if(A=R.evaluate(w),A===null)return 0;const q=Number(A);if(!isNaN(q))return q}throw new Zo(`Could not convert ${JSON.stringify(A)} to number.`)}else return this.type.kind==="formatted"?gl.fromString(Xh(this.args[0].evaluate(w))):this.type.kind==="resolvedImage"?vu.fromString(Xh(this.args[0].evaluate(w))):Xh(this.args[0].evaluate(w))}eachChild(w){this.args.forEach(w)}outputDefined(){return this.args.every(w=>w.outputDefined())}serialize(){if(this.type.kind==="formatted")return new od([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ad(this.args[0]).serialize();const w=[`to-${this.type.kind}`];return this.eachChild(A=>{w.push(A.serialize())}),w}}var Yc=Xf;const lv=["Unknown","Point","LineString","Polygon"];class uv{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const w=this.featureDistanceData.center,A=this.featureDistanceData.scale,{x:R,y:q}=this.featureTileCoord,Y=R*A-w[0],y=q*A-w[1],v=this.featureDistanceData.bearing[0],ce=this.featureDistanceData.bearing[1];return v*Y+ce*y}return 0}parseColor(w){let A=this._parseColorCache[w];return A||(A=this._parseColorCache[w]=qo.parse(w)),A}}var By=uv;class Qc{constructor(w,A,R,q){this.name=w,this.type=A,this._evaluate=R,this.args=q}evaluate(w){return this._evaluate(w,this.args)}eachChild(w){this.args.forEach(w)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(w=>w.serialize()))}static parse(w,A){const R=w[0],q=Qc.definitions[R];if(!q)return A.error(`Unknown expression "${R}". If you wanted a literal array, use ["literal", [...]].`,0);const Y=Array.isArray(q)?q[0]:q.type,y=Array.isArray(q)?[[q[1],q[2]]]:q.overloads,v=y.filter(([Te])=>!Array.isArray(Te)||Te.length===w.length-1);let ce=null;for(const[Te,Oe]of v){ce=new Vy(A.registry,A.path,null,A.scope);const Xe=[];let xe=!1;for(let dt=1;dt<w.length;dt++){const zt=w[dt],ci=Array.isArray(Te)?Te[dt-1]:Te.type,Ct=ce.parse(zt,1+Xe.length,ci);if(!Ct){xe=!0;break}Xe.push(Ct)}if(!xe){if(Array.isArray(Te)&&Te.length!==Xe.length){ce.error(`Expected ${Te.length} arguments, but found ${Xe.length} instead.`);continue}for(let dt=0;dt<Xe.length;dt++){const zt=Array.isArray(Te)?Te[dt]:Te.type,ci=Xe[dt];ce.concat(dt+1).checkSubtype(zt,ci.type)}if(ce.errors.length===0)return new Qc(R,Y,Oe,Xe)}}if(v.length===1)A.errors.push(...ce.errors);else{const Oe=(v.length?v:y).map(([xe])=>cv(xe)).join(" | "),Xe=[];for(let xe=1;xe<w.length;xe++){const dt=A.parse(w[xe],1+Xe.length);if(!dt)return null;Xe.push(kn(dt.type))}A.error(`Expected arguments of type ${Oe}, but found (${Xe.join(", ")}) instead.`)}return null}static register(w,A){Qc.definitions=A;for(const R in A)w[R]=Qc}}function cv(C){return Array.isArray(C)?`(${C.map(kn).join(", ")})`:`(${kn(C.type)}...)`}var nh=Qc;class sd{constructor(w,A,R){this.type=rd,this.locale=R,this.caseSensitive=w,this.diacriticSensitive=A}static parse(w,A){if(w.length!==2)return A.error("Expected one argument.");const R=w[1];if(typeof R!="object"||Array.isArray(R))return A.error("Collator options argument must be an object.");const q=A.parse(R["case-sensitive"]===void 0?!1:R["case-sensitive"],1,Ji);if(!q)return null;const Y=A.parse(R["diacritic-sensitive"]===void 0?!1:R["diacritic-sensitive"],1,Ji);if(!Y)return null;let y=null;return R.locale&&(y=A.parse(R.locale,1,sr),!y)?null:new sd(q,Y,y)}evaluate(w){return new Zf(this.caseSensitive.evaluate(w),this.diacriticSensitive.evaluate(w),this.locale?this.locale.evaluate(w):null)}eachChild(w){w(this.caseSensitive),w(this.diacriticSensitive),this.locale&&w(this.locale)}outputDefined(){return!1}serialize(){const w={};return w["case-sensitive"]=this.caseSensitive.serialize(),w["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(w.locale=this.locale.serialize()),["collator",w]}}const Zu=8192;function Wf(C,w){C[0]=Math.min(C[0],w[0]),C[1]=Math.min(C[1],w[1]),C[2]=Math.max(C[2],w[0]),C[3]=Math.max(C[3],w[1])}function hv(C){return(180+C)/360}function pv(C){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+C*Math.PI/360)))/360}function Kp(C,w){return!(C[0]<=w[0]||C[2]>=w[2]||C[1]<=w[1]||C[3]>=w[3])}function dv(C,w){const A=hv(C[0]),R=pv(C[1]),q=Math.pow(2,w.z);return[Math.round(A*q*Zu),Math.round(R*q*Zu)]}function fv(C,w,A){const R=C[0]-w[0],q=C[1]-w[1],Y=C[0]-A[0],y=C[1]-A[1];return R*y-Y*q===0&&R*Y<=0&&q*y<=0}function mv(C,w,A){return w[1]>C[1]!=A[1]>C[1]&&C[0]<(A[0]-w[0])*(C[1]-w[1])/(A[1]-w[1])+w[0]}function Hf(C,w){let A=!1;for(let R=0,q=w.length;R<q;R++){const Y=w[R];for(let y=0,v=Y.length;y<v-1;y++){if(fv(C,Y[y],Y[y+1]))return!1;mv(C,Y[y],Y[y+1])&&(A=!A)}}return A}function yv(C,w){for(let A=0;A<w.length;A++)if(Hf(C,w[A]))return!0;return!1}function gv(C,w){return C[0]*w[1]-C[1]*w[0]}function Hm(C,w,A,R){const q=C[0]-A[0],Y=C[1]-A[1],y=w[0]-A[0],v=w[1]-A[1],ce=R[0]-A[0],Te=R[1]-A[1],Oe=q*Te-ce*Y,Xe=y*Te-ce*v;return Oe>0&&Xe<0||Oe<0&&Xe>0}function _v(C,w,A,R){const q=[w[0]-C[0],w[1]-C[1]],Y=[R[0]-A[0],R[1]-A[1]];return gv(Y,q)===0?!1:!!(Hm(C,w,A,R)&&Hm(A,R,C,w))}function vv(C,w,A){for(const R of A)for(let q=0;q<R.length-1;++q)if(_v(C,w,R[q],R[q+1]))return!0;return!1}function Fy(C,w){for(let A=0;A<C.length;++A)if(!Hf(C[A],w))return!1;for(let A=0;A<C.length-1;++A)if(vv(C[A],C[A+1],w))return!1;return!0}function xv(C,w){for(let A=0;A<w.length;A++)if(Fy(C,w[A]))return!0;return!1}function Kf(C,w,A){const R=[];for(let q=0;q<C.length;q++){const Y=[];for(let y=0;y<C[q].length;y++){const v=dv(C[q][y],A);Wf(w,v),Y.push(v)}R.push(Y)}return R}function Oy(C,w,A){const R=[];for(let q=0;q<C.length;q++){const Y=Kf(C[q],w,A);R.push(Y)}return R}function Uy(C,w,A,R){if(C[0]<A[0]||C[0]>A[2]){const q=R*.5;let Y=C[0]-A[0]>q?-R:A[0]-C[0]>q?R:0;Y===0&&(Y=C[0]-A[2]>q?-R:A[2]-C[0]>q?R:0),C[0]+=Y}Wf(w,C)}function bv(C){C[0]=C[1]=1/0,C[2]=C[3]=-1/0}function Km(C,w,A,R){const q=Math.pow(2,R.z)*Zu,Y=[R.x*Zu,R.y*Zu],y=[];if(!C)return y;for(const v of C)for(const ce of v){const Te=[ce.x+Y[0],ce.y+Y[1]];Uy(Te,w,A,q),y.push(Te)}return y}function Jm(C,w,A,R){const q=Math.pow(2,R.z)*Zu,Y=[R.x*Zu,R.y*Zu],y=[];if(!C)return y;for(const v of C){const ce=[];for(const Te of v){const Oe=[Te.x+Y[0],Te.y+Y[1]];Wf(w,Oe),ce.push(Oe)}y.push(ce)}if(w[2]-w[0]<=q/2){bv(w);for(const v of y)for(const ce of v)Uy(ce,w,A,q)}return y}function wv(C,w){const A=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],q=C.canonicalID();if(!q)return!1;if(w.type==="Polygon"){const Y=Kf(w.coordinates,R,q),y=Km(C.geometry(),A,R,q);if(!Kp(A,R))return!1;for(const v of y)if(!Hf(v,Y))return!1}if(w.type==="MultiPolygon"){const Y=Oy(w.coordinates,R,q),y=Km(C.geometry(),A,R,q);if(!Kp(A,R))return!1;for(const v of y)if(!yv(v,Y))return!1}return!0}function Tv(C,w){const A=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],q=C.canonicalID();if(!q)return!1;if(w.type==="Polygon"){const Y=Kf(w.coordinates,R,q),y=Jm(C.geometry(),A,R,q);if(!Kp(A,R))return!1;for(const v of y)if(!Fy(v,Y))return!1}if(w.type==="MultiPolygon"){const Y=Oy(w.coordinates,R,q),y=Jm(C.geometry(),A,R,q);if(!Kp(A,R))return!1;for(const v of y)if(!xv(v,Y))return!1}return!0}class Wh{constructor(w,A){this.type=Ji,this.geojson=w,this.geometries=A}static parse(w,A){if(w.length!==2)return A.error(`'within' expression requires exactly one argument, but found ${w.length-1} instead.`);if(Wp(w[1])){const R=w[1];if(R.type==="FeatureCollection")for(let q=0;q<R.features.length;++q){const Y=R.features[q].geometry.type;if(Y==="Polygon"||Y==="MultiPolygon")return new Wh(R,R.features[q].geometry)}else if(R.type==="Feature"){const q=R.geometry.type;if(q==="Polygon"||q==="MultiPolygon")return new Wh(R,R.geometry)}else if(R.type==="Polygon"||R.type==="MultiPolygon")return new Wh(R,R)}return A.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(w){if(w.geometry()!=null&&w.canonicalID()!=null){if(w.geometryType()==="Point")return wv(w,this.geometries);if(w.geometryType()==="LineString")return Tv(w,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Jf=Wh;function Yf(C){if(C instanceof nh){if(C.name==="get"&&C.args.length===1)return!1;if(C.name==="feature-state")return!1;if(C.name==="has"&&C.args.length===1)return!1;if(C.name==="properties"||C.name==="geometry-type"||C.name==="id")return!1;if(/^filter-/.test(C.name))return!1}if(C instanceof Jf)return!1;let w=!0;return C.eachChild(A=>{w&&!Yf(A)&&(w=!1)}),w}function Qf(C){if(C instanceof nh&&C.name==="feature-state")return!1;let w=!0;return C.eachChild(A=>{w&&!Qf(A)&&(w=!1)}),w}function em(C,w){if(C instanceof nh&&w.indexOf(C.name)>=0)return!1;let A=!0;return C.eachChild(R=>{A&&!em(R,w)&&(A=!1)}),A}class tm{constructor(w,A){this.type=A.type,this.name=w,this.boundExpression=A}static parse(w,A){if(w.length!==2||typeof w[1]!="string")return A.error("'var' expression requires exactly one string literal argument.");const R=w[1];return A.scope.has(R)?new tm(R,A.scope.get(R)):A.error(`Unknown variable "${R}". Make sure "${R}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(w){return this.boundExpression.evaluate(w)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var jy=tm;class im{constructor(w,A=[],R,q=new iv,Y=[]){this.registry=w,this.path=A,this.key=A.map(y=>`[${y}]`).join(""),this.scope=q,this.errors=Y,this.expectedType=R}parse(w,A,R,q,Y={}){return A?this.concat(A,R,q)._parse(w,Y):this._parse(w,Y)}_parse(w,A){(w===null||typeof w=="string"||typeof w=="boolean"||typeof w=="number")&&(w=["literal",w]);function R(q,Y,y){return y==="assert"?new yu(Y,[q]):y==="coerce"?new Yc(Y,[q]):q}if(Array.isArray(w)){if(w.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const q=w[0];if(typeof q!="string")return this.error(`Expression name must be a string, but found ${typeof q} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Y=this.registry[q];if(Y){let y=Y.parse(w,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,ce=y.type;if((v.kind==="string"||v.kind==="number"||v.kind==="boolean"||v.kind==="object"||v.kind==="array")&&ce.kind==="value")y=R(y,v,A.typeAnnotation||"assert");else if((v.kind==="color"||v.kind==="formatted"||v.kind==="resolvedImage")&&(ce.kind==="value"||ce.kind==="string"))y=R(y,v,A.typeAnnotation||"coerce");else if(this.checkSubtype(v,ce))return null}if(!(y instanceof Hp)&&y.type.kind!=="resolvedImage"&&Lf(y)){const v=new By;try{y=new Hp(y.type,y.evaluate(v))}catch(ce){return this.error(ce.message),null}}return y}return this.error(`Unknown expression "${q}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof w>"u"?this.error("'undefined' value invalid. Use null instead."):typeof w=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof w} instead.`)}concat(w,A,R){const q=typeof w=="number"?this.path.concat(w):this.path,Y=R?this.scope.concat(R):this.scope;return new im(this.registry,q,A||null,Y,this.errors)}error(w,...A){const R=`${this.key}${A.map(q=>`[${q}]`).join("")}`;this.errors.push(new Zl(R,w))}checkSubtype(w,A){const R=Hh(w,A);return R&&this.error(R),R}}var Vy=im;function Lf(C){if(C instanceof jy)return Lf(C.boundExpression);if(C instanceof nh&&C.name==="error")return!1;if(C instanceof sd)return!1;if(C instanceof Jf)return!1;const w=C instanceof Yc||C instanceof yu;let A=!0;return C.eachChild(R=>{w?A=A&&Lf(R):A=A&&R instanceof Hp}),A?Yf(C)&&em(C,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function ld(C,w){const A=C.length-1;let R=0,q=A,Y=0,y,v;for(;R<=q;)if(Y=Math.floor((R+q)/2),y=C[Y],v=C[Y+1],y<=w){if(Y===A||w<v)return Y;R=Y+1}else if(y>w)q=Y-1;else throw new Zo("Input is not a number.");return 0}class rm{constructor(w,A,R){this.type=w,this.input=A,this.labels=[],this.outputs=[];for(const[q,Y]of R)this.labels.push(q),this.outputs.push(Y)}static parse(w,A){if(w.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${w.length-1}.`);if((w.length-1)%2!==0)return A.error("Expected an even number of arguments.");const R=A.parse(w[1],1,Vt);if(!R)return null;const q=[];let Y=null;A.expectedType&&A.expectedType.kind!=="value"&&(Y=A.expectedType);for(let y=1;y<w.length;y+=2){const v=y===1?-1/0:w[y],ce=w[y+1],Te=y,Oe=y+1;if(typeof v!="number")return A.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Te);if(q.length&&q[q.length-1][0]>=v)return A.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Te);const Xe=A.parse(ce,Oe,Y);if(!Xe)return null;Y=Y||Xe.type,q.push([v,Xe])}return new rm(Y,R,q)}evaluate(w){const A=this.labels,R=this.outputs;if(A.length===1)return R[0].evaluate(w);const q=this.input.evaluate(w);if(q<=A[0])return R[0].evaluate(w);const Y=A.length;if(q>=A[Y-1])return R[Y-1].evaluate(w);const y=ld(A,q);return R[y].evaluate(w)}eachChild(w){w(this.input);for(const A of this.outputs)w(A)}outputDefined(){return this.outputs.every(w=>w.outputDefined())}serialize(){const w=["step",this.input.serialize()];for(let A=0;A<this.labels.length;A++)A>0&&w.push(this.labels[A]),w.push(this.outputs[A].serialize());return w}}var Ny=rm,Sv=oh;function oh(C,w,A,R){this.cx=3*C,this.bx=3*(A-C)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*w,this.by=3*(R-w)-this.cy,this.ay=1-this.cy-this.by,this.p1x=C,this.p1y=R,this.p2x=A,this.p2y=R}oh.prototype.sampleCurveX=function(C){return((this.ax*C+this.bx)*C+this.cx)*C};oh.prototype.sampleCurveY=function(C){return((this.ay*C+this.by)*C+this.cy)*C};oh.prototype.sampleCurveDerivativeX=function(C){return(3*this.ax*C+2*this.bx)*C+this.cx};oh.prototype.solveCurveX=function(C,w){typeof w>"u"&&(w=1e-6);var A,R,q,Y,y;for(q=C,y=0;y<8;y++){if(Y=this.sampleCurveX(q)-C,Math.abs(Y)<w)return q;var v=this.sampleCurveDerivativeX(q);if(Math.abs(v)<1e-6)break;q=q-Y/v}if(A=0,R=1,q=C,q<A)return A;if(q>R)return R;for(;A<R;){if(Y=this.sampleCurveX(q),Math.abs(Y-C)<w)return q;C>Y?A=q:R=q,q=(R-A)*.5+A}return q};oh.prototype.solve=function(C,w){return this.sampleCurveY(this.solveCurveX(C,w))};function us(C,w,A){return C*(1-A)+w*A}function Iv(C,w,A){return new qo(us(C.r,w.r,A),us(C.g,w.g,A),us(C.b,w.b,A),us(C.a,w.a,A))}function Ev(C,w,A){return C.map((R,q)=>us(R,w[q],A))}var qy=Object.freeze({__proto__:null,number:us,color:Iv,array:Ev});const Zy=.95047,Gy=1,$y=1.08883,Xy=4/29,th=6/29,Wy=3*th*th,kv=th*th*th,Av=Math.PI/180,zv=180/Math.PI;function hf(C){return C>kv?Math.pow(C,1/3):C/Wy+Xy}function pf(C){return C>th?C*C*C:Wy*(C-Xy)}function df(C){return 255*(C<=.0031308?12.92*C:1.055*Math.pow(C,1/2.4)-.055)}function ff(C){return C/=255,C<=.04045?C/12.92:Math.pow((C+.055)/1.055,2.4)}function Hy(C){const w=ff(C.r),A=ff(C.g),R=ff(C.b),q=hf((.4124564*w+.3575761*A+.1804375*R)/Zy),Y=hf((.2126729*w+.7151522*A+.072175*R)/Gy),y=hf((.0193339*w+.119192*A+.9503041*R)/$y);return{l:116*Y-16,a:500*(q-Y),b:200*(Y-y),alpha:C.a}}function Ky(C){let w=(C.l+16)/116,A=isNaN(C.a)?w:w+C.a/500,R=isNaN(C.b)?w:w-C.b/200;return w=Gy*pf(w),A=Zy*pf(A),R=$y*pf(R),new qo(df(3.2404542*A-1.5371385*w-.4985314*R),df(-.969266*A+1.8760108*w+.041556*R),df(.0556434*A-.2040259*w+1.0572252*R),C.alpha)}function Cv(C,w,A){return{l:us(C.l,w.l,A),a:us(C.a,w.a,A),b:us(C.b,w.b,A),alpha:us(C.alpha,w.alpha,A)}}function Pv(C){const{l:w,a:A,b:R}=Hy(C),q=Math.atan2(R,A)*zv;return{h:q<0?q+360:q,c:Math.sqrt(A*A+R*R),l:w,alpha:C.a}}function Mv(C){const w=C.h*Av,A=C.c,R=C.l;return Ky({l:R,a:Math.cos(w)*A,b:Math.sin(w)*A,alpha:C.alpha})}function Dv(C,w,A){const R=w-C;return C+A*(R>180||R<-180?R-360*Math.round(R/360):R)}function Lv(C,w,A){return{h:Dv(C.h,w.h,A),c:us(C.c,w.c,A),l:us(C.l,w.l,A),alpha:us(C.alpha,w.alpha,A)}}const Gh={forward:Hy,reverse:Ky,interpolate:Cv},$h={forward:Pv,reverse:Mv,interpolate:Lv};var Jy=Object.freeze({__proto__:null,lab:Gh,hcl:$h});class Jp{constructor(w,A,R,q,Y){this.type=w,this.operator=A,this.interpolation=R,this.input=q,this.labels=[],this.outputs=[];for(const[y,v]of Y)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(w,A,R,q){let Y=0;if(w.name==="exponential")Y=mf(A,w.base,R,q);else if(w.name==="linear")Y=mf(A,1,R,q);else if(w.name==="cubic-bezier"){const y=w.controlPoints;Y=new Sv(y[0],y[1],y[2],y[3]).solve(mf(A,1,R,q))}return Y}static parse(w,A){let[R,q,Y,...y]=w;if(!Array.isArray(q)||q.length===0)return A.error("Expected an interpolation type expression.",1);if(q[0]==="linear")q={name:"linear"};else if(q[0]==="exponential"){const Te=q[1];if(typeof Te!="number")return A.error("Exponential interpolation requires a numeric base.",1,1);q={name:"exponential",base:Te}}else if(q[0]==="cubic-bezier"){const Te=q.slice(1);if(Te.length!==4||Te.some(Oe=>typeof Oe!="number"||Oe<0||Oe>1))return A.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);q={name:"cubic-bezier",controlPoints:Te}}else return A.error(`Unknown interpolation type ${String(q[0])}`,1,0);if(w.length-1<4)return A.error(`Expected at least 4 arguments, but found only ${w.length-1}.`);if((w.length-1)%2!==0)return A.error("Expected an even number of arguments.");if(Y=A.parse(Y,2,Vt),!Y)return null;const v=[];let ce=null;R==="interpolate-hcl"||R==="interpolate-lab"?ce=gu:A.expectedType&&A.expectedType.kind!=="value"&&(ce=A.expectedType);for(let Te=0;Te<y.length;Te+=2){const Oe=y[Te],Xe=y[Te+1],xe=Te+3,dt=Te+4;if(typeof Oe!="number")return A.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(v.length&&v[v.length-1][0]>=Oe)return A.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);const zt=A.parse(Xe,dt,ce);if(!zt)return null;ce=ce||zt.type,v.push([Oe,zt])}return ce.kind!=="number"&&ce.kind!=="color"&&!(ce.kind==="array"&&ce.itemType.kind==="number"&&typeof ce.N=="number")?A.error(`Type ${kn(ce)} is not interpolatable.`):new Jp(ce,R,q,Y,v)}evaluate(w){const A=this.labels,R=this.outputs;if(A.length===1)return R[0].evaluate(w);const q=this.input.evaluate(w);if(q<=A[0])return R[0].evaluate(w);const Y=A.length;if(q>=A[Y-1])return R[Y-1].evaluate(w);const y=ld(A,q),v=A[y],ce=A[y+1],Te=Jp.interpolationFactor(this.interpolation,q,v,ce),Oe=R[y].evaluate(w),Xe=R[y+1].evaluate(w);return this.operator==="interpolate"?qy[this.type.kind.toLowerCase()](Oe,Xe,Te):this.operator==="interpolate-hcl"?$h.reverse($h.interpolate($h.forward(Oe),$h.forward(Xe),Te)):Gh.reverse(Gh.interpolate(Gh.forward(Oe),Gh.forward(Xe),Te))}eachChild(w){w(this.input);for(const A of this.outputs)w(A)}outputDefined(){return this.outputs.every(w=>w.outputDefined())}serialize(){let w;this.interpolation.name==="linear"?w=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?w=["linear"]:w=["exponential",this.interpolation.base]:w=["cubic-bezier"].concat(this.interpolation.controlPoints);const A=[this.operator,w,this.input.serialize()];for(let R=0;R<this.labels.length;R++)A.push(this.labels[R],this.outputs[R].serialize());return A}}function mf(C,w,A,R){const q=R-A,Y=C-A;return q===0?0:w===1?Y/q:(Math.pow(w,Y)-1)/(Math.pow(w,q)-1)}var _u=Jp;class Yp{constructor(w,A){this.type=w,this.args=A}static parse(w,A){if(w.length<2)return A.error("Expectected at least one argument.");let R=null;const q=A.expectedType;q&&q.kind!=="value"&&(R=q);const Y=[];for(const v of w.slice(1)){const ce=A.parse(v,1+Y.length,R,void 0,{typeAnnotation:"omit"});if(!ce)return null;R=R||ce.type,Y.push(ce)}return q&&Y.some(v=>Hh(q,v.type))?new Yp(Yi,Y):new Yp(R,Y)}evaluate(w){let A=null,R=0,q;for(const Y of this.args){if(R++,A=Y.evaluate(w),A&&A instanceof vu&&!A.available&&(q||(q=A),A=null,R===this.args.length))return q;if(A!==null)break}return A}eachChild(w){this.args.forEach(w)}outputDefined(){return this.args.every(w=>w.outputDefined())}serialize(){const w=["coalesce"];return this.eachChild(A=>{w.push(A.serialize())}),w}}var Yy=Yp;class nm{constructor(w,A){this.type=A.type,this.bindings=[].concat(w),this.result=A}evaluate(w){return this.result.evaluate(w)}eachChild(w){for(const A of this.bindings)w(A[1]);w(this.result)}static parse(w,A){if(w.length<4)return A.error(`Expected at least 3 arguments, but found ${w.length-1} instead.`);const R=[];for(let Y=1;Y<w.length-1;Y+=2){const y=w[Y];if(typeof y!="string")return A.error(`Expected string, but found ${typeof y} instead.`,Y);if(/[^a-zA-Z0-9_]/.test(y))return A.error("Variable names must contain only alphanumeric characters or '_'.",Y);const v=A.parse(w[Y+1],Y+1);if(!v)return null;R.push([y,v])}const q=A.parse(w[w.length-1],w.length-1,A.expectedType,R);return q?new nm(R,q):null}outputDefined(){return this.result.outputDefined()}serialize(){const w=["let"];for(const[A,R]of this.bindings)w.push(A,R.serialize());return w.push(this.result.serialize()),w}}var Qy=nm;class om{constructor(w,A,R){this.type=w,this.index=A,this.input=R}static parse(w,A){if(w.length!==3)return A.error(`Expected 2 arguments, but found ${w.length-1} instead.`);const R=A.parse(w[1],1,Vt),q=A.parse(w[2],2,Ls(A.expectedType||Yi));if(!R||!q)return null;const Y=q.type;return new om(Y.itemType,R,q)}evaluate(w){const A=this.index.evaluate(w),R=this.input.evaluate(w);if(A<0)throw new Zo(`Array index out of bounds: ${A} < 0.`);if(A>=R.length)throw new Zo(`Array index out of bounds: ${A} > ${R.length-1}.`);if(A!==Math.floor(A))throw new Zo(`Array index must be an integer, but found ${A} instead.`);return R[A]}eachChild(w){w(this.index),w(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Rv=om;class am{constructor(w,A){this.type=Ji,this.needle=w,this.haystack=A}static parse(w,A){if(w.length!==3)return A.error(`Expected 2 arguments, but found ${w.length-1} instead.`);const R=A.parse(w[1],1,Yi),q=A.parse(w[2],2,Yi);return!R||!q?null:qf(R.type,[Ji,sr,Vt,id,Yi])?new am(R,q):A.error(`Expected first argument to be of type boolean, string, number or null, but found ${kn(R.type)} instead`)}evaluate(w){const A=this.needle.evaluate(w),R=this.haystack.evaluate(w);if(R==null)return!1;if(!Kh(A,["boolean","string","number","null"]))throw new Zo(`Expected first argument to be of type boolean, string, number or null, but found ${kn(Io(A))} instead.`);if(!Kh(R,["string","array"]))throw new Zo(`Expected second argument to be of type array or string, but found ${kn(Io(R))} instead.`);return R.indexOf(A)>=0}eachChild(w){w(this.needle),w(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Bv=am;class Qp{constructor(w,A,R){this.type=Vt,this.needle=w,this.haystack=A,this.fromIndex=R}static parse(w,A){if(w.length<=2||w.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${w.length-1} instead.`);const R=A.parse(w[1],1,Yi),q=A.parse(w[2],2,Yi);if(!R||!q)return null;if(!qf(R.type,[Ji,sr,Vt,id,Yi]))return A.error(`Expected first argument to be of type boolean, string, number or null, but found ${kn(R.type)} instead`);if(w.length===4){const Y=A.parse(w[3],3,Vt);return Y?new Qp(R,q,Y):null}else return new Qp(R,q)}evaluate(w){const A=this.needle.evaluate(w),R=this.haystack.evaluate(w);if(!Kh(A,["boolean","string","number","null"]))throw new Zo(`Expected first argument to be of type boolean, string, number or null, but found ${kn(Io(A))} instead.`);if(!Kh(R,["string","array"]))throw new Zo(`Expected second argument to be of type array or string, but found ${kn(Io(R))} instead.`);if(this.fromIndex){const q=this.fromIndex.evaluate(w);return R.indexOf(A,q)}return R.indexOf(A)}eachChild(w){w(this.needle),w(this.haystack),this.fromIndex&&w(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const w=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),w]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Fv=Qp;class sm{constructor(w,A,R,q,Y,y){this.inputType=w,this.type=A,this.input=R,this.cases=q,this.outputs=Y,this.otherwise=y}static parse(w,A){if(w.length<5)return A.error(`Expected at least 4 arguments, but found only ${w.length-1}.`);if(w.length%2!==1)return A.error("Expected an even number of arguments.");let R,q;A.expectedType&&A.expectedType.kind!=="value"&&(q=A.expectedType);const Y={},y=[];for(let Te=2;Te<w.length-1;Te+=2){let Oe=w[Te];const Xe=w[Te+1];Array.isArray(Oe)||(Oe=[Oe]);const xe=A.concat(Te);if(Oe.length===0)return xe.error("Expected at least one branch label.");for(const zt of Oe){if(typeof zt!="number"&&typeof zt!="string")return xe.error("Branch labels must be numbers or strings.");if(typeof zt=="number"&&Math.abs(zt)>Number.MAX_SAFE_INTEGER)return xe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof zt=="number"&&Math.floor(zt)!==zt)return xe.error("Numeric branch labels must be integer values.");if(!R)R=Io(zt);else if(xe.checkSubtype(R,Io(zt)))return null;if(typeof Y[String(zt)]<"u")return xe.error("Branch labels must be unique.");Y[String(zt)]=y.length}const dt=A.parse(Xe,Te,q);if(!dt)return null;q=q||dt.type,y.push(dt)}const v=A.parse(w[1],1,Yi);if(!v)return null;const ce=A.parse(w[w.length-1],w.length-1,q);return!ce||v.type.kind!=="value"&&A.concat(1).checkSubtype(R,v.type)?null:new sm(R,q,v,Y,y,ce)}evaluate(w){const A=this.input.evaluate(w);return(Io(A)===this.inputType&&this.outputs[this.cases[A]]||this.otherwise).evaluate(w)}eachChild(w){w(this.input),this.outputs.forEach(w),w(this.otherwise)}outputDefined(){return this.outputs.every(w=>w.outputDefined())&&this.otherwise.outputDefined()}serialize(){const w=["match",this.input.serialize()],A=Object.keys(this.cases).sort(),R=[],q={};for(const y of A){const v=q[this.cases[y]];v===void 0?(q[this.cases[y]]=R.length,R.push([this.cases[y],[y]])):R[v][1].push(y)}const Y=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,v]of R)v.length===1?w.push(Y(v[0])):w.push(v.map(Y)),w.push(this.outputs[y].serialize());return w.push(this.otherwise.serialize()),w}}var Ov=sm;class lm{constructor(w,A,R){this.type=w,this.branches=A,this.otherwise=R}static parse(w,A){if(w.length<4)return A.error(`Expected at least 3 arguments, but found only ${w.length-1}.`);if(w.length%2!==0)return A.error("Expected an odd number of arguments.");let R;A.expectedType&&A.expectedType.kind!=="value"&&(R=A.expectedType);const q=[];for(let y=1;y<w.length-1;y+=2){const v=A.parse(w[y],y,Ji);if(!v)return null;const ce=A.parse(w[y+1],y+1,R);if(!ce)return null;q.push([v,ce]),R=R||ce.type}const Y=A.parse(w[w.length-1],w.length-1,R);return Y?new lm(R,q,Y):null}evaluate(w){for(const[A,R]of this.branches)if(A.evaluate(w))return R.evaluate(w);return this.otherwise.evaluate(w)}eachChild(w){for(const[A,R]of this.branches)w(A),w(R);w(this.otherwise)}outputDefined(){return this.branches.every(([w,A])=>A.outputDefined())&&this.otherwise.outputDefined()}serialize(){const w=["case"];return this.eachChild(A=>{w.push(A.serialize())}),w}}var Uv=lm;class ed{constructor(w,A,R,q){this.type=w,this.input=A,this.beginIndex=R,this.endIndex=q}static parse(w,A){if(w.length<=2||w.length>=5)return A.error(`Expected 3 or 4 arguments, but found ${w.length-1} instead.`);const R=A.parse(w[1],1,Yi),q=A.parse(w[2],2,Vt);if(!R||!q)return null;if(!qf(R.type,[Ls(Yi),sr,Yi]))return A.error(`Expected first argument to be of type array or string, but found ${kn(R.type)} instead`);if(w.length===4){const Y=A.parse(w[3],3,Vt);return Y?new ed(R.type,R,q,Y):null}else return new ed(R.type,R,q)}evaluate(w){const A=this.input.evaluate(w),R=this.beginIndex.evaluate(w);if(!Kh(A,["string","array"]))throw new Zo(`Expected first argument to be of type array or string, but found ${kn(Io(A))} instead.`);if(this.endIndex){const q=this.endIndex.evaluate(w);return A.slice(R,q)}return A.slice(R)}eachChild(w){w(this.input),w(this.beginIndex),this.endIndex&&w(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const w=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),w]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var jv=ed;function Ym(C,w){return C==="=="||C==="!="?w.kind==="boolean"||w.kind==="string"||w.kind==="number"||w.kind==="null"||w.kind==="value":w.kind==="string"||w.kind==="number"||w.kind==="value"}function Vv(C,w,A){return w===A}function Nv(C,w,A){return w!==A}function qv(C,w,A){return w<A}function Zv(C,w,A){return w>A}function Gv(C,w,A){return w<=A}function $v(C,w,A){return w>=A}function eg(C,w,A,R){return R.compare(w,A)===0}function Xv(C,w,A,R){return!eg(C,w,A,R)}function Wv(C,w,A,R){return R.compare(w,A)<0}function Hv(C,w,A,R){return R.compare(w,A)>0}function Kv(C,w,A,R){return R.compare(w,A)<=0}function Jv(C,w,A,R){return R.compare(w,A)>=0}function ah(C,w,A){const R=C!=="=="&&C!=="!=";return class tg{constructor(Y,y,v){this.type=Ji,this.lhs=Y,this.rhs=y,this.collator=v,this.hasUntypedArgument=Y.type.kind==="value"||y.type.kind==="value"}static parse(Y,y){if(Y.length!==3&&Y.length!==4)return y.error("Expected two or three arguments.");const v=Y[0];let ce=y.parse(Y[1],1,Yi);if(!ce)return null;if(!Ym(v,ce.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${kn(ce.type)}'.`);let Te=y.parse(Y[2],2,Yi);if(!Te)return null;if(!Ym(v,Te.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${kn(Te.type)}'.`);if(ce.type.kind!==Te.type.kind&&ce.type.kind!=="value"&&Te.type.kind!=="value")return y.error(`Cannot compare types '${kn(ce.type)}' and '${kn(Te.type)}'.`);R&&(ce.type.kind==="value"&&Te.type.kind!=="value"?ce=new yu(Te.type,[ce]):ce.type.kind!=="value"&&Te.type.kind==="value"&&(Te=new yu(ce.type,[Te])));let Oe=null;if(Y.length===4){if(ce.type.kind!=="string"&&Te.type.kind!=="string"&&ce.type.kind!=="value"&&Te.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(Oe=y.parse(Y[3],3,rd),!Oe)return null}return new tg(ce,Te,Oe)}evaluate(Y){const y=this.lhs.evaluate(Y),v=this.rhs.evaluate(Y);if(R&&this.hasUntypedArgument){const ce=Io(y),Te=Io(v);if(ce.kind!==Te.kind||!(ce.kind==="string"||ce.kind==="number"))throw new Zo(`Expected arguments for "${C}" to be (string, string) or (number, number), but found (${ce.kind}, ${Te.kind}) instead.`)}if(this.collator&&!R&&this.hasUntypedArgument){const ce=Io(y),Te=Io(v);if(ce.kind!=="string"||Te.kind!=="string")return w(Y,y,v)}return this.collator?A(Y,y,v,this.collator.evaluate(Y)):w(Y,y,v)}eachChild(Y){Y(this.lhs),Y(this.rhs),this.collator&&Y(this.collator)}outputDefined(){return!0}serialize(){const Y=[C];return this.eachChild(y=>{Y.push(y.serialize())}),Y}}}const Yv=ah("==",Vv,eg),Qv=ah("!=",Nv,Xv),e0=ah("<",qv,Wv),t0=ah(">",Zv,Hv),i0=ah("<=",Gv,Kv),r0=ah(">=",$v,Jv);class um{constructor(w,A,R,q,Y){this.type=sr,this.number=w,this.locale=A,this.currency=R,this.minFractionDigits=q,this.maxFractionDigits=Y}static parse(w,A){if(w.length!==3)return A.error("Expected two arguments.");const R=A.parse(w[1],1,Vt);if(!R)return null;const q=w[2];if(typeof q!="object"||Array.isArray(q))return A.error("NumberFormat options argument must be an object.");let Y=null;if(q.locale&&(Y=A.parse(q.locale,1,sr),!Y))return null;let y=null;if(q.currency&&(y=A.parse(q.currency,1,sr),!y))return null;let v=null;if(q["min-fraction-digits"]&&(v=A.parse(q["min-fraction-digits"],1,Vt),!v))return null;let ce=null;return q["max-fraction-digits"]&&(ce=A.parse(q["max-fraction-digits"],1,Vt),!ce)?null:new um(R,Y,y,v,ce)}evaluate(w){return new Intl.NumberFormat(this.locale?this.locale.evaluate(w):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(w):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(w):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(w):void 0}).format(this.number.evaluate(w))}eachChild(w){w(this.number),this.locale&&w(this.locale),this.currency&&w(this.currency),this.minFractionDigits&&w(this.minFractionDigits),this.maxFractionDigits&&w(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const w={};return this.locale&&(w.locale=this.locale.serialize()),this.currency&&(w.currency=this.currency.serialize()),this.minFractionDigits&&(w["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(w["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),w]}}class cm{constructor(w){this.type=Vt,this.input=w}static parse(w,A){if(w.length!==2)return A.error(`Expected 1 argument, but found ${w.length-1} instead.`);const R=A.parse(w[1],1);return R?R.type.kind!=="array"&&R.type.kind!=="string"&&R.type.kind!=="value"?A.error(`Expected argument of type string or array, but found ${kn(R.type)} instead.`):new cm(R):null}evaluate(w){const A=this.input.evaluate(w);if(typeof A=="string")return A.length;if(Array.isArray(A))return A.length;throw new Zo(`Expected value to be of type string or array, but found ${kn(Io(A))} instead.`)}eachChild(w){w(this.input)}outputDefined(){return!1}serialize(){const w=["length"];return this.eachChild(A=>{w.push(A.serialize())}),w}}var n0=cm;const ig={"==":Yv,"!=":Qv,">":t0,"<":e0,">=":r0,"<=":i0,array:yu,at:Rv,boolean:yu,case:Uv,coalesce:Yy,collator:sd,format:od,image:ad,in:Bv,"index-of":Fv,interpolate:_u,"interpolate-hcl":_u,"interpolate-lab":_u,length:n0,let:Qy,literal:Hp,match:Ov,number:yu,"number-format":um,object:yu,slice:jv,step:Ny,string:yu,"to-boolean":Yc,"to-color":Yc,"to-number":Yc,"to-string":Yc,var:jy,within:Jf};function Qm(C,[w,A,R,q]){w=w.evaluate(C),A=A.evaluate(C),R=R.evaluate(C);const Y=q?q.evaluate(C):1,y=Ry(w,A,R,Y);if(y)throw new Zo(y);return new qo(w/255*Y,A/255*Y,R/255*Y,Y)}function ey(C,w){return C in w}function yf(C,w){const A=w[C];return typeof A>"u"?null:A}function o0(C,w,A,R){for(;A<=R;){const q=A+R>>1;if(w[q]===C)return!0;w[q]>C?R=q-1:A=q+1}return!1}function bc(C){return{type:C}}nh.register(ig,{error:[rv,[sr],(C,[w])=>{throw new Zo(w.evaluate(C))}],typeof:[sr,[Yi],(C,[w])=>kn(Io(w.evaluate(C)))],"to-rgba":[Ls(Vt,4),[gu],(C,[w])=>w.evaluate(C).toArray()],rgb:[gu,[Vt,Vt,Vt],Qm],rgba:[gu,[Vt,Vt,Vt,Vt],Qm],has:{type:Ji,overloads:[[[sr],(C,[w])=>ey(w.evaluate(C),C.properties())],[[sr,eh],(C,[w,A])=>ey(w.evaluate(C),A.evaluate(C))]]},get:{type:Yi,overloads:[[[sr],(C,[w])=>yf(w.evaluate(C),C.properties())],[[sr,eh],(C,[w,A])=>yf(w.evaluate(C),A.evaluate(C))]]},"feature-state":[Yi,[sr],(C,[w])=>yf(w.evaluate(C),C.featureState||{})],properties:[eh,[],C=>C.properties()],"geometry-type":[sr,[],C=>C.geometryType()],id:[Yi,[],C=>C.id()],zoom:[Vt,[],C=>C.globals.zoom],pitch:[Vt,[],C=>C.globals.pitch||0],"distance-from-center":[Vt,[],C=>C.distanceFromCenter()],"heatmap-density":[Vt,[],C=>C.globals.heatmapDensity||0],"line-progress":[Vt,[],C=>C.globals.lineProgress||0],"sky-radial-progress":[Vt,[],C=>C.globals.skyRadialProgress||0],accumulated:[Yi,[],C=>C.globals.accumulated===void 0?null:C.globals.accumulated],"+":[Vt,bc(Vt),(C,w)=>{let A=0;for(const R of w)A+=R.evaluate(C);return A}],"*":[Vt,bc(Vt),(C,w)=>{let A=1;for(const R of w)A*=R.evaluate(C);return A}],"-":{type:Vt,overloads:[[[Vt,Vt],(C,[w,A])=>w.evaluate(C)-A.evaluate(C)],[[Vt],(C,[w])=>-w.evaluate(C)]]},"/":[Vt,[Vt,Vt],(C,[w,A])=>w.evaluate(C)/A.evaluate(C)],"%":[Vt,[Vt,Vt],(C,[w,A])=>w.evaluate(C)%A.evaluate(C)],ln2:[Vt,[],()=>Math.LN2],pi:[Vt,[],()=>Math.PI],e:[Vt,[],()=>Math.E],"^":[Vt,[Vt,Vt],(C,[w,A])=>Math.pow(w.evaluate(C),A.evaluate(C))],sqrt:[Vt,[Vt],(C,[w])=>Math.sqrt(w.evaluate(C))],log10:[Vt,[Vt],(C,[w])=>Math.log(w.evaluate(C))/Math.LN10],ln:[Vt,[Vt],(C,[w])=>Math.log(w.evaluate(C))],log2:[Vt,[Vt],(C,[w])=>Math.log(w.evaluate(C))/Math.LN2],sin:[Vt,[Vt],(C,[w])=>Math.sin(w.evaluate(C))],cos:[Vt,[Vt],(C,[w])=>Math.cos(w.evaluate(C))],tan:[Vt,[Vt],(C,[w])=>Math.tan(w.evaluate(C))],asin:[Vt,[Vt],(C,[w])=>Math.asin(w.evaluate(C))],acos:[Vt,[Vt],(C,[w])=>Math.acos(w.evaluate(C))],atan:[Vt,[Vt],(C,[w])=>Math.atan(w.evaluate(C))],min:[Vt,bc(Vt),(C,w)=>Math.min(...w.map(A=>A.evaluate(C)))],max:[Vt,bc(Vt),(C,w)=>Math.max(...w.map(A=>A.evaluate(C)))],abs:[Vt,[Vt],(C,[w])=>Math.abs(w.evaluate(C))],round:[Vt,[Vt],(C,[w])=>{const A=w.evaluate(C);return A<0?-Math.round(-A):Math.round(A)}],floor:[Vt,[Vt],(C,[w])=>Math.floor(w.evaluate(C))],ceil:[Vt,[Vt],(C,[w])=>Math.ceil(w.evaluate(C))],"filter-==":[Ji,[sr,Yi],(C,[w,A])=>C.properties()[w.value]===A.value],"filter-id-==":[Ji,[Yi],(C,[w])=>C.id()===w.value],"filter-type-==":[Ji,[sr],(C,[w])=>C.geometryType()===w.value],"filter-<":[Ji,[sr,Yi],(C,[w,A])=>{const R=C.properties()[w.value],q=A.value;return typeof R==typeof q&&R<q}],"filter-id-<":[Ji,[Yi],(C,[w])=>{const A=C.id(),R=w.value;return typeof A==typeof R&&A<R}],"filter->":[Ji,[sr,Yi],(C,[w,A])=>{const R=C.properties()[w.value],q=A.value;return typeof R==typeof q&&R>q}],"filter-id->":[Ji,[Yi],(C,[w])=>{const A=C.id(),R=w.value;return typeof A==typeof R&&A>R}],"filter-<=":[Ji,[sr,Yi],(C,[w,A])=>{const R=C.properties()[w.value],q=A.value;return typeof R==typeof q&&R<=q}],"filter-id-<=":[Ji,[Yi],(C,[w])=>{const A=C.id(),R=w.value;return typeof A==typeof R&&A<=R}],"filter->=":[Ji,[sr,Yi],(C,[w,A])=>{const R=C.properties()[w.value],q=A.value;return typeof R==typeof q&&R>=q}],"filter-id->=":[Ji,[Yi],(C,[w])=>{const A=C.id(),R=w.value;return typeof A==typeof R&&A>=R}],"filter-has":[Ji,[Yi],(C,[w])=>w.value in C.properties()],"filter-has-id":[Ji,[],C=>C.id()!==null&&C.id()!==void 0],"filter-type-in":[Ji,[Ls(sr)],(C,[w])=>w.value.indexOf(C.geometryType())>=0],"filter-id-in":[Ji,[Ls(Yi)],(C,[w])=>w.value.indexOf(C.id())>=0],"filter-in-small":[Ji,[sr,Ls(Yi)],(C,[w,A])=>A.value.indexOf(C.properties()[w.value])>=0],"filter-in-large":[Ji,[sr,Ls(Yi)],(C,[w,A])=>o0(C.properties()[w.value],A.value,0,A.value.length-1)],all:{type:Ji,overloads:[[[Ji,Ji],(C,[w,A])=>w.evaluate(C)&&A.evaluate(C)],[bc(Ji),(C,w)=>{for(const A of w)if(!A.evaluate(C))return!1;return!0}]]},any:{type:Ji,overloads:[[[Ji,Ji],(C,[w,A])=>w.evaluate(C)||A.evaluate(C)],[bc(Ji),(C,w)=>{for(const A of w)if(A.evaluate(C))return!0;return!1}]]},"!":[Ji,[Ji],(C,[w])=>!w.evaluate(C)],"is-supported-script":[Ji,[sr],(C,[w])=>{const A=C.globals&&C.globals.isSupportedScript;return A?A(w.evaluate(C)):!0}],upcase:[sr,[sr],(C,[w])=>w.evaluate(C).toUpperCase()],downcase:[sr,[sr],(C,[w])=>w.evaluate(C).toLowerCase()],concat:[sr,bc(Yi),(C,w)=>w.map(A=>Xh(A.evaluate(C))).join("")],"resolved-locale":[sr,[rd],(C,[w])=>w.evaluate(C).resolvedLocale()]});var rg=ig;function Rf(C){return{result:"success",value:C}}function Jc(C){return{result:"error",value:C}}function a0(C){return C["property-type"]==="data-driven"||C["property-type"]==="cross-faded-data-driven"}function s0(C){return!!C.expression&&C.expression.parameters.indexOf("zoom")>-1}function ng(C){return!!C.expression&&C.expression.interpolated}function hm(C){return C instanceof Number?"number":C instanceof String?"string":C instanceof Boolean?"boolean":Array.isArray(C)?"array":C===null?"null":typeof C}function pm(C){return typeof C=="object"&&C!==null&&!Array.isArray(C)}function l0(C){return C}function dm(C,w){const A=w.type==="color",R=C.stops&&typeof C.stops[0][0]=="object",q=R||C.property!==void 0,Y=R||!q,y=C.type||(ng(w)?"exponential":"interval");if(A&&(C=Ly({},C),C.stops&&(C.stops=C.stops.map(Oe=>[Oe[0],qo.parse(Oe[1])])),C.default?C.default=qo.parse(C.default):C.default=qo.parse(w.default)),C.colorSpace&&C.colorSpace!=="rgb"&&!Jy[C.colorSpace])throw new Error(`Unknown color space: ${C.colorSpace}`);let v,ce,Te;if(y==="exponential")v=ty;else if(y==="interval")v=c0;else if(y==="categorical"){v=u0,ce=Object.create(null);for(const Oe of C.stops)ce[Oe[0]]=Oe[1];Te=typeof C.stops[0][0]}else if(y==="identity")v=h0;else throw new Error(`Unknown function type "${y}"`);if(R){const Oe={},Xe=[];for(let zt=0;zt<C.stops.length;zt++){const ci=C.stops[zt],Ct=ci[0].zoom;Oe[Ct]===void 0&&(Oe[Ct]={zoom:Ct,type:C.type,property:C.property,default:C.default,stops:[]},Xe.push(Ct)),Oe[Ct].stops.push([ci[0].value,ci[1]])}const xe=[];for(const zt of Xe)xe.push([Oe[zt].zoom,dm(Oe[zt],w)]);const dt={name:"linear"};return{kind:"composite",interpolationType:dt,interpolationFactor:_u.interpolationFactor.bind(void 0,dt),zoomStops:xe.map(zt=>zt[0]),evaluate({zoom:zt},ci){return ty({stops:xe,base:C.base},w,zt).evaluate(zt,ci)}}}else if(Y){const Oe=y==="exponential"?{name:"exponential",base:C.base!==void 0?C.base:1}:null;return{kind:"camera",interpolationType:Oe,interpolationFactor:_u.interpolationFactor.bind(void 0,Oe),zoomStops:C.stops.map(Xe=>Xe[0]),evaluate:({zoom:Xe})=>v(C,w,Xe,ce,Te)}}else return{kind:"source",evaluate(Oe,Xe){const xe=Xe&&Xe.properties?Xe.properties[C.property]:void 0;return xe===void 0?Qh(C.default,w.default):v(C,w,xe,ce,Te)}}}function Qh(C,w,A){if(C!==void 0)return C;if(w!==void 0)return w;if(A!==void 0)return A}function u0(C,w,A,R,q){const Y=typeof A===q?R[A]:void 0;return Qh(Y,C.default,w.default)}function c0(C,w,A){if(hm(A)!=="number")return Qh(C.default,w.default);const R=C.stops.length;if(R===1||A<=C.stops[0][0])return C.stops[0][1];if(A>=C.stops[R-1][0])return C.stops[R-1][1];const q=ld(C.stops.map(Y=>Y[0]),A);return C.stops[q][1]}function ty(C,w,A){const R=C.base!==void 0?C.base:1;if(hm(A)!=="number")return Qh(C.default,w.default);const q=C.stops.length;if(q===1||A<=C.stops[0][0])return C.stops[0][1];if(A>=C.stops[q-1][0])return C.stops[q-1][1];const Y=ld(C.stops.map(Oe=>Oe[0]),A),y=p0(A,R,C.stops[Y][0],C.stops[Y+1][0]),v=C.stops[Y][1],ce=C.stops[Y+1][1];let Te=qy[w.type]||l0;if(C.colorSpace&&C.colorSpace!=="rgb"){const Oe=Jy[C.colorSpace];Te=(Xe,xe)=>Oe.reverse(Oe.interpolate(Oe.forward(Xe),Oe.forward(xe),y))}return typeof v.evaluate=="function"?{evaluate(...Oe){const Xe=v.evaluate.apply(void 0,Oe),xe=ce.evaluate.apply(void 0,Oe);if(!(Xe===void 0||xe===void 0))return Te(Xe,xe,y)}}:Te(v,ce,y)}function h0(C,w,A){return w.type==="color"?A=qo.parse(A):w.type==="formatted"?A=gl.fromString(A.toString()):w.type==="resolvedImage"?A=vu.fromString(A.toString()):hm(A)!==w.type&&(w.type!=="enum"||!w.values[A])&&(A=void 0),Qh(A,C.default,w.default)}function p0(C,w,A,R){const q=R-A,Y=C-A;return q===0?0:w===1?Y/q:(Math.pow(w,Y)-1)/(Math.pow(w,q)-1)}class og{constructor(w,A){this.expression=w,this._warningHistory={},this._evaluator=new By,this._defaultValue=A?m0(A):null,this._enumValues=A&&A.type==="enum"?A.values:null}evaluateWithoutErrorHandling(w,A,R,q,Y,y,v,ce){return this._evaluator.globals=w,this._evaluator.feature=A,this._evaluator.featureState=R,this._evaluator.canonical=q||null,this._evaluator.availableImages=Y||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=ce||null,this.expression.evaluate(this._evaluator)}evaluate(w,A,R,q,Y,y,v,ce){this._evaluator.globals=w,this._evaluator.feature=A||null,this._evaluator.featureState=R||null,this._evaluator.canonical=q||null,this._evaluator.availableImages=Y||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=ce||null;try{const Te=this.expression.evaluate(this._evaluator);if(Te==null||typeof Te=="number"&&Te!==Te)return this._defaultValue;if(this._enumValues&&!(Te in this._enumValues))throw new Zo(`Expected value to be one of ${Object.keys(this._enumValues).map(Oe=>JSON.stringify(Oe)).join(", ")}, but found ${JSON.stringify(Te)} instead.`);return Te}catch(Te){return this._warningHistory[Te.message]||(this._warningHistory[Te.message]=!0,typeof console<"u"&&console.warn(Te.message)),this._defaultValue}}}function ag(C){return Array.isArray(C)&&C.length>0&&typeof C[0]=="string"&&C[0]in rg}function sg(C,w){const A=new Vy(rg,[],w?f0(w):void 0),R=A.parse(C,void 0,void 0,void 0,w&&w.type==="string"?{typeAnnotation:"coerce"}:void 0);return R?Rf(new og(R,w)):Jc(A.errors)}class Bf{constructor(w,A){this.kind=w,this._styleExpression=A,this.isStateDependent=w!=="constant"&&!Qf(A.expression)}evaluateWithoutErrorHandling(w,A,R,q,Y,y){return this._styleExpression.evaluateWithoutErrorHandling(w,A,R,q,Y,y)}evaluate(w,A,R,q,Y,y){return this._styleExpression.evaluate(w,A,R,q,Y,y)}}class Ff{constructor(w,A,R,q){this.kind=w,this.zoomStops=R,this._styleExpression=A,this.isStateDependent=w!=="camera"&&!Qf(A.expression),this.interpolationType=q}evaluateWithoutErrorHandling(w,A,R,q,Y,y){return this._styleExpression.evaluateWithoutErrorHandling(w,A,R,q,Y,y)}evaluate(w,A,R,q,Y,y){return this._styleExpression.evaluate(w,A,R,q,Y,y)}interpolationFactor(w,A,R){return this.interpolationType?_u.interpolationFactor(this.interpolationType,w,A,R):0}}function lg(C,w){if(C=sg(C,w),C.result==="error")return C;const A=C.value.expression,R=Yf(A);if(!R&&!a0(w))return Jc([new Zl("","data expressions not supported")]);const q=em(A,["zoom","pitch","distance-from-center"]);if(!q&&!s0(w))return Jc([new Zl("","zoom expressions not supported")]);const Y=Gp(A);if(!Y&&!q)return Jc([new Zl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(Y instanceof Zl)return Jc([Y]);if(Y instanceof _u&&!ng(w))return Jc([new Zl("",'"interpolate" expressions cannot be used with this property')]);if(!Y)return Rf(R?new Bf("constant",C.value):new Bf("source",C.value));const y=Y instanceof _u?Y.interpolation:void 0;return Rf(R?new Ff("camera",C.value,Y.labels,y):new Ff("composite",C.value,Y.labels,y))}class ud{constructor(w,A){this._parameters=w,this._specification=A,Ly(this,dm(this._parameters,this._specification))}static deserialize(w){return new ud(w._parameters,w._specification)}static serialize(w){return{_parameters:w._parameters,_specification:w._specification}}}function d0(C,w){if(pm(C))return new ud(C,w);if(ag(C)){const A=lg(C,w);if(A.result==="error")throw new Error(A.value.map(R=>`${R.key}: ${R.message}`).join(", "));return A.value}else{let A=C;return typeof C=="string"&&w.type==="color"&&(A=qo.parse(C)),{kind:"constant",evaluate:()=>A}}}function Gp(C){let w=null;if(C instanceof Qy)w=Gp(C.result);else if(C instanceof Yy){for(const A of C.args)if(w=Gp(A),w)break}else(C instanceof Ny||C instanceof _u)&&C.input instanceof nh&&C.input.name==="zoom"&&(w=C);return w instanceof Zl||C.eachChild(A=>{const R=Gp(A);R instanceof Zl?w=R:!w&&R?w=new Zl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):w&&R&&w!==R&&(w=new Zl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),w}function f0(C){const w={color:gu,string:sr,number:Vt,enum:sr,boolean:Ji,formatted:nd,resolvedImage:Yh};return C.type==="array"?Ls(w[C.value]||Yi,C.length):w[C.type]}function m0(C){return C.type==="color"&&(pm(C.default)||Array.isArray(C.default))?new qo(0,0,0,0):C.type==="color"?qo.parse(C.default)||null:C.default===void 0?null:C.default}function Jh(C){return typeof C=="object"?["literal",C]:C}function y0(C,w){let A=C.stops;if(!A)return g0(C,w);const R=A&&typeof A[0][0]=="object",q=R||C.property!==void 0,Y=R||!q;return A=A.map(y=>!q&&w.tokens&&typeof y[1]=="string"?[y[0],b0(y[1])]:[y[0],Jh(y[1])]),R?_0(C,w,A):Y?x0(C,w,A):Of(C,w,A)}function g0(C,w){const A=["get",C.property];if(C.default===void 0)return w.type==="string"?["string",A]:A;if(w.type==="enum")return["match",A,Object.keys(w.values),A,C.default];{const R=[w.type==="color"?"to-color":w.type,A,Jh(C.default)];return w.type==="array"&&R.splice(1,0,w.value,w.length||null),R}}function fm(C){switch(C.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function _0(C,w,A){const R={},q={},Y=[];for(let v=0;v<A.length;v++){const ce=A[v],Te=ce[0].zoom;R[Te]===void 0&&(R[Te]={zoom:Te,type:C.type,property:C.property,default:C.default},q[Te]=[],Y.push(Te)),q[Te].push([ce[0].value,ce[1]])}if(ym({},w)==="exponential"){const v=[fm(C),["linear"],["zoom"]];for(const ce of Y){const Te=Of(R[ce],w,q[ce]);ih(v,ce,Te,!1)}return v}else{const v=["step",["zoom"]];for(const ce of Y){const Te=Of(R[ce],w,q[ce]);ih(v,ce,Te,!0)}return mm(v),v}}function v0(C,w){if(C!==void 0)return C;if(w!==void 0)return w}function iy(C,w){const A=Jh(v0(C.default,w.default));return A===void 0&&w.type==="resolvedImage"?"":A}function Of(C,w,A){const R=ym(C,w),q=["get",C.property];if(R==="categorical"&&typeof A[0][0]=="boolean"){const Y=["case"];for(const y of A)Y.push(["==",q,y[0]],y[1]);return Y.push(iy(C,w)),Y}else if(R==="categorical"){const Y=["match",q];for(const y of A)ih(Y,y[0],y[1],!1);return Y.push(iy(C,w)),Y}else if(R==="interval"){const Y=["step",["number",q]];for(const y of A)ih(Y,y[0],y[1],!0);return mm(Y),C.default===void 0?Y:["case",["==",["typeof",q],"number"],Y,Jh(C.default)]}else if(R==="exponential"){const Y=C.base!==void 0?C.base:1,y=[fm(C),Y===1?["linear"]:["exponential",Y],["number",q]];for(const v of A)ih(y,v[0],v[1],!1);return C.default===void 0?y:["case",["==",["typeof",q],"number"],y,Jh(C.default)]}else throw new Error(`Unknown property function type ${R}`)}function x0(C,w,A,R=["zoom"]){const q=ym(C,w);let Y,y=!1;if(q==="interval")Y=["step",R],y=!0;else if(q==="exponential"){const v=C.base!==void 0?C.base:1;Y=[fm(C),v===1?["linear"]:["exponential",v],R]}else throw new Error(`Unknown zoom function type "${q}"`);for(const v of A)ih(Y,v[0],v[1],y);return mm(Y),Y}function mm(C){C[0]==="step"&&C.length===3&&(C.push(0),C.push(C[3]))}function ih(C,w,A,R){C.length>3&&w===C[C.length-2]||(R&&C.length===2||C.push(w),C.push(A))}function ym(C,w){return C.type?C.type:w.expression.interpolated?"exponential":"interval"}function b0(C){const w=["concat"],A=/{([^{}]+)}/g;let R=0;for(let q=A.exec(C);q!==null;q=A.exec(C)){const Y=C.slice(R,A.lastIndex-q[0].length);R=A.lastIndex,Y.length>0&&w.push(Y),w.push(["get",q[1]])}if(w.length===1)return C;if(R<C.length)w.push(C.slice(R));else if(w.length===2)return["to-string",w[1]];return w}function ug(C){if(C===!0||C===!1)return!0;if(!Array.isArray(C)||C.length===0)return!1;switch(C[0]){case"has":return C.length>=2&&C[1]!=="$id"&&C[1]!=="$type";case"in":return C.length>=3&&(typeof C[1]!="string"||Array.isArray(C[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return C.length!==3||Array.isArray(C[1])||Array.isArray(C[2]);case"any":case"all":for(const w of C.slice(1))if(!ug(w)&&typeof w!="boolean")return!1;return!0;default:return!0}}td(function(C,w){var A=function(){var R=function(hr,wt,Et,oi){for(Et=Et||{},oi=hr.length;oi--;Et[hr[oi]]=wt);return Et},q=[1,12],Y=[1,13],y=[1,9],v=[1,10],ce=[1,11],Te=[1,14],Oe=[1,15],Xe=[14,18,22,24],xe=[18,22],dt=[22,24],zt={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(wt,Et,oi,Jt,Kt,pi,or){var zi=pi.length-1;switch(Kt){case 1:this.$=new String(wt.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(wt),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=pi[zi-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=pi[zi-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[pi[zi-2],pi[zi]];break;case 16:this.$={},this.$[pi[zi][0]]=pi[zi][1];break;case 17:this.$=pi[zi-2],pi[zi-2][pi[zi][0]]=pi[zi][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[pi[zi]];break;case 21:this.$=pi[zi-2],pi[zi-2].push(pi[zi]);break}},table:[{3:5,4:q,5:6,6:Y,7:3,8:y,9:4,10:v,11:ce,12:1,13:2,15:7,16:8,17:Te,23:Oe},{1:[3]},{14:[1,16]},R(Xe,[2,7]),R(Xe,[2,8]),R(Xe,[2,9]),R(Xe,[2,10]),R(Xe,[2,11]),R(Xe,[2,12]),R(Xe,[2,3]),R(Xe,[2,4]),R(Xe,[2,5]),R([14,18,21,22,24],[2,1]),R(Xe,[2,2]),{3:20,4:q,18:[1,17],19:18,20:19},{3:5,4:q,5:6,6:Y,7:3,8:y,9:4,10:v,11:ce,13:23,15:7,16:8,17:Te,23:Oe,24:[1,21],25:22},{1:[2,6]},R(Xe,[2,13]),{18:[1,24],22:[1,25]},R(xe,[2,16]),{21:[1,26]},R(Xe,[2,18]),{22:[1,28],24:[1,27]},R(dt,[2,20]),R(Xe,[2,14]),{3:20,4:q,20:29},{3:5,4:q,5:6,6:Y,7:3,8:y,9:4,10:v,11:ce,13:30,15:7,16:8,17:Te,23:Oe},R(Xe,[2,19]),{3:5,4:q,5:6,6:Y,7:3,8:y,9:4,10:v,11:ce,13:31,15:7,16:8,17:Te,23:Oe},R(xe,[2,17]),R(xe,[2,15]),R(dt,[2,21])],defaultActions:{16:[2,6]},parseError:function(wt,Et){if(Et.recoverable)this.trace(wt);else throw new Error(wt)},parse:function(wt){var Et=this,oi=[0],Jt=[null],Kt=[],pi=this.table,or="",zi=0,sn=0,Xr=2,fn=1,lr=Kt.slice.call(arguments,1),Li=Object.create(this.lexer),Yr={yy:{}};for(var Wt in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Wt)&&(Yr.yy[Wt]=this.yy[Wt]);Li.setInput(wt,Yr.yy),Yr.yy.lexer=Li,Yr.yy.parser=this,typeof Li.yylloc>"u"&&(Li.yylloc={});var Qr=Li.yylloc;Kt.push(Qr);var An=Li.options&&Li.options.ranges;typeof Yr.yy.parseError=="function"?this.parseError=Yr.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function Jn(){var vr;return vr=Li.lex()||fn,typeof vr!="number"&&(vr=Et.symbols_[vr]||vr),vr}for(var kt,ti,si,Fi,Oi={},Qi,Ui,ji,ir;;){if(ti=oi[oi.length-1],this.defaultActions[ti]?si=this.defaultActions[ti]:((kt===null||typeof kt>"u")&&(kt=Jn()),si=pi[ti]&&pi[ti][kt]),typeof si>"u"||!si.length||!si[0]){var gi="";ir=[];for(Qi in pi[ti])this.terminals_[Qi]&&Qi>Xr&&ir.push("'"+this.terminals_[Qi]+"'");Li.showPosition?gi="Parse error on line "+(zi+1)+`:
`+Li.showPosition()+`
Expecting `+ir.join(", ")+", got '"+(this.terminals_[kt]||kt)+"'":gi="Parse error on line "+(zi+1)+": Unexpected "+(kt==fn?"end of input":"'"+(this.terminals_[kt]||kt)+"'"),this.parseError(gi,{text:Li.match,token:this.terminals_[kt]||kt,line:Li.yylineno,loc:Qr,expected:ir})}if(si[0]instanceof Array&&si.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ti+", token: "+kt);switch(si[0]){case 1:oi.push(kt),Jt.push(Li.yytext),Kt.push(Li.yylloc),oi.push(si[1]),kt=null,sn=Li.yyleng,or=Li.yytext,zi=Li.yylineno,Qr=Li.yylloc;break;case 2:if(Ui=this.productions_[si[1]][1],Oi.$=Jt[Jt.length-Ui],Oi._$={first_line:Kt[Kt.length-(Ui||1)].first_line,last_line:Kt[Kt.length-1].last_line,first_column:Kt[Kt.length-(Ui||1)].first_column,last_column:Kt[Kt.length-1].last_column},An&&(Oi._$.range=[Kt[Kt.length-(Ui||1)].range[0],Kt[Kt.length-1].range[1]]),Fi=this.performAction.apply(Oi,[or,sn,zi,Yr.yy,si[1],Jt,Kt].concat(lr)),typeof Fi<"u")return Fi;Ui&&(oi=oi.slice(0,-1*Ui*2),Jt=Jt.slice(0,-1*Ui),Kt=Kt.slice(0,-1*Ui)),oi.push(this.productions_[si[1]][0]),Jt.push(Oi.$),Kt.push(Oi._$),ji=pi[oi[oi.length-2]][oi[oi.length-1]],oi.push(ji);break;case 3:return!0}}return!0}},ci=function(){var hr={EOF:1,parseError:function(Et,oi){if(this.yy.parser)this.yy.parser.parseError(Et,oi);else throw new Error(Et)},setInput:function(wt,Et){return this.yy=Et||this.yy||{},this._input=wt,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var wt=this._input[0];this.yytext+=wt,this.yyleng++,this.offset++,this.match+=wt,this.matched+=wt;var Et=wt.match(/(?:\r\n?|\n).*/g);return Et?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),wt},unput:function(wt){var Et=wt.length,oi=wt.split(/(?:\r\n?|\n)/g);this._input=wt+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-Et),this.offset-=Et;var Jt=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),oi.length-1&&(this.yylineno-=oi.length-1);var Kt=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:oi?(oi.length===Jt.length?this.yylloc.first_column:0)+Jt[Jt.length-oi.length].length-oi[0].length:this.yylloc.first_column-Et},this.options.ranges&&(this.yylloc.range=[Kt[0],Kt[0]+this.yyleng-Et]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(wt){this.unput(this.match.slice(wt))},pastInput:function(){var wt=this.matched.substr(0,this.matched.length-this.match.length);return(wt.length>20?"...":"")+wt.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var wt=this.match;return wt.length<20&&(wt+=this._input.substr(0,20-wt.length)),(wt.substr(0,20)+(wt.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var wt=this.pastInput(),Et=new Array(wt.length+1).join("-");return wt+this.upcomingInput()+`
`+Et+"^"},test_match:function(wt,Et){var oi,Jt,Kt;if(this.options.backtrack_lexer&&(Kt={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(Kt.yylloc.range=this.yylloc.range.slice(0))),Jt=wt[0].match(/(?:\r\n?|\n).*/g),Jt&&(this.yylineno+=Jt.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:Jt?Jt[Jt.length-1].length-Jt[Jt.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+wt[0].length},this.yytext+=wt[0],this.match+=wt[0],this.matches=wt,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(wt[0].length),this.matched+=wt[0],oi=this.performAction.call(this,this.yy,this,Et,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),oi)return oi;if(this._backtrack){for(var pi in Kt)this[pi]=Kt[pi];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var wt,Et,oi,Jt;this._more||(this.yytext="",this.match="");for(var Kt=this._currentRules(),pi=0;pi<Kt.length;pi++)if(oi=this._input.match(this.rules[Kt[pi]]),oi&&(!Et||oi[0].length>Et[0].length)){if(Et=oi,Jt=pi,this.options.backtrack_lexer){if(wt=this.test_match(oi,Kt[pi]),wt!==!1)return wt;if(this._backtrack){Et=!1;continue}else return!1}else if(!this.options.flex)break}return Et?(wt=this.test_match(Et,Kt[Jt]),wt!==!1?wt:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var Et=this.next();return Et||this.lex()},begin:function(Et){this.conditionStack.push(Et)},popState:function(){var Et=this.conditionStack.length-1;return Et>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Et){return Et=this.conditionStack.length-1-Math.abs(Et||0),Et>=0?this.conditionStack[Et]:"INITIAL"},pushState:function(Et){this.begin(Et)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(Et,oi,Jt,Kt){switch(Jt){case 0:break;case 1:return 6;case 2:return oi.yytext=oi.yytext.substr(1,oi.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return hr}();zt.lexer=ci;function Ct(){this.yy={}}return Ct.prototype=zt,zt.Parser=Ct,new Ct}();typeof J_<"u"&&(w.parser=A,w.Parser=A.Parser,w.parse=function(){return A.parse.apply(A,arguments)})});const w0={StyleExpression:og,isExpression:ag,isExpressionFilter:ug,createExpression:sg,createPropertyExpression:lg,normalizePropertyExpression:d0,ZoomConstantExpression:Bf,ZoomDependentExpression:Ff,StylePropertyFunction:ud},T0={convertFunction:y0,createFunction:dm,isFunction:pm};function S0(C){var w=C.expr,A=C.layer,R=Math.min(w(A,"paint","circle-radius"),8),q=Math.min(w(A,"paint","circle-stroke-width"),4),Y=w(A,"paint","circle-color"),y=w(A,"paint","circle-opacity"),v=w(A,"paint","circle-stroke-color"),ce=w(A,"paint","circle-stroke-opacity"),Te=R-q/2;return{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",style:{filter:"blur("+w(A,"paint","circle-blur")*Te+"px)"}},children:[{element:"circle",attributes:{key:"l1",cx:10,cy:10,fill:Y,opacity:y,r:Te}},{element:"circle",attributes:{key:"l2",cx:10,cy:10,fill:"transparent",opacity:ce,r:R,"stroke-width":q,stroke:v}}]}}function I0(C){var w=C.expr,A=C.layer;return{element:"div",attributes:{style:{width:"100%",height:"100%",backgroundImage:"url("+(0,C.image)(w(A,"paint","fill-pattern"))+")",backgroundColor:w(A,"paint","fill-color"),opacity:w(A,"paint","fill-opacity"),backgroundSize:"66% 66%",backgroundPosition:"center"}}}}function E0(C){var w=C.layer,A=C.expr,R=(0,C.image)(A(w,"paint","line-pattern")),q={stroke:R?"url(#img1)":A(w,"paint","line-color"),strokeWidth:Math.max(2,Math.min(A(w,"paint","line-width"),8)),strokeOpacity:A(w,"paint","line-opacity")},Y=q.strokeWidth;return{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"defs",attributes:{key:"defs"},children:[{element:"pattern",attributes:{key:"pattern",id:"img1",x:0,y:0,width:q.strokeWidth,height:q.strokeWidth,patternUnits:"userSpaceOnUse",patternTransform:"translate("+-Y/2+" "+-Y/2+") rotate(45)"},children:[{element:"image",attributes:{key:"img",xlinkHref:R,x:0,y:0,width:q.strokeWidth,height:q.strokeWidth}}]}]},{element:"path",attributes:{key:"path",style:q,stroke:q.stroke,d:"M0 20 L 20 0"}}]}}function k0(C){return function(v){var ce=v.image,Te=(0,v.expr)(v.layer,"layout","icon-image");if(!Te)return null;var Oe=ce(Te);return Oe?{element:"div",attributes:{style:{backgroundImage:"url("+Oe+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%"}}}:null}(C)||(q=(A=(w=C).expr)(R=w.layer,"paint","text-color"),Y=A(R,"paint","text-opacity"),{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"path",attributes:{key:"l1",d:y="M 4,4 L 16,4 L 16,7 L 11.5 7 L 11.5 16 L 8.5 16 L 8.5 7 L 4 7 Z",stroke:A(R,"paint","text-halo-color"),"stroke-width":2*A(R,"paint","text-halo-width"),fill:"transparent","stroke-linejoin":"round"}},{element:"path",attributes:{key:"l2",d:y,fill:"white"}},{element:"path",attributes:{key:"l3",d:y,fill:q,opacity:Y}}]});var w,A,R,q,Y,y}var A0=[["background"],["circle"],["fill-extrusion"],["fill"],["heatmap"],["hillshade"],["line"],["raster"],["icon","symbol"],["text","symbol"]];function z0(C){var w,A=C.sprite,R=C.layer,q={circle:S0,symbol:k0,line:E0,fill:I0}[R.type],Y=(w=C.zoom,function(y,v,ce){var Te=function(zt){var ci=A0.find(function(Ct){return zt.startsWith(Ct[0])});return ci?ci[1]||ci[0]:null}(ce),Oe=K_[v+"_"+Te][ce];if(!y[v])return Oe.default;var Xe=y[v][ce];if(Xe===void 0)return Oe.default;if(typeof Xe=="object"){var xe;if(!(xe=Array.isArray(Xe)?w0.createExpression(Xe).value:T0.createFunction(Xe,Oe)).evaluate)return null;var dt=xe.evaluate({zoom:w},{});return dt?dt.name||dt:null}return Xe});return q?q({layer:R,expr:Y,image:function(y){if(A&&A.json){var v=A.json[y];if(v)return ce=A.image,Oe=(Te=v).x,Xe=Te.y,xe=Te.width,dt=Te.height,(zt=document.createElement("canvas")).width=2*xe,zt.height=2*dt,zt.getContext("2d").drawImage(ce,2*Oe,2*Xe,2*xe,2*dt,0,0,2*xe,2*dt),zt.toDataURL()}var ce,Te,Oe,Xe,xe,dt,zt;return null}}):null}const C0=Object.freeze(Object.defineProperty({__proto__:null,default:z0},Symbol.toStringTag,{value:"Module"})),P0=Qg(C0);var cg={exports:{}},gm={exports:{}},hg=function(w,A){return function(){for(var q=new Array(arguments.length),Y=0;Y<q.length;Y++)q[Y]=arguments[Y];return w.apply(A,q)}},M0=hg,wc=Object.prototype.toString;function _m(C){return wc.call(C)==="[object Array]"}function Uf(C){return typeof C>"u"}function D0(C){return C!==null&&!Uf(C)&&C.constructor!==null&&!Uf(C.constructor)&&typeof C.constructor.isBuffer=="function"&&C.constructor.isBuffer(C)}function L0(C){return wc.call(C)==="[object ArrayBuffer]"}function R0(C){return typeof FormData<"u"&&C instanceof FormData}function B0(C){var w;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?w=ArrayBuffer.isView(C):w=C&&C.buffer&&C.buffer instanceof ArrayBuffer,w}function F0(C){return typeof C=="string"}function O0(C){return typeof C=="number"}function pg(C){return C!==null&&typeof C=="object"}function $p(C){if(wc.call(C)!=="[object Object]")return!1;var w=Object.getPrototypeOf(C);return w===null||w===Object.prototype}function U0(C){return wc.call(C)==="[object Date]"}function j0(C){return wc.call(C)==="[object File]"}function V0(C){return wc.call(C)==="[object Blob]"}function dg(C){return wc.call(C)==="[object Function]"}function N0(C){return pg(C)&&dg(C.pipe)}function q0(C){return typeof URLSearchParams<"u"&&C instanceof URLSearchParams}function Z0(C){return C.trim?C.trim():C.replace(/^\s+|\s+$/g,"")}function G0(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function vm(C,w){if(!(C===null||typeof C>"u"))if(typeof C!="object"&&(C=[C]),_m(C))for(var A=0,R=C.length;A<R;A++)w.call(null,C[A],A,C);else for(var q in C)Object.prototype.hasOwnProperty.call(C,q)&&w.call(null,C[q],q,C)}function jf(){var C={};function w(q,Y){$p(C[Y])&&$p(q)?C[Y]=jf(C[Y],q):$p(q)?C[Y]=jf({},q):_m(q)?C[Y]=q.slice():C[Y]=q}for(var A=0,R=arguments.length;A<R;A++)vm(arguments[A],w);return C}function $0(C,w,A){return vm(w,function(q,Y){A&&typeof q=="function"?C[Y]=M0(q,A):C[Y]=q}),C}function X0(C){return C.charCodeAt(0)===65279&&(C=C.slice(1)),C}var cs={isArray:_m,isArrayBuffer:L0,isBuffer:D0,isFormData:R0,isArrayBufferView:B0,isString:F0,isNumber:O0,isObject:pg,isPlainObject:$p,isUndefined:Uf,isDate:U0,isFile:j0,isBlob:V0,isFunction:dg,isStream:N0,isURLSearchParams:q0,isStandardBrowserEnv:G0,forEach:vm,merge:jf,extend:$0,trim:Z0,stripBOM:X0},Hc=cs;function ry(C){return encodeURIComponent(C).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var fg=function(w,A,R){if(!A)return w;var q;if(R)q=R(A);else if(Hc.isURLSearchParams(A))q=A.toString();else{var Y=[];Hc.forEach(A,function(ce,Te){ce===null||typeof ce>"u"||(Hc.isArray(ce)?Te=Te+"[]":ce=[ce],Hc.forEach(ce,function(Xe){Hc.isDate(Xe)?Xe=Xe.toISOString():Hc.isObject(Xe)&&(Xe=JSON.stringify(Xe)),Y.push(ry(Te)+"="+ry(Xe))}))}),q=Y.join("&")}if(q){var y=w.indexOf("#");y!==-1&&(w=w.slice(0,y)),w+=(w.indexOf("?")===-1?"?":"&")+q}return w},W0=cs;function cd(){this.handlers=[]}cd.prototype.use=function(w,A,R){return this.handlers.push({fulfilled:w,rejected:A,synchronous:R?R.synchronous:!1,runWhen:R?R.runWhen:null}),this.handlers.length-1};cd.prototype.eject=function(w){this.handlers[w]&&(this.handlers[w]=null)};cd.prototype.forEach=function(w){W0.forEach(this.handlers,function(R){R!==null&&w(R)})};var H0=cd,K0=cs,J0=function(w,A){K0.forEach(w,function(q,Y){Y!==A&&Y.toUpperCase()===A.toUpperCase()&&(w[A]=q,delete w[Y])})},mg=function(w,A,R,q,Y){return w.config=A,R&&(w.code=R),w.request=q,w.response=Y,w.isAxiosError=!0,w.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},w},gf,ny;function yg(){if(ny)return gf;ny=1;var C=mg;return gf=function(A,R,q,Y,y){var v=new Error(A);return C(v,R,q,Y,y)},gf}var _f,oy;function Y0(){if(oy)return _f;oy=1;var C=yg();return _f=function(A,R,q){var Y=q.config.validateStatus;!q.status||!Y||Y(q.status)?A(q):R(C("Request failed with status code "+q.status,q.config,null,q.request,q))},_f}var vf,ay;function Q0(){if(ay)return vf;ay=1;var C=cs;return vf=C.isStandardBrowserEnv()?function(){return{write:function(R,q,Y,y,v,ce){var Te=[];Te.push(R+"="+encodeURIComponent(q)),C.isNumber(Y)&&Te.push("expires="+new Date(Y).toGMTString()),C.isString(y)&&Te.push("path="+y),C.isString(v)&&Te.push("domain="+v),ce===!0&&Te.push("secure"),document.cookie=Te.join("; ")},read:function(R){var q=document.cookie.match(new RegExp("(^|;\\s*)("+R+")=([^;]*)"));return q?decodeURIComponent(q[3]):null},remove:function(R){this.write(R,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),vf}var xf,sy;function ex(){return sy||(sy=1,xf=function(w){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(w)}),xf}var bf,ly;function tx(){return ly||(ly=1,bf=function(w,A){return A?w.replace(/\/+$/,"")+"/"+A.replace(/^\/+/,""):w}),bf}var wf,uy;function ix(){if(uy)return wf;uy=1;var C=ex(),w=tx();return wf=function(R,q){return R&&!C(q)?w(R,q):q},wf}var Tf,cy;function rx(){if(cy)return Tf;cy=1;var C=cs,w=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Tf=function(R){var q={},Y,y,v;return R&&C.forEach(R.split(`
`),function(Te){if(v=Te.indexOf(":"),Y=C.trim(Te.substr(0,v)).toLowerCase(),y=C.trim(Te.substr(v+1)),Y){if(q[Y]&&w.indexOf(Y)>=0)return;Y==="set-cookie"?q[Y]=(q[Y]?q[Y]:[]).concat([y]):q[Y]=q[Y]?q[Y]+", "+y:y}}),q},Tf}var Sf,hy;function nx(){if(hy)return Sf;hy=1;var C=cs;return Sf=C.isStandardBrowserEnv()?function(){var A=/(msie|trident)/i.test(navigator.userAgent),R=document.createElement("a"),q;function Y(y){var v=y;return A&&(R.setAttribute("href",v),v=R.href),R.setAttribute("href",v),{href:R.href,protocol:R.protocol?R.protocol.replace(/:$/,""):"",host:R.host,search:R.search?R.search.replace(/^\?/,""):"",hash:R.hash?R.hash.replace(/^#/,""):"",hostname:R.hostname,port:R.port,pathname:R.pathname.charAt(0)==="/"?R.pathname:"/"+R.pathname}}return q=Y(window.location.href),function(v){var ce=C.isString(v)?Y(v):v;return ce.protocol===q.protocol&&ce.host===q.host}}():function(){return function(){return!0}}(),Sf}var If,py;function dy(){if(py)return If;py=1;var C=cs,w=Y0(),A=Q0(),R=fg,q=ix(),Y=rx(),y=nx(),v=yg();return If=function(Te){return new Promise(function(Xe,xe){var dt=Te.data,zt=Te.headers,ci=Te.responseType;C.isFormData(dt)&&delete zt["Content-Type"];var Ct=new XMLHttpRequest;if(Te.auth){var hr=Te.auth.username||"",wt=Te.auth.password?unescape(encodeURIComponent(Te.auth.password)):"";zt.Authorization="Basic "+btoa(hr+":"+wt)}var Et=q(Te.baseURL,Te.url);Ct.open(Te.method.toUpperCase(),R(Et,Te.params,Te.paramsSerializer),!0),Ct.timeout=Te.timeout;function oi(){if(!!Ct){var Kt="getAllResponseHeaders"in Ct?Y(Ct.getAllResponseHeaders()):null,pi=!ci||ci==="text"||ci==="json"?Ct.responseText:Ct.response,or={data:pi,status:Ct.status,statusText:Ct.statusText,headers:Kt,config:Te,request:Ct};w(Xe,xe,or),Ct=null}}if("onloadend"in Ct?Ct.onloadend=oi:Ct.onreadystatechange=function(){!Ct||Ct.readyState!==4||Ct.status===0&&!(Ct.responseURL&&Ct.responseURL.indexOf("file:")===0)||setTimeout(oi)},Ct.onabort=function(){!Ct||(xe(v("Request aborted",Te,"ECONNABORTED",Ct)),Ct=null)},Ct.onerror=function(){xe(v("Network Error",Te,null,Ct)),Ct=null},Ct.ontimeout=function(){var pi="timeout of "+Te.timeout+"ms exceeded";Te.timeoutErrorMessage&&(pi=Te.timeoutErrorMessage),xe(v(pi,Te,Te.transitional&&Te.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",Ct)),Ct=null},C.isStandardBrowserEnv()){var Jt=(Te.withCredentials||y(Et))&&Te.xsrfCookieName?A.read(Te.xsrfCookieName):void 0;Jt&&(zt[Te.xsrfHeaderName]=Jt)}"setRequestHeader"in Ct&&C.forEach(zt,function(pi,or){typeof dt>"u"&&or.toLowerCase()==="content-type"?delete zt[or]:Ct.setRequestHeader(or,pi)}),C.isUndefined(Te.withCredentials)||(Ct.withCredentials=!!Te.withCredentials),ci&&ci!=="json"&&(Ct.responseType=Te.responseType),typeof Te.onDownloadProgress=="function"&&Ct.addEventListener("progress",Te.onDownloadProgress),typeof Te.onUploadProgress=="function"&&Ct.upload&&Ct.upload.addEventListener("progress",Te.onUploadProgress),Te.cancelToken&&Te.cancelToken.promise.then(function(pi){!Ct||(Ct.abort(),xe(pi),Ct=null)}),dt||(dt=null),Ct.send(dt)})},If}var No=cs,fy=J0,ox=mg,ax={"Content-Type":"application/x-www-form-urlencoded"};function my(C,w){!No.isUndefined(C)&&No.isUndefined(C["Content-Type"])&&(C["Content-Type"]=w)}function sx(){var C;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(C=dy()),C}function lx(C,w,A){if(No.isString(C))try{return(w||JSON.parse)(C),No.trim(C)}catch(R){if(R.name!=="SyntaxError")throw R}return(A||JSON.stringify)(C)}var hd={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:sx(),transformRequest:[function(w,A){return fy(A,"Accept"),fy(A,"Content-Type"),No.isFormData(w)||No.isArrayBuffer(w)||No.isBuffer(w)||No.isStream(w)||No.isFile(w)||No.isBlob(w)?w:No.isArrayBufferView(w)?w.buffer:No.isURLSearchParams(w)?(my(A,"application/x-www-form-urlencoded;charset=utf-8"),w.toString()):No.isObject(w)||A&&A["Content-Type"]==="application/json"?(my(A,"application/json"),lx(w)):w}],transformResponse:[function(w){var A=this.transitional,R=A&&A.silentJSONParsing,q=A&&A.forcedJSONParsing,Y=!R&&this.responseType==="json";if(Y||q&&No.isString(w)&&w.length)try{return JSON.parse(w)}catch(y){if(Y)throw y.name==="SyntaxError"?ox(y,this,"E_JSON_PARSE"):y}return w}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(w){return w>=200&&w<300}};hd.headers={common:{Accept:"application/json, text/plain, */*"}};No.forEach(["delete","get","head"],function(w){hd.headers[w]={}});No.forEach(["post","put","patch"],function(w){hd.headers[w]=No.merge(ax)});var xm=hd,ux=cs,cx=xm,hx=function(w,A,R){var q=this||cx;return ux.forEach(R,function(y){w=y.call(q,w,A)}),w},Ef,yy;function gg(){return yy||(yy=1,Ef=function(w){return!!(w&&w.__CANCEL__)}),Ef}var gy=cs,kf=hx,px=gg(),dx=xm;function Af(C){C.cancelToken&&C.cancelToken.throwIfRequested()}var fx=function(w){Af(w),w.headers=w.headers||{},w.data=kf.call(w,w.data,w.headers,w.transformRequest),w.headers=gy.merge(w.headers.common||{},w.headers[w.method]||{},w.headers),gy.forEach(["delete","get","head","post","put","patch","common"],function(q){delete w.headers[q]});var A=w.adapter||dx.adapter;return A(w).then(function(q){return Af(w),q.data=kf.call(w,q.data,q.headers,w.transformResponse),q},function(q){return px(q)||(Af(w),q&&q.response&&(q.response.data=kf.call(w,q.response.data,q.response.headers,w.transformResponse))),Promise.reject(q)})},ta=cs,_g=function(w,A){A=A||{};var R={},q=["url","method","data"],Y=["headers","auth","proxy","params"],y=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],v=["validateStatus"];function ce(xe,dt){return ta.isPlainObject(xe)&&ta.isPlainObject(dt)?ta.merge(xe,dt):ta.isPlainObject(dt)?ta.merge({},dt):ta.isArray(dt)?dt.slice():dt}function Te(xe){ta.isUndefined(A[xe])?ta.isUndefined(w[xe])||(R[xe]=ce(void 0,w[xe])):R[xe]=ce(w[xe],A[xe])}ta.forEach(q,function(dt){ta.isUndefined(A[dt])||(R[dt]=ce(void 0,A[dt]))}),ta.forEach(Y,Te),ta.forEach(y,function(dt){ta.isUndefined(A[dt])?ta.isUndefined(w[dt])||(R[dt]=ce(void 0,w[dt])):R[dt]=ce(void 0,A[dt])}),ta.forEach(v,function(dt){dt in A?R[dt]=ce(w[dt],A[dt]):dt in w&&(R[dt]=ce(void 0,w[dt]))});var Oe=q.concat(Y).concat(y).concat(v),Xe=Object.keys(w).concat(Object.keys(A)).filter(function(dt){return Oe.indexOf(dt)===-1});return ta.forEach(Xe,Te),R};const mx="axios",yx="0.21.4",gx="Promise based HTTP client for the browser and node.js",_x="index.js",vx={test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},xx={type:"git",url:"https://github.com/axios/axios.git"},bx=["xhr","http","ajax","promise","node"],wx="Matt Zabriskie",Tx="MIT",Sx={url:"https://github.com/axios/axios/issues"},Ix="https://axios-http.com",Ex={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},kx={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},Ax="dist/axios.min.js",zx="dist/axios.min.js",Cx="./index.d.ts",Px={"follow-redirects":"^1.14.0"},Mx=[{path:"./dist/axios.min.js",threshold:"5kB"}],Dx={name:mx,version:yx,description:gx,main:_x,scripts:vx,repository:xx,keywords:bx,author:wx,license:Tx,bugs:Sx,homepage:Ix,devDependencies:Ex,browser:kx,jsdelivr:Ax,unpkg:zx,typings:Cx,dependencies:Px,bundlesize:Mx};var vg=Dx,bm={};["object","boolean","number","function","string","symbol"].forEach(function(C,w){bm[C]=function(R){return typeof R===C||"a"+(w<1?"n ":" ")+C}});var _y={},Lx=vg.version.split(".");function xg(C,w){for(var A=w?w.split("."):Lx,R=C.split("."),q=0;q<3;q++){if(A[q]>R[q])return!0;if(A[q]<R[q])return!1}return!1}bm.transitional=function(w,A,R){var q=A&&xg(A);function Y(y,v){return"[Axios v"+vg.version+"] Transitional option '"+y+"'"+v+(R?". "+R:"")}return function(y,v,ce){if(w===!1)throw new Error(Y(v," has been removed in "+A));return q&&!_y[v]&&(_y[v]=!0,console.warn(Y(v," has been deprecated since v"+A+" and will be removed in the near future"))),w?w(y,v,ce):!0}};function Rx(C,w,A){if(typeof C!="object")throw new TypeError("options must be an object");for(var R=Object.keys(C),q=R.length;q-- >0;){var Y=R[q],y=w[Y];if(y){var v=C[Y],ce=v===void 0||y(v,Y,C);if(ce!==!0)throw new TypeError("option "+Y+" must be "+ce);continue}if(A!==!0)throw Error("Unknown option "+Y)}}var Bx={isOlderVersion:xg,assertOptions:Rx,validators:bm},bg=cs,Fx=fg,vy=H0,xy=fx,pd=_g,wg=Bx,Kc=wg.validators;function ep(C){this.defaults=C,this.interceptors={request:new vy,response:new vy}}ep.prototype.request=function(w){typeof w=="string"?(w=arguments[1]||{},w.url=arguments[0]):w=w||{},w=pd(this.defaults,w),w.method?w.method=w.method.toLowerCase():this.defaults.method?w.method=this.defaults.method.toLowerCase():w.method="get";var A=w.transitional;A!==void 0&&wg.assertOptions(A,{silentJSONParsing:Kc.transitional(Kc.boolean,"1.0.0"),forcedJSONParsing:Kc.transitional(Kc.boolean,"1.0.0"),clarifyTimeoutError:Kc.transitional(Kc.boolean,"1.0.0")},!1);var R=[],q=!0;this.interceptors.request.forEach(function(xe){typeof xe.runWhen=="function"&&xe.runWhen(w)===!1||(q=q&&xe.synchronous,R.unshift(xe.fulfilled,xe.rejected))});var Y=[];this.interceptors.response.forEach(function(xe){Y.push(xe.fulfilled,xe.rejected)});var y;if(!q){var v=[xy,void 0];for(Array.prototype.unshift.apply(v,R),v=v.concat(Y),y=Promise.resolve(w);v.length;)y=y.then(v.shift(),v.shift());return y}for(var ce=w;R.length;){var Te=R.shift(),Oe=R.shift();try{ce=Te(ce)}catch(Xe){Oe(Xe);break}}try{y=xy(ce)}catch(Xe){return Promise.reject(Xe)}for(;Y.length;)y=y.then(Y.shift(),Y.shift());return y};ep.prototype.getUri=function(w){return w=pd(this.defaults,w),Fx(w.url,w.params,w.paramsSerializer).replace(/^\?/,"")};bg.forEach(["delete","get","head","options"],function(w){ep.prototype[w]=function(A,R){return this.request(pd(R||{},{method:w,url:A,data:(R||{}).data}))}});bg.forEach(["post","put","patch"],function(w){ep.prototype[w]=function(A,R,q){return this.request(pd(q||{},{method:w,url:A,data:R}))}});var Ox=ep,zf,by;function Tg(){if(by)return zf;by=1;function C(w){this.message=w}return C.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},C.prototype.__CANCEL__=!0,zf=C,zf}var Cf,wy;function Ux(){if(wy)return Cf;wy=1;var C=Tg();function w(A){if(typeof A!="function")throw new TypeError("executor must be a function.");var R;this.promise=new Promise(function(y){R=y});var q=this;A(function(y){q.reason||(q.reason=new C(y),R(q.reason))})}return w.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},w.source=function(){var R,q=new w(function(y){R=y});return{token:q,cancel:R}},Cf=w,Cf}var Pf,Ty;function jx(){return Ty||(Ty=1,Pf=function(w){return function(R){return w.apply(null,R)}}),Pf}var Mf,Sy;function Vx(){return Sy||(Sy=1,Mf=function(w){return typeof w=="object"&&w.isAxiosError===!0}),Mf}var Iy=cs,Nx=hg,Xp=Ox,qx=_g,Zx=xm;function Sg(C){var w=new Xp(C),A=Nx(Xp.prototype.request,w);return Iy.extend(A,Xp.prototype,w),Iy.extend(A,w),A}var _l=Sg(Zx);_l.Axios=Xp;_l.create=function(w){return Sg(qx(_l.defaults,w))};_l.Cancel=Tg();_l.CancelToken=Ux();_l.isCancel=gg();_l.all=function(w){return Promise.all(w)};_l.spread=jx();_l.isAxiosError=Vx();gm.exports=_l;gm.exports.default=_l;(function(C){C.exports=gm.exports})(cg);var Gx=rh&&rh.__awaiter||function(C,w,A,R){function q(Y){return Y instanceof A?Y:new A(function(y){y(Y)})}return new(A||(A=Promise))(function(Y,y){function v(Oe){try{Te(R.next(Oe))}catch(Xe){y(Xe)}}function ce(Oe){try{Te(R.throw(Oe))}catch(Xe){y(Xe)}}function Te(Oe){Oe.done?Y(Oe.value):q(Oe.value).then(v,ce)}Te((R=R.apply(C,w||[])).next())})},Ig=rh&&rh.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(Vf,"__esModule",{value:!0});const Ey=Dy.exports,$x=Ig(P0),Xx=Ig(cg.exports);class Wx{constructor(w,A){this.uncheckedLayers={},this.options={showDefault:!0,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0,accesstoken:void 0,title:void 0},this.sprite={image:HTMLImageElement,json:JSON},this.targets=w,A&&(this.options=Object.assign(this.options,A)),this.onlyRendered=this.options.onlyRendered,this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}changeLayerVisibility(w,A){var R,q;A?(this.uncheckedLayers[w]&&delete this.uncheckedLayers[w],(R=this.map)===null||R===void 0||R.setLayoutProperty(w,"visibility","visible")):(this.uncheckedLayers[w]=w,(q=this.map)===null||q===void 0||q.setLayoutProperty(w,"visibility","none"));const Y=document.getElementsByName(w);for(let y in Y)typeof Y[y]!="number"&&(Y[y].checked=A)}createLayerCheckbox(w){var A;if(!this.options.showCheckbox)return;const R=this,q=document.createElement("TD");q.className="legend-table-td";const Y=document.createElement("input");Y.setAttribute("type","checkbox"),Y.setAttribute("name",w.id),Y.setAttribute("value",w.id);const y=(A=this.map)===null||A===void 0?void 0:A.getLayoutProperty(w.id,"visibility");if(!y)Y.checked=!0;else{let v=!0;switch(y){case"none":v=!1;break;case"visible":v=!0,Y.checked=!0;break}R.changeLayerVisibility(w.id,v)}return Y.addEventListener("click",function(v){var ce,Te;const Oe=(ce=v.target)===null||ce===void 0?void 0:ce.value,Xe=(Te=v.target)===null||Te===void 0?void 0:Te.checked;R.changeLayerVisibility(Oe,Xe)}),q.appendChild(Y),q}getLayerLegend(w){const A=this.map,R=A==null?void 0:A.getZoom(),q=this.sprite;let Y=$x.default({sprite:q,zoom:R,layer:w});var y=document.createElement("TR");const v=this.createLayerCheckbox(w);v&&y.appendChild(v);var ce=document.createElement("TD");if(ce.className="legend-table-td",Y)switch(Y.element){case"div":if(Y.attributes.style.backgroundImage&&!["url(undefined)","url(null)"].includes(Y.attributes.style.backgroundImage)){var Oe=document.createElement("img");Oe.src=Y.attributes.style.backgroundImage.replace("url(","").replace(")",""),Oe.alt=w.id,Oe.style.cssText="height: 17px;",ce.appendChild(Oe)}ce.style.backgroundColor=Y.attributes.style.backgroundColor,ce.style.backgroundPosition=Y.attributes.style.backgroundPosition,ce.style.backgroundSize=Y.attributes.style.backgroundSize,ce.style.backgroundRepeat=Y.attributes.style.backgroundRepeat,ce.style.opacity=Y.attributes.style.opacity;break;case"svg":let dt=document.createElementNS("http://www.w3.org/2000/svg","svg");dt.style.cssText="height: 17px;",dt.setAttributeNS(null,"version","1.1"),Object.keys(Y.attributes).forEach(ci=>{dt.setAttribute(ci,Y.attributes[ci]);let Ct=document.createElementNS("http://www.w3.org/2000/svg","g");Y.children.forEach(hr=>{var wt=document.createElementNS("http://www.w3.org/2000/svg",hr.element);Object.keys(hr.attributes).forEach(Et=>{wt.setAttributeNS(null,Et,hr.attributes[Et])}),Ct.appendChild(wt)}),dt.appendChild(Ct)});var Te=document.createElement("label");Te.textContent=this.targets&&this.targets[w.id]?this.targets[w.id]:w.id,ce.appendChild(dt);break;default:return}else{const dt=document.createElementNS("http://www.w3.org/2000/svg","svg"),zt=document.createElementNS("http://www.w3.org/2000/svg","path"),ci=document.createElementNS("http://www.w3.org/2000/svg","path");dt.setAttribute("fill","none"),dt.setAttribute("viewBox","0 0 24 24"),dt.setAttribute("stroke","black"),dt.classList.add("post-icon"),zt.setAttribute("d","M21,0H3A3,3,0,0,0,0,3V21a3,3,0,0,0,3,3H21a3,3,0,0,0,3-3V3A3,3,0,0,0,21,0ZM3,2H21a1,1,0,0,1,1,1V15.86L14.18,9.35a5.06,5.06,0,0,0-6.39-.06L2,13.92V3A1,1,0,0,1,3,2ZM21,22H3a1,1,0,0,1-1-1V16.48l7-5.63a3.06,3.06,0,0,1,3.86,0L22,18.47V21A1,1,0,0,1,21,22Z"),zt.setAttribute("stroke-linecap","round"),zt.setAttribute("stroke-linejoin","round"),zt.setAttribute("stroke-width","2"),ci.setAttribute("d","M18,9a3,3,0,1,0-3-3A3,3,0,0,0,18,9Zm0-4a1,1,0,1,1-1,1A1,1,0,0,1,18,5Z"),ci.setAttribute("stroke-linecap","round"),ci.setAttribute("stroke-linejoin","round"),ci.setAttribute("stroke-width","2"),dt.appendChild(zt),dt.appendChild(ci);var Te=document.createElement("label");Te.textContent=this.targets&&this.targets[w.id]?this.targets[w.id]:w.id,ce.appendChild(dt)}var Xe=document.createElement("TD");Xe.className="legend-table-td";let xe=document.createElement("label");return xe.textContent=this.targets&&this.targets[w.id]?this.targets[w.id]:w.id,Xe.appendChild(xe),y.appendChild(ce),y.appendChild(Xe),y}updateLegendControl(){const w=this.map,A={};if(w){const q=w.queryRenderedFeatures();for(let Y of q)A[Y.layer.id]=Y.layer}let R=w==null?void 0:w.getStyle().layers;if(R){for(this.legendTable||(this.legendTable=document.createElement("TABLE"),this.legendTable.className="legend-table",this.legendContainer.appendChild(this.legendTable));this.legendTable.firstChild;)this.legendTable.removeChild(this.legendTable.firstChild);this.options.reverseOrder&&(R=R.reverse()),R.forEach(q=>{if(A[q.id]&&this.uncheckedLayers[q.id]?delete this.uncheckedLayers[q.id]:this.uncheckedLayers[q.id]&&(A[q.id]=q),this.targets===void 0||this.targets&&Object.keys(this.targets).length===0||this.targets&&Object.keys(this.targets).map(Y=>Y).includes(q.id)){if(this.onlyRendered&&!A[q.id])return;const Y=this.getLayerLegend(q);if(!Y)return;this.legendTable.appendChild(Y)}else return})}}onAdd(w){this.map=w,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const A=document.createElement("label");A.classList.add("maplibregl-legend-title-label"),A.textContent=this.options.title||"Legend",this.legendContainer.appendChild(A),this.legendContainer.appendChild(document.createElement("br"));const R=document.createElement("input");R.setAttribute("type","checkbox");const q=`maplibregl-legend-onlyrendered-checkbox-${Math.random()*100}`;R.setAttribute("id",q),R.classList.add("maplibregl-legend-onlyRendered-checkbox"),R.checked=this.onlyRendered;const Y=this;R.addEventListener("click",function(ce){var Te;const Oe=(Te=ce.target)===null||Te===void 0?void 0:Te.checked;Y.onlyRendered=!!Oe,Y.updateLegendControl()}),this.legendContainer.appendChild(R);const y=document.createElement("label");y.classList.add("maplibregl-legend-onlyRendered-label"),y.textContent="Only rendered",y.htmlFor=q,this.legendContainer.appendChild(y),this.legendContainer.appendChild(document.createElement("br")),this.map.on("moveend",ce=>{this.updateLegendControl()});const v=()=>Gx(this,void 0,void 0,function*(){if(w.loaded()){let Te=w.getStyle().sprite,Oe="";Te&&Te.includes("mapbox://")&&(Te=Te.replace(/mapbox:\/\//g,Ey.baseApiUrl).replace(/sprites/g,"/styles/v1"),Te=`${Te}/sprite`,Oe=`?access_token=${this.options.accesstoken||Ey.accessToken}`),yield Promise.all([this.loadImage(`${Te}@2x.png${Oe}`),this.loadJson(`${Te}.json${Oe}`)]).then(([xe,dt])=>{this.setSprite(xe,dt)}),this.updateLegendControl(),w.off("idle",v)}});return this.map.on("idle",v),this.options&&this.options.showDefault==!0&&(this.legendContainer.style.display="block",this.legendButton.style.display="none"),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.legendButton||(this.legendButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}redraw(){this.updateLegendControl()}onDocumentClick(w){this.controlContainer&&!this.controlContainer.contains(w.target)&&this.legendContainer&&this.legendButton&&this.options&&this.options.showDefault!==!0&&(this.legendContainer.style.display="none",this.legendButton.style.display="block")}setSprite(w,A){this.sprite={image:w,json:A}}loadImage(w){let A=!1;const R=new Promise((q,Y)=>{const y=new Image;y.crossOrigin="Anonymous",y.onload=()=>{A||q(y)},y.onerror=v=>{A||Y(v)},y.src=w});return R.cancel=()=>{A=!0},R}loadJson(w){return Xx.default.get(w,{responseType:"json"}).then(A=>A.data)}}Vf.default=Wx;(function(C){Object.defineProperty(C,"__esModule",{value:!0});var w=Vf;Object.defineProperty(C,"MaplibreLegendControl",{enumerable:!0,get:function(){return w.default}})})(My);class Hx{constructor(w){this.map=w,this.contents=[]}add(w,A){var y;const R=`
    <div class="maplibregl-popup-layer-name">${A.sourceLayer}</div>
    <div class="maplibregl-popup-panel_area"><table class="maplibregl-popup-table">
    ${Object.keys(A.properties).map(v=>`<tr><th class="maplibregl-popup-th">${v.replace(/_/g," ").replace(/-/g," ")}</th><td class="maplibregl-popup-td">${A.properties[v]}</td></tr>`).join("")}
    </table></div>`;this.contents.push(R);let q;if(this.contents.length===1?q=this.contents[0]:q=`
      <div class="maplibregl-popup-tab_wrap">
      ${[...Array(this.contents.length).keys()].map(v=>(v+=1,`<input id="maplibregl-popup-tab${v}" type="radio" name="tab_btn" ${v===0?"checked":""}>`)).join("")}
      <div class="maplibregl-popup-tab_area">
      ${[...Array(this.contents.length).keys()].map(v=>(v+=1,`<label class="maplibregl-popup-tab${v}_label" for="maplibregl-popup-tab${v}">${v}</label>`)).join("")}
      </div>
      <div class="maplibregl-popup-panel_area">
      ${this.contents.map((v,ce)=>(ce+=1,`<div id="maplibregl-popup-panel${ce}" class="maplibregl-popup-tab_panel">${v}</div>`)).join("")}
      </div>
     </div>`,this.popup?this.popup.setHTML(q):this.popup=new qu.exports.Popup().setLngLat(w).setHTML(q).setMaxWidth("400px").addTo(this.map),this.contents.length>1){const v=document.getElementById("maplibregl-popup-tab1");v.checked=!0}const Y=this;(y=Y.popup)==null||y.on("close",function(){Y.popup=null,Y.contents=[]})}}class Kx{constructor(w=[]){this.targets=w}onAdd(w){return this.map=w,this.popupManager=new Hx(this.map),this.targets.length>0&&w.on("click",this.onClick.bind(this)),this.controlContainer=document.createElement("div"),this.controlContainer.className="maplibregl-ctrl maplibregl-ctrl-group",Object.assign(this.controlContainer,{style:"display:none"}),this.popupButton=document.createElement("button"),this.popupButton.className="maplibregl-ctrl-icon",this.popupButton.type="button",this.controlContainer.appendChild(this.popupButton),this.controlContainer}onClick(w){const A=[];this.targets.forEach(q=>{this.map.getLayer(q)&&A.push(q)}),this.map.queryRenderedFeatures(w.point,{layers:A}).forEach(q=>{var Y;(Y=this.popupManager)==null||Y.add(w.lngLat,q)})}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.popupButton||(this.controlContainer.parentNode.removeChild(this.controlContainer),this.map=void 0)}}function Jx(C){let w;return{c(){w=jp("div"),this.h()},l(A){w=Vp(A,"DIV",{class:!0,id:!0}),Np(w).forEach(Nu),this.h()},h(){$m(w,"class","map svelte-1jgeeqp"),$m(w,"id","map")},m(A,R){qp(A,w,R),C[1](w)},p:Zp,i:Zp,o:Zp,d(A){A&&Nu(w),C[1](null)}}}function Yx(C,w,A){let R,q;Xm(C,lf,Oe=>A(2,R=Oe)),Xm(C,t_,Oe=>A(3,q=Oe));const Y="maZk4SFzBeCf1DctFUW4 ";let y;Ug(async()=>{const Oe=new qu.exports.Map({container:y,style:`https://api.maptiler.com/maps/streets/style.json?key=${Y}`,center:[37.138,.414],zoom:4,hash:!1,attributionControl:!1});lf.update(()=>Oe),Oe.on("load",async()=>{await v(),await ce()})});const v=async()=>{R.addControl(new qu.exports.NavigationControl({}),"top-right"),R.addControl(new qu.exports.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-right"),R.addControl(new qu.exports.ScaleControl({maxWidth:80,unit:"metric"}),"bottom-left"),R.addControl(new qu.exports.AttributionControl({compact:!0}),"bottom-right");const{MaplibreExportControl:Oe}=await Yg(()=>import("./index-9fa87ce4.js").then(xe=>xe.i),["immutable/chunks/index-9fa87ce4.js","immutable/chunks/preload-helper-fc38b599.js","immutable/chunks/index-826da4b2.js"]);R.addControl(new Oe({Crosshair:!0,PrintableArea:!0}),"top-right"),R.addControl(new My.MaplibreLegendControl({},{showDefault:!0,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0}),"bottom-left");const Xe=R.getStyle().layers.map(xe=>xe.id);R.addControl(new Kx(Xe))},ce=async()=>{const Oe=q.url.searchParams.get("style");if(Oe){const xe=await(await fetch(Oe)).json();R.remove();const dt=new qu.exports.Map({container:y,style:xe,center:R.getCenter(),zoom:R.getZoom(),bearing:R.getBearing(),pitch:R.getPitch(),hash:!0,attributionControl:!1});xe.zoom&&dt.setZoom(xe.zoom),xe.bearing&&dt.setBearing(xe.bearing),xe.pitch&&dt.setPitch(xe.pitch),xe.center&&dt.setCenter(xe.center),lf.update(()=>dt),dt.on("load",async()=>{await v()})}};function Te(Oe){jg[Oe?"unshift":"push"](()=>{y=Oe,A(0,y)})}return[y,Te]}class Qx extends Ay{constructor(w){super(),zy(this,w,Yx,Jx,Cy,{})}}function e1(C){let w,A,R,q,Y,y,v;return y=new Qx({}),{c(){w=jp("sveltekit:head"),A=jp("title"),R=Vg(ky),q=Ng(),Y=jp("div"),qg(y.$$.fragment)},l(ce){w=Vp(ce,"SVELTEKIT:HEAD",{});var Te=Np(w);A=Vp(Te,"TITLE",{});var Oe=Np(A);R=Zg(Oe,ky),Oe.forEach(Nu),Te.forEach(Nu),q=Gg(ce),Y=Vp(ce,"DIV",{});var Xe=Np(Y);$g(y.$$.fragment,Xe),Xe.forEach(Nu)},m(ce,Te){qp(ce,w,Te),Wm(w,A),Wm(A,R),qp(ce,q,Te),qp(ce,Y,Te),Xg(y,Y,null),v=!0},p:Zp,i(ce){v||(Wg(y.$$.fragment,ce),v=!0)},o(ce){Hg(y.$$.fragment,ce),v=!1},d(ce){ce&&Nu(w),ce&&Nu(q),ce&&Nu(Y),Kg(y)}}}const ky="Sveltekit Maplibre boilerplate";class n1 extends Ay{constructor(w){super(),zy(this,w,null,e1,Cy,{})}}export{n1 as R,r1 as a,rh as c,Qg as g,qu as m};
